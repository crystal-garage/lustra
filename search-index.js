crystal_doc_search_index_callback({"repository_name":"lustra","body":"<p align=\"center\"><img src=\"design/logo.png\" alt=\"lustra\" height=\"200px\"></p>\n\n# Lustra\n\n![Crystal CI](https://github.com/crystal-garage/lustra/workflows/Crystal%20CI/badge.svg)\n[![GitHub release](https://img.shields.io/github/release/crystal-garage/lustra.svg)](https://github.com/crystal-garage/lustra/releases)\n[![License](https://img.shields.io/github/license/crystal-garage/lustra.svg)](https://github.com/crystal-garage/lustra/blob/develop/LICENSE)\n\n\nLustra is an ORM built specifically for PostgreSQL in Crystal.\n\nIt's probably the most advanced ORM for PG on Crystal in term of features offered.\nIt features Active Record pattern models, and low-level SQL builder.\n\nYou can deal out of the box with jsonb, tsvectors, cursors, CTE, bcrypt password,\narray, uuid primary key, foreign constraints... and other things !\nIt also has a powerful DSL to construct `where` and `having` clauses.\n\nThe philosophy beneath is to please me (and you !) with emphasis made on business\ncode readability and minimal setup.\n\nThe project is quite active and well maintened, too !\n\nLustra started as a fork of [Clear](https://github.com/anykeyh/clear) at version 0.8, and it is not compatible with later Clear releases. Over time it evolved into an independent project. To keep it compatible with newer Crystal versions, I continued development, added missing features, improved existing ones, and expanded test coverage. Today Lustra is far beyond its upstream origins — a distinct, mature project in its own right.\n\n## Why to use Lustra ?\n\nIn few seconds, you want to use Lustra if:\n\n- [x] You want an expressive ORM. Put straight your thought to your code !\n- [x] You'd like to use advanced Postgres features without hassle\n- [x] You are at aware of the pro and cons of Active Records pattern\n\nYou don't want to use Lustra if:\n\n- [ ] You're not willing to use on PostgreSQL\n- [ ] You look for a minimalist ORM / Data Mapper\n\n## Features\n\n- Active Record pattern based ORM\n- Expressiveness as mantra - even with advanced features like jsonb, regexp... -\n\n```crystal\n# Like ...\nProduct.query.where { ( type == \"Book\" ) & ( metadata.jsonb(\"author.full_name\") == \"Philip K. Dick\" ) }\n# ^--- will use @> operator, to relay on your gin index. For real.\n\nProduct.query.where { ( products.type == \"Book\" ) & ( products.metadata.jsonb(\"author.full_name\") != \"Philip K. Dick\" ) }\n# ^--- this time will use -> notation, because no optimizations possible :/\n\n# Or...\nUser.query.where { created_at.in? 5.days.ago .. 1.day.ago }\n\n# Or even...\nORM.query.where { ( description =~ /(^| )awesome($| )/i ) }.first!.name\n```\n\n## Core ORM Features\n\n**Model & Database Management**\n- Complete migration system with versioning and rollbacks\n- Comprehensive validation system with custom validators\n- Model lifecycle hooks (before/after callbacks for create, update, delete, validate, save)\n- Primary key support (auto-incrementing integers, UUIDs)\n- Timestamps (created_at, updated_at) with automatic touch functionality\n\n**Associations & Relations**\n- belongs_to, has_many, has_one relationships with full support\n- Through associations for complex relationships\n- Polymorphic associations and Single Table Inheritance (STI)\n- Counter cache with atomic updates and reset functionality\n- Touch functionality for automatic timestamp updates on related models\n\n**Query Interface**\n- Chainable and expressive query builder\n- Scopes for reusable query fragments with parameter support\n- Advanced WHERE clauses with complex conditions\n- JOIN operations (inner, left, right, full outer)\n- Subqueries and CTEs (Common Table Expressions)\n- Window functions and advanced SQL features\n- Pagination with limit/offset\n- Ordering and grouping\n- Aggregation functions (count, sum, avg, etc.)\n\n**Performance & Optimization**\n- N+1 query avoidance with eager loading\n- Query result caching\n- Database connection pooling\n- Lazy loading and batch processing\n- Query optimization and SQL analysis\n\n**Data Types & Storage**\n- Full PostgreSQL JSON and JSONB support with complex queries\n- Array columns (strings, integers, booleans)\n- UUID columns and primary keys\n- Enum support with type-safe database integration\n- Custom data type converters\n- Null handling and presence validation\n\n## Advanced Features\n\n**Full-Text Search**\n- PostgreSQL TSVector integration\n- Natural language query parsing\n- Weighted search with relevance scoring\n- Complex search operators (AND, OR, NOT, phrases)\n\n**Database Features**\n- Transaction support with rollback and savepoint\n- Database locking (optimistic and pessimistic)\n- Multiple database connections\n- Database views as models\n- Raw SQL execution when needed\n- Stored procedures and functions support\n\n**Developer Experience**\n- Comprehensive error messages and debugging\n- Query logging with colorized output\n- Crash reporting with last executed query\n- Compile-time type checking and validation\n- Intuitive API design following ActiveRecord conventions\n\n**Data Management**\n- Database seeding utilities\n- Model factories for testing\n- Bulk operations and batch processing\n- Data import/export capabilities\n\n### Installation\n\nIn `shards.yml`\n\n```yml\ndependencies:\n  lustra:\n    github: crystal-garage/lustra\n    branch: develop\n    version: \">= 0.12.0\"\n```\n\nThen:\n\n```crystal\nrequire \"lustra\"\n```\n\n### Database Setup\n\nInitialize your database connection:\n\n```crystal\nLustra::SQL.init(\"postgres://user:password@localhost/database_name\")\n```\n\nFor multiple database connections:\n\n```crystal\nLustra::SQL.init(\"readonly\", \"postgres://user:password@localhost/readonly_db\")\nLustra::SQL.init(\"primary\", \"postgres://user:password@localhost/primary_db\")\n```\n\n**Using specific connections:**\n\nAt the model level:\n\n```crystal\nclass ReadOnlyModel\n  include Lustra::Model\n\n  self.connection = \"readonly\" # All queries use readonly connection\n\n  column id : Int64, primary: true\n  column data : String\nend\n```\n\nAt the query level:\n\n```crystal\n# For model queries\nUser.query.use_connection(\"readonly\").where { active == true }\n\n# For raw SQL queries\nLustra::SQL.execute(\"readonly\", \"SELECT * FROM users\")\nLustra::SQL.select.from(\"users\").where { active == true }.use_connection(\"readonly\").to_a\n```\n\n### Model definition\n\nLustra offers some mixins, just include them in your classes:\n\n#### Column mapping\n\n```crystal\nclass User\n  include Lustra::Model\n\n  column id : Int64, primary: true\n\n  column email : String\n\n  column first_name : String?\n  column last_name : String?\n\n  column encrypted_password : Crypto::Bcrypt::Password\n\n  def password=(x)\n    self.encrypted_password = Crypto::Bcrypt::Password.create(password)\n  end\nend\n\n```\n\n#### Column types\n\n- `Number`, `String`, `Time`, `Boolean` and `Jsonb` structures are already mapped.\n- `Array` of primitives too.\n  For other type of data, just create your own converter !\n\n```crystal\nclass Lustra::Model::Converter::MyClassConversion\n  def self.to_column(x) : MyClass?\n    case x\n    when String\n      MyClass.from_string(x)\n    when Slice(UInt8)\n      MyClass.from_slice(x)\n    else\n      raise \"Cannot convert from #{x.class} to MyClass\"\n    end\n  end\n\n  def self.to_db(x : UUID?)\n    x.to_s\n  end\nend\n\nLustra::Model::Converter.add_converter(\"MyClass\", Lustra::Model::Converter::MyClassConversion)\n```\n\n##### Column presence\n\nMost of the ORM for Crystal are mapping column type as `Type | Nil` union.\nIt makes sens so we allow selection of some columns only of a model.\nHowever, this have a caveats: columns are still accessible, and will return nil,\neven if the real value of the column is not null !\n\nMoreover, most of the developers will enforce nullity only on their programming\nlanguage level via validation, but not on the database, leading to inconsistency.\n\nTherefore, we choose to throw exception whenever a column is accessed before\nit has been initialized and to enforce presence through the union system of\nCrystal.\n\nLustra offers this through the use of column wrapper.\nWrapper can be of the type of the column as in postgres, or in `UNKNOWN` state.\nThis approach offers more flexibility:\n\n```crystal\nUser.query.select(\"last_name\").each do |usr|\n  puts usr.first_name # Will raise an exception, as first_name hasn't been fetched.\nend\n\nu = User.new\nu.first_name_column.defined? # Return false\nu.first_name_column.value(\"\") # Call the value or empty string if not defined :-)\nu.first_name = \"bonjour\"\nu.first_name_column.defined? # Return true now !\n```\n\nWrapper give also some pretty useful features:\n\n```crystal\nu = User.new\nu.email = \"me@myaddress.com\"\nu.email_column.changed? # TRUE\nu.email_column.revert\nu.email_column.defined? # No more\n```\n\n#### Associations\n\nLustra offers `has_many`, `has_one`, `belongs_to` and `has_many through` associations:\n\n```crystal\nclass Security::Action\n  belongs_to role : Role\nend\n\nclass Security::Role\n  has_many user : User\nend\n\nclass User\n  include Lustra::Model\n\n  has_one user_info : UserInfo\n  has_many posts : Post\n\n  belongs_to role : Security::Role\n\n  # Use of the standard keys (users_id <=> security_role_id)\n  has_many actions : Security::Action, through: Security::Role\nend\n```\n\n### Querying\n\nLustra offers a collection system for your models. The collection system\ntakes origin to the lower API `Lustra::SQL`, used to build requests.\n\n#### Simple query\n\n##### Fetch a model\n\nTo fetch one model:\n\n```crystal\n# 1. Get the first user\nUser.query.first # Get the first user, ordered by primary key\n\n# Get a specific user by primary key\nUser.find!(1) # Returns user with id=1, or raises exception if not found\nUser.find(1)  # Returns user with id=1, or nil if not found\n\n# Find multiple users by array of IDs\nusers = User.find([1, 2, 3])    # Returns Array(User), may be partial if some IDs don't exist\nusers = User.find!([1, 2, 3])   # Raises error if ANY ID is not found\n\n# Find by other columns\nuser = User.find_by(email: \"test@example.com\")  # Returns nil if not found\nuser = User.find_by!(email: \"test@example.com\") # Raises error if not found\n\n# Find by multiple columns\nuser = User.find_by(first_name: \"John\", last_name: \"Doe\")\n\n# Using query with expression engine\nu : User? = User.query.find { email =~ /yacine/i }\n```\n\n##### Fetch multiple models\n\nTo prepare a collection, just use `Model#query`.\nCollections include `SQL::Select` object, so all the low level API\n(`where`, `where.not`, `where.or`, `join`, `group_by`, `lock`...) can be used in this context.\n\n```crystal\n# Basic filtering with where\nUser.query.where { (id >= 100) & (id <= 200) }.each do |user|\n  # Do something with user !\nend\n\n# Negative filtering with where.not\nUser.query.where.not { active == false }.each do |user|\n  # Get all users that are not inactive\nend\n\n# Chaining where, where.not, and where.or conditions\nUser.query\n  .where { active == true }\n  .not { role == \"admin\" }\n  .or(id: [1, 2, 3])\n  .each do |user|\n    # Complex filtering with chained conditions\n  end\n# Generated SQL:\n# SELECT * FROM \"users\" WHERE (((\"active\" = TRUE) AND NOT (\"role\" = 'admin')) OR \"id\" IN (1, 2, 3))\n\n# Check if any records exist\nif User.query.where { active == true }.exists?\n  puts \"There are active users!\"\nend\n\n# Extract specific column values\nuser_names = User.query.pluck_col(\"first_name\")\nuser_data = User.query.pluck(\"first_name\", \"last_name\")\n\n# Get array of IDs (shortcut for pluck_col primary key)\nactive_user_ids = User.query.where { active == true }.ids  # => [1, 2, 3, 4, 5]\n\n# Bulk update without loading models (bypasses validations and callbacks)\naffected = User.query.where { active == false }.update_all(status: \"inactive\")\nputs \"Updated #{affected} users\"\n\n# Update multiple columns at once\nUser.query.where { role == \"guest\" }.update_all(role: \"user\", verified: true)\n\n# In case you know there's millions of rows, use a cursor to avoid memory issues!\nUser.query.where { (id >= 1) & (id <= 20_000_000) }.each_cursor(batch: 100) do |user|\n  # Do something with user; only 100 users will be stored in memory\n  # This method is using pg cursor, so it's 100% transaction-safe\nend\n```\n\n##### JOIN operations\n\nLustra supports automatic join detection from associations, as well as manual joins with custom conditions.\n\n```crystal\nclass User\n  include Lustra::Model\n\n  has_many posts : Post\n  has_many categories : Category, through: Post\n  has_one info : UserInfo\nend\n\nclass Post\n  include Lustra::Model\n\n  belongs_to user : User\n  belongs_to category : Category\nend\n\nclass UserInfo\n  include Lustra::Model\n\n  belongs_to user : User\nend\n\nclass Category\n  include Lustra::Model\n\n  has_many posts : Post\n  has_many users : User, through: Post\nend\n```\n\n###### Auto-joins\n\nSimply pass the association name and Lustra will auto-detect the join conditions:\n\n```crystal\n# has_many association\nUser.query.join(:posts)\n# Equivalent to:\nUser.query.join(:posts) { posts.user_id == users.id }\n# SQL: `INNER JOIN \"posts\" ON (\"posts\".\"user_id\" = \"users\".\"id\")`\n\n# belongs_to association\nPost.query.join(:user)\n# Equivalent to:\nPost.query.join(:users) { posts.user_id == users.id }\n# SQL: `INNER JOIN \"users\" ON (\"posts\".\"user_id\" = \"users\".\"id\")`\n\n# has_one association\nUser.query.join(:info)\n# Equivalent to:\nUser.query.join(:user_infos) { user_infos.user_id == users.id }\n# SQL: `INNER JOIN \"user_infos\" ON (\"user_infos\".\"user_id\" = \"users\".\"id\")`\n\n# has_many through (automatically generates TWO joins!)\nUser.query.join(:categories)  # has_many :categories, through: Post\n# Equivalent to:\nUser.query\n  .join(:posts) { posts.user_id == users.id }\n  .join(:categories) { categories.id == posts.category_id }\n# SQL: `INNER JOIN \"posts\" ON (\"posts\".\"user_id\" = \"users\".\"id\")\n#      INNER JOIN \"categories\" ON (\"categories\".\"id\" = \"posts\".\"category_id\")`\n\n# All join types supported\nUser.query.left_join(:posts)\nUser.query.right_join(:posts)\nUser.query.full_outer_join(:posts)\nUser.query.inner_join(:posts)\n\n# Chaining joins\nPost.query\n  .join(:user)\n  .join(:category)\n  .where { (users.active == true) & (categories.name == \"Tech\") }\n# Equivalent to:\nPost.query\n  .join(:user) { posts.user_id == users.id }\n  .join(:categories) { posts.category_id == categories.id }\n  .where { (users.active == true) & (categories.name == \"Tech\") }\n```\n\n###### Manual joins with custom conditions\n\nFor complex joins or when you need custom conditions, use the block syntax:\n\n```crystal\n# Custom join condition\nUser.query.join(\"infos\") { infos.user_id == users.id }\n\n# Multiple joins with custom conditions\nPost.query\n  .join(\"users\") { users.id == posts.user_id }\n  .join(\"categories\") { categories.id == posts.category_id }\n  .where { users.active == true }\n\n# Mix auto-join and manual joins\nUser.query\n  .join(:posts)\n  .join(\"custom_table\") { custom_table.user_id == users.id }\n```\n\n##### Aggregate functions\n\nCall aggregate functions from the query is possible. For complex aggregation,\nI would recommend to use the `SQL::View` API (note: Not yet developed),\nand keep the model query for _fetching_ models only\n\n```crystal\n# count\nuser_on_gmail = User.query.where { email.ilike \"@gmail.com%\" }.count # Note: count return is Int64\n# min/max\nmax_id = User.query.where { email.ilike \"@gmail.com%\" }.max(\"id\", Int32)\n# your own aggregate\nweighted_avg = User.query.agg(\"SUM(performance_weight * performance_score) / SUM(performance_weight)\", Float64)\n```\n\n##### Fetching associations\n\nAssociations are basically getter which create predefined SQL.\nTo access to an association, just call it !\n\n```crystal\nUser.query.each do |user|\n  puts \"User #{user.id} posts:\"\n  user.posts.each do |post| # Works, but will trigger a request for each user.\n    puts \"• #{post.id}\"\n  end\nend\n```\n\n###### Caching association for N+1 request\n\nFor every association, you can tell Lustra to encache the results to avoid\nN+1 queries, using `with_XXX` on the collection:\n\n```crystal\n# Will call two requests only.\nUser.query.with_posts.each do |user|\n  puts \"User #{user.id} posts:\"\n  user.posts.each do |post|\n    puts \"• #{post.id}\"\n  end\nend\n```\n\nNote: For association eager loading (like `with_posts`), Lustra uses separate queries with the `IN` operator rather than JOINs for optimal performance.\n\nIn the case above:\n\n- The first request will be\n\n```sql\nSELECT * FROM users;\n```\n\n- Thanks to the cache, a second request will be called before fetching the users:\n\n```sql\nSELECT * FROM posts WHERE user_id IN ( SELECT id FROM users )\n```\n\nI have plan in a late future to offer different query strategies for the cache (e.g. joins, unions...)\n\n###### Associations caching examples\n\nWhen you use the caching system of the association, using filters on association will\ninvalidate the cache, and N+1 query will happens.\n\nFor example:\n\n```crystal\nUser.query.with_posts.each do |user|\n  puts \"User #{user.id} published posts:\"\n  # Here: The cache system will not work. The cache on association\n  # is invalidated by the filter `where`.\n  user.posts.where({published: true}).each do |post|\n    puts \"• #{post.id}\"\n  end\nend\n```\n\nThe way to fix it is to filter on the association itself:\n\n```crystal\nUser.query.with_posts(&.where({published: true})).each do |user|\n  puts \"User #{user.id} published posts:\"\n  # The posts collection of user is already encached with the published filter\n  user.posts.each do |post|\n    puts \"• #{post.id}\"\n  end\nend\n```\n\nNote than, of course in this example `user.posts` are not ALL the posts but only the\n`published` posts\n\nThanks to this system, we can stack it to encache long distance relations:\n\n```crystal\n# Will cache users<=>posts & posts<=>category\n# Total: 3 requests !\nUser.query.with_posts(&.with_category).each do |user|\n  #...\nend\n```\n\n##### Querying computed or foreign columns\n\nIn case you want columns computed by postgres, or stored in another table, you can use `fetch_column`.\nBy default, for performance reasons, `fetch_columns` option is set to false.\n\n```crystal\nusers = User.query.select(email: \"users.email\", remark: \"infos.remark\")\n  .join(\"infos\") { infos.user_id == users.id }.to_a(fetch_columns: true)\n\n# Now the column \"remark\" will be fetched into each user object.\n# Access can be made using `[]` operator on the model.\n\nusers.each do |u|\n  puts \"email: `#{u.email}`, remark: `#{u[\"remark\"]?}`\"\nend\n```\n\n### Scopes and Default Scopes\n\n#### Scopes\n\nScopes allow you to define reusable query fragments that make your code more readable and maintainable:\n\n```crystal\nclass Post\n  include Lustra::Model\n\n  column title : String\n  column published : Bool\n  column view_count : Int32\n\n  # Simple scope\n  scope(\"published\") { where(published: true) }\n\n  # Scope with parameter\n  scope(\"popular\") { |min_views| where { view_count >= min_views } }\n\n  # Scope that chains multiple conditions\n  scope(\"recent\") { where { created_at > 7.days.ago }.order_by(created_at: :desc) }\nend\n\n# Usage\nPost.published                    # All published posts\nPost.popular(100)                 # Posts with 100+ views\nPost.published.recent             # Published posts from last 7 days\nPost.published.popular(50).first  # Most popular published post\n```\n\n#### Default Scopes\n\nDefault scopes automatically apply conditions to **all** queries on a model. This is particularly useful for soft deletes and multi-tenancy:\n\n```crystal\nclass Post\n  include Lustra::Model\n\n  column title : String\n  column deleted_at : Time?\n\n  # This filter is applied to ALL queries automatically\n  default_scope { where { deleted_at == nil } }\nend\n\n# All these queries automatically exclude deleted posts:\nPost.find(1)          # WHERE id = 1 AND deleted_at IS NULL\nPost.query.first      # WHERE deleted_at IS NULL ORDER BY id LIMIT 1\nPost.query.where(...) # WHERE ... AND deleted_at IS NULL\n\n# To bypass the default scope when needed:\nPost.query.unscoped.count      # Count all posts including deleted\nPost.query.unscoped.first      # Get first record ignoring scope\nPost.query.unscoped.where(...) # Build query without default scope\n```\n\n**Warning:** Default scopes can be confusing because they're implicit. Use them sparingly and document them clearly. Always provide an `unscoped` escape hatch when you need to bypass them.\n\n### Inspection & SQL logging\n\n#### Inspection\n\n`inspect` over model offers debugging insights:\n\n```text\np # => #<Post:0x10c5f6720\n        @attributes={},\n        @cache=\n         #<Lustra::Model::QueryCache:0x10c6e8100\n          @cache={},\n          @cache_activation=Set{}>,\n        @content_column=\n         \"...\",\n        @errors=[],\n        @id_column=38,\n        @persisted=true,\n        @published_column=true,\n        @read_only=false,\n        @title_column=\"Lorem ipsum torquent inceptos\"*,\n        @user_id_column=5>\n```\n\nIn this case, the `*` means a column is changed and the object is dirty and diverge from the database.\n\n#### Query Performance Analysis\n\nLustra provides PostgreSQL `EXPLAIN` support to analyze and optimize your queries:\n\n```crystal\n# Get query execution plan (doesn't modify data, but may read for planning)\nplan = User.query.where { active == true }.explain\nputs plan\n# Output:\n# Seq Scan on users  (cost=0.00..35.50 rows=10 width=116)\n#   Filter: (active = true)\n\n# Get actual execution statistics (RUNS the query)\nplan = User.query.where { active == true }.join(:posts).explain_analyze\nputs plan\n# Output includes:\n# - Actual execution time\n# - Rows processed\n# - Memory usage\n# - Index usage details\n# - Join algorithms used\n\n# Optimize complex queries\nslow_query = Post.query\n  .join(:user)\n  .join(:category)\n  .where { published == true }\n  .order_by(created_at: :desc)\n\n# Analyze to find bottlenecks\nputs slow_query.explain_analyze\n\n# Use insights to add indexes, rewrite query, etc.\n```\n\n**Common use cases:**\n- **Finding missing indexes**: Look for \"Seq Scan\" on large tables\n- **Understanding join performance**: See which join algorithms are used\n- **Debugging slow queries**: Get actual timing and row counts\n- **Capacity planning**: Understand query costs before deploying\n\n**Difference between `explain` and `explain_analyze`:**\n\n| Method | Modifies Data | Shows Actual Stats | Use When |\n|--------|---------------|-------------------|----------|\n| `explain` | No | No (estimated) | Safe for all queries, get execution plan |\n| `explain_analyze` | Yes* | Yes (actual) | Need actual performance data |\n\n- `explain` is safe - shows estimated plan without modifying data\n- `explain_analyze` EXECUTES the query fully, including INSERT/UPDATE/DELETE\n- For write operations with `explain_analyze`, wrap in a transaction with rollback if testing\n\n**Safe pattern for testing write operations:**\n\n```crystal\n# Analyze a DELETE or UPDATE without permanently modifying data\nLustra::SQL.transaction do\n  plan = User.query.where { inactive == true }.to_delete.explain_analyze\n  puts plan # See actual execution statistics\n\n  # Rollback to undo changes\n  raise Lustra::SQL::RollbackError.new\nend\n\n# Data is unchanged - safe for production analysis!\n```\n\n#### SQL Logging\n\nOne thing very important for a good ORM is to offer vision of the SQL\ncalled under the hood.\nLustra is offering SQL logging tools, with SQL syntax colorizing in your terminal.\n\nFor activation, simply setup the logger to `DEBUG` level !\n\n```crystal\nLog.builder.bind \"lustra.*\", :debug, Log::IOBackend.new(STDOUT)\n```\n\n### Save & validation\n\n#### Save\n\nObject can be persisted, saved, updated:\n\n```crystal\nu = User.new\nu.email = \"test@example.com\"\nu.save! # Save or throw if unsavable (validation failed).\n```\n\n##### Attribute Change Tracking\n\nLustra automatically tracks changes to model attributes:\n\n```crystal\nuser = User.create!({first_name: \"John\", last_name: \"Doe\", email: \"john@test.com\"})\n\n# Make some changes\nuser.first_name = \"Jane\"\nuser.email = \"jane@test.com\"\n\n# Get change for specific attribute as {old, new} tuple\nuser.first_name_column.change # => {\"John\", \"Jane\"}\nuser.email_column.change      # => {\"john@test.com\", \"jane@test.com\"}\nuser.last_name_column.change  # => nil (not changed)\n\n# Get all changes at once\nuser.changes\n# => {\"first_name\" => {\"John\", \"Jane\"}, \"email\" => {\"john@test.com\", \"jane@test.com\"}}\n\n# Get list of changed attribute names\nuser.changed # => [\"first_name\", \"email\"]\n\n# After saving, changes are cleared\nuser.save!\nuser.changed # => []\nuser.changes # => {}\n```\n\n**Column-level access:**\n\n```crystal\n# Access change tracking via column objects\nuser.email_column.changed?  # Check if changed\nuser.email_column.old_value # Get raw old value\nuser.email_column.change    # Get {old, new} tuple (nil if not changed)\nuser.email_column.revert    # Revert to old value\n```\n\n##### Atomic Counter Updates\n\nIncrement or decrement numeric columns atomically without running validations or callbacks:\n\n```crystal\n# Increment/decrement with immediate save (bypasses validations and callbacks)\nuser.increment!(:login_count)        # Increment by 1\nuser.increment!(:score, 10)          # Increment by custom amount\nuser.decrement!(:attempts_left)      # Decrement by 1\nuser.decrement!(:balance, 5.5)       # Decrement by custom amount\n\n# Increment/decrement in-memory only (requires save! to persist)\nuser.increment(:login_count)\nuser.decrement(:attempts_left, 2)\nuser.save!  # Persist both changes together\n\n# Thread-safe atomic updates (using SQL: SET column = column + amount)\nuser.increment!(:view_count)  # Safe for concurrent requests\n```\n\nThe `!` versions update the database immediately using atomic SQL operations, making them thread-safe for counters like views, likes, or login counts.\n\n##### Direct Column Updates\n\nUpdate columns directly without running validations or callbacks. Useful for performance-critical updates when you know the data is valid:\n\n```crystal\n# Update single column (bypasses validations, callbacks, and timestamp updates)\nuser.update_column(:login_count, 10)\nuser.update_column(:last_login_at, Time.utc)\n\n# Update multiple columns at once\nuser.update_columns(login_count: 5, status: \"active\", verified: true)\n\n# With NamedTuple or Hash\nuser.update_columns({admin: true, role: \"superuser\"})\n```\n\n**Warning:** `update_column` and `update_columns` bypass:\n- Validations\n- Callbacks (before/after hooks)\n- Automatic timestamp updates (`updated_at` will NOT change)\n\nUse these methods only when you need raw performance and are certain the data is valid.\n\n##### Deleting Records\n\nLustra provides two ways to delete records:\n\n```crystal\n# delete - Fast deletion WITHOUT callbacks (just removes from DB)\nuser.delete\nuser.persisted? # => false\n\n# destroy - Safe deletion WITH callbacks (triggers before/after :destroy hooks)\nuser.destroy\nuser.persisted? # => false\n\n# Bulk operations on collections\nUser.query.where { active == false }.delete_all   # Fast bulk delete, NO callbacks\nUser.query.where { active == false }.destroy_all  # Loads each record, calls destroy, HAS callbacks\n```\n\n**Example with callbacks:**\n\n```crystal\nclass Post\n  include Lustra::Model\n\n  belongs_to user : User, counter_cache: true\n\n  after(:destroy) do |model|\n    post = model.as(Post)\n    # Clean up associated data\n    Comment.query.where(post_id: post.id).delete_all\n  end\nend\n\n# This will trigger the callback and clean up comments\npost.destroy\n\n# This will NOT trigger callbacks - comments remain orphaned\npost.delete\n```\n\n#### Validation\n\n##### Presence validator\n\nPresence validator is done using the type of the column:\n\n```crystal\nclass User\n  include Lustra::Model\n\n  column first_name : String # Must be present\n  column last_name : String? # Can be null\nend\n```\n\n###### `NOT NULL DEFAULT ...` CASE\n\nThere's a case when a column CAN be null inside Crystal, if not persisted,\nbut CANNOT be null inside Postgres.\n\nIt's for example the case of the `id` column, which take value after saving !\n\nIn this case, you can write:\n\n```crystal\nclass User\n  column id : Int64, primary: true, presence: false # id will be set using pg serial !\nend\n```\n\nThus, in all case this will fail:\n\n```crystal\nu = User.new\nu.id # raise error\n```\n\n##### Other validators\n\nWhen you save your model, Lustra will call first the presence validators, then\ncall your custom made validators. All you have to do is to reimplement\nthe `validate` method:\n\n```crystal\nclass MyModel\n  #...\n  def validate\n    # Your code goes here\n  end\nend\n```\n\nValidation fails if `model#errors` is not empty:\n\n```crystal\nclass MyModel\n  #...\n  def validate\n    if first_name_column.defined? && first_name != \"ABCD\" # < See below why `defined?` must be called.\n      add_error(\"first_name\", \"must be ABCD!\")\n    end\n  end\nend\n```\n\n##### Unique validator\n\nPlease use `unique` feature of postgres. Unique validator at crystal level is a\nnon-go and lead to terrible race concurrency issues if your deploy on multiple nodes/pods.\nIt's an anti-pattern and must be avoided at any cost.\n\n##### The validation and the presence system\n\nIn the case you try validation on a column which has not been initialized,\nLustra will complain, telling you you cannot access to the column.\nLet's see an example here:\n\n```crystal\nclass MyModel\n  #...\n  def validate\n    add_error(\"first_name\", \"should not be empty\") if first_name == \"\"\n  end\nend\n\nMyModel.new.save! # < Raise unexpected exception, not validation failure :(\n```\n\nThis validator will raise an exception, because first_name has never been initialized.\nTo avoid this, we have many way:\n\n```crystal\n# 1. Check presence:\ndef validate\n  if first_name_column.defined? # Ensure we have a value here.\n    add_error(\"first_name\", \"should not be empty\") if first_name == \"\"\n  end\nend\n\n# 2. Use column object + default value\ndef validate\n  add_error(\"first_name\", \"should not be empty\") if first_name_column.value(\"\") == \"\"\nend\n\n# 3. Use the helper macro `on_presence`\ndef validate\n  on_presence(first_name) do\n    add_error(\"first_name\", \"should not be empty\") if first_name == \"\"\n  end\nend\n\n# 4. Use the helper macro `ensure_than`\ndef validate\n  ensure_than(first_name, \"should not be empty\", &.!=(\"\"))\nend\n\n# 5. Use the `ensure_than` helper (but with block notation) !\ndef validate\n  ensure_than(first_name, \"should not be empty\") do |column|\n    column != \"\"\n  end\nend\n\n```\n\nI recommend the 4th method in most of the cases you will faces.\nSimple to write and easy to read !\n\n#### Lifecycle Callbacks\n\nLustra provides a comprehensive callback system to hook into model lifecycle events. Callbacks allow you to execute code at specific points during a model's lifecycle.\n\n##### Available Callback Events\n\n- `:validate` - Triggered during validation\n- `:save` - Triggered for any save operation (wraps create/update)\n- `:create` - Triggered when a new record is inserted\n- `:update` - Triggered when an existing record is updated\n- `:destroy` - Triggered when a record is destroyed (via `destroy` method, not `delete`)\n\n##### Callback Directions\n\n- `before` - Executed before the event\n- `after` - Executed after the event\n\n##### Basic Usage\n\n```crystal\nclass User\n  include Lustra::Model\n\n  column email : String\n  column name : String\n\n  # Block syntax\n  before(:validate) do |model|\n    user = model.as(User)\n    user.email = user.email.downcase\n  end\n\n  after(:create) do |model|\n    user = model.as(User)\n    puts \"New user created: #{user.first_name}\"\n  end\n\n  # Method syntax (cleaner for complex logic - auto-casts for you)\n  before(:save, :normalize_email)\n  after(:destroy, :cleanup_user_data)\n\n  def normalize_email\n    self.email = email.strip.downcase\n  end\n\n  def cleanup_user_data\n    # Custom cleanup logic\n    puts \"User #{id} deleted, cleaning up...\"\n  end\nend\n```\n\n##### Callback Execution Order\n\n**Before callbacks:** Last defined → First defined (reverse order)\n```crystal\nbefore(:save) { puts \"1\" }\nbefore(:save) { puts \"2\" }\nbefore(:save) { puts \"3\" }\n# Execution order: 3, 2, 1\n```\n\n**After callbacks:** First defined → Last defined (normal order)\n```crystal\nafter(:save) { puts \"1\" }\nafter(:save) { puts \"2\" }\nafter(:save) { puts \"3\" }\n# Execution order: 1, 2, 3\n```\n\n##### Common Patterns\n\n**Sanitizing data before validation:**\n```crystal\nbefore(:validate) do |model|\n  user = model.as(User)\n  user.email = user.email.strip.downcase if user.email_column.defined?\nend\n```\n\n**Sending notifications after creation:**\n```crystal\nafter(:create) do |model|\n  user = model.as(User)\n  WelcomeMailer.send(user.email)\nend\n```\n\n**Cleanup after deletion:**\n```crystal\nafter(:destroy) do |model|\n  user = model.as(User)\n  FileStorage.delete(user.avatar_path) if user.avatar_path\nend\n```\n\n**Auditing changes:**\n```crystal\nafter(:update) do |model|\n  user = model.as(User)\n  AuditLog.create!(\n    model_type: \"User\",\n    model_id: user.id,\n    action: \"update\"\n  )\nend\n```\n\n##### Callbacks with Associations\n\nCallbacks work seamlessly with associations like `counter_cache` and `touch`:\n\n```crystal\nclass Post\n  include Lustra::Model\n\n  belongs_to user : User, counter_cache: true  # Uses after(:create) and after(:destroy)\n  belongs_to category : Category, touch: true   # Uses after(:create) and after(:update)\nend\n```\n\nThe `counter_cache` automatically registers `after(:create)` and `after(:destroy)` callbacks to increment/decrement the counter on the parent model.\n\n### Migration\n\nLustra offers of course a migration system.\n\nMigration should have an `order` column set.\nThis number can be wrote at the end of the class itself:\n\n```crystal\nclass Migration1\n  include Lustra::Migration\n\n  def change(dir)\n    #...\n  end\nend\n```\n\n#### Using filename\n\nAnother way is to write down all your migrations one file per migration, and\nnaming the file using the `[number]_migration_description.cr` pattern.\nIn this case, the migration class name doesn't need to have a number at the end of the class name.\n\n```crystal\n# in src/db/migrations/1234_create_table.cr\nclass CreateTable\n  include Lustra::Migration\n\n  def change(dir)\n    #...\n  end\nend\n```\n\n#### Migration examples\n\nMigration must implement the method `change(dir : Migration::Direction)`\n\nDirection is the current direction of the migration (up or down).\nIt provides few methods: `up?`, `down?`, `up(&block)`, `down(&block)`\n\nYou can create a table:\n\n```crystal\ndef change(dir)\n  create_table(:test) do |t|\n    t.column :first_name, :string, index: true\n    t.column :last_name, :string, unique: true\n\n    t.index \"lower(first_name || ' ' || last_name)\", using: :btree\n\n    t.timestamps\n  end\nend\n```\n\n#### Constraints\n\nI strongly encourage to use the foreign key constraints of postgres for your references:\n\n```crystal\nt.references to: \"users\", on_delete: \"cascade\", null: false\n```\n\nThere's no plan to offer on Crystal level the `on_delete` feature, like\n`dependent` in ActiveRecord. That's a standard PG feature, just set it\nup in migration\n\n## Licensing\n\nThis shard is provided under the MIT license.\n\n## Contribution\n\nAll contributions are welcome ! As a specialized ORM for PostgreSQL,\nbe sure a great contribution on a very specific PG feature will be incorporated\nto this shard.\nI hope one day we will cover all the features of PG here !\n\n### Running Tests\n\nIn order to run the test suite, you will need to have the PostgresSQL service locally available via a socket for access with psql. psql will attempt to use the 'postgres' user to create the test database. If you are working with a newly installed database that may not have the postgres user, this can be created with `createuser -s postgres`.\n","program":{"html_id":"lustra/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"lustra","program":true,"enum":false,"alias":false,"const":false,"constants":[{"id":"ARRAY_TYPEMAP","name":"ARRAY_TYPEMAP","value":"{\"Bool\" => \"boolean[]\", \"String\" => \"text[]\", \"Float32\" => \"real[]\", \"Float64\" => \"double precision[]\", \"Int32\" => \"int[]\", \"Int64\" => \"bigint[]\"}"},{"id":"ARRAY_VALUES","name":"ARRAY_VALUES","value":"{\n  bool: Bool,\n  s: String,\n  f32: Float32,\n  f: Float64,\n  i: Int32,\n  i64: Int64,\n}"}],"macros":[{"html_id":"columns_to_instance_vars-macro","name":"columns_to_instance_vars","doc":"Used internally to deserialise json","summary":"<p>Used internally to deserialise json</p>","abstract":false,"location":{"filename":"src/lustra/model/json_deserialize.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/json_deserialize.cr#L19"},"def":{"name":"columns_to_instance_vars","visibility":"Public","body":"  \n# :nodoc:\n\n  struct Assigner\n    include JSON::Serializable\n\n    \n{% for name, settings in COLUMNS %}\n      @[JSON::Field(presence: true)]\n      getter {{ name.id }} : {{ settings[:type] }} {% unless settings[:type].resolve.nilable? %} | Nil {% end %}\n      @[JSON::Field(ignore: true)]\n      getter? {{ name.id }}_present : Bool\n    {% end %}\n\n\n    \n# Create a new empty model and fill the columns with object's instance variables\n\n    \n# Trusted flag set to true will allow mass assignment without protection\n\n    def create(trusted : Bool)\n      assign_columns(\n{{ @type }}\n.new, trusted)\n    \nend\n\n    \n# Update the inputted model and assign the columns with object's instance variables\n\n    \n# Trusted flag set to true will allow mass assignment without protection\n\n    def update(model, trusted : Bool)\n      assign_columns(model, trusted)\n    \nend\n\n    macro finished\n      \n# Assign properties to the model inputted with object's instance variables\n\n      \n# Trusted flag set to true will allow mass assignment without protection\n\n      protected def assign_columns(model, trusted : Bool)\n        \n{% for name, settings in COLUMNS %}\n          if ({{ settings[:mass_assign] }} || trusted) && self.{{ name.id }}_present?\n            %value = self.{{ name.id }}\n            {% if settings[:type].resolve.nilable? %}\n              model.{{ name.id }} = %value\n            {% else %}\n              model.{{ name.id }} = %value unless %value.nil?\n            {% end %}\n          end\n        {% end %}\n\n\n        model\n      \nend\n    \nend\n  \nend\n\n  \n# Create a new empty model and fill the columns from json. Returns the new model\n\n  \n#\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def self.from_json(string_or_io : String | IO, trusted : Bool = false)\n    Assigner.from_json(string_or_io).create(trusted)\n  \nend\n\n  \n# Create a new model from json and save it. Returns the model.\n\n  \n#\n\n  \n# The model may not be saved due to validation failure;\n\n  \n# check the returned model `errors?` and `persisted?` flags.\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def self.create_from_json(string_or_io : String | IO, trusted : Bool = false)\n    mdl = self.from_json(string_or_io, trusted)\n    mdl.save\n    mdl\n  \nend\n\n  \n# Create a new model from json and save it. Returns the model.\n\n  \n#\n\n  \n# Returns the newly inserted model\n\n  \n# Raises an exception if validation failed during the saving process.\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def self.create_from_json!(string_or_io : String | IO, trusted : Bool = false)\n    self.from_json(string_or_io, trusted).save!\n  \nend\n\n  \n# Set the fields from json passed as argument\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def set_from_json(string_or_io : String | IO, trusted : Bool = false)\n    Assigner.from_json(string_or_io).update(self, trusted)\n  \nend\n\n  \n# Set the fields from json passed as argument and call `save` on the object\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def update_from_json(string_or_io : String | IO, trusted : Bool = false)\n    mdl = set_from_json(string_or_io, trusted)\n    mdl.save\n    mdl\n  \nend\n\n  \n# Set the fields from json passed as argument and call `save!` on the object\n\n  \n# Trusted flag set to true will allow mass assignment without protection, FALSE by default\n\n  def update_from_json!(string_or_io : String | IO, trusted : Bool = false)\n    set_from_json(string_or_io, trusted).save!\n  \nend\n\n"}}],"types":[{"html_id":"lustra/BigDecimal","path":"BigDecimal.html","kind":"struct","full_name":"BigDecimal","name":"BigDecimal","abstract":false,"superclass":{"html_id":"lustra/Number","kind":"struct","full_name":"Number","name":"Number"},"ancestors":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Number","kind":"struct","full_name":"Number","name":"Number"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Steppable","kind":"module","full_name":"Steppable","name":"Steppable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/core_ext.cr","line_number":121,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L121"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"}],"doc":"A `BigDecimal` can represent arbitrarily large precision decimals.\n\nIt is internally represented by a pair of `BigInt` and `UInt64`: value and scale.\nValue contains the actual value, and scale tells the decimal point place.\nE.g. when value is `1234` and scale `2`, the result is `12.34`.\n\nNOTE: To use `BigDecimal`, you must explicitly import it with `require \"big\"`\n\nThe general idea and some of the arithmetic algorithms were adapted from\nthe MIT/APACHE-licensed [bigdecimal-rs](https://github.com/akubera/bigdecimal-rs).","summary":"<p>A <code><a href=\"BigDecimal.html\">BigDecimal</a></code> can represent arbitrarily large precision decimals.</p>","instance_methods":[{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/extensions/core_ext.cr","line_number":122,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L122"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(to_s)"},"external_var":false}]},{"html_id":"lustra/Char","path":"Char.html","kind":"struct","full_name":"Char","name":"Char","abstract":false,"superclass":{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},"ancestors":[{"html_id":"lustra/Steppable","kind":"module","full_name":"Steppable","name":"Steppable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"lib/inflector/src/inflector/string.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/lib/inflector/src/inflector/string.cr#L4"},{"filename":"src/lustra/extensions/core_ext.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Steppable","kind":"module","full_name":"Steppable","name":"Steppable"}],"doc":"A `Char` represents a [Unicode](http://en.wikipedia.org/wiki/Unicode) [code point](http://en.wikipedia.org/wiki/Code_point).\nIt occupies 32 bits.\n\nIt is created by enclosing an UTF-8 character in single quotes.\n\n```\n'a'\n'z'\n'0'\n'_'\n'あ'\n```\n\nYou can use a backslash to denote some characters:\n\n```\n'\\'' # single quote\n'\\\\' # backslash\n'\\e' # escape\n'\\f' # form feed\n'\\n' # newline\n'\\r' # carriage return\n'\\t' # tab\n'\\v' # vertical tab\n```\n\nYou can use a backslash followed by an *u* and four hexadecimal characters to denote a unicode codepoint written:\n\n```\n'\\u0041' # == 'A'\n```\n\nOr you can use curly braces and specify up to four hexadecimal numbers:\n\n```\n'\\u{41}' # == 'A'\n```\n\nSee [`Char` literals](https://crystal-lang.org/reference/syntax_and_semantics/literals/char.html) in the language reference.","summary":"<p>A <code><a href=\"Char.html\">Char</a></code> represents a <a href=\"http://en.wikipedia.org/wiki/Unicode\">Unicode</a> <a href=\"http://en.wikipedia.org/wiki/Code_point\">code point</a>.</p>","instance_methods":[{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/extensions/core_ext.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L6"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(\"#{self}\")"},"external_var":false}]},{"html_id":"lustra/Citext","path":"Citext.html","kind":"struct","full_name":"Citext","name":"Citext","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/citext/citext.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"doc":"Represents a case insensitive text, used by Postgres\nWrap a string and basically change the equality check to make it case insensitive.s","summary":"<p>Represents a case insensitive text, used by Postgres Wrap a string and basically change the equality check to make it case insensitive.s</p>","constructors":[{"html_id":"new(string:String)-class-method","name":"new","abstract":false,"args":[{"name":"string","external_name":"string","restriction":"::String"}],"args_string":"(string : String)","args_html":"(string : String)","location":{"filename":"src/lustra/extensions/citext/citext.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L8"},"def":{"name":"new","args":[{"name":"string","external_name":"string","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(string)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"!=(x:String|Citext)-instance-method","name":"!=","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String | Citext"}],"args_string":"(x : String | Citext)","args_html":"(x : String | <a href=\"Citext.html\">Citext</a>)","location":{"filename":"src/lustra/extensions/citext/citext.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L15"},"def":{"name":"!=","args":[{"name":"x","external_name":"x","restriction":"String | Citext"}],"visibility":"Public","body":"!(self == x)"},"external_var":false},{"html_id":"==(x:String|Citext)-instance-method","name":"==","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String | Citext"}],"args_string":"(x : String | Citext)","args_html":"(x : String | <a href=\"Citext.html\">Citext</a>)","location":{"filename":"src/lustra/extensions/citext/citext.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L11"},"def":{"name":"==","args":[{"name":"x","external_name":"x","restriction":"String | Citext"}],"visibility":"Public","body":"(compare(x.to_s, true)) == 0"},"external_var":false},{"html_id":"string:String-instance-method","name":"string","abstract":false,"location":{"filename":"src/lustra/extensions/citext/citext.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L4"},"def":{"name":"string","return_type":"String","visibility":"Public","body":"@string"},"external_var":false}],"macros":[{"html_id":"method_missing(call)-macro","name":"method_missing","abstract":false,"args":[{"name":"call","external_name":"call","restriction":""}],"args_string":"(call)","args_html":"(call)","location":{"filename":"src/lustra/extensions/citext/citext.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/citext/citext.cr#L6"},"def":{"name":"method_missing","args":[{"name":"call","external_name":"call","restriction":""}],"visibility":"Public","body":"      @string.\n{{ call }}\n\n    \n"}}]},{"html_id":"lustra/Lustra","path":"Lustra.html","kind":"module","full_name":"Lustra","name":"Lustra","abstract":false,"locations":[{"filename":"src/lustra/cli.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L9"},{"filename":"src/lustra/extensions/enum/enum.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L1"},{"filename":"src/lustra/log.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/log.cr#L3"},{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L24"},{"filename":"src/lustra/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/seed.cr#L1"},{"filename":"src/lustra/sql/lock.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/lock.cr#L1"},{"filename":"src/lustra/sql/sql.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L19"},{"filename":"src/lustra/sql/truncate.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/truncate.cr#L1"},{"filename":"src/lustra/version.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/version.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"lustra\")"},{"id":"VERSION","name":"VERSION","value":"{{ (`shards version /home/runner/work/lustra/lustra/src/lustra`).chomp.stringify }}"}],"class_methods":[{"html_id":"apply_seeds-class-method","name":"apply_seeds","abstract":false,"location":{"filename":"src/lustra/seed.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/seed.cr#L12"},"def":{"name":"apply_seeds","visibility":"Public","body":"Lustra::SQL.transaction do @@seed_list.each(&.call) end"},"external_var":false},{"html_id":"seed(&block)-class-method","name":"seed","doc":"Register a seed block.\nthis block will be called by `Lustra.apply_seeds`\nor conveniently by the CLI\nusing `$cli_cmd migrate seeds`","summary":"<p>Register a seed block.</p>","abstract":false,"location":{"filename":"src/lustra/seed.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/seed.cr#L8"},"def":{"name":"seed","yields":0,"block_arity":0,"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"@@seed_list << block"},"external_var":false},{"html_id":"with_cli(&)-class-method","name":"with_cli","doc":"Check for the CLI. If the CLI is not triggered, yield the block passed as parameter","summary":"<p>Check for the CLI.</p>","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L32"},"def":{"name":"with_cli","yields":0,"block_arity":0,"visibility":"Public","body":"if ARGV.size > 0 && (ARGV[0] == \"lustra\")\n  ARGV.shift\n  Lustra::CLI.run\nelse\n  yield\nend"},"external_var":false}],"macros":[{"html_id":"enum(name,*values,&block)-macro","name":"enum","doc":"## Enum\n\nLustra offers full support of postgres enum strings.\n\n### Example\n\nLet's say you need to define an enum for genders:\n\n```\n# Define the enum\nLustra.enum MyApp::Gender, \"male\", \"female\" # , ...\n```\n\nIn migration, we tell Postgres about the enum:\n\n```\ncreate_enum :gender, MyApp::Gender # < Create the new type `gender` in the database\n\ncreate_table :users do |t|\n  # ...\n  t.gender \"gender\" # < first `gender` is the type of column, while second is the name of the column\nend\n```\n\nFinally in your model, simply add the enum as column:\n\n```\nclass User\n  include Lustra::Model\n  # ...\n\n  column gender : MyApp::Gender\nend\n```\n\nNow, you can assign the enum:\n\n```\nu = User.new\nu.gender = MyApp::Gender::Male\n```\n\nYou can dynamically check and build the enumeration values:\n\n```\nMyApp::Gender.authorized_values # < return [\"male\", \"female\"]\nMyApp::Gender.all               # < return [MyApp::Gender::Male, MyApp::Gender::Female]\n\nMyApp::Gender.from_string(\"male\")    # < return MyApp::Gender::Male\nMyApp::Gender.from_string(\"unknown\") # < throw Lustra::IllegalEnumValueError\n\nMyApp::Gender.valid?(\"female\")  # < Return true\nMyApp::Gender.valid?(\"unknown\") # < Return false\n```\n\nHowever, you cannot write:\n\n```\nu = User.new\nu.gender = \"male\"\n```\n\nBut instead:\n\n```\nu = User.new\nu.gender = MyApp::Gender::Male\n```","summary":"<h2><a id=\"enum\" class=\"anchor\" href=\"#enum\">  <svg class=\"octicon-link\" aria-hidden=\"true\">\n    <use href=\"#octicon-link\"/>\n  </svg>\n</a>Enum</h2>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"values","external_name":"values","restriction":""}],"args_string":"(name, *values, &block)","args_html":"(name, *values, &block)","location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":113,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L113"},"def":{"name":"enum","args":[{"name":"name","external_name":"name","restriction":""},{"name":"values","external_name":"values","restriction":""}],"splat_index":1,"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"    struct \n{{ name.id }}\n < ::Lustra::Enum\n      \n{% for i in values %}\n        {{ i.camelcase.id }} = {{ name.id }}.new(\"{{ i.id }}\")\n      {% end %}\n\n\n      \n{% if true %}\n        AUTHORIZED_VALUES = {\n        {% for i in values %}\n          \"{{ i.id }}\" => {{ i.camelcase.id }},\n        {% end %}\n        }\n      {% end %}\n\n\n      \n# Return the enum with the string passed as parameter.\n\n      \n# Throw Lustra::IllegalEnumValueError if the string is not found.\n\n      def self.from_string(str : String)\n        AUTHORIZED_VALUES[str]? || raise ::Lustra::IllegalEnumValueError.new(\"Illegal enum value for `#{self.class}`: '#{str}'\")\n      \nend\n\n      \n# Return the list of authorized values\n\n      def self.authorized_values\n        AUTHORIZED_VALUES.keys\n      \nend\n\n      def self.all\n        AUTHORIZED_VALUES.values\n      \nend\n\n      def self.valid?(x)\n        AUTHORIZED_VALUES[x]?\n      \nend\n\n      macro finished\n        module ::Lustra::Model::Converter::\n\\{\n{@type}}Converter\n          def self.to_column(x) : ::\n\\{\n{@type}}?\n            case x\n            when Nil\n              nil\n            when ::\n\\{\n{@type}}\n              x\n            when String\n              ::\n\\{\n{@type}}.from_string(x)\n            when Slice(UInt8)\n              ::\n\\{\n{@type}}.from_string(String.new(x))\n            \nelse\n              raise Lustra::ErrorMessages.converter_error(x.class.name, \"::\n\\{\n{@type}}\")\n            \nend\n          \nend\n\n          def self.to_db(x : ::\n\\{\n{@type}}?)\n            x.to_s\n          \nend\n        \nend\n\n        Lustra::Model::Converter.add_converter(\"\n\\{\n{@type}}\", ::Lustra::Model::Converter::\n\\{\n{@type}}Converter)\n      \nend\n\n      \n{{ yield }}\n\n    \nend\n  \n"}},{"html_id":"json_serializable_converter(type)-macro","name":"json_serializable_converter","doc":"Register a type to allow use in Lustra column system.\nType must include JSON::Serializable.\n[More info about how to use JSON::Serializable it can be found here](https://crystal-lang.org/api/latest/JSON/Serializable.html)\n\n```\nLustra.json_serializable_converter(MyJsonType)\n\n# ...\n\nclass YourModel\n  include Lustra::Model\n  # ...\n  column my_column : MyJsonType # jsonb (recommended), json or string column in postgresql.\nend\n```","summary":"<p>Register a type to allow use in Lustra column system.</p>","abstract":false,"args":[{"name":"type","external_name":"type","restriction":""}],"args_string":"(type)","args_html":"(type)","location":{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L40"},"def":{"name":"json_serializable_converter","args":[{"name":"type","external_name":"type","restriction":""}],"visibility":"Public","body":"    \n{% type = type.resolve %}\n\n    module ::Lustra::Model::Converter::\n{{ type }}\nConverter\n      def self.to_column(x) : ::\n{{ type }}\n?\n        case x\n        when ::\n{{ type }}\n\n          x\n        when String\n          ::\n{{ type }}\n.new(::JSON::PullParser.new(x))\n        when ::JSON::PullParser\n          ::\n{{ type }}\n.new(x)\n        when ::JSON::Any\n          ::\n{{ type }}\n.new(::JSON::PullParser.new(x.to_json))\n        \nelse\n          raise \"Cannot convert to \n{{ type }}\n from #{x.class}\"\n        \nend\n      \nend\n\n      def self.to_db(x : ::\n{{ type }}\n?)\n        x ? x.to_json : nil\n      \nend\n    \nend\n\n    ::Lustra::Model::Converter.add_converter(\n{{ \"#{type}\" }}\n, ::Lustra::Model::Converter::\n{{ type }}\nConverter)\n  \n"}}],"types":[{"html_id":"lustra/Lustra/CLI","path":"Lustra/CLI.html","kind":"module","full_name":"Lustra::CLI","name":"CLI","abstract":false,"locations":[{"filename":"src/lustra/cli.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L10"},{"filename":"src/lustra/cli/command.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/command.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"class_methods":[{"html_id":"run-class-method","name":"run","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L11"},"def":{"name":"run","visibility":"Public","body":"Lustra::CLI::Base.run"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Base","path":"Lustra/CLI/Base.html","kind":"class","full_name":"Lustra::CLI::Base","name":"Base","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI","kind":"module","full_name":"Lustra::CLI","name":"CLI"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Base/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Base/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L16"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L25"},"def":{"name":"run_impl","visibility":"Public","body":"STDOUT.puts(help)"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false},{"html_id":"version-instance-method","name":"version","abstract":false,"location":{"filename":"src/lustra/cli.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L18"},"def":{"name":"version","visibility":"Public","body":"Lustra::VERSION"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Base/Arguments","path":"Lustra/CLI/Base/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Base::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Base","kind":"class","full_name":"Lustra::CLI::Base","name":"Base"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Base/Flags","path":"Lustra/CLI/Base/Flags.html","kind":"struct","full_name":"Lustra::CLI::Base::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__version__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--version\", \"Displays the version of the current application.\"}, short: \"nil\", long: \"version\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Base","kind":"class","full_name":"Lustra::CLI::Base","name":"Base"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"__version__-instance-method","name":"__version__","abstract":false,"def":{"name":"__version__","visibility":"Public","body":"@__version__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli.cr#L15"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__version__.nil?\n  raise(Admiral::Error.new(\"Flag required: --version\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Command","path":"Lustra/CLI/Command.html","kind":"module","full_name":"Lustra::CLI::Command","name":"Command","abstract":false,"locations":[{"filename":"src/lustra/cli/command.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/command.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/CLI/Base","kind":"class","full_name":"Lustra::CLI::Base","name":"Base"},{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},{"html_id":"lustra/Lustra/CLI/Generator/Migration","kind":"class","full_name":"Lustra::CLI::Generator::Migration","name":"Migration"},{"html_id":"lustra/Lustra/CLI/Generator/Model","kind":"class","full_name":"Lustra::CLI::Generator::Model","name":"Model"},{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},{"html_id":"lustra/Lustra/CLI/Migration/Down","kind":"class","full_name":"Lustra::CLI::Migration::Down","name":"Down"},{"html_id":"lustra/Lustra/CLI/Migration/Migrate","kind":"class","full_name":"Lustra::CLI::Migration::Migrate","name":"Migrate"},{"html_id":"lustra/Lustra/CLI/Migration/Rollback","kind":"class","full_name":"Lustra::CLI::Migration::Rollback","name":"Rollback"},{"html_id":"lustra/Lustra/CLI/Migration/Seed","kind":"class","full_name":"Lustra::CLI::Migration::Seed","name":"Seed"},{"html_id":"lustra/Lustra/CLI/Migration/Set","kind":"class","full_name":"Lustra::CLI::Migration::Set","name":"Set"},{"html_id":"lustra/Lustra/CLI/Migration/Status","kind":"class","full_name":"Lustra::CLI::Migration::Status","name":"Status"},{"html_id":"lustra/Lustra/CLI/Migration/Up","kind":"class","full_name":"Lustra::CLI::Migration::Up","name":"Up"},{"html_id":"lustra/Lustra/CLI/Seed","kind":"class","full_name":"Lustra::CLI::Seed","name":"Seed"}],"namespace":{"html_id":"lustra/Lustra/CLI","kind":"module","full_name":"Lustra::CLI","name":"CLI"}},{"html_id":"lustra/Lustra/CLI/Generator","path":"Lustra/CLI/Generator.html","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},{"filename":"src/lustra/cli/generators/migration.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L3"},{"filename":"src/lustra/cli/generators/model.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI","kind":"module","full_name":"Lustra::CLI","name":"CLI"},"class_methods":[{"html_id":"[](name)-class-method","name":"[]","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""}],"args_string":"(name)","args_html":"(name)","location":{"filename":"src/lustra/cli/generator.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L21"},"def":{"name":"[]","args":[{"name":"name","external_name":"name","restriction":""}],"visibility":"Public","body":"@@generators[name]"},"external_var":false},{"html_id":"[]?(name)-class-method","name":"[]?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""}],"args_string":"(name)","args_html":"(name)","location":{"filename":"src/lustra/cli/generator.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L17"},"def":{"name":"[]?","args":[{"name":"name","external_name":"name","restriction":""}],"visibility":"Public","body":"@@generators[name]?"},"external_var":false},{"html_id":"add(name,desc,&block:Array(String)->Nil)-class-method","name":"add","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"desc","external_name":"desc","restriction":""}],"args_string":"(name, desc, &block : Array(String) -> Nil)","args_html":"(name, desc, &block : Array(String) -> Nil)","location":{"filename":"src/lustra/cli/generator.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L13"},"def":{"name":"add","args":[{"name":"name","external_name":"name","restriction":""},{"name":"desc","external_name":"desc","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Array(String) -> Nil)"},"visibility":"Public","body":"@@generators[name] = Record.new(name, desc, block)"},"external_var":false},{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"generators-class-method","name":"generators","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L11"},"def":{"name":"generators","visibility":"Public","body":"@@generators"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Generator/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Generator/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Generate code automatically\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L5"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L25"},"def":{"name":"run_impl","visibility":"Public","body":"puts(help)"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"macros":[{"html_id":"ecr_to_s(string,opts)-macro","name":"ecr_to_s","abstract":false,"args":[{"name":"string","external_name":"string","restriction":""},{"name":"opts","external_name":"opts","restriction":""}],"args_string":"(string, opts)","args_html":"(string, opts)","location":{"filename":"src/lustra/cli/generator.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L29"},"def":{"name":"ecr_to_s","args":[{"name":"string","external_name":"string","restriction":""},{"name":"opts","external_name":"opts","restriction":""}],"visibility":"Public","body":"    opts = \n{{ opts }}\n\n    io = IO::Memory.new\n    ECR.embed \n{{ string }}\n, io\n    io.to_s\n  \n"}}],"types":[{"html_id":"lustra/Lustra/CLI/Generator/Arguments","path":"Lustra/CLI/Generator/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Generator::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Generator/Flags","path":"Lustra/CLI/Generator/Flags.html","kind":"struct","full_name":"Lustra::CLI::Generator::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generator.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L4"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Generator/Migration","path":"Lustra/CLI/Generator/Migration.html","kind":"class","full_name":"Lustra::CLI::Generator::Migration","name":"Migration","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Generator/Migration/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Generator/Migration/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Generate a new migration\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L7"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L19"},"def":{"name":"run_impl","visibility":"Public","body":"g = Generate::Generator.new\n\ng.target_directory = flags.directory\nname = arguments.name\n\nif name\n  name_underscore = name.underscore\n  class_name = name.camelcase\n  migration_uid = Time.local.to_unix.to_s.rjust(10, '0')\n\n  g[\"migration_uid\"] = migration_uid\n  g[\"class_name\"] = class_name\n\n  migration_file = \"#{migration_uid}_#{name_underscore}.cr\"\n\n  if Dir[File.join(g.target_directory, \"src/db/migrations/*_#{name_underscore}.cr\")].empty?\n  else\n    puts(\"A migration file `xxxx_#{name_underscore}.cr` already exists\")\n    exit(1)\n  end\n\n  g.in_directory(\"src/db/migrations\") do\n    g.file(migration_file, Lustra::CLI::Generator.ecr_to_s(\"/home/runner/work/lustra/lustra/src/lustra/cli/generators/../../../../templates/migration.cr.ecr\", g))\n  end\nelse\n  puts(\"Please provide a name for the migration\")\n  exit(1)\nend\n"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Generator/Migration/Arguments","path":"Lustra/CLI/Generator/Migration/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Generator::Migration::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},{"filename":"src/lustra/cli/generators/migration.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L17"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"name\" => {type: \"String\", description: {\"name\", \"\"}, default: \"nil\", is_required: false}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator/Migration","kind":"class","full_name":"Lustra::CLI::Generator::Migration","name":"Migration"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  name: @name,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"name:String|Nil-instance-method","name":"name","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L17"},"def":{"name":"name","return_type":"String | Nil","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"String\", description: {\"name\", \"\"}, default: \"nil\", is_required: false}[:is_required] && @name.nil?\n  raise(Admiral::Error.new(\"Argument required: name\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Generator/Migration/Flags","path":"Lustra/CLI/Generator/Migration/Flags.html","kind":"struct","full_name":"Lustra::CLI::Generator::Migration::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},{"filename":"src/lustra/cli/generators/migration.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}, \"directory\" => {kind: \"nil\", type: \"String\", default: \"\\\".\\\"\", description: {\"--directory, -d (default: \\\".\\\")\", \"Set target directory\"}, short: \"d\", long: \"directory\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator/Migration","kind":"class","full_name":"Lustra::CLI::Generator::Migration","name":"Migration"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"directory-instance-method","name":"directory","abstract":false,"location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L11"},"def":{"name":"directory","visibility":"Public","body":"@directory.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generators/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/migration.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\n\nif @directory.nil?\n  raise(Admiral::Error.new(\"Flag required: --directory\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Generator/Model","path":"Lustra/CLI/Generator/Model.html","kind":"class","full_name":"Lustra::CLI::Generator::Model","name":"Model","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Generator/Model/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Generator/Model/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Create a new model and the first migration\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L7"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L19"},"def":{"name":"run_impl","visibility":"Public","body":"g = Generate::Generator.new\n\ng.target_directory = flags.directory\nname = arguments.name\n\nif name\n  name_underscore = name.underscore\n  model_table = name_underscore.pluralize\n  class_name = name.camelcase\n\n  fields = @argv.join(\"|\")\n  migration_uid = Time.local.to_unix.to_s.rjust(10, '0')\n\n  g[\"model_class\"] = class_name\n  g[\"migration_uid\"] = migration_uid\n  g[\"model_table\"] = model_table\n  g[\"model_fields\"] = fields\n\n  model_file = \"#{name_underscore}.cr\"\n  migration_file = \"#{migration_uid}_create_#{name_underscore.pluralize}.cr\"\n\n  if Dir[File.join(g.target_directory, \"src/db/migrations/*_create_#{name_underscore.pluralize}.cr\")].empty?\n  else\n    puts(\"A migration file `xxxx__create_#{name_underscore.pluralize}.cr` already exists\")\n    exit(1)\n  end\n\n  g.in_directory(\"src/models\") do\n    g.file(model_file, Lustra::CLI::Generator.ecr_to_s(\"/home/runner/work/lustra/lustra/src/lustra/cli/generators/../../../../templates/model/model.cr.ecr\", g))\n  end\n\n  g.in_directory(\"src/db/migrations\") do\n    g.file(migration_file, Lustra::CLI::Generator.ecr_to_s(\"/home/runner/work/lustra/lustra/src/lustra/cli/generators/../../../../templates/model/migration.cr.ecr\", g))\n  end\nelse\n  puts(\"Please provide a name for the model\")\n  exit(1)\nend\n"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Generator/Model/Arguments","path":"Lustra/CLI/Generator/Model/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Generator::Model::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},{"filename":"src/lustra/cli/generators/model.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L17"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"name\" => {type: \"String\", description: {\"name\", \"\"}, default: \"nil\", is_required: false}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator/Model","kind":"class","full_name":"Lustra::CLI::Generator::Model","name":"Model"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  name: @name,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"name:String|Nil-instance-method","name":"name","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L17"},"def":{"name":"name","return_type":"String | Nil","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"String\", description: {\"name\", \"\"}, default: \"nil\", is_required: false}[:is_required] && @name.nil?\n  raise(Admiral::Error.new(\"Argument required: name\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Generator/Model/Flags","path":"Lustra/CLI/Generator/Model/Flags.html","kind":"struct","full_name":"Lustra::CLI::Generator::Model::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},{"filename":"src/lustra/cli/generators/model.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}, \"directory\" => {kind: \"nil\", type: \"String\", default: \"\\\".\\\"\", description: {\"--directory, -d (default: \\\".\\\")\", \"Set target directory\"}, short: \"d\", long: \"directory\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Generator/Model","kind":"class","full_name":"Lustra::CLI::Generator::Model","name":"Model"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"directory-instance-method","name":"directory","abstract":false,"location":{"filename":"src/lustra/cli/generators/model.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L11"},"def":{"name":"directory","visibility":"Public","body":"@directory.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/generators/model.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generators/model.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\n\nif @directory.nil?\n  raise(Admiral::Error.new(\"Flag required: --directory\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Generator/Record","path":"Lustra/CLI/Generator/Record.html","kind":"struct","full_name":"Lustra::CLI::Generator::Record","name":"Record","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/generator.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L7"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/CLI/Generator","kind":"class","full_name":"Lustra::CLI::Generator","name":"Generator"},"constructors":[{"html_id":"new(name:String,desc:String,callback:Array(String)->Nil)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"desc","external_name":"desc","restriction":"String"},{"name":"callback","external_name":"callback","restriction":"(Array(String) -> Nil)"}],"args_string":"(name : String, desc : String, callback : Array(String) -> Nil)","args_html":"(name : String, desc : String, callback : Array(String) -> Nil)","location":{"filename":"src/lustra/cli/generator.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L7"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"desc","external_name":"desc","restriction":"String"},{"name":"callback","external_name":"callback","restriction":"(Array(String) -> Nil)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, desc, callback)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"callback:Array(String)->Nil-instance-method","name":"callback","abstract":false,"def":{"name":"callback","return_type":"(Array(String) -> Nil)","visibility":"Public","body":"@callback"},"external_var":false},{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/cli/generator.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L7"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@name.clone, @desc.clone, @callback.clone)"},"external_var":false},{"html_id":"copy_with(name_name=@name,desc_desc=@desc,callback_callback=@callback)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_name","default_value":"@name","external_name":"name","restriction":""},{"name":"_desc","default_value":"@desc","external_name":"desc","restriction":""},{"name":"_callback","default_value":"@callback","external_name":"callback","restriction":""}],"args_string":"(name _name = @name, desc _desc = @desc, callback _callback = @callback)","args_html":"(name _name = @name, desc _desc = @desc, callback _callback = @callback)","location":{"filename":"src/lustra/cli/generator.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/generator.cr#L7"},"def":{"name":"copy_with","args":[{"name":"_name","default_value":"@name","external_name":"name","restriction":""},{"name":"_desc","default_value":"@desc","external_name":"desc","restriction":""},{"name":"_callback","default_value":"@callback","external_name":"callback","restriction":""}],"visibility":"Public","body":"self.class.new(_name, _desc, _callback)"},"external_var":false},{"html_id":"desc:String-instance-method","name":"desc","abstract":false,"def":{"name":"desc","return_type":"String","visibility":"Public","body":"@desc"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration","path":"Lustra/CLI/Migration.html","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Admiral/Command/Run","kind":"module","full_name":"Admiral::Command::Run","name":"Run"},{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI","kind":"module","full_name":"Lustra::CLI","name":"CLI"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Migration/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Migration/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Manage migration state of your database\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L2"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":108,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L108"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra::Migration::Manager.instance.apply_all"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Arguments","path":"Lustra/CLI/Migration/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Down","path":"Lustra/CLI/Migration/Down.html","kind":"class","full_name":"Lustra::CLI::Migration::Down","name":"Down","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Down/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Down/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Downgrade your database to a specific migration version\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L38"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L43"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra::Migration::Manager.instance.down(arguments.migration_number)"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Down/Arguments","path":"Lustra/CLI/Migration/Down/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Down::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},{"filename":"src/lustra/cli/migration.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L40"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"migration_number\" => {type: \"Int64\", description: {\"migration_number (required)\", \"\"}, default: \"nil\", is_required: true}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Down","kind":"class","full_name":"Lustra::CLI::Migration::Down","name":"Down"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  migration_number: @migration_number,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"migration_number:Int64-instance-method","name":"migration_number","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L40"},"def":{"name":"migration_number","return_type":"Int64","visibility":"Public","body":"@migration_number.not_nil!"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"Int64\", description: {\"migration_number (required)\", \"\"}, default: \"nil\", is_required: true}[:is_required] && @migration_number.nil?\n  raise(Admiral::Error.new(\"Argument required: migration_number\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Down/Flags","path":"Lustra/CLI/Migration/Down/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Down::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Down","kind":"class","full_name":"Lustra::CLI::Migration::Down","name":"Down"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L37"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Flags","path":"Lustra/CLI/Migration/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L1"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Migrate","path":"Lustra/CLI/Migration/Migrate.html","kind":"class","full_name":"Lustra::CLI::Migration::Migrate","name":"Migrate","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Migrate/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Migrate/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":72,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L72"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L74"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra::Migration::Manager.instance.apply_all"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Migrate/Arguments","path":"Lustra/CLI/Migration/Migrate/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Migrate::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Migrate","kind":"class","full_name":"Lustra::CLI::Migration::Migrate","name":"Migrate"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Migrate/Flags","path":"Lustra/CLI/Migration/Migrate/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Migrate::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Migrate","kind":"class","full_name":"Lustra::CLI::Migration::Migrate","name":"Migrate"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L71"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Rollback","path":"Lustra/CLI/Migration/Rollback.html","kind":"class","full_name":"Lustra::CLI::Migration::Rollback","name":"Rollback","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Rollback/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Rollback/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Rollback the last up migration\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":80,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L80"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":85,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L85"},"def":{"name":"run_impl","visibility":"Public","body":"array = Lustra::Migration::Manager.instance.migrations_up.to_a.sort\n\nnum = (arguments.num.try(&.to_i) || 1) + 1\n\nif num > array.size\n  num = array.size - 1\nend\n\nLustra::Migration::Manager.instance.apply_to(array[-num], direction: :down)\n"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Rollback/Arguments","path":"Lustra/CLI/Migration/Rollback/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Rollback::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},{"filename":"src/lustra/cli/migration.cr","line_number":83,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L83"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"num\" => {type: \"Int64\", description: {\"num\", \"\"}, default: \"nil\", is_required: false}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Rollback","kind":"class","full_name":"Lustra::CLI::Migration::Rollback","name":"Rollback"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  num: @num,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"num:Int64|Nil-instance-method","name":"num","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":83,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L83"},"def":{"name":"num","return_type":"Int64 | Nil","visibility":"Public","body":"@num"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"Int64\", description: {\"num\", \"\"}, default: \"nil\", is_required: false}[:is_required] && @num.nil?\n  raise(Admiral::Error.new(\"Argument required: num\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Rollback/Flags","path":"Lustra/CLI/Migration/Rollback/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Rollback::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Rollback","kind":"class","full_name":"Lustra::CLI::Migration::Rollback","name":"Rollback"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L79"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Seed","path":"Lustra/CLI/Migration/Seed.html","kind":"class","full_name":"Lustra::CLI::Migration::Seed","name":"Seed","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Seed/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Seed/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Call the seeds data\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L17"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L21"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra.apply_seeds"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Seed/Arguments","path":"Lustra/CLI/Migration/Seed/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Seed::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Seed","kind":"class","full_name":"Lustra::CLI::Migration::Seed","name":"Seed"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Seed/Flags","path":"Lustra/CLI/Migration/Seed/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Seed::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Seed","kind":"class","full_name":"Lustra::CLI::Migration::Seed","name":"Seed"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L16"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Set","path":"Lustra/CLI/Migration/Set.html","kind":"class","full_name":"Lustra::CLI::Migration::Set","name":"Set","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Set/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Set/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L49"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L54"},"def":{"name":"run_impl","visibility":"Public","body":"dir_symbol = case flags.direction\nwhen \"up\"\n  :up\nwhen \"down\"\n  :down\nwhen \"both\"\n  :both\nelse\n  puts(\"Bad argument --direction : #{flags.direction}. Must be up|down|both\")\n  exit(1)\nend\n\nLustra::Migration::Manager.instance.apply_to(arguments.to, direction: dir_symbol)\n"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Set/Arguments","path":"Lustra/CLI/Migration/Set/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Set::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},{"filename":"src/lustra/cli/migration.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L52"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"to\" => {type: \"Int64\", description: {\"to (required)\", \"\"}, default: \"nil\", is_required: true}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Set","kind":"class","full_name":"Lustra::CLI::Migration::Set","name":"Set"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  to: @to,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"to:Int64-instance-method","name":"to","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L52"},"def":{"name":"to","return_type":"Int64","visibility":"Public","body":"@to.not_nil!"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"Int64\", description: {\"to (required)\", \"\"}, default: \"nil\", is_required: true}[:is_required] && @to.nil?\n  raise(Admiral::Error.new(\"Argument required: to\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Set/Flags","path":"Lustra/CLI/Migration/Set/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Set::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},{"filename":"src/lustra/cli/migration.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L51"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"direction\" => {kind: \"nil\", type: \"String\", default: \"\\\"both\\\"\", description: {\"--direction, -d (default: \\\"both\\\")\", \"\"}, short: \"d\", long: \"direction\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Set","kind":"class","full_name":"Lustra::CLI::Migration::Set","name":"Set"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"direction-instance-method","name":"direction","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L51"},"def":{"name":"direction","visibility":"Public","body":"@direction.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L48"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @direction.nil?\n  raise(Admiral::Error.new(\"Flag required: --direction\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Status","path":"Lustra/CLI/Migration/Status.html","kind":"class","full_name":"Lustra::CLI::Migration::Status","name":"Status","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Status/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Status/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Return the current state of the database\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L7"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L11"},"def":{"name":"run_impl","visibility":"Public","body":"puts(Lustra::Migration::Manager.instance.print_status)"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Status/Arguments","path":"Lustra/CLI/Migration/Status/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Status::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Status","kind":"class","full_name":"Lustra::CLI::Migration::Status","name":"Status"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Status/Flags","path":"Lustra/CLI/Migration/Status/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Status::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Status","kind":"class","full_name":"Lustra::CLI::Migration::Status","name":"Status"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L6"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]},{"html_id":"lustra/Lustra/CLI/Migration/Up","path":"Lustra/CLI/Migration/Up.html","kind":"class","full_name":"Lustra::CLI::Migration::Up","name":"Up","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration","kind":"class","full_name":"Lustra::CLI::Migration","name":"Migration"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Up/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../../Lustra/CLI/Migration/Up/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Upgrade your database to a specific migration version\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L27"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L32"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra::Migration::Manager.instance.up(arguments.migration_number)"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Migration/Up/Arguments","path":"Lustra/CLI/Migration/Up/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Migration::Up::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},{"filename":"src/lustra/cli/migration.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L29"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{\"migration_number\" => {type: \"Int64\", description: {\"migration_number (required)\", \"\"}, default: \"nil\", is_required: true}} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Up","kind":"class","full_name":"Lustra::CLI::Migration::Up","name":"Up"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"{\n  migration_number: @migration_number,\n}[name]?"},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"migration_number:Int64-instance-method","name":"migration_number","abstract":false,"location":{"filename":"src/lustra/cli/migration.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L29"},"def":{"name":"migration_number","return_type":"Int64","visibility":"Public","body":"@migration_number.not_nil!"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"if {type: \"Int64\", description: {\"migration_number (required)\", \"\"}, default: \"nil\", is_required: true}[:is_required] && @migration_number.nil?\n  raise(Admiral::Error.new(\"Argument required: migration_number\"))\nend"},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Migration/Up/Flags","path":"Lustra/CLI/Migration/Up/Flags.html","kind":"struct","full_name":"Lustra::CLI::Migration::Up::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Migration/Up","kind":"class","full_name":"Lustra::CLI::Migration::Up","name":"Up"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/migration.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/migration.cr#L26"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]}]},{"html_id":"lustra/Lustra/CLI/Seed","path":"Lustra/CLI/Seed.html","kind":"class","full_name":"Lustra::CLI::Seed","name":"Seed","abstract":false,"superclass":{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},"ancestors":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"},{"html_id":"lustra/Admiral/Command","kind":"class","full_name":"Admiral::Command","name":"Command"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"HELP","name":"HELP","value":"{\"description\" => \"\"}"}],"included_modules":[{"html_id":"lustra/Lustra/CLI/Command","kind":"module","full_name":"Lustra::CLI::Command","name":"Command"}],"namespace":{"html_id":"lustra/Lustra/CLI","kind":"module","full_name":"Lustra::CLI","name":"CLI"},"class_methods":[{"html_id":"description-class-method","name":"description","abstract":false,"location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"description","visibility":"Public","body":"HELP[\"description\"]"},"external_var":false},{"html_id":"run(*args,**params)-class-method","name":"run","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **params)","args_html":"(*args, **params)","location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"run","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":0,"visibility":"Public","body":"(new(*args, **params)).parse_and_run"},"external_var":false}],"instance_methods":[{"html_id":"__rescue_from___Admiral__Error(e)-instance-method","name":"__rescue_from___Admiral__Error","abstract":false,"args":[{"name":"e","external_name":"e","restriction":""}],"args_string":"(e)","args_html":"(e)","def":{"name":"__rescue_from___Admiral__Error","args":[{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"panic(e.message.colorize(:red))"},"external_var":false},{"html_id":"arguments-instance-method","name":"arguments","doc":"Returns the commands `Arguments` object.\n\nYou can access names arguments by name.\nYou can also access the remaning arguments using `.arguments[index]`.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Seed/Arguments.html\">Arguments</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"arguments","visibility":"Public","body":"@arguments || (@arguments = Arguments.new(self))"},"external_var":false},{"html_id":"flags-instance-method","name":"flags","doc":"Returns the commands `Flags` object.\n\nYou can access names flags by name.","summary":"<p>Returns the commands <code><a href=\"../../Lustra/CLI/Seed/Flags.html\">Flags</a></code> object.</p>","abstract":false,"location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"flags","visibility":"Public","body":"@flags || (@flags = Flags.new(self))"},"external_var":false},{"html_id":"help-instance-method","name":"help","abstract":false,"def":{"name":"help","visibility":"Public","body":"[help_usage, \"Seed the database with seed data\" + \"\\n\", help_flags, help_arguments, help_sub_commands].reject() do |__arg0| __arg0.strip.empty? end.join(\"\\n\")"},"external_var":false},{"html_id":"run-instance-method","name":"run","doc":"The run command.","summary":"<p>The run command.</p>","abstract":false,"location":{"filename":"src/lustra/cli/seed.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L2"},"def":{"name":"run","visibility":"Public","body":"Colorize.enabled = !flags.no_color\n\nrun_impl\n"},"external_var":false},{"html_id":"run_impl-instance-method","name":"run_impl","abstract":false,"location":{"filename":"src/lustra/cli/seed.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L6"},"def":{"name":"run_impl","visibility":"Public","body":"Lustra.apply_seeds"},"external_var":false},{"html_id":"sub(command,*args,**params)-instance-method","name":"sub","doc":"Invokes a sub command by name, passing `self` as the parent.","summary":"<p>Invokes a sub command by name, passing <code>self</code> as the parent.</p>","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(command, *args, **params)","args_html":"(command, *args, **params)","location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"sub","args":[{"name":"command","external_name":"command","restriction":""},{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"splat_index":1,"visibility":"Public","body":"SubCommands.invoke(command, *args, **params, parent: self)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/CLI/Seed/Arguments","path":"Lustra/CLI/Seed/Arguments.html","kind":"struct","full_name":"Lustra::CLI::Seed::Arguments","name":"Arguments","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"SPECS","name":"SPECS","value":"{} of String => NamedTuple(type: String, description: Tuple(String, String | ::Nil), default: String, is_required: Bool)"}],"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"}],"namespace":{"html_id":"lustra/Lustra/CLI/Seed","kind":"class","full_name":"Lustra::CLI::Seed","name":"Seed"},"constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](*args,**options)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__[*args, **options]"},"external_var":false},{"html_id":"[](*args,**options,&)-instance-method","name":"[]","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"[]","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.[](*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"each(*args,**options)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"visibility":"Public","body":"@__rest__.each(*args, **options)"},"external_var":false},{"html_id":"each(*args,**options,&)-instance-method","name":"each","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","def":{"name":"each","args":[{"name":"args","external_name":"args","restriction":""}],"double_splat":{"name":"options","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arity":1,"visibility":"Public","body":"@__rest__.each(*args, **options) do |*yield_args|\n  yield *yield_args\nend"},"external_var":false},{"html_id":"exists?(name:Symbol)-instance-method","name":"exists?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"exists?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"!!SPECS[name]?"},"external_var":false},{"html_id":"get(name:Symbol)-instance-method","name":"get","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"get?(name:Symbol)-instance-method","name":"get?","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"args_string":"(name : Symbol)","args_html":"(name : Symbol)","def":{"name":"get?","args":[{"name":"name","external_name":"name","restriction":"Symbol"}],"visibility":"Public","body":"exists?(name) ? get(name) : false"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"names = SPECS.keys\nif size > 0\n  names << \"...\"\nend\nio << \"<#{self.class}\"\nio << \"(\"\nif names.empty?\nelse\n  io << (names.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"rest:Array(String)-instance-method","name":"rest","abstract":false,"def":{"name":"rest","visibility":"Public","body":"@__rest__"},"external_var":false},{"html_id":"validate!(command:Admiral::Command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"value_from_spec(command:Admiral::Command,*,arg:String,type,default,is_required:Bool)-instance-method","name":"value_from_spec","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"args_string":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","args_html":"(command : Admiral::Command, *, arg : String, type, default, is_required : Bool)","location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"value_from_spec","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"},{"name":"","external_name":"","restriction":""},{"name":"arg","external_name":"arg","restriction":"String"},{"name":"type","external_name":"type","restriction":""},{"name":"default","external_name":"default","restriction":""},{"name":"is_required","external_name":"is_required","restriction":"Bool"}],"splat_index":1,"visibility":"Public","body":"pos_only = false\nindex = 0\nwhile ((command.@argv)[index]?.to_s.starts_with?(\"-\")) && (!pos_only)\n  index = index + 1\n  pos_only = (command.@argv)[index]? == \"--\"\nend\nif (command.@argv)[index]?\n  value = (command.@argv).delete_at(index)\n  type.new(value)\nelse\n  default\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/CLI/Seed/Flags","path":"Lustra/CLI/Seed/Flags.html","kind":"struct","full_name":"Lustra::CLI::Seed::Flags","name":"Flags","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DESCRIPTIONS","name":"DESCRIPTIONS","value":"{} of String => String"},{"id":"SPECS","name":"SPECS","value":"{\"verbose\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--verbose, -v\", \"Display verbose informations during execution\"}, short: \"v\", long: \"verbose\", is_required: true}, \"no_color\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--no-color\", \"Cancel color output\"}, short: \"nil\", long: \"no-color\", is_required: true}, \"__help__\" => {kind: \"bool\", type: \"Bool\", default: \"false\", description: {\"--help\", \"Displays help for the current command.\"}, short: \"nil\", long: \"help\", is_required: true}} of String => NamedTuple(kind: String, type: String, default: String, description: Tuple(String, String | ::Nil), short: String | ::Nil, long: String, is_required: Bool)"}],"namespace":{"html_id":"lustra/Lustra/CLI/Seed","kind":"class","full_name":"Lustra::CLI::Seed","name":"Seed"},"doc":"Extend the flags struct to include the flag","summary":"<p>Extend the flags struct to include the flag</p>","constructors":[{"html_id":"new(command:Admiral::Command)-class-method","name":"new","abstract":false,"args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"args_string":"(command : Admiral::Command)","args_html":"(command : Admiral::Command)","def":{"name":"new","args":[{"name":"command","external_name":"command","restriction":"::Admiral::Command"}],"visibility":"Public","body":"_ = allocate\n_.initialize(command)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"__help__-instance-method","name":"__help__","abstract":false,"def":{"name":"__help__","visibility":"Public","body":"@__help__.not_nil!"},"external_var":false},{"html_id":"inspect(io)-instance-method","name":"inspect","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/cli/seed.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/cli/seed.cr#L1"},"def":{"name":"inspect","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"io << \"<#{self.class}\"\nio << \"(\"\nif SPECS.empty?\nelse\n  io << (SPECS.keys.join(\", \"))\nend\nio << \")\"\nio << \">\"\n"},"external_var":false},{"html_id":"no_color-instance-method","name":"no_color","abstract":false,"def":{"name":"no_color","visibility":"Public","body":"@no_color.not_nil!"},"external_var":false},{"html_id":"validate!(command)-instance-method","name":"validate!","abstract":false,"args":[{"name":"command","external_name":"command","restriction":""}],"args_string":"(command)","args_html":"(command)","def":{"name":"validate!","args":[{"name":"command","external_name":"command","restriction":""}],"visibility":"Public","body":"if @verbose.nil?\n  raise(Admiral::Error.new(\"Flag required: --verbose\"))\nend\n\n\n\nif @no_color.nil?\n  raise(Admiral::Error.new(\"Flag required: --no-color\"))\nend\n\n\n\nif @__help__.nil?\n  raise(Admiral::Error.new(\"Flag required: --help\"))\nend\n\n\nraise_extra_flags!(command)\n"},"external_var":false},{"html_id":"verbose-instance-method","name":"verbose","abstract":false,"def":{"name":"verbose","visibility":"Public","body":"@verbose.not_nil!"},"external_var":false}]}]}]},{"html_id":"lustra/Lustra/Enum","path":"Lustra/Enum.html","kind":"struct","full_name":"Lustra::Enum","name":"Enum","abstract":true,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Literal","kind":"module","full_name":"Lustra::Expression::Literal","name":"Literal"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/enum/enum.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L7"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Expression/Literal","kind":"module","full_name":"Lustra::Expression::Literal","name":"Literal"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"Lustra::Enum wrap the enums used in PostgreSQL.\nSee `Lustra.enum` macro helper.","summary":"<p>Lustra::Enum wrap the enums used in PostgreSQL.</p>","constructors":[{"html_id":"new(value:JSON::PullParser|String)-class-method","name":"new","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"::JSON::PullParser | ::String"}],"args_string":"(value : JSON::PullParser | String)","args_html":"(value : <a href=\"../JSON/PullParser.html\">JSON::PullParser</a> | String)","location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L12"},"def":{"name":"new","args":[{"name":"value","external_name":"value","restriction":"::JSON::PullParser | ::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"==(x)-instance-method","name":"==","doc":"Returns `true` if this struct is equal to *other*.\n\nBoth structs' instance vars are compared to each other. Thus, two\nstructs are considered equal if each of their instance variables are\nequal. Subclasses should override this method to provide specific\nequality semantics.\n\n```\nstruct Point\n  def initialize(@x : Int32, @y : Int32)\n  end\nend\n\np1 = Point.new 1, 2\np2 = Point.new 1, 2\np3 = Point.new 3, 4\n\np1 == p2 # => true\np1 == p3 # => false\n```","summary":"<p>Returns <code>true</code> if this struct is equal to <em>other</em>.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L27"},"def":{"name":"==","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"(super(x)) || (@value == x)"},"external_var":false},{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L23"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(@value)"},"external_var":false},{"html_id":"to_s:String-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L15"},"def":{"name":"to_s","return_type":"String","visibility":"Public","body":"@value.to_s"},"external_var":false},{"html_id":"to_sql:String-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L19"},"def":{"name":"to_sql","return_type":"String","visibility":"Public","body":"@value.to_sql"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Enum/Converter","path":"Lustra/Enum/Converter.html","kind":"module","full_name":"Lustra::Enum::Converter(T)","name":"Converter","abstract":false,"locations":[{"filename":"src/lustra/extensions/enum/enum.cr","line_number":31,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L31"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Enum","kind":"struct","full_name":"Lustra::Enum","name":"Enum"},"class_methods":[{"html_id":"to_column(x):T|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : T | Nil","args_html":"(x) : T | Nil","location":{"filename":"src/lustra/extensions/enum/enum.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L32"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"case x\nwhen String\n  T.authorized_values[x]\nwhen Nil\n  nil\nelse\n  raise(converter_error(x.class.name, \"Enum: #{T.class.name}\"))\nend"},"external_var":false}]}]},{"html_id":"lustra/Lustra/ErrorMessages","path":"Lustra/ErrorMessages.html","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages","abstract":false,"locations":[{"filename":"src/lustra/error_messages.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"including_types":[{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},{"html_id":"lustra/Lustra/Migration/Manager","kind":"class","full_name":"Lustra::Migration::Manager","name":"Manager"},{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},{"html_id":"lustra/Lustra/Model/Column","kind":"class","full_name":"Lustra::Model::Column(T, C)","name":"Column"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"This module list most of the runtime errors happening in Lustra.\nIt's an attempt to make Lustra user friendly by enabling advanced resolution\nof problems when they raise.","summary":"<p>This module list most of the runtime errors happening in Lustra.</p>","instance_methods":[{"html_id":"build_error_message(message:String,ways_to_resolve:Tuple|Array=Tuple.new)-instance-method","name":"build_error_message","abstract":false,"args":[{"name":"message","external_name":"message","restriction":"String"},{"name":"ways_to_resolve","default_value":"Tuple.new","external_name":"ways_to_resolve","restriction":"Tuple | Array"}],"args_string":"(message : String, ways_to_resolve : Tuple | Array = Tuple.new)","args_html":"(message : String, ways_to_resolve : Tuple | Array = <span class=\"t\">Tuple</span>.new)","location":{"filename":"src/lustra/error_messages.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L54"},"def":{"name":"build_error_message","args":[{"name":"message","external_name":"message","restriction":"String"},{"name":"ways_to_resolve","default_value":"Tuple.new","external_name":"ways_to_resolve","restriction":"Tuple | Array"}],"visibility":"Public","body":"{% if flag?(:release) %}\n      message\n    {% else %}\n      format_width({\n        build_message(message),\n        build_tips(ways_to_resolve),\n        (\n          \"You may also have encountered a bug. \\n\" +\n          \"Feel free to submit an issue: \\n#{build_url(\"https://github.com/crystal-garage/lustra/issues/new\")}\"\n        ),\n        \"\\n\\nStack trace:\\n\",\n      }.join)\n    {% end %}"},"external_var":false},{"html_id":"converter_error(from,to)-instance-method","name":"converter_error","abstract":false,"args":[{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"args_string":"(from, to)","args_html":"(from, to)","location":{"filename":"src/lustra/error_messages.cr","line_number":178,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L178"},"def":{"name":"converter_error","args":[{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"visibility":"Public","body":"build_error_message(\"Lustra cannot convert from `#{from}` to #{to}.\", {\"Ensure your database column type matches the column declaration in Lustra\"})"},"external_var":false},{"html_id":"format_width(x,w=80)-instance-method","name":"format_width","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""},{"name":"w","default_value":"80","external_name":"w","restriction":""}],"args_string":"(x, w = 80)","args_html":"(x, w = <span class=\"n\">80</span>)","location":{"filename":"src/lustra/error_messages.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L11"},"def":{"name":"format_width","args":[{"name":"x","external_name":"x","restriction":""},{"name":"w","default_value":"80","external_name":"w","restriction":""}],"visibility":"Public","body":"counter = 0\no = [] of String\n\n(x.split(/([ \\n\\t])/)).each do |word|\n  case word\n  when \"\\n\"\n    o << word\n    counter = 0\n  else\n    counter = counter + word.size\n\n    if counter > w\n      o << \"\\n\"\n      if word == \" \"\n        counter = 0\n      else\n        o << word\n        counter = word.size\n      end\n    else\n      o << word\n    end\n  end\nend\n\no.join\n"},"external_var":false},{"html_id":"illegal_setter_access_to_undefined_column(name)-instance-method","name":"illegal_setter_access_to_undefined_column","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""}],"args_string":"(name)","args_html":"(name)","location":{"filename":"src/lustra/error_messages.cr","line_number":151,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L151"},"def":{"name":"illegal_setter_access_to_undefined_column","args":[{"name":"name","external_name":"name","restriction":""}],"visibility":"Public","body":"build_error_message(\"You're trying to access to the column `#{name}` but it is not initialized.\", {\"Ensure that the column `#{name}` exists in your table\", \"If the model comes from a collection query, there was maybe a filtering on your `select` clause, \" + \"and you forgot to declare the column `#{name}`\", \"In the case of unpersisted models, please initialize by calling `#{name}=` first\", \"For validator, try `ensure_than` method, or use `#{name}_column.defined?` to avoid your validation code.\", \"Are you calling `#{name}_column.revert` somewhere before?\", \"If your model comes from JSON, please ensure the JSON source defines the column. Usage of `strict` mode will \" + \"trigger exception on JSON loading.\"})"},"external_var":false},{"html_id":"lack_of_primary_key(model_name)-instance-method","name":"lack_of_primary_key","abstract":false,"args":[{"name":"model_name","external_name":"model_name","restriction":""}],"args_string":"(model_name)","args_html":"(model_name)","location":{"filename":"src/lustra/error_messages.cr","line_number":187,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L187"},"def":{"name":"lack_of_primary_key","args":[{"name":"model_name","external_name":"model_name","restriction":""}],"visibility":"Public","body":"build_error_message(\"Model `#{model_name}` lacks of primary key field\", {\"Define a column as primary key\", \"Only one column can be primary key (no compound keys are allowed in Lustra for now)\", \"You can use the helpers for primary key (see manual page)\"})"},"external_var":false},{"html_id":"migration_already_down(number)-instance-method","name":"migration_already_down","abstract":false,"args":[{"name":"number","external_name":"number","restriction":""}],"args_string":"(number)","args_html":"(number)","location":{"filename":"src/lustra/error_messages.cr","line_number":80,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L80"},"def":{"name":"migration_already_down","args":[{"name":"number","external_name":"number","restriction":""}],"visibility":"Public","body":"build_error_message(\"Migration already down: #{number}\", {\"You're trying to force a migration which is not set in your database yet. \" + \"You should up the migration first, then down it again.\"})"},"external_var":false},{"html_id":"migration_already_up(number)-instance-method","name":"migration_already_up","abstract":false,"args":[{"name":"number","external_name":"number","restriction":""}],"args_string":"(number)","args_html":"(number)","location":{"filename":"src/lustra/error_messages.cr","line_number":70,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L70"},"def":{"name":"migration_already_up","args":[{"name":"number","external_name":"number","restriction":""}],"visibility":"Public","body":"build_error_message(\"Migration already up: #{number}\", {\"You're trying to force a migration which is already existing in your database. \" + \"You should down the migration first, then up it again.\"})"},"external_var":false},{"html_id":"migration_irreversible(name=nil,operation=nil)-instance-method","name":"migration_irreversible","abstract":false,"args":[{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"operation","default_value":"nil","external_name":"operation","restriction":""}],"args_string":"(name = nil, operation = nil)","args_html":"(name = <span class=\"n\">nil</span>, operation = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/error_messages.cr","line_number":122,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L122"},"def":{"name":"migration_irreversible","args":[{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"operation","default_value":"nil","external_name":"operation","restriction":""}],"visibility":"Public","body":"op_string = operation ? \"This is caused by the operation #{operation} which is irreversible.\" : nil\nmig_string = name ? \"The migration `#{name}` is irreversible. You're trying to down a migration which is not downable, \" + \"because the operations are one way only.\" : \"A migration is irreversible. You're trying to down a migration which is not downable, \" + \"because the operations are one way only.\"\n\nbuild_error_message(mig_string, [op_string, \"Build a way to revert the migration\", \"Do not revert the migration\", \"Maybe you need to manually flush the migration using Postgres. `__lustra_metadatas` table store loaded \" + \"migrations. Good luck !\"].compact)\n"},"external_var":false},{"html_id":"migration_not_found(number)-instance-method","name":"migration_not_found","abstract":false,"args":[{"name":"number","external_name":"number","restriction":""}],"args_string":"(number)","args_html":"(number)","location":{"filename":"src/lustra/error_messages.cr","line_number":90,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L90"},"def":{"name":"migration_not_found","args":[{"name":"number","external_name":"number","restriction":""}],"visibility":"Public","body":"build_error_message(\"The migration number `#{number}` is not found.\", {\"Ensure your migration files are required\", \"Number of the migrations can be found in the filename, \" + \"in the classname or in the `uid` method of the migration.\"})"},"external_var":false},{"html_id":"migration_not_unique(numbers)-instance-method","name":"migration_not_unique","abstract":false,"args":[{"name":"numbers","external_name":"numbers","restriction":""}],"args_string":"(numbers)","args_html":"(numbers)","location":{"filename":"src/lustra/error_messages.cr","line_number":140,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L140"},"def":{"name":"migration_not_unique","args":[{"name":"numbers","external_name":"numbers","restriction":""}],"visibility":"Public","body":"build_error_message(\"The migration manage found collision on migration number. Migrations number are: #{numbers.join(\", \")}\", {\"It happens when migration share the same `uid`. Try to change the UID of one of your migrations\", \"By default, Lustra has a `-1` migration used internally. Do not use this migration number.\", \"Migration numbers can be found in filename, classname or return of `uid` method\"})"},"external_var":false},{"html_id":"no_migration_yet(version)-instance-method","name":"no_migration_yet","abstract":false,"args":[{"name":"version","external_name":"version","restriction":""}],"args_string":"(version)","args_html":"(version)","location":{"filename":"src/lustra/error_messages.cr","line_number":101,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L101"},"def":{"name":"no_migration_yet","args":[{"name":"version","external_name":"version","restriction":""}],"visibility":"Public","body":"build_error_message(\"No migrations are registered yet, so we cannot go to version=#{version}\", {\"Ensure your migration files are required\", \"Ensure you have some migration files. Captain obvious to the rescue! ;-)\"})"},"external_var":false},{"html_id":"null_column_mapping_error(name,type)-instance-method","name":"null_column_mapping_error","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"type","external_name":"type","restriction":""}],"args_string":"(name, type)","args_html":"(name, type)","location":{"filename":"src/lustra/error_messages.cr","line_number":167,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L167"},"def":{"name":"null_column_mapping_error","args":[{"name":"name","external_name":"name","restriction":""},{"name":"type","external_name":"type","restriction":""}],"visibility":"Public","body":"build_error_message(\"Your field `#{name}` is declared as `#{type}` but `NULL` value has been found in the database.\", {\"In your model, declare your column `column #{name} : #{type}?` (note the `?` which allow nil value)\", \"In your database, adding `DEFAULT` value and/or `NOT NULL` constraint should disallow NULL fields \" + \"from your data.\"})"},"external_var":false},{"html_id":"order_by_error_invalid_order(current_order)-instance-method","name":"order_by_error_invalid_order","abstract":false,"args":[{"name":"current_order","external_name":"current_order","restriction":""}],"args_string":"(current_order)","args_html":"(current_order)","location":{"filename":"src/lustra/error_messages.cr","line_number":226,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L226"},"def":{"name":"order_by_error_invalid_order","args":[{"name":"current_order","external_name":"current_order","restriction":""}],"visibility":"Public","body":"build_error_message(\"Order by allow only ASC and DESC directions. But #{current_order} was given.\", {\"Ensure to use :asc, :desc symbol (or string) when constructing your query.\", \"If the code is dynamic, force the casting to one of the two value above, to avoid SQL injection.\"})"},"external_var":false},{"html_id":"polymorphic_nil(through)-instance-method","name":"polymorphic_nil","abstract":false,"args":[{"name":"through","external_name":"through","restriction":""}],"args_string":"(through)","args_html":"(through)","location":{"filename":"src/lustra/error_messages.cr","line_number":198,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L198"},"def":{"name":"polymorphic_nil","args":[{"name":"through","external_name":"through","restriction":""}],"visibility":"Public","body":"build_error_message(\"Impossible to instantiate polymorphic object, because the type given by the data is nil.\", {\"The column `#{through}` contains NULL value, but is set as storage for \" + \"the type of the polymorphic object.\", \"Try to set DEFAULT value for your column `#{through}`\", \"In case of new implementation of polymorphic system, we recommend you to update the column to the previous \" + \"Class value. Value must be equal to the fully qualified model class name in Crystal (e.g. `MyApp::MyModel`)\"})"},"external_var":false},{"html_id":"polymorphic_unknown_class(class_name)-instance-method","name":"polymorphic_unknown_class","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":""}],"args_string":"(class_name)","args_html":"(class_name)","location":{"filename":"src/lustra/error_messages.cr","line_number":211,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L211"},"def":{"name":"polymorphic_unknown_class","args":[{"name":"class_name","external_name":"class_name","restriction":""}],"visibility":"Public","body":"build_error_message(\"Impossible to instantiate a new `#{class_name}` using polymorphism.\", {((\"Ensure the type is properly setup in your `polymorphic` helper. \" + \"Any model which can exists in your database needs to manually be setup as in the example below:\\n\") + \"`polymorphic Dog, Cat, through: \\\"type\\\"`\\n\") + \"In this case, if you have a `Cow` object in your database, then add it in the list of allowed polymorphic objects.\", (\"Ensure the name match a fully qualified, with full path, Lustra model:\\n\" + \"`polymorphic ::Animal::Dog, ::Animal::Cat, through: \\\"type\\\"`\\n\") + \"The column should then contains `Animal::Dog` and not `Dog`\"})"},"external_var":false},{"html_id":"query_building_error(message)-instance-method","name":"query_building_error","abstract":false,"args":[{"name":"message","external_name":"message","restriction":""}],"args_string":"(message)","args_html":"(message)","location":{"filename":"src/lustra/error_messages.cr","line_number":236,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L236"},"def":{"name":"query_building_error","args":[{"name":"message","external_name":"message","restriction":""}],"visibility":"Public","body":"Lustra::SQL::QueryBuildingError.new(build_error_message({\"You're trying to construct an invalid SQL request:\\n\", message}.join))"},"external_var":false},{"html_id":"uid_not_found(class_name)-instance-method","name":"uid_not_found","abstract":false,"args":[{"name":"class_name","external_name":"class_name","restriction":""}],"args_string":"(class_name)","args_html":"(class_name)","location":{"filename":"src/lustra/error_messages.cr","line_number":111,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L111"},"def":{"name":"uid_not_found","args":[{"name":"class_name","external_name":"class_name","restriction":""}],"visibility":"Public","body":"build_error_message(\"I don't know how to order the migration `#{class_name}`\", {\"Rename your migration class to have the migration UID at the end of the class name\", \"Rename the file where your migration stand to have the migration UID in front of the filename\", \"Override the method `uid`. Be sure the number is immutable (e.g. return constant)\"})"},"external_var":false},{"html_id":"uninitialized_db_connection(connection)-instance-method","name":"uninitialized_db_connection","abstract":false,"args":[{"name":"connection","external_name":"connection","restriction":""}],"args_string":"(connection)","args_html":"(connection)","location":{"filename":"src/lustra/error_messages.cr","line_number":244,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/error_messages.cr#L244"},"def":{"name":"uninitialized_db_connection","args":[{"name":"connection","external_name":"connection","restriction":""}],"visibility":"Public","body":"build_error_message(\"You're trying to access the connection #{connection} which is not initialized\", {\"Use `Lustra::SQL.init(#{connection}: \\\"postgres://XXX...\\\" )` on startup of your application\", \"The name of the connection (#{connection}) can't be found. It may have been mistyped.\"})"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression","path":"Lustra/Expression.html","kind":"class","full_name":"Lustra::Expression","name":"Expression","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/expression.cr","line_number":55,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L55"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DATABASE_DATE_FORMAT","name":"DATABASE_DATE_FORMAT","value":"\"%Y-%m-%d\""},{"id":"DATABASE_DATE_TIME_FORMAT","name":"DATABASE_DATE_TIME_FORMAT","value":"\"%Y-%m-%d %H:%M:%S.%L %:z\""}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"## Lustra's Expression engine\n\nThe goal of this module is to offer the most natural way to write down your\nquery in crystal.\n\nIf you're familiar with Sequel on Ruby, then here you have !\n\nInstead of writing:\n\n```\nmodel_collection.where(\"created_at BETWEEN ? AND ?\", 1.day.ago, DateTime.local)\n```\n\nYou can write:\n```\nmodel_collection.where { created_at.between(1.day.ago, DateTime.local) }\n```\n\nor even:\n\n```\nmodel_collection.where { created_at.in?(1.day.ago..DateTime.local) }\n```\n\n(Note for the later, it will generate `created_at > 1.day.ago AND created_at < DateTime.local`)\n\n## Limitations\n\nDue to the use of `missing_method` macro, some case can be confusing.\n\n### Existing local variable / instance method\n\n```\nid = 1\nmodel_collection.where { id > 100 } # Will raise an error, because the expression is resolved by Crystal !\n# Should be:\nid = 1\nmodel_collection.where { var(\"id\") > 100 } # Will works\n```\n\n### Usage of AND / OR\n\nAnd/Or can be used using the bitwises operators `&` and `|`.\nDue to the impossibility to reuse `||` and `&&`, beware the operator precendance\nrules are changed.\n\n```\n# v-- This below will not works, as we cannot redefine the `or` operator\nmodel_collection.where { first_name == \"yacine\" || last_name == \"petitprez\" }\n# v-- This will works, but beware of the parenthesis between each terms, as `|` is prioritary on `==`\nmodel.collection.where { (firt_name == \"yacine\") | (last_name == \"petitprez\") }\n# ^-- ... WHERE first_name = 'yacine' OR last_name == ''\n```\n","summary":"<h2><a id=\"lustras-expression-engine\" class=\"anchor\" href=\"#lustras-expression-engine\">  <svg class=\"octicon-link\" aria-hidden=\"true\">\n    <use href=\"#octicon-link\"/>\n  </svg>\n</a>Lustra's Expression engine</h2>","class_methods":[{"html_id":"[](arg)-class-method","name":"[]","doc":"A fast way to call `self.safe_literal`\nSee `safe_literal(x : _)`","summary":"<p>A fast way to call <code>self<a href=\"../Lustra/Expression.html#safe_literal%28x%3AEnumerable%28AvailableLiteral%29%29%3AEnumerable%28String%29-class-method\">.safe_literal</a></code> See <code><a href=\"../Lustra/Expression.html#safe_literal%28x%3AEnumerable%28AvailableLiteral%29%29%3AEnumerable%28String%29-class-method\">.safe_literal(x : _)</a></code></p>","abstract":false,"args":[{"name":"arg","external_name":"arg","restriction":""}],"args_string":"(arg)","args_html":"(arg)","location":{"filename":"src/lustra/expression/expression.cr","line_number":97,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L97"},"def":{"name":"[]","args":[{"name":"arg","external_name":"arg","restriction":""}],"visibility":"Public","body":"safe_literal(arg)"},"external_var":false},{"html_id":"ensure_node!(any)-class-method","name":"ensure_node!","doc":"This method will raise error on compilation if discovered in the code.\nThis allow to avoid issues like this one at compile type:\n\n```\nid = 1\n# ... and later\nUser.query.where { id == 2 }\n```\n\nIn this case, the local var id will be evaluated in the expression engine.\nleading to buggy code.\n\nHaving this method prevent the code to compile.\n\nTo be able to pass a literal or values other than node, please use `raw`\nmethod.","summary":"<p>This method will raise error on compilation if discovered in the code.</p>","abstract":false,"args":[{"name":"any","external_name":"any","restriction":""}],"args_string":"(any)","args_html":"(any)","location":{"filename":"src/lustra/expression/expression.cr","line_number":188,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L188"},"def":{"name":"ensure_node!","args":[{"name":"any","external_name":"any","restriction":""}],"visibility":"Public","body":"{% raise(((((\"The expression engine discovered a runtime-evaluable condition.\\n\" + \"It happens when a test is done with values on both sides.\\n\") + \"Maybe a local variable is breaking the expression engine like here:\\n\") + \"id = 1\\n\") + \"Users.where { id == nil }\\n\\n\") + \"In this case, please use `raw(\\\"id IS NULL\\\")` to allow the expression.\") %}"},"external_var":false},{"html_id":"raw(x:String,*args)-class-method","name":"raw","doc":"In case the name of the variable is a reserved word (e.g. `not`, `var`, `raw`)\nor in case of a complex piece of computation impossible to express with the expression engine\n(e.g. usage of functions) you can use then raw to pass the String.\n\nBE AWARE than the String is pasted AS-IS and can lead to SQL injection if not used properly.\n\n```\nhaving { raw(\"COUNT(*)\") > 5 }           # SELECT ... FROM ... HAVING COUNT(*) > 5\nwhere { raw(\"func(?, ?) = ?\", a, b, c) } # SELECT ... FROM ... WHERE function(a, b) = c\n```","summary":"<p>In case the name of the variable is a reserved word (e.g.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(x : String, *args)","args_html":"(x : String, *args)","location":{"filename":"src/lustra/expression/expression.cr","line_number":252,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L252"},"def":{"name":"raw","args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"raw_enum(x, args)"},"external_var":false},{"html_id":"raw(__template:String,**tuple)-class-method","name":"raw","doc":"In case the name of the variable is a reserved word (e.g. `not`, `var`, `raw`)\nor in case of a complex piece of computation impossible to express with the expression engine\n(e.g. usage of functions) you can use then raw to pass the String.\n\nBE AWARE than the String is pasted AS-IS and can lead to SQL injection if not used properly.\n\n```\nhaving { raw(\"COUNT(*)\") > 5 }                       # SELECT ... FROM ... HAVING COUNT(*) > 5\nwhere { raw(\"func(:a, :b) = :c\", a: a, b: b, c: c) } # SELECT ... FROM ... WHERE function(a, b) = c\n```","summary":"<p>In case the name of the variable is a reserved word (e.g.</p>","abstract":false,"args":[{"name":"__template","external_name":"__template","restriction":"String"}],"args_string":"(__template : String, **tuple)","args_html":"(__template : String, **tuple)","location":{"filename":"src/lustra/expression/expression.cr","line_number":296,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L296"},"def":{"name":"raw","args":[{"name":"__template","external_name":"__template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"__template.gsub(/(^|[^:])\\:([a-zA-Z0-9_]+)/) do |_, match|\n  begin\n    sym = match[2]\n    match[1] + Lustra::Expression[tuple[sym]]\n  rescue e : KeyError\n    raise(Lustra::ErrorMessages.query_building_error(e.message))\n  end\nend"},"external_var":false},{"html_id":"raw_enum(x:String,args)-class-method","name":"raw_enum","doc":"See `self.raw`\nCan pass an array to this version","summary":"<p>See <code>self<a href=\"../Lustra/Expression.html#raw%28x%3AString%2C%2Aargs%29-class-method\">.raw</a></code> Can pass an array to this version</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(x : String, args)","args_html":"(x : String, args)","location":{"filename":"src/lustra/expression/expression.cr","line_number":258,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L258"},"def":{"name":"raw_enum","args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"visibility":"Public","body":"idx = -1\n\nx.gsub(\"?\") do |_|\n  begin\n    Lustra::Expression[args[idx = idx + 1]]\n  rescue e : IndexError\n    raise(Lustra::ErrorMessages.query_building_error(e.message))\n  end\nend\n"},"external_var":false},{"html_id":"safe_literal(x:Enumerable(AvailableLiteral)):Enumerable(String)-class-method","name":"safe_literal","doc":"Transform multiple objects into a string which is SQL-Injection safe.","summary":"<p>Transform multiple objects into a string which is SQL-Injection safe.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Enumerable(AvailableLiteral)"}],"args_string":"(x : Enumerable(AvailableLiteral)) : Enumerable(String)","args_html":"(x : Enumerable(<a href=\"../Lustra/Expression/AvailableLiteral.html\">AvailableLiteral</a>)) : Enumerable(String)","location":{"filename":"src/lustra/expression/expression.cr","line_number":127,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L127"},"def":{"name":"safe_literal","args":[{"name":"x","external_name":"x","restriction":"Enumerable(AvailableLiteral)"}],"return_type":"Enumerable(String)","visibility":"Public","body":"x.map do |item| safe_literal(item) end"},"external_var":false},{"html_id":"safe_literal(x:Time,date:Bool=false):String-class-method","name":"safe_literal","doc":"Safe literal of a time return a string representation of time in the format understood by postgresql.\n\nIf the optional parameter `date` is passed, the time is truncated and only the date is passed:\n\n## Example\n\n```\nLustra::Expression[Time.local]             # < \"2017-04-03 23:04:43.234 +08:00\"\nLustra::Expression[Time.local, date: true] # < \"2017-04-03\"\n```","summary":"<p>Safe literal of a time return a string representation of time in the format understood by postgresql.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Time"},{"name":"date","default_value":"false","external_name":"date","restriction":"Bool"}],"args_string":"(x : Time, date : Bool = false) : String","args_html":"(x : <a href=\"../Time.html\">Time</a>, date : Bool = <span class=\"n\">false</span>) : String","location":{"filename":"src/lustra/expression/expression.cr","line_number":147,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L147"},"def":{"name":"safe_literal","args":[{"name":"x","external_name":"x","restriction":"Time"},{"name":"date","default_value":"false","external_name":"date","restriction":"Bool"}],"return_type":"String","visibility":"Public","body":"{\"'\", x.to_utc.to_s(date ? DATABASE_DATE_FORMAT : DATABASE_DATE_TIME_FORMAT), \"'\"}.join"},"external_var":false},{"html_id":"safe_literal(x:_):String-class-method","name":"safe_literal","doc":"Sanitize an object and return a `String` representation of itself which is proofed against SQL injections.","summary":"<p>Sanitize an object and return a <code>String</code> representation of itself which is proofed against SQL injections.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"_"}],"args_string":"(x : _) : String","args_html":"(x : _) : String","location":{"filename":"src/lustra/expression/expression.cr","line_number":167,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L167"},"def":{"name":"safe_literal","args":[{"name":"x","external_name":"x","restriction":"_"}],"return_type":"String","visibility":"Public","body":"safe_literal(x.to_s)"},"external_var":false},{"html_id":"unsafe(x)-class-method","name":"unsafe","doc":"Return unsafe string injected to the query.\n  can be used for example in `insert` query building","summary":"<p>Return unsafe string injected to the query.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/expression/expression.cr","line_number":133,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L133"},"def":{"name":"unsafe","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"Lustra::Expression::UnsafeSql.new(x)"},"external_var":false},{"html_id":"where(&):Node-class-method","name":"where","doc":"Return a node of the expression engine\nThis node can then be combined with others node\nin case of chain request creation `where {...}.where {...}`\nthrough the chaining engine","summary":"<p>Return a node of the expression engine This node can then be combined with others node in case of chain request creation <code>where {...}<a href=\"../Lustra/Expression.html#where%28%26%29%3ANode-class-method\">.where</a> {...}</code> through the chaining engine</p>","abstract":false,"location":{"filename":"src/lustra/expression/expression.cr","line_number":207,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L207"},"def":{"name":"where","yields":0,"block_arity":0,"return_type":"Node","visibility":"Public","body":"expression_engine = new\n\nensure_node!(with expression_engine yield)\n"},"external_var":false}],"instance_methods":[{"html_id":"not(x:Node)-instance-method","name":"not","doc":"`NOT` operator\n\nReturn an logically reversed version of the contained `Node`\n\n## Example\n\n```\nLustra::Expression.where { not(a == b) }.resolve # >> \"WHERE NOT( a = b )\n```","summary":"<p><code>NOT</code> operator</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Node"}],"args_string":"(x : Node)","args_html":"(x : <a href=\"../Lustra/Expression/Node.html\">Node</a>)","location":{"filename":"src/lustra/expression/expression.cr","line_number":222,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L222"},"def":{"name":"not","args":[{"name":"x","external_name":"x","restriction":"Node"}],"visibility":"Public","body":"Node::Not.new(x)"},"external_var":false},{"html_id":"op(a:Node|AvailableLiteral,b:Node|AvailableLiteral,op:String)-instance-method","name":"op","doc":"Because many postgresql operators are not transcriptable in Crystal lang,\nthis helpers helps to write the expressions:\n\n```\nwhere { op(jsonb_field, \"something\", \"?\") } # << Return \"jsonb_field ? 'something'\"\n```","summary":"<p>Because many postgresql operators are not transcriptable in Crystal lang, this helpers helps to write the expressions:</p>","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Node | AvailableLiteral"},{"name":"b","external_name":"b","restriction":"Node | AvailableLiteral"},{"name":"op","external_name":"op","restriction":"String"}],"args_string":"(a : Node | AvailableLiteral, b : Node | AvailableLiteral, op : String)","args_html":"(a : <a href=\"../Lustra/Expression/Node.html\">Node</a> | <a href=\"../Lustra/Expression/AvailableLiteral.html\">AvailableLiteral</a>, b : <a href=\"../Lustra/Expression/Node.html\">Node</a> | <a href=\"../Lustra/Expression/AvailableLiteral.html\">AvailableLiteral</a>, op : String)","location":{"filename":"src/lustra/expression/expression.cr","line_number":337,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L337"},"def":{"name":"op","args":[{"name":"a","external_name":"a","restriction":"Node | AvailableLiteral"},{"name":"b","external_name":"b","restriction":"Node | AvailableLiteral"},{"name":"op","external_name":"op","restriction":"String"}],"visibility":"Public","body":"if a.is_a?(AvailableLiteral)\n  a = Node::Literal.new(a)\nend\nif b.is_a?(AvailableLiteral)\n  b = Node::Literal.new(b)\nend\n\nNode::DoubleOperator.new(a, b, op)\n"},"external_var":false},{"html_id":"raw(x:String,*args)-instance-method","name":"raw","doc":"In case the name of the variable is a reserved word (e.g. `not`, `var`, `raw`)\nor in case of a complex piece of computation impossible to express with the expression engine\n(e.g. usage of functions) you can use then raw to pass the String.\n\nBE AWARE than the String is pasted AS-IS and can lead to SQL injection if not used properly.\n\n```\nhaving { raw(\"COUNT(*)\") > 5 }           # SELECT ... FROM ... HAVING COUNT(*) > 5\nwhere { raw(\"func(?, ?) = ?\", a, b, c) } # SELECT ... FROM ... WHERE function(a, b) = c\n```","summary":"<p>In case the name of the variable is a reserved word (e.g.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(x : String, *args)","args_html":"(x : String, *args)","location":{"filename":"src/lustra/expression/expression.cr","line_number":237,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L237"},"def":{"name":"raw","args":[{"name":"x","external_name":"x","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"Node::Raw.new(self.class.raw(x, *args))"},"external_var":false},{"html_id":"raw(__template:String,**tuple)-instance-method","name":"raw","doc":"In case the name of the variable is a reserved word (e.g. `not`, `var`, `raw`)\nor in case of a complex piece of computation impossible to express with the expression engine\n(e.g. usage of functions) you can use then raw to pass the String.\n\nBE AWARE than the String is pasted AS-IS and can lead to SQL injection if not used properly.\n\n```\nhaving { raw(\"COUNT(*)\") > 5 }                       # SELECT ... FROM ... HAVING COUNT(*) > 5\nwhere { raw(\"func(:a, :b) = :c\", a: a, b: b, c: c) } # SELECT ... FROM ... WHERE function(a, b) = c\n```","summary":"<p>In case the name of the variable is a reserved word (e.g.</p>","abstract":false,"args":[{"name":"__template","external_name":"__template","restriction":"String"}],"args_string":"(__template : String, **tuple)","args_html":"(__template : String, **tuple)","location":{"filename":"src/lustra/expression/expression.cr","line_number":281,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L281"},"def":{"name":"raw","args":[{"name":"__template","external_name":"__template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"Node::Raw.new(self.class.raw(__template, **tuple))"},"external_var":false},{"html_id":"var(*parts)-instance-method","name":"var","doc":"Use var to create expression of variable. Variables are columns with or without the namespace and tablename:\n\nIt escapes each part of the expression with double-quote as requested by PostgreSQL.\nThis is useful to escape SQL keywords or `.` and `\"` character in the name of a column.\n\n```\nvar(\"template1\", \"users\", \"name\")        # \"template1\".\"users\".\"name\"\nvar(\"template1\", \"users.table2\", \"name\") # \"template1\".\"users.table2\".\"name\"\nvar(\"order\")                             # \"order\"\n```","summary":"<p>Use var to create expression of variable.</p>","abstract":false,"args":[{"name":"parts","external_name":"parts","restriction":""}],"args_string":"(*parts)","args_html":"(*parts)","location":{"filename":"src/lustra/expression/expression.cr","line_number":317,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L317"},"def":{"name":"var","args":[{"name":"parts","external_name":"parts","restriction":""}],"splat_index":0,"visibility":"Public","body":"_var(parts)"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Expression/AvailableLiteral","path":"Lustra/Expression/AvailableLiteral.html","kind":"alias","full_name":"Lustra::Expression::AvailableLiteral","name":"AvailableLiteral","abstract":false,"locations":[{"filename":"src/lustra/expression/expression.cr","line_number":91,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L91"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Bool | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | Lustra::Expression::Literal | String | Symbol | Time | UInt16 | UInt32 | UInt64 | UInt8 | Nil)","aliased_html":"Bool | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | <a href=\"../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | String | Symbol | <a href=\"../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | Nil","const":false,"namespace":{"html_id":"lustra/Lustra/Expression","kind":"class","full_name":"Lustra::Expression","name":"Expression"}},{"html_id":"lustra/Lustra/Expression/JSONB","path":"Lustra/Expression/JSONB.html","kind":"module","full_name":"Lustra::Expression::JSONB","name":"JSONB","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression","kind":"class","full_name":"Lustra::Expression","name":"Expression"},"types":[{"html_id":"lustra/Lustra/Expression/JSONB/Node","path":"Lustra/Expression/JSONB/Node.html","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"}],"namespace":{"html_id":"lustra/Lustra/Expression/JSONB","kind":"module","full_name":"Lustra::Expression::JSONB","name":"JSONB"},"instance_methods":[{"html_id":"jsonb(key:String)-instance-method","name":"jsonb","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L21"},"def":{"name":"jsonb","args":[{"name":"key","external_name":"key","restriction":"String"}],"visibility":"Public","body":"Lustra::Expression::Node::JSONB::Field.new(self, key)"},"external_var":false},{"html_id":"jsonb_all_keys_exists?(keys:Array(T))forallT-instance-method","name":"jsonb_all_keys_exists?","abstract":false,"args":[{"name":"keys","external_name":"keys","restriction":"Array(T)"}],"args_string":"(keys : Array(T)) forall T","args_html":"(keys : Array(T)) forall T","location":{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L17"},"def":{"name":"jsonb_all_keys_exists?","args":[{"name":"keys","external_name":"keys","restriction":"Array(T)"}],"visibility":"Public","body":"_jsonb_keys_exists(keys, \"?&\")"},"external_var":false},{"html_id":"jsonb_any_key_exists?(keys:Array(T))forallT-instance-method","name":"jsonb_any_key_exists?","abstract":false,"args":[{"name":"keys","external_name":"keys","restriction":"Array(T)"}],"args_string":"(keys : Array(T)) forall T","args_html":"(keys : Array(T)) forall T","location":{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L13"},"def":{"name":"jsonb_any_key_exists?","args":[{"name":"keys","external_name":"keys","restriction":"Array(T)"}],"visibility":"Public","body":"_jsonb_keys_exists(keys, \"?|\")"},"external_var":false},{"html_id":"jsonb_key_exists?(key:String)-instance-method","name":"jsonb_key_exists?","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/lustra/extensions/jsonb/node.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/node.cr#L2"},"def":{"name":"jsonb_key_exists?","args":[{"name":"key","external_name":"key","restriction":"String"}],"visibility":"Public","body":"Lustra::Expression::Node::DoubleOperator.new(self, Lustra::Expression::Node::Literal.new(key), \"?\")"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Expression/Literal","path":"Lustra/Expression/Literal.html","kind":"module","full_name":"Lustra::Expression::Literal","name":"Literal","abstract":false,"locations":[{"filename":"src/lustra/expression/expression.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L62"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Enum","kind":"struct","full_name":"Lustra::Enum","name":"Enum"},{"html_id":"lustra/Lustra/Expression/UnsafeSql","kind":"class","full_name":"Lustra::Expression::UnsafeSql","name":"UnsafeSql"}],"namespace":{"html_id":"lustra/Lustra/Expression","kind":"class","full_name":"Lustra::Expression","name":"Expression"},"doc":"Allow any type to be used into the expression engine\n  by including the module Lustra::Expression::Literal\n  and defining the method `to_sql`.","summary":"<p>Allow any type to be used into the expression engine   by including the module Lustra::Expression::Literal   and defining the method <code><a href=\"../../Lustra/Expression/Literal.html#to_sql-instance-method\">#to_sql</a></code>.</p>","instance_methods":[{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":true,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/expression/expression.cr","line_number":64,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L64"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":true,"location":{"filename":"src/lustra/expression/expression.cr","line_number":63,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L63"},"def":{"name":"to_sql","visibility":"Public","body":""},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node","path":"Lustra/Expression/Node.html","kind":"class","full_name":"Lustra::Expression::Node","name":"Node","abstract":true,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/node.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L4"},{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":144,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L144"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"}],"subclasses":[{"html_id":"lustra/Lustra/Expression/Node/Between","kind":"class","full_name":"Lustra::Expression::Node::Between","name":"Between"},{"html_id":"lustra/Lustra/Expression/Node/DoubleOperator","kind":"class","full_name":"Lustra::Expression::Node::DoubleOperator","name":"DoubleOperator"},{"html_id":"lustra/Lustra/Expression/Node/Function","kind":"class","full_name":"Lustra::Expression::Node::Function","name":"Function"},{"html_id":"lustra/Lustra/Expression/Node/InArray","kind":"class","full_name":"Lustra::Expression::Node::InArray","name":"InArray"},{"html_id":"lustra/Lustra/Expression/Node/InRange","kind":"class","full_name":"Lustra::Expression::Node::InRange","name":"InRange"},{"html_id":"lustra/Lustra/Expression/Node/InSelect","kind":"class","full_name":"Lustra::Expression::Node::InSelect","name":"InSelect"},{"html_id":"lustra/Lustra/Expression/Node/JSONB/ArrayContains","kind":"class","full_name":"Lustra::Expression::Node::JSONB::ArrayContains","name":"ArrayContains"},{"html_id":"lustra/Lustra/Expression/Node/JSONB/Equality","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Equality","name":"Equality"},{"html_id":"lustra/Lustra/Expression/Node/JSONB/Field","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Field","name":"Field"},{"html_id":"lustra/Lustra/Expression/Node/Literal","kind":"class","full_name":"Lustra::Expression::Node::Literal","name":"Literal"},{"html_id":"lustra/Lustra/Expression/Node/Minus","kind":"class","full_name":"Lustra::Expression::Node::Minus","name":"Minus"},{"html_id":"lustra/Lustra/Expression/Node/NodeArray","kind":"class","full_name":"Lustra::Expression::Node::NodeArray","name":"NodeArray"},{"html_id":"lustra/Lustra/Expression/Node/Not","kind":"class","full_name":"Lustra::Expression::Node::Not","name":"Not"},{"html_id":"lustra/Lustra/Expression/Node/NotBetween","kind":"class","full_name":"Lustra::Expression::Node::NotBetween","name":"NotBetween"},{"html_id":"lustra/Lustra/Expression/Node/Null","kind":"class","full_name":"Lustra::Expression::Node::Null","name":"Null"},{"html_id":"lustra/Lustra/Expression/Node/PGArray","kind":"class","full_name":"Lustra::Expression::Node::PGArray(T)","name":"PGArray"},{"html_id":"lustra/Lustra/Expression/Node/Raw","kind":"class","full_name":"Lustra::Expression::Node::Raw","name":"Raw"},{"html_id":"lustra/Lustra/Expression/Node/Variable","kind":"class","full_name":"Lustra::Expression::Node::Variable","name":"Variable"}],"namespace":{"html_id":"lustra/Lustra/Expression","kind":"class","full_name":"Lustra::Expression","name":"Expression"},"doc":"Mother class of all the rendering nodes","summary":"<p>Mother class of all the rendering nodes</p>","instance_methods":[{"html_id":"!=(any:Node):Node-instance-method","name":"!=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L49"},"def":{"name":"!=","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"<>\")"},"external_var":false},{"html_id":"!=(some_nil:Nil):Node-instance-method","name":"!=","abstract":false,"args":[{"name":"some_nil","external_name":"some_nil","restriction":"Nil"}],"args_string":"(some_nil : Nil) : Node","args_html":"(some_nil : Nil) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L49"},"def":{"name":"!=","args":[{"name":"some_nil","external_name":"some_nil","restriction":"Nil"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Null.new, \"IS NOT\")"},"external_var":false},{"html_id":"!=(any:T):NodeforallT-instance-method","name":"!=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L49"},"def":{"name":"!=","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"<>\")"},"external_var":false},{"html_id":"!~(any:Node):Node-instance-method","name":"!~","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L29"},"def":{"name":"!~","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"!~\")"},"external_var":false},{"html_id":"!~(regexp:Regex):Node-instance-method","name":"!~","abstract":false,"args":[{"name":"regexp","external_name":"regexp","restriction":"Regex"}],"args_string":"(regexp : Regex) : Node","args_html":"(regexp : Regex) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L41"},"def":{"name":"!~","args":[{"name":"regexp","external_name":"regexp","restriction":"Regex"}],"return_type":"Node","visibility":"Public","body":"if regexp.options.ignore_case?\n  Node::DoubleOperator.new(self, Literal.new(regexp.source), \"!~*\")\nelse\n  Node::DoubleOperator.new(self, Literal.new(regexp.source), \"!~\")\nend"},"external_var":false},{"html_id":"&(any:Node):Node-instance-method","name":"&","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":53,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L53"},"def":{"name":"&","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"AND\")"},"external_var":false},{"html_id":"&(any:T):NodeforallT-instance-method","name":"&","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":53,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L53"},"def":{"name":"&","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"AND\")"},"external_var":false},{"html_id":"*(any:Node):Node-instance-method","name":"*","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"*","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"*\")"},"external_var":false},{"html_id":"*(any:T):NodeforallT-instance-method","name":"*","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"*","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"*\")"},"external_var":false},{"html_id":"+(any:Node):Node-instance-method","name":"+","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"+","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"+\")"},"external_var":false},{"html_id":"+(any:T):NodeforallT-instance-method","name":"+","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"+","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"+\")"},"external_var":false},{"html_id":"-(any:Node):Node-instance-method","name":"-","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"-","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"-\")"},"external_var":false},{"html_id":"-(any:T):NodeforallT-instance-method","name":"-","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"-","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"-\")"},"external_var":false},{"html_id":"--instance-method","name":"-","abstract":false,"location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":78,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L78"},"def":{"name":"-","visibility":"Public","body":"Node::Minus.new(self)"},"external_var":false},{"html_id":"/(any:Node):Node-instance-method","name":"/","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"/","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"/\")"},"external_var":false},{"html_id":"/(any:T):NodeforallT-instance-method","name":"/","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"/","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"/\")"},"external_var":false},{"html_id":"<(any:Node):Node-instance-method","name":"<","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"<","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"<\")"},"external_var":false},{"html_id":"<(any:T):NodeforallT-instance-method","name":"<","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"<","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"<\")"},"external_var":false},{"html_id":"<=(any:Node):Node-instance-method","name":"<=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":"<=","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"<=\")"},"external_var":false},{"html_id":"<=(any:T):NodeforallT-instance-method","name":"<=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":"<=","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"<=\")"},"external_var":false},{"html_id":"==(any:Node):Node-instance-method","name":"==","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L50"},"def":{"name":"==","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"=\")"},"external_var":false},{"html_id":"==(some_nil:Nil):Node-instance-method","name":"==","abstract":false,"args":[{"name":"some_nil","external_name":"some_nil","restriction":"Nil"}],"args_string":"(some_nil : Nil) : Node","args_html":"(some_nil : Nil) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L50"},"def":{"name":"==","args":[{"name":"some_nil","external_name":"some_nil","restriction":"Nil"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Null.new, \"IS\")"},"external_var":false},{"html_id":"==(any:T):NodeforallT-instance-method","name":"==","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L50"},"def":{"name":"==","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"=\")"},"external_var":false},{"html_id":"=~(any:Node):Node-instance-method","name":"=~","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L25"},"def":{"name":"=~","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"~\")"},"external_var":false},{"html_id":"=~(regexp:Regex):Node-instance-method","name":"=~","abstract":false,"args":[{"name":"regexp","external_name":"regexp","restriction":"Regex"}],"args_string":"(regexp : Regex) : Node","args_html":"(regexp : Regex) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L33"},"def":{"name":"=~","args":[{"name":"regexp","external_name":"regexp","restriction":"Regex"}],"return_type":"Node","visibility":"Public","body":"if regexp.options.ignore_case?\n  Node::DoubleOperator.new(self, Literal.new(regexp.source), \"~*\")\nelse\n  Node::DoubleOperator.new(self, Literal.new(regexp.source), \"~\")\nend"},"external_var":false},{"html_id":">(any:Node):Node-instance-method","name":">","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":">","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \">\")"},"external_var":false},{"html_id":">(any:T):NodeforallT-instance-method","name":">","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":">","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \">\")"},"external_var":false},{"html_id":">=(any:Node):Node-instance-method","name":">=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","def":{"name":">=","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \">=\")"},"external_var":false},{"html_id":">=(any:T):NodeforallT-instance-method","name":">=","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","def":{"name":">=","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \">=\")"},"external_var":false},{"html_id":"|(any:Node):Node-instance-method","name":"|","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L54"},"def":{"name":"|","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"OR\")"},"external_var":false},{"html_id":"|(any:T):NodeforallT-instance-method","name":"|","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L54"},"def":{"name":"|","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"OR\")"},"external_var":false},{"html_id":"~-instance-method","name":"~","abstract":false,"location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":82,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L82"},"def":{"name":"~","visibility":"Public","body":"Node::Not.new(self)"},"external_var":false},{"html_id":"between(a,b)-instance-method","name":"between","abstract":false,"args":[{"name":"a","external_name":"a","restriction":""},{"name":"b","external_name":"b","restriction":""}],"args_string":"(a, b)","args_html":"(a, b)","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L74"},"def":{"name":"between","args":[{"name":"a","external_name":"a","restriction":""},{"name":"b","external_name":"b","restriction":""}],"visibility":"Public","body":"Node::Between.new(self, a, b)"},"external_var":false},{"html_id":"ilike(any:Node):Node-instance-method","name":"ilike","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L52"},"def":{"name":"ilike","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"ILIKE\")"},"external_var":false},{"html_id":"ilike(any:T):NodeforallT-instance-method","name":"ilike","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L52"},"def":{"name":"ilike","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"ILIKE\")"},"external_var":false},{"html_id":"in?(range:Range(B,E))forallB,E-instance-method","name":"in?","abstract":false,"args":[{"name":"range","external_name":"range","restriction":"Range(B, E)"}],"args_string":"(range : Range(B, E)) forall B, E","args_html":"(range : Range(B, E)) forall B, E","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L56"},"def":{"name":"in?","args":[{"name":"range","external_name":"range","restriction":"Range(B, E)"}],"visibility":"Public","body":"Node::InRange.new(self, Lustra::Expression[range.begin]..Lustra::Expression[range.end], range.exclusive?)"},"external_var":false},{"html_id":"in?(arr:Array(T))forallT-instance-method","name":"in?","abstract":false,"args":[{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"args_string":"(arr : Array(T)) forall T","args_html":"(arr : Array(T)) forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L62"},"def":{"name":"in?","args":[{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"visibility":"Public","body":"Node::InArray.new(self, arr.map do |x| Lustra::Expression[x] end)"},"external_var":false},{"html_id":"in?(tuple:Tuple(*T))forallT-instance-method","name":"in?","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"Tuple(*T)"}],"args_string":"(tuple : Tuple(*T)) forall T","args_html":"(tuple : Tuple(<span class=\"o\">*</span><span class=\"t\">T</span>)) forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":66,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L66"},"def":{"name":"in?","args":[{"name":"tuple","external_name":"tuple","restriction":"Tuple(*T)"}],"visibility":"Public","body":"in?(tuple.to_a)"},"external_var":false},{"html_id":"in?(request:Lustra::SQL::SelectBuilder)-instance-method","name":"in?","abstract":false,"args":[{"name":"request","external_name":"request","restriction":"::Lustra::SQL::SelectBuilder"}],"args_string":"(request : Lustra::SQL::SelectBuilder)","args_html":"(request : <a href=\"../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a>)","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":70,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L70"},"def":{"name":"in?","args":[{"name":"request","external_name":"request","restriction":"::Lustra::SQL::SelectBuilder"}],"visibility":"Public","body":"Node::InSelect.new(self, request)"},"external_var":false},{"html_id":"like(any:Node):Node-instance-method","name":"like","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"Node"}],"args_string":"(any : Node) : Node","args_html":"(any : <a href=\"../../Lustra/Expression/Node.html\">Node</a>) : <a href=\"../../Lustra/Expression/Node.html\">Node</a>","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L51"},"def":{"name":"like","args":[{"name":"any","external_name":"any","restriction":"Node"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, any, \"LIKE\")"},"external_var":false},{"html_id":"like(any:T):NodeforallT-instance-method","name":"like","abstract":false,"args":[{"name":"any","external_name":"any","restriction":"T"}],"args_string":"(any : T) : Node forall T","args_html":"(any : T) : <a href=\"../../Lustra/Expression/Node.html\">Node</a> forall T","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L51"},"def":{"name":"like","args":[{"name":"any","external_name":"any","restriction":"T"}],"return_type":"Node","visibility":"Public","body":"Node::DoubleOperator.new(self, Literal.new(any), \"LIKE\")"},"external_var":false},{"html_id":"resolve:String-instance-method","name":"resolve","abstract":true,"location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":86,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L86"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":""},"external_var":false}],"macros":[{"html_id":"define_operator(op_name,sql_name,null=false)-macro","name":"define_operator","abstract":false,"args":[{"name":"op_name","external_name":"op_name","restriction":""},{"name":"sql_name","external_name":"sql_name","restriction":""},{"name":"null","default_value":"false","external_name":"null","restriction":""}],"args_string":"(op_name, sql_name, null = false)","args_html":"(op_name, sql_name, null = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/expression/nodes/node.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node.cr#L5"},"def":{"name":"define_operator","args":[{"name":"op_name","external_name":"op_name","restriction":""},{"name":"sql_name","external_name":"sql_name","restriction":""},{"name":"null","default_value":"false","external_name":"null","restriction":""}],"visibility":"Public","body":"    def \n{{ op_name.id }}\n(any : Node) : Node\n      Node::DoubleOperator.new(self, any, \"\n{{ sql_name.id }}\n\")\n    \nend\n\n    \n{% if null %}\n      def {{ op_name.id }}(some_nil : Nil) : Node\n        Node::DoubleOperator.new(self, Null.new, {{ null }} )\n      end\n    {% end %}\n\n\n    def \n{{ op_name.id }}\n(any : T) : Node forall T\n      Node::DoubleOperator.new(self, Literal.new(any), \"\n{{ sql_name.id }}\n\")\n    \nend\n  \n"}}],"types":[{"html_id":"lustra/Lustra/Expression/Node/Between","path":"Lustra/Expression/Node/Between.html","kind":"class","full_name":"Lustra::Expression::Node::Between","name":"Between","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/between.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/between.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering of `(var BETWEEN a AND b)`\nexpressions.","summary":"<p>A node managing the rendering of <code>(var BETWEEN a AND b)</code> expressions.</p>","constructors":[{"html_id":"new(target:Node,starts:BetweenType,ends:BetweenType)-class-method","name":"new","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"starts","external_name":"starts","restriction":"BetweenType"},{"name":"ends","external_name":"ends","restriction":"BetweenType"}],"args_string":"(target : Node, starts : BetweenType, ends : BetweenType)","args_html":"(target : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, starts : <a href=\"../../../Lustra/Expression/Node/Between/BetweenType.html\">BetweenType</a>, ends : <a href=\"../../../Lustra/Expression/Node/Between/BetweenType.html\">BetweenType</a>)","location":{"filename":"src/lustra/expression/nodes/between.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/between.cr#L8"},"def":{"name":"new","args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"starts","external_name":"starts","restriction":"BetweenType"},{"name":"ends","external_name":"ends","restriction":"BetweenType"}],"visibility":"Public","body":"_ = allocate\n_.initialize(target, starts, ends)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/between.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/between.cr#L11"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"(\", @target.resolve, \" BETWEEN \", Lustra::Expression.safe_literal(@starts), \" AND \", Lustra::Expression.safe_literal(@ends), \")\"}.join"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Expression/Node/Between/BetweenType","path":"Lustra/Expression/Node/Between/BetweenType.html","kind":"alias","full_name":"Lustra::Expression::Node::Between::BetweenType","name":"BetweenType","abstract":false,"locations":[{"filename":"src/lustra/expression/nodes/between.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/between.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Float32 | Float64 | Int32 | Int64 | Lustra::Expression::Node | String | Time)","aliased_html":"Float32 | Float64 | Int32 | Int64 | <a href=\"../../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a> | String | <a href=\"../../../../Time.html\">Time</a>","const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node/Between","kind":"class","full_name":"Lustra::Expression::Node::Between","name":"Between"}}]},{"html_id":"lustra/Lustra/Expression/Node/DoubleOperator","path":"Lustra/Expression/Node/DoubleOperator.html","kind":"class","full_name":"Lustra::Expression::Node::DoubleOperator","name":"DoubleOperator","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/double_operator.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/double_operator.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering of\ncombination operations like `<val1> <op> <val2>`","summary":"<p>A node managing the rendering of combination operations like <code>&lt;val1&gt; &lt;op&gt; &lt;val2&gt;</code></p>","constructors":[{"html_id":"new(a:Node,b:Node,op:String)-class-method","name":"new","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Node"},{"name":"b","external_name":"b","restriction":"Node"},{"name":"op","external_name":"op","restriction":"String"}],"args_string":"(a : Node, b : Node, op : String)","args_html":"(a : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, b : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, op : String)","location":{"filename":"src/lustra/expression/nodes/double_operator.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/double_operator.cr#L6"},"def":{"name":"new","args":[{"name":"a","external_name":"a","restriction":"Node"},{"name":"b","external_name":"b","restriction":"Node"},{"name":"op","external_name":"op","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(a, b, op)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/double_operator.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/double_operator.cr#L8"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"(\", @a.resolve, \" \", @op, \" \", @b.resolve, \")\"}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/Function","path":"Lustra/Expression/Node/Function.html","kind":"class","full_name":"Lustra::Expression::Node::Function","name":"Function","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/function.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/function.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering of functions in Postgres.","summary":"<p>A node managing the rendering of functions in Postgres.</p>","constructors":[{"html_id":"new(name:String,args:Array(String))-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"args","external_name":"args","restriction":"Array(String)"}],"args_string":"(name : String, args : Array(String))","args_html":"(name : String, args : Array(String))","location":{"filename":"src/lustra/expression/nodes/function.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/function.cr#L5"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"args","external_name":"args","restriction":"Array(String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, args)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/function.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/function.cr#L7"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{@name, \"(\", @args.join(\", \"), \")\"}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/InArray","path":"Lustra/Expression/Node/InArray.html","kind":"class","full_name":"Lustra::Expression::Node::InArray","name":"InArray","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/in_array.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_array.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering of array in Postgres.\n- It renders `val IN (...)`.\n- If the array passed as argument is empty, it renders `FALSE` instead.","summary":"<p>A node managing the rendering of array in Postgres.</p>","constructors":[{"html_id":"new(target:Node,array:Array(String))-class-method","name":"new","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"array","external_name":"array","restriction":"Array(String)"}],"args_string":"(target : Node, array : Array(String))","args_html":"(target : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, array : Array(String))","location":{"filename":"src/lustra/expression/nodes/in_array.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_array.cr#L7"},"def":{"name":"new","args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"array","external_name":"array","restriction":"Array(String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(target, array)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/in_array.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_array.cr#L9"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"if @array.size == 0\n  \"FALSE\"\nelse\n  {@target.resolve, \" IN (\", @array.join(\", \"), \")\"}.join\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/InRange","path":"Lustra/Expression/Node/InRange.html","kind":"class","full_name":"Lustra::Expression::Node::InRange","name":"InRange","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/in_range.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_range.cr#L19"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering a range in Postgres.\n\nExample:\n\n```\nvalue.in?(1..5)\n```\n\nwill render:\n\n```\nvalue >= 1 AND value < 5\n```\n\nInclusion and exclusion of the last number of the range is featured\n","summary":"<p>A node managing the rendering a range in Postgres.</p>","constructors":[{"html_id":"new(target:Node,range:Range(String,String),exclusive:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"range","external_name":"range","restriction":"Range(String, String)"},{"name":"exclusive","default_value":"false","external_name":"exclusive","restriction":"::Bool"}],"args_string":"(target : Node, range : Range(String, String), exclusive : Bool = false)","args_html":"(target : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, range : Range(String, String), exclusive : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/expression/nodes/in_range.cr","line_number":20,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_range.cr#L20"},"def":{"name":"new","args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"range","external_name":"range","restriction":"Range(String, String)"},{"name":"exclusive","default_value":"false","external_name":"exclusive","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(target, range, exclusive)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/in_range.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_range.cr#L22"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"rt = @target.resolve\nfinal_op = @exclusive ? \" < \" : \" <= \"\n\n{\"(\", rt, \" >= \", @range.begin, \" AND \", rt, final_op, @range.end, \")\"}.join\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/InSelect","path":"Lustra/Expression/Node/InSelect.html","kind":"class","full_name":"Lustra::Expression::Node::InSelect","name":"InSelect","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/in_select.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_select.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":" A node managing the rendering of `value IN ( <SUBQUERY> )`","summary":"<p>A node managing the rendering of <code>value IN ( &lt;SUBQUERY&gt; )</code></p>","constructors":[{"html_id":"new(target:Node,select__arg0:Lustra::SQL::SelectBuilder)-class-method","name":"new","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"__arg0","external_name":"select","restriction":"Lustra::SQL::SelectBuilder"}],"args_string":"(target : Node, select __arg0 : Lustra::SQL::SelectBuilder)","args_html":"(target : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, select __arg0 : <a href=\"../../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a>)","location":{"filename":"src/lustra/expression/nodes/in_select.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_select.cr#L5"},"def":{"name":"new","args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"__arg0","external_name":"select","restriction":"Lustra::SQL::SelectBuilder"}],"visibility":"Public","body":"_ = allocate\n_.initialize(target, __arg0)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/in_select.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/in_select.cr#L7"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{@target.resolve, \" IN (\", @select.to_sql, \")\"}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/JSONB","path":"Lustra/Expression/Node/JSONB.html","kind":"module","full_name":"Lustra::Expression::Node::JSONB","name":"JSONB","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"types":[{"html_id":"lustra/Lustra/Expression/Node/JSONB/ArrayContains","path":"Lustra/Expression/Node/JSONB/ArrayContains.html","kind":"class","full_name":"Lustra::Expression::Node::JSONB::ArrayContains","name":"ArrayContains","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":58,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L58"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node/JSONB","kind":"module","full_name":"Lustra::Expression::Node::JSONB","name":"JSONB"},"doc":"Define a __array contains? (?)__ operation between a jsonb column and a json hash","summary":"<p>Define a <strong>array contains? (?)</strong> operation between a jsonb column and a json hash</p>","constructors":[{"html_id":"new(jsonb_field:String,value:String)-class-method","name":"new","abstract":false,"args":[{"name":"jsonb_field","external_name":"jsonb_field","restriction":"::String"},{"name":"value","external_name":"value","restriction":"::String"}],"args_string":"(jsonb_field : String, value : String)","args_html":"(jsonb_field : String, value : String)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L62"},"def":{"name":"new","args":[{"name":"jsonb_field","external_name":"jsonb_field","restriction":"::String"},{"name":"value","external_name":"value","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(jsonb_field, value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"jsonb_field:String-instance-method","name":"jsonb_field","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":59,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L59"},"def":{"name":"jsonb_field","return_type":"String","visibility":"Public","body":"@jsonb_field"},"external_var":false},{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L65"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{@jsonb_field, @value}.join(\" ? \")"},"external_var":false},{"html_id":"value:String-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":60,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L60"},"def":{"name":"value","return_type":"String","visibility":"Public","body":"@value"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/JSONB/Equality","path":"Lustra/Expression/Node/JSONB/Equality.html","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Equality","name":"Equality","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"},{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L43"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"}],"namespace":{"html_id":"lustra/Lustra/Expression/Node/JSONB","kind":"module","full_name":"Lustra::Expression::Node::JSONB","name":"JSONB"},"doc":"Define a __value match? (@>)__ operation between a jsonb column and a json hash","summary":"<p>Define a <strong>value match? (@&gt;)</strong> operation between a jsonb column and a json hash</p>","constructors":[{"html_id":"new(jsonb_field:String,value:Hash(String,Lustra::SQL::JSONB::JSONBKey))-class-method","name":"new","abstract":false,"args":[{"name":"jsonb_field","external_name":"jsonb_field","restriction":"::String"},{"name":"value","external_name":"value","restriction":"::Hash(::String, ::Lustra::SQL::JSONB::JSONBKey)"}],"args_string":"(jsonb_field : String, value : Hash(String, Lustra::SQL::JSONB::JSONBKey))","args_html":"(jsonb_field : String, value : Hash(String, <a href=\"../../../../Lustra/SQL/JSONB/JSONBKey.html\">Lustra::SQL::JSONB::JSONBKey</a>))","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L49"},"def":{"name":"new","args":[{"name":"jsonb_field","external_name":"jsonb_field","restriction":"::String"},{"name":"value","external_name":"value","restriction":"::Hash(::String, ::Lustra::SQL::JSONB::JSONBKey)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(jsonb_field, value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"jsonb_field:String-instance-method","name":"jsonb_field","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":46,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L46"},"def":{"name":"jsonb_field","return_type":"String","visibility":"Public","body":"@jsonb_field"},"external_var":false},{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L52"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{@jsonb_field, Lustra::Expression[@value.to_json]}.join(\" @> \")"},"external_var":false},{"html_id":"value:JSONBHash-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":47,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L47"},"def":{"name":"value","return_type":"JSONBHash","visibility":"Public","body":"@value"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/JSONB/Field","path":"Lustra/Expression/Node/JSONB/Field.html","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Field","name":"Field","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"},{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"}],"namespace":{"html_id":"lustra/Lustra/Expression/Node/JSONB","kind":"module","full_name":"Lustra::Expression::Node::JSONB","name":"JSONB"},"constructors":[{"html_id":"new(field:Lustra::Expression::Node,key:String,cast:Nil|String=nil)-class-method","name":"new","abstract":false,"args":[{"name":"field","external_name":"field","restriction":"::Lustra::Expression::Node"},{"name":"key","external_name":"key","restriction":"::String"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":"::Nil | ::String"}],"args_string":"(field : Lustra::Expression::Node, key : String, cast : Nil | String = nil)","args_html":"(field : <a href=\"../../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>, key : String, cast : Nil | String = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L10"},"def":{"name":"new","args":[{"name":"field","external_name":"field","restriction":"::Lustra::Expression::Node"},{"name":"key","external_name":"key","restriction":"::String"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":"::Nil | ::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(field, key, cast)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"==(value:Lustra::Expression::Node)-instance-method","name":"==","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"Lustra::Expression::Node"}],"args_string":"(value : Lustra::Expression::Node)","args_html":"(value : <a href=\"../../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L21"},"def":{"name":"==","args":[{"name":"value","external_name":"value","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"super(value)"},"external_var":false},{"html_id":"==(value:_)-instance-method","name":"==","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"_"}],"args_string":"(value : _)","args_html":"(value : _)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L25"},"def":{"name":"==","args":[{"name":"value","external_name":"value","restriction":"_"}],"visibility":"Public","body":"if @cast\n  super(value)\nelse\n  Lustra::Expression::Node::JSONB::Equality.new(field.resolve, jsonb_k2h(key, value))\nend"},"external_var":false},{"html_id":"cast(cast:Nil|String)-instance-method","name":"cast","abstract":false,"args":[{"name":"cast","external_name":"cast","restriction":"::Nil | ::String"}],"args_string":"(cast : Nil | String)","args_html":"(cast : Nil | String)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L17"},"def":{"name":"cast","args":[{"name":"cast","external_name":"cast","restriction":"::Nil | ::String"}],"visibility":"Public","body":"@cast = cast\nself\n"},"external_var":false},{"html_id":"cast:String|Nil-instance-method","name":"cast","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L8"},"def":{"name":"cast","return_type":"String | ::Nil","visibility":"Public","body":"@cast"},"external_var":false},{"html_id":"contains?(expression:Lustra::Expression::Node)-instance-method","name":"contains?","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":"Lustra::Expression::Node"}],"args_string":"(expression : Lustra::Expression::Node)","args_html":"(expression : <a href=\"../../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L33"},"def":{"name":"contains?","args":[{"name":"expression","external_name":"expression","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"Lustra::Expression::Node::JSONB::ArrayContains.new(resolve, expression.resolve)"},"external_var":false},{"html_id":"contains?(expression)-instance-method","name":"contains?","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":""}],"args_string":"(expression)","args_html":"(expression)","location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L37"},"def":{"name":"contains?","args":[{"name":"expression","external_name":"expression","restriction":""}],"visibility":"Public","body":"Lustra::Expression::Node::JSONB::ArrayContains.new(resolve, Lustra::Expression[expression])"},"external_var":false},{"html_id":"field:Node-instance-method","name":"field","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L6"},"def":{"name":"field","return_type":"Node","visibility":"Public","body":"@field"},"external_var":false},{"html_id":"key:String-instance-method","name":"key","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L7"},"def":{"name":"key","return_type":"String","visibility":"Public","body":"@key"},"external_var":false},{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/extensions/jsonb/expression.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/expression.cr#L13"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"jsonb_resolve(@field.resolve, jsonb_k2a(key), @cast)"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Expression/Node/Literal","path":"Lustra/Expression/Node/Literal.html","kind":"class","full_name":"Lustra::Expression::Node::Literal","name":"Literal","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/literal.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/literal.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"Management of rendering of literal values.","summary":"<p>Management of rendering of literal values.</p>","constructors":[{"html_id":"new(value)-class-method","name":"new","abstract":false,"args":[{"name":"value","external_name":"value","restriction":""}],"args_string":"(value)","args_html":"(value)","location":{"filename":"src/lustra/expression/nodes/literal.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/literal.cr#L7"},"def":{"name":"new","args":[{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/literal.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/literal.cr#L17"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"Lustra::Expression[@value]"},"external_var":false},{"html_id":"value:AvailableLiteral-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/expression/nodes/literal.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/literal.cr#L5"},"def":{"name":"value","return_type":"AvailableLiteral","visibility":"Public","body":"@value"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/Minus","path":"Lustra/Expression/Node/Minus.html","kind":"class","full_name":"Lustra::Expression::Node::Minus","name":"Minus","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/minus.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/minus.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the unary `-` operator.","summary":"<p>A node managing the unary <code>-</code> operator.</p>","constructors":[{"html_id":"new(a:Node)-class-method","name":"new","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Node"}],"args_string":"(a : Node)","args_html":"(a : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>)","location":{"filename":"src/lustra/expression/nodes/minus.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/minus.cr#L5"},"def":{"name":"new","args":[{"name":"a","external_name":"a","restriction":"Node"}],"visibility":"Public","body":"_ = allocate\n_.initialize(a)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/minus.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/minus.cr#L7"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"-\", @a.resolve}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/NodeArray","path":"Lustra/Expression/Node/NodeArray.html","kind":"class","full_name":"Lustra::Expression::Node::NodeArray","name":"NodeArray","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"This node is used to generate expression like `( a AND b AND ... AND k )`","summary":"<p>This node is used to generate expression like `( a AND b AND ...</p>","constructors":[{"html_id":"new(expression:Array(Node),link:String)-class-method","name":"new","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":"Array(Node)"},{"name":"link","external_name":"link","restriction":"::String"}],"args_string":"(expression : Array(Node), link : String)","args_html":"(expression : Array(<a href=\"../../../Lustra/Expression/Node.html\">Node</a>), link : String)","location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L8"},"def":{"name":"new","args":[{"name":"expression","external_name":"expression","restriction":"Array(Node)"},{"name":"link","external_name":"link","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(expression, link)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"expression:Array(Node)-instance-method","name":"expression","abstract":false,"location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L5"},"def":{"name":"expression","return_type":"Array(Node)","visibility":"Public","body":"@expression"},"external_var":false},{"html_id":"expression=(expression:Array(Node))-instance-method","name":"expression=","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":"Array(Node)"}],"args_string":"(expression : Array(Node))","args_html":"(expression : Array(<a href=\"../../../Lustra/Expression/Node.html\">Node</a>))","location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L5"},"def":{"name":"expression=","args":[{"name":"expression","external_name":"expression","restriction":"Array(Node)"}],"visibility":"Public","body":"@expression = expression"},"external_var":false},{"html_id":"link:String-instance-method","name":"link","abstract":false,"location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L6"},"def":{"name":"link","return_type":"String","visibility":"Public","body":"@link"},"external_var":false},{"html_id":"link=(link:String)-instance-method","name":"link=","abstract":false,"args":[{"name":"link","external_name":"link","restriction":"String"}],"args_string":"(link : String)","args_html":"(link : String)","location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L6"},"def":{"name":"link=","args":[{"name":"link","external_name":"link","restriction":"String"}],"visibility":"Public","body":"@link = link"},"external_var":false},{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/node_array.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/node_array.cr#L12"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"if !@expression.empty?\n  {\"(\", @expression.join(\" #{@link} \", &.resolve), \")\"}.join\nelse\n  \"\"\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/Not","path":"Lustra/Expression/Node/Not.html","kind":"class","full_name":"Lustra::Expression::Node::Not","name":"Not","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/not.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the unary `NOT` operator.","summary":"<p>A node managing the unary <code>NOT</code> operator.</p>","constructors":[{"html_id":"new(a:Node)-class-method","name":"new","abstract":false,"args":[{"name":"a","external_name":"a","restriction":"Node"}],"args_string":"(a : Node)","args_html":"(a : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>)","location":{"filename":"src/lustra/expression/nodes/not.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not.cr#L5"},"def":{"name":"new","args":[{"name":"a","external_name":"a","restriction":"Node"}],"visibility":"Public","body":"_ = allocate\n_.initialize(a)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/not.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not.cr#L7"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"NOT \", @a.resolve}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/NotBetween","path":"Lustra/Expression/Node/NotBetween.html","kind":"class","full_name":"Lustra::Expression::Node::NotBetween","name":"NotBetween","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/not_between.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not_between.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing the rendering of `(var NOT BETWEEN a AND b)`\nexpressions.","summary":"<p>A node managing the rendering of <code>(var NOT BETWEEN a AND b)</code> expressions.</p>","constructors":[{"html_id":"new(target:Node,starts:BetweenType,ends:BetweenType)-class-method","name":"new","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"starts","external_name":"starts","restriction":"BetweenType"},{"name":"ends","external_name":"ends","restriction":"BetweenType"}],"args_string":"(target : Node, starts : BetweenType, ends : BetweenType)","args_html":"(target : <a href=\"../../../Lustra/Expression/Node.html\">Node</a>, starts : <a href=\"../../../Lustra/Expression/Node/NotBetween/BetweenType.html\">BetweenType</a>, ends : <a href=\"../../../Lustra/Expression/Node/NotBetween/BetweenType.html\">BetweenType</a>)","location":{"filename":"src/lustra/expression/nodes/not_between.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not_between.cr#L8"},"def":{"name":"new","args":[{"name":"target","external_name":"target","restriction":"Node"},{"name":"starts","external_name":"starts","restriction":"BetweenType"},{"name":"ends","external_name":"ends","restriction":"BetweenType"}],"visibility":"Public","body":"_ = allocate\n_.initialize(target, starts, ends)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/not_between.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not_between.cr#L11"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"(\", @target.resolve, \" NOT BETWEEN \", Lustra::Expression[@starts], \" AND \", Lustra::Expression[@ends], \")\"}.join"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Expression/Node/NotBetween/BetweenType","path":"Lustra/Expression/Node/NotBetween/BetweenType.html","kind":"alias","full_name":"Lustra::Expression::Node::NotBetween::BetweenType","name":"BetweenType","abstract":false,"locations":[{"filename":"src/lustra/expression/nodes/not_between.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/not_between.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Float32 | Float64 | Int32 | Int64 | Lustra::Expression::Node | String | Time)","aliased_html":"Float32 | Float64 | Int32 | Int64 | <a href=\"../../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a> | String | <a href=\"../../../../Time.html\">Time</a>","const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node/NotBetween","kind":"class","full_name":"Lustra::Expression::Node::NotBetween","name":"NotBetween"}}]},{"html_id":"lustra/Lustra/Expression/Node/Null","path":"Lustra/Expression/Node/Null.html","kind":"class","full_name":"Lustra::Expression::Node::Null","name":"Null","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/null.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/null.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"Render NULL !","summary":"<p>Render NULL !</p>","constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/expression/nodes/null.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/null.cr#L5"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/null.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/null.cr#L8"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"\"NULL\""},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/PGArray","path":"Lustra/Expression/Node/PGArray.html","kind":"class","full_name":"Lustra::Expression::Node::PGArray(T)","name":"PGArray","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/pg_array.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/pg_array.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A node managing PG structure `array[args...]`\nNamed PGArray instead of Array to avoid issue with naming","summary":"<p>A node managing PG structure <code>array[args...]</code> Named PGArray instead of Array to avoid issue with naming</p>","constructors":[{"html_id":"new(arr:Array(T))-class-method","name":"new","abstract":false,"args":[{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"args_string":"(arr : Array(T))","args_html":"(arr : Array(T))","location":{"filename":"src/lustra/expression/nodes/pg_array.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/pg_array.cr#L8"},"def":{"name":"new","args":[{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"visibility":"Public","body":"_ = PGArray(T).allocate\n_.initialize(arr)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/pg_array.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/pg_array.cr#L11"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"{\"array[\", Lustra::Expression[@arr].join(\", \"), \"]\"}.join"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/Raw","path":"Lustra/Expression/Node/Raw.html","kind":"class","full_name":"Lustra::Expression::Node::Raw","name":"Raw","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/raw.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/raw.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"This node manage the rendering of a raw SQL fragment.","summary":"<p>This node manage the rendering of a raw SQL fragment.</p>","constructors":[{"html_id":"new(raw:String)-class-method","name":"new","abstract":false,"args":[{"name":"raw","external_name":"raw","restriction":"String"}],"args_string":"(raw : String)","args_html":"(raw : String)","location":{"filename":"src/lustra/expression/nodes/raw.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/raw.cr#L5"},"def":{"name":"new","args":[{"name":"raw","external_name":"raw","restriction":"String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(raw)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/raw.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/raw.cr#L7"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"@raw"},"external_var":false}]},{"html_id":"lustra/Lustra/Expression/Node/Variable","path":"Lustra/Expression/Node/Variable.html","kind":"class","full_name":"Lustra::Expression::Node::Variable","name":"Variable","abstract":false,"superclass":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},{"html_id":"lustra/Lustra/Expression/JSONB/Node","kind":"module","full_name":"Lustra::Expression::JSONB::Node","name":"Node"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/nodes/variable.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/variable.cr#L16"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Expression/Node","kind":"class","full_name":"Lustra::Expression::Node","name":"Node"},"doc":"A variable AST node.\nIt's what's created under the hood when you use a non-existent variable:\n\n```\nwhere { users.id != nil }\n\nwill produce this tree:\n\n# => double_operator('<>')\n#   # => variable('id', parent: 'users')\n#   # => null\n\n```","summary":"<p>A variable AST node.</p>","constructors":[{"html_id":"new(name:String,parent:Variable|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"parent","default_value":"nil","external_name":"parent","restriction":"Variable | ::Nil"}],"args_string":"(name : String, parent : Variable | Nil = nil)","args_html":"(name : String, parent : <a href=\"../../../Lustra/Expression/Node/Variable.html\">Variable</a> | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/expression/nodes/variable.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/variable.cr#L17"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"parent","default_value":"nil","external_name":"parent","restriction":"Variable | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, parent)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"resolve:String-instance-method","name":"resolve","abstract":false,"location":{"filename":"src/lustra/expression/nodes/variable.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/variable.cr#L28"},"def":{"name":"resolve","return_type":"String","visibility":"Public","body":"parent = @parent\nif parent\n  {parent.resolve, \".\", Lustra::SQL.escape(@name)}.join\nelse\n  Lustra::SQL.escape(@name)\nend\n"},"external_var":false}],"macros":[{"html_id":"method_missing(call)-macro","name":"method_missing","abstract":false,"args":[{"name":"call","external_name":"call","restriction":""}],"args_string":"(call)","args_html":"(call)","location":{"filename":"src/lustra/expression/nodes/variable.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/nodes/variable.cr#L19"},"def":{"name":"method_missing","args":[{"name":"call","external_name":"call","restriction":""}],"visibility":"Public","body":"    \n{% if call.args.size > 0 %}\n      args = Lustra::Expression[{{ call.args }}].join(\", \")\n      return Node::Variable.new(\"{{ call.name.id }}(#{args})\", self)\n    {% else %}\n      return Node::Variable.new({{ call.name.id.stringify }}, self)\n    {% end %}\n\n  \n"}}]}]},{"html_id":"lustra/Lustra/Expression/UnsafeSql","path":"Lustra/Expression/UnsafeSql.html","kind":"class","full_name":"Lustra::Expression::UnsafeSql","name":"UnsafeSql","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Expression/Literal","kind":"module","full_name":"Lustra::Expression::Literal","name":"Literal"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/expression/expression.cr","line_number":70,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L70"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Expression/Literal","kind":"module","full_name":"Lustra::Expression::Literal","name":"Literal"}],"namespace":{"html_id":"lustra/Lustra/Expression","kind":"class","full_name":"Lustra::Expression","name":"Expression"},"doc":"Wrap an unsafe string. Useful to cancel-out the\nsafe_literal function used internally.\nObviously, this can lead to SQL injection, so beware!","summary":"<p>Wrap an unsafe string.</p>","constructors":[{"html_id":"new(value:String)-class-method","name":"new","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"::String"}],"args_string":"(value : String)","args_html":"(value : String)","location":{"filename":"src/lustra/expression/expression.cr","line_number":75,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L75"},"def":{"name":"new","args":[{"name":"value","external_name":"value","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(value)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"to_json(json=nil):String-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","default_value":"nil","external_name":"json","restriction":""}],"args_string":"(json = nil) : String","args_html":"(json = <span class=\"n\">nil</span>) : String","location":{"filename":"src/lustra/expression/expression.cr","line_number":86,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L86"},"def":{"name":"to_json","args":[{"name":"json","default_value":"nil","external_name":"json","restriction":""}],"visibility":"Public","body":"@value"},"external_var":false},{"html_id":"to_s:String-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/lustra/expression/expression.cr","line_number":78,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L78"},"def":{"name":"to_s","visibility":"Public","body":"@value"},"external_var":false},{"html_id":"to_sql:String-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/expression/expression.cr","line_number":82,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/expression/expression.cr#L82"},"def":{"name":"to_sql","visibility":"Public","body":"@value"},"external_var":false}]}]},{"html_id":"lustra/Lustra/IllegalEnumValueError","path":"Lustra/IllegalEnumValueError.html","kind":"class","full_name":"Lustra::IllegalEnumValueError","name":"IllegalEnumValueError","abstract":false,"superclass":{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/enum/enum.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/enum.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"}},{"html_id":"lustra/Lustra/Interval","path":"Lustra/Interval.html","kind":"struct","full_name":"Lustra::Interval","name":"Interval","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/interval/interval.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L17"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"It can be converted automatically from/to a `interval` column.\n\n## Usage example\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column interval : Lustra::TimeInDay\nend\n\ninterval = Lustra::Interval.new(60.days)\nrecord = MyModel.create!(interval: interval)\n```","summary":"<p>It can be converted automatically from/to a <code>interval</code> column.</p>","class_methods":[{"html_id":"decode(x:Slice(UInt8))-class-method","name":"decode","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Slice(UInt8)"}],"args_string":"(x : Slice(UInt8))","args_html":"(x : <a href=\"../Slice.html\">Slice</a>(UInt8))","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":109,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L109"},"def":{"name":"decode","args":[{"name":"x","external_name":"x","restriction":"Slice(UInt8)"}],"visibility":"Public","body":"io = IO::Memory.new(x, writeable: false)\n\nnew(io)\n"},"external_var":false}],"constructors":[{"html_id":"new(months:Int32=0,days:Int32=0,hours:Int32=0,minutes:Int32=0,seconds:Int32=0,milliseconds:Int32=0,microseconds:Int64=0)-class-method","name":"new","abstract":false,"args":[{"name":"months","default_value":"0","external_name":"months","restriction":"Int32"},{"name":"days","default_value":"0","external_name":"days","restriction":"Int32"},{"name":"hours","default_value":"0","external_name":"hours","restriction":"Int32"},{"name":"minutes","default_value":"0","external_name":"minutes","restriction":"Int32"},{"name":"seconds","default_value":"0","external_name":"seconds","restriction":"Int32"},{"name":"milliseconds","default_value":"0","external_name":"milliseconds","restriction":"Int32"},{"name":"microseconds","default_value":"0","external_name":"microseconds","restriction":"Int64"}],"args_string":"(months : Int32 = 0, days : Int32 = 0, hours : Int32 = 0, minutes : Int32 = 0, seconds : Int32 = 0, milliseconds : Int32 = 0, microseconds : Int64 = 0)","args_html":"(months : Int32 = <span class=\"n\">0</span>, days : Int32 = <span class=\"n\">0</span>, hours : Int32 = <span class=\"n\">0</span>, minutes : Int32 = <span class=\"n\">0</span>, seconds : Int32 = <span class=\"n\">0</span>, milliseconds : Int32 = <span class=\"n\">0</span>, microseconds : Int64 = <span class=\"n\">0</span>)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":55,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L55"},"def":{"name":"new","args":[{"name":"months","default_value":"0","external_name":"months","restriction":"Int32"},{"name":"days","default_value":"0","external_name":"days","restriction":"Int32"},{"name":"hours","default_value":"0","external_name":"hours","restriction":"Int32"},{"name":"minutes","default_value":"0","external_name":"minutes","restriction":"Int32"},{"name":"seconds","default_value":"0","external_name":"seconds","restriction":"Int32"},{"name":"milliseconds","default_value":"0","external_name":"milliseconds","restriction":"Int32"},{"name":"microseconds","default_value":"0","external_name":"microseconds","restriction":"Int64"}],"visibility":"Public","body":"_ = allocate\n_.initialize(months, days, hours, minutes, seconds, milliseconds, microseconds)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(months:Int32,days:Int32,microseconds:Number)-class-method","name":"new","doc":"For `PG::Interval`","summary":"<p>For <code><a href=\"../PG/Interval.html\">PG::Interval</a></code></p>","abstract":false,"args":[{"name":"months","external_name":"months","restriction":"Int32"},{"name":"days","external_name":"days","restriction":"Int32"},{"name":"microseconds","external_name":"microseconds","restriction":"Number"}],"args_string":"(months : Int32, days : Int32, microseconds : Number)","args_html":"(months : Int32, days : Int32, microseconds : Number)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L41"},"def":{"name":"new","args":[{"name":"months","external_name":"months","restriction":"Int32"},{"name":"days","external_name":"days","restriction":"Int32"},{"name":"microseconds","external_name":"microseconds","restriction":"Number"}],"visibility":"Public","body":"_ = allocate\n_.initialize(months, days, microseconds)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(span:Time::Span)-class-method","name":"new","abstract":false,"args":[{"name":"span","external_name":"span","restriction":"Time::Span"}],"args_string":"(span : Time::Span)","args_html":"(span : Time::Span)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L27"},"def":{"name":"new","args":[{"name":"span","external_name":"span","restriction":"Time::Span"}],"visibility":"Public","body":"_ = allocate\n_.initialize(span)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(span:Time::MonthSpan)-class-method","name":"new","abstract":false,"args":[{"name":"span","external_name":"span","restriction":"Time::MonthSpan"}],"args_string":"(span : Time::MonthSpan)","args_html":"(span : Time::MonthSpan)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L36"},"def":{"name":"new","args":[{"name":"span","external_name":"span","restriction":"Time::MonthSpan"}],"visibility":"Public","body":"_ = allocate\n_.initialize(span)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(io:IO)-class-method","name":"new","abstract":false,"args":[{"name":"io","external_name":"io","restriction":"IO"}],"args_string":"(io : IO)","args_html":"(io : IO)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":66,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L66"},"def":{"name":"new","args":[{"name":"io","external_name":"io","restriction":"IO"}],"visibility":"Public","body":"_ = allocate\n_.initialize(io)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"+(interval:self)-instance-method","name":"+","abstract":false,"args":[{"name":"interval","external_name":"interval","restriction":"self"}],"args_string":"(interval : self)","args_html":"(interval : <span class=\"k\">self</span>)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":97,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L97"},"def":{"name":"+","args":[{"name":"interval","external_name":"interval","restriction":"self"}],"visibility":"Public","body":"new(months: self.months + interval.months, day: self.days + interval.days, hours: self.hours + interval.hours, minutes: self.minutes + interval.minutes, seconds: self.seconds + interval.seconds, milliseconds: self.milliseconds + interval.milliseconds, microseconds: self.microseconds + interval.microseconds)"},"external_var":false},{"html_id":"days:Int32-instance-method","name":"days","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L19"},"def":{"name":"days","return_type":"Int32","visibility":"Public","body":"@days"},"external_var":false},{"html_id":"hours:Int32-instance-method","name":"hours","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L22"},"def":{"name":"hours","return_type":"Int32","visibility":"Public","body":"@hours"},"external_var":false},{"html_id":"microseconds:Int64-instance-method","name":"microseconds","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":20,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L20"},"def":{"name":"microseconds","return_type":"Int64","visibility":"Public","body":"@microseconds"},"external_var":false},{"html_id":"milliseconds:Int32-instance-method","name":"milliseconds","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L25"},"def":{"name":"milliseconds","return_type":"Int32","visibility":"Public","body":"@milliseconds"},"external_var":false},{"html_id":"minutes:Int32-instance-method","name":"minutes","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L23"},"def":{"name":"minutes","return_type":"Int32","visibility":"Public","body":"@minutes"},"external_var":false},{"html_id":"months:Int32-instance-method","name":"months","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L18"},"def":{"name":"months","return_type":"Int32","visibility":"Public","body":"@months"},"external_var":false},{"html_id":"seconds:Int32-instance-method","name":"seconds","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L24"},"def":{"name":"seconds","return_type":"Int32","visibility":"Public","body":"@seconds"},"external_var":false},{"html_id":"to_json(json:JSON::Builder):Nil-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder) : Nil","args_html":"(json : JSON::Builder) : Nil","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":76,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L76"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"return_type":"Nil","visibility":"Public","body":"json.string(to_s)"},"external_var":false},{"html_id":"to_s(io)-instance-method","name":"to_s","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":72,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L72"},"def":{"name":"to_s","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"\"\""},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/extensions/interval/interval.cr","line_number":80,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval.cr#L80"},"def":{"name":"to_sql","visibility":"Public","body":"o = [] of String\n\nif @months.zero?\nelse\n  ((o << @months.to_s) << \"months\")\nend\nif @days.zero?\nelse\n  ((o << @days.to_s) << \"days\")\nend\nif @hours.zero?\nelse\n  ((o << @hours.to_s) << \"hours\")\nend\nif @minutes.zero?\nelse\n  ((o << @minutes.to_s) << \"minutes\")\nend\nif @seconds.zero?\nelse\n  ((o << @seconds.to_s) << \"seconds\")\nend\nif @milliseconds.zero?\nelse\n  ((o << @milliseconds.to_s) << \"milliseconds\")\nend\nif @microseconds.zero?\nelse\n  ((o << @microseconds.to_s) << \"microseconds\")\nend\n\nLustra::SQL.unsafe({\"INTERVAL\", Lustra::Expression[o.join(\" \")]}.join(\" \"))\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Interval/Converter","path":"Lustra/Interval/Converter.html","kind":"class","full_name":"Lustra::Interval::Converter","name":"Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L27"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Interval","kind":"struct","full_name":"Lustra::Interval","name":"Interval"},"class_methods":[{"html_id":"to_column(x):Lustra::Interval|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Lustra::Interval | Nil","args_html":"(x) : <a href=\"../../Lustra/Interval.html\">Lustra::Interval</a> | Nil","location":{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L28"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Lustra::Interval | ::Nil","visibility":"Public","body":"case x\nwhen PG::Interval\n  Lustra::Interval.new(x.months, x.days, x.microseconds)\nwhen Slice(UInt8)\n  Lustra::Interval.decode(x.as(Slice(UInt8)))\nwhen Lustra::Interval\n  x\nwhen Nil\n  nil\nelse\n  raise(Lustra::ErrorMessages.converter_error(x.class, \"Interval\"))\nend"},"external_var":false},{"html_id":"to_db(x:Lustra::Interval|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Lustra::Interval | ::Nil"}],"args_string":"(x : Lustra::Interval | Nil)","args_html":"(x : <a href=\"../../Lustra/Interval.html\">Lustra::Interval</a> | Nil)","location":{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L43"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Lustra::Interval | ::Nil"}],"visibility":"Public","body":"x.try(&.to_sql)"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Migration","path":"Lustra/Migration.html","kind":"module","full_name":"Lustra::Migration","name":"Migration","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/Migration/Helper","kind":"module","full_name":"Lustra::Migration::Helper","name":"Helper"},{"html_id":"lustra/Lustra/Migration/FullTextSearchableHelpers","kind":"module","full_name":"Lustra::Migration::FullTextSearchableHelpers","name":"FullTextSearchableHelpers"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"locations":[{"filename":"src/lustra/extensions/enum/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L1"},{"filename":"src/lustra/migration/direction.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L22"},{"filename":"src/lustra/migration/migration.cr","line_number":57,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L57"},{"filename":"src/lustra/migration/operation/columns.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L1"},{"filename":"src/lustra/migration/operation/execute.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/execute.cr#L3"},{"filename":"src/lustra/migration/operation/indexes.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L1"},{"filename":"src/lustra/migration/operation/operation.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L1"},{"filename":"src/lustra/migration/operation/table.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"lustra.migration\")"}],"included_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Lustra/Migration/Helper","kind":"module","full_name":"Lustra::Migration::Helper","name":"Helper"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"# Lustra's migration system\n\nMigrations in Lustra are very similar to active record's migrations.\nMigrations are two-way modification of the database.\n\nIt helps to keep a consistent database state during development lifecycle\nof your application.\n\nTo create a migration, two ways:\n\n## Lustra command\n\n### TL;DR\n\nYou can create a new file which will be present in `src/db/migrate` using:\n\n`lustra-cli migration:g migration_name`\n\nThus will create a migration in `src/db/migration/[:uid]_migration_name.cr`\n(with uid number) and a class `MigrationName`\n\n### Advanced options\n\nYou can use `lustra-cli migration help` to get advanced options.\n\n## Manually\n\nYou can create a class following this naming convention:\n`Anything + Number.`\nThe number is then used to order the migration between each others and must be unique.\n\nFollowing the rule than inclusion is often better than inheritance, just\ninclude the module `Lustra::Migration` to your class.\n\n## Methods of migration\n\n### Migration direction\n\nOnly one method must be overrided: `change`. In comparison to ActiveRecord, there's no\nup and down methods, instead you can put specific up/down code like this:\n\n```\ndef change(dir)\n  dir.down { irreversible! }\nend\n```\n\n```\ndef change(dir)\n  add_column :users, :full_name, :string\n\n  dir.up do\n    execute(\"UPDATE users SET full_name = (SELECT first_name || ' '  || last_name) from users\")\n  end\nend\n```","summary":"<h1><a id=\"lustras-migration-system\" class=\"anchor\" href=\"#lustras-migration-system\">  <svg class=\"octicon-link\" aria-hidden=\"true\">\n    <use href=\"#octicon-link\"/>\n  </svg>\n</a>Lustra's migration system</h1>","instance_methods":[{"html_id":"uid:Int64-instance-method","name":"uid","abstract":true,"location":{"filename":"src/lustra/migration/migration.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L62"},"def":{"name":"uid","return_type":"Int64","visibility":"Public","body":""},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Migration/AddColumn","path":"Lustra/Migration/AddColumn.html","kind":"class","full_name":"Lustra::Migration::AddColumn","name":"AddColumn","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/columns.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,column:String,datatype,nullable:Bool=false,constraint:Nil|String=nil,default:Nil|String=nil,with_values:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column","external_name":"column","restriction":"::String"},{"name":"datatype","external_name":"datatype","restriction":""},{"name":"nullable","default_value":"false","external_name":"nullable","restriction":"::Bool"},{"name":"constraint","default_value":"nil","external_name":"constraint","restriction":"::Nil | ::String"},{"name":"default","default_value":"nil","external_name":"default","restriction":"::Nil | ::String"},{"name":"with_values","default_value":"false","external_name":"with_values","restriction":"::Bool"}],"args_string":"(table : String, column : String, datatype, nullable : Bool = false, constraint : Nil | String = nil, default : Nil | String = nil, with_values : Bool = false)","args_html":"(table : String, column : String, datatype, nullable : Bool = <span class=\"n\">false</span>, constraint : Nil | String = <span class=\"n\">nil</span>, default : Nil | String = <span class=\"n\">nil</span>, with_values : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L18"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column","external_name":"column","restriction":"::String"},{"name":"datatype","external_name":"datatype","restriction":""},{"name":"nullable","default_value":"false","external_name":"nullable","restriction":"::Bool"},{"name":"constraint","default_value":"nil","external_name":"constraint","restriction":"::Nil | ::String"},{"name":"default","default_value":"nil","external_name":"default","restriction":"::Nil | ::String"},{"name":"with_values","default_value":"false","external_name":"with_values","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, column, datatype, nullable, constraint, default, with_values)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":34,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L34"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} DROP #{@column}\"]"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L22"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"constraint = @constraint\ndefault = @default\nwith_values = @with_values\n\n[[\"ALTER TABLE\", @table, \"ADD\", @column, @datatype, @nullable ? \"NULL\" : \"NOT NULL\", constraint ? \"CONSTRAINT #{constraint}\" : nil, default ? \"DEFAULT #{default}\" : nil, with_values ? \"WITH VALUES\" : nil].compact.join(\" \")]\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/AddTable","path":"Lustra/Migration/AddTable.html","kind":"class","full_name":"Lustra::Migration::AddTable","name":"AddTable","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/table.cr","line_number":189,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L189"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,schema:String)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"}],"args_string":"(table : String, schema : String)","args_html":"(table : String, schema : String)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":193,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L193"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, schema)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":204,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L204"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"DROP TABLE #{@table}\"]"},"external_var":false},{"html_id":"full_name-instance-method","name":"full_name","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":196,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L196"},"def":{"name":"full_name","visibility":"Public","body":"{Lustra::SQL.escape(@schema), Lustra::SQL.escape(@name)}.join(\".\")"},"external_var":false},{"html_id":"schema:String-instance-method","name":"schema","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":191,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L191"},"def":{"name":"schema","return_type":"String","visibility":"Public","body":"@schema"},"external_var":false},{"html_id":"table:String-instance-method","name":"table","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":190,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L190"},"def":{"name":"table","return_type":"String","visibility":"Public","body":"@table"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":200,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L200"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"CREATE TABLE #{@table}\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/ChangeColumnType","path":"Lustra/Migration/ChangeColumnType.html","kind":"class","full_name":"Lustra::Migration::ChangeColumnType","name":"ChangeColumnType","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/columns.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L74"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,column_name:String,old_column_type,new_column_type)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column_name","external_name":"column_name","restriction":"::String"},{"name":"old_column_type","external_name":"old_column_type","restriction":""},{"name":"new_column_type","external_name":"new_column_type","restriction":""}],"args_string":"(table : String, column_name : String, old_column_type, new_column_type)","args_html":"(table : String, column_name : String, old_column_type, new_column_type)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":80,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L80"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column_name","external_name":"column_name","restriction":"::String"},{"name":"old_column_type","external_name":"old_column_type","restriction":""},{"name":"new_column_type","external_name":"new_column_type","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, column_name, old_column_type, new_column_type)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":89,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L89"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} ALTER COLUMN #{@column_name} SET DATA TYPE #{@old_column_type};\"]"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":85,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L85"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} ALTER COLUMN #{@column_name} SET DATA TYPE #{@new_column_type};\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/CreateEnum","path":"Lustra/Migration/CreateEnum.html","kind":"class","full_name":"Lustra::Migration::CreateEnum","name":"CreateEnum","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/enum/migration.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(name:String,values:Array(String))-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"values","external_name":"values","restriction":"::Array(::String)"}],"args_string":"(name : String, values : Array(String))","args_html":"(name : String, values : Array(String))","location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L6"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"values","external_name":"values","restriction":"::Array(::String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, values)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L13"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"DROP TYPE #{@name}\"]"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L9"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"CREATE TYPE #{@name} AS ENUM (#{Lustra::Expression[@values].join(\", \")})\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/CreateIndex","path":"Lustra/Migration/CreateIndex.html","kind":"class","full_name":"Lustra::Migration::CreateIndex","name":"CreateIndex","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/indexes.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,fields:Array(String),name=nil,using:Nil|String=nil,unique:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":"::Nil | ::String"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"::Bool"}],"args_string":"(table : String, fields : Array(String), name = nil, using : Nil | String = nil, unique : Bool = false)","args_html":"(table : String, fields : Array(String), name = <span class=\"n\">nil</span>, using : Nil | String = <span class=\"n\">nil</span>, unique : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L9"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":"::Nil | ::String"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, fields, name, using, unique)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(table:String,field:String|Symbol,name=nil,using:Nil|String=nil,unique:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"field","external_name":"field","restriction":"String | Symbol"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":"::Nil | ::String"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"::Bool"}],"args_string":"(table : String, field : String | Symbol, name = nil, using : Nil | String = nil, unique : Bool = false)","args_html":"(table : String, field : String | Symbol, name = <span class=\"n\">nil</span>, using : Nil | String = <span class=\"n\">nil</span>, unique : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L13"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"field","external_name":"field","restriction":"String | Symbol"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":"::Nil | ::String"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, field, name, using, unique)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L38"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"DROP INDEX IF EXISTS #{@name}\"]"},"external_var":false},{"html_id":"safe_name(x)-instance-method","name":"safe_name","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L18"},"def":{"name":"safe_name","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"x.gsub(/[^A-Za-z_0-9]/, \"_\")"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":34,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L34"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[[\"CREATE\", print_unique, \"INDEX\", safe_name(@name), \"ON\", @table, print_using, print_columns].compact.join(\" \")]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Direction","path":"Lustra/Migration/Direction.html","kind":"enum","full_name":"Lustra::Migration::Direction","name":"Direction","abstract":false,"ancestors":[{"html_id":"lustra/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/direction.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L23"}],"repository_name":"lustra","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"Up","name":"Up","value":"0"},{"id":"Down","name":"Down","value":"1"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"instance_methods":[{"html_id":"down(&)-instance-method","name":"down","doc":"Run the block given in parameter if the direction is a rollback","summary":"<p>Run the block given in parameter if the direction is a rollback</p>","abstract":false,"location":{"filename":"src/lustra/migration/direction.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L38"},"def":{"name":"down","yields":0,"block_arity":0,"visibility":"Public","body":"if down?\n  yield\nend"},"external_var":false},{"html_id":"down?-instance-method","name":"down?","doc":"Return true whether the migration is a rollback","summary":"<p>Return true whether the migration is a rollback</p>","abstract":false,"location":{"filename":"src/lustra/migration/direction.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L43"},"def":{"name":"down?","visibility":"Public","body":"self == Down"},"external_var":false},{"html_id":"up(&)-instance-method","name":"up","doc":"Run the block given in parameter if the direction is a upstream","summary":"<p>Run the block given in parameter if the direction is a upstream</p>","abstract":false,"location":{"filename":"src/lustra/migration/direction.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L28"},"def":{"name":"up","yields":0,"block_arity":0,"visibility":"Public","body":"if self == Up\n  yield\nend"},"external_var":false},{"html_id":"up?-instance-method","name":"up?","doc":"Return true whether the migration is a upstream","summary":"<p>Return true whether the migration is a upstream</p>","abstract":false,"location":{"filename":"src/lustra/migration/direction.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/direction.cr#L33"},"def":{"name":"up?","visibility":"Public","body":"self == Up"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/DropEnum","path":"Lustra/Migration/DropEnum.html","kind":"class","full_name":"Lustra::Migration::DropEnum","name":"DropEnum","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/enum/migration.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L18"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(name:String,values:Nil|Array(String))-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"values","external_name":"values","restriction":"::Nil | ::Array(::String)"}],"args_string":"(name : String, values : Nil | Array(String))","args_html":"(name : String, values : Nil | Array(String))","location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L22"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"values","external_name":"values","restriction":"::Nil | ::Array(::String)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, values)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L29"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"if values = @values\n  [\"CREATE TYPE #{@name} AS ENUM (#{Lustra::Expression[values].join(\", \")})\"]\nelse\n  irreversible!\nend"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L25"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"DROP TYPE #{@name}\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/DropTable","path":"Lustra/Migration/DropTable.html","kind":"class","full_name":"Lustra::Migration::DropTable","name":"DropTable","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/table.cr","line_number":209,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L209"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,schema:String)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"}],"args_string":"(table : String, schema : String)","args_html":"(table : String, schema : String)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":213,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L213"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, schema)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":224,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L224"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"CREATE TABLE #{@table}\"]"},"external_var":false},{"html_id":"full_name-instance-method","name":"full_name","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":216,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L216"},"def":{"name":"full_name","visibility":"Public","body":"{Lustra::SQL.escape(@schema), Lustra::SQL.escape(@name)}.join(\".\")"},"external_var":false},{"html_id":"schema:String-instance-method","name":"schema","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":211,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L211"},"def":{"name":"schema","return_type":"String","visibility":"Public","body":"@schema"},"external_var":false},{"html_id":"table:String-instance-method","name":"table","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":210,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L210"},"def":{"name":"table","return_type":"String","visibility":"Public","body":"@table"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":220,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L220"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"DROP TABLE #{@table}\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Execute","path":"Lustra/Migration/Execute.html","kind":"class","full_name":"Lustra::Migration::Execute","name":"Execute","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/execute.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/execute.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(sql:String,irreversible:Bool|Nil=false)-class-method","name":"new","abstract":false,"args":[{"name":"sql","external_name":"sql","restriction":"String"},{"name":"irreversible","default_value":"false","external_name":"irreversible","restriction":"Bool | ::Nil"}],"args_string":"(sql : String, irreversible : Bool | Nil = false)","args_html":"(sql : String, irreversible : Bool | Nil = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/execute.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/execute.cr#L5"},"def":{"name":"new","args":[{"name":"sql","external_name":"sql","restriction":"String"},{"name":"irreversible","default_value":"false","external_name":"irreversible","restriction":"Bool | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(sql, irreversible)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/execute.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/execute.cr#L12"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"if @irreversible\n  irreversible!\nend\n[@sql].compact\n"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/execute.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/execute.cr#L8"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[@sql].compact"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/FullTextSearchableHelpers","path":"Lustra/Migration/FullTextSearchableHelpers.html","kind":"module","full_name":"Lustra::Migration::FullTextSearchableHelpers","name":"FullTextSearchableHelpers","abstract":false,"locations":[{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":83,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L83"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Migration/Helper","kind":"module","full_name":"Lustra::Migration::Helper","name":"Helper"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"instance_methods":[{"html_id":"add_full_text_searchable(table,on:Array(Tuple(String,Char)),column_name=\"full_text_vector\",catalog=\"pg_catalog.english\",trigger_name=nil,function_name=nil)-instance-method","name":"add_full_text_searchable","doc":"Add a `tsvector` field to a table.\nCreate column, index and trigger.","summary":"<p>Add a <code>tsvector</code> field to a table.</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"on","external_name":"on","restriction":"Array(Tuple(String, Char))"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"args_string":"(table, on : Array(Tuple(String, Char)), column_name = \"full_text_vector\", catalog = \"pg_catalog.english\", trigger_name = nil, function_name = nil)","args_html":"(table, on : Array(Tuple(String, <a href=\"../../Char.html\">Char</a>)), column_name = <span class=\"s\">&quot;full_text_vector&quot;</span>, catalog = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, trigger_name = <span class=\"n\">nil</span>, function_name = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":86,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L86"},"def":{"name":"add_full_text_searchable","args":[{"name":"table","external_name":"table","restriction":""},{"name":"on","external_name":"on","restriction":"Array(Tuple(String, Char))"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"visibility":"Public","body":"add_column(table, column_name, \"tsvector\")\ncreate_index(table, column_name, using: \"gin\")\nmigration.add_operation(Lustra::Migration::FullTextSearchableOperation.new(table, on, catalog, trigger_name, function_name, column_name))\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/FullTextSearchableOperation","path":"Lustra/Migration/FullTextSearchableOperation.html","kind":"class","full_name":"Lustra::Migration::FullTextSearchableOperation","name":"FullTextSearchableOperation","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,src_fields:Array(Tuple(String,Char)),catalog:String=\"pg_catalog.english\",trigger_name=nil,function_name=nil,dest_field:String=\"full_text_vector\")-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"src_fields","external_name":"src_fields","restriction":"::Array(::Tuple(::String, ::Char))"},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":"::String"},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""},{"name":"dest_field","default_value":"\"full_text_vector\"","external_name":"dest_field","restriction":"::String"}],"args_string":"(table : String, src_fields : Array(Tuple(String, Char)), catalog : String = \"pg_catalog.english\", trigger_name = nil, function_name = nil, dest_field : String = \"full_text_vector\")","args_html":"(table : String, src_fields : Array(Tuple(String, <a href=\"../../Char.html\">Char</a>)), catalog : String = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, trigger_name = <span class=\"n\">nil</span>, function_name = <span class=\"n\">nil</span>, dest_field : String = <span class=\"s\">&quot;full_text_vector&quot;</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L17"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"src_fields","external_name":"src_fields","restriction":"::Array(::Tuple(::String, ::Char))"},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":"::String"},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""},{"name":"dest_field","default_value":"\"full_text_vector\"","external_name":"dest_field","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, src_fields, catalog, trigger_name, function_name, dest_field)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"catalog:String-instance-method","name":"catalog","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L12"},"def":{"name":"catalog","return_type":"String","visibility":"Public","body":"@catalog"},"external_var":false},{"html_id":"dest_field:String-instance-method","name":"dest_field","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L13"},"def":{"name":"dest_field","return_type":"String","visibility":"Public","body":"@dest_field"},"external_var":false},{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":78,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L78"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"print_delete_trigger"},"external_var":false},{"html_id":"function_name:String-instance-method","name":"function_name","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L11"},"def":{"name":"function_name","return_type":"String","visibility":"Public","body":"@function_name"},"external_var":false},{"html_id":"src_fields:Array(Tuple(String,Char))-instance-method","name":"src_fields","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L15"},"def":{"name":"src_fields","return_type":"Array(::Tuple(String, Char))","visibility":"Public","body":"@src_fields"},"external_var":false},{"html_id":"table:String-instance-method","name":"table","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L9"},"def":{"name":"table","return_type":"String","visibility":"Public","body":"@table"},"external_var":false},{"html_id":"trigger_name:String-instance-method","name":"trigger_name","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L10"},"def":{"name":"trigger_name","return_type":"String","visibility":"Public","body":"@trigger_name"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L74"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"print_trigger + print_update_current_data"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Migration/FullTextSearchableOperation/Priority","path":"Lustra/Migration/FullTextSearchableOperation/Priority.html","kind":"module","full_name":"Lustra::Migration::FullTextSearchableOperation::Priority","name":"Priority","abstract":false,"locations":[{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"IMPORTANT","name":"IMPORTANT","value":"'B'"},{"id":"LOW","name":"LOW","value":"'D'"},{"id":"NORMAL","name":"NORMAL","value":"'C'"},{"id":"VERY_IMPORTANT","name":"VERY_IMPORTANT","value":"'A'"}],"namespace":{"html_id":"lustra/Lustra/Migration/FullTextSearchableOperation","kind":"class","full_name":"Lustra::Migration::FullTextSearchableOperation","name":"FullTextSearchableOperation"}}]},{"html_id":"lustra/Lustra/Migration/FullTextSearchableTableHelpers","path":"Lustra/Migration/FullTextSearchableTableHelpers.html","kind":"module","full_name":"Lustra::Migration::FullTextSearchableTableHelpers","name":"FullTextSearchableTableHelpers","abstract":false,"locations":[{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":104,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L104"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Migration/Table","kind":"class","full_name":"Lustra::Migration::Table","name":"Table"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"instance_methods":[{"html_id":"full_text_searchable(on:Array(Tuple(String,Char)),column_name=\"full_text_vector\",catalog=\"pg_catalog.english\",trigger_name=nil,function_name=nil)-instance-method","name":"full_text_searchable","abstract":false,"args":[{"name":"on","external_name":"on","restriction":"Array(Tuple(String, Char))"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"args_string":"(on : Array(Tuple(String, Char)), column_name = \"full_text_vector\", catalog = \"pg_catalog.english\", trigger_name = nil, function_name = nil)","args_html":"(on : Array(Tuple(String, <a href=\"../../Char.html\">Char</a>)), column_name = <span class=\"s\">&quot;full_text_vector&quot;</span>, catalog = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, trigger_name = <span class=\"n\">nil</span>, function_name = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":105,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L105"},"def":{"name":"full_text_searchable","args":[{"name":"on","external_name":"on","restriction":"Array(Tuple(String, Char))"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"visibility":"Public","body":"column(column_name, \"tsvector\", index: \"gin\")\n\nmigration.try(&.add_operation(Lustra::Migration::FullTextSearchableOperation.new(name, on, catalog, trigger_name, function_name, column_name)))\n"},"external_var":false},{"html_id":"full_text_searchable(on:String,column_name=\"full_text_vector\",catalog=\"pg_catalog.english\",trigger_name=nil,function_name=nil)-instance-method","name":"full_text_searchable","abstract":false,"args":[{"name":"on","external_name":"on","restriction":"String"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"args_string":"(on : String, column_name = \"full_text_vector\", catalog = \"pg_catalog.english\", trigger_name = nil, function_name = nil)","args_html":"(on : String, column_name = <span class=\"s\">&quot;full_text_vector&quot;</span>, catalog = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, trigger_name = <span class=\"n\">nil</span>, function_name = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":122,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L122"},"def":{"name":"full_text_searchable","args":[{"name":"on","external_name":"on","restriction":"String"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"visibility":"Public","body":"full_text_searchable([{on, 'C'}], column_name, catalog, trigger_name, function_name)"},"external_var":false},{"html_id":"full_text_searchable(on:Array(String),column_name=\"full_text_vector\",catalog=\"pg_catalog.english\",trigger_name=nil,function_name=nil)-instance-method","name":"full_text_searchable","abstract":false,"args":[{"name":"on","external_name":"on","restriction":"Array(String)"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"args_string":"(on : Array(String), column_name = \"full_text_vector\", catalog = \"pg_catalog.english\", trigger_name = nil, function_name = nil)","args_html":"(on : Array(String), column_name = <span class=\"s\">&quot;full_text_vector&quot;</span>, catalog = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, trigger_name = <span class=\"n\">nil</span>, function_name = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/migration.cr","line_number":128,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/migration.cr#L128"},"def":{"name":"full_text_searchable","args":[{"name":"on","external_name":"on","restriction":"Array(String)"},{"name":"column_name","default_value":"\"full_text_vector\"","external_name":"column_name","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"trigger_name","default_value":"nil","external_name":"trigger_name","restriction":""},{"name":"function_name","default_value":"nil","external_name":"function_name","restriction":""}],"visibility":"Public","body":"if on.empty?\n  raise(\"cannot implement tsv_searchable because empty array was given\")\nend\n\nfields = on.map do |name| {name, 'C'} end\n\nfull_text_searchable(fields, column_name, catalog, trigger_name, function_name)\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Helper","path":"Lustra/Migration/Helper.html","kind":"module","full_name":"Lustra::Migration::Helper","name":"Helper","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/Migration/FullTextSearchableHelpers","kind":"module","full_name":"Lustra::Migration::FullTextSearchableHelpers","name":"FullTextSearchableHelpers"}],"locations":[{"filename":"src/lustra/extensions/enum/migration.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L38"},{"filename":"src/lustra/extensions/full_text_searchable/full_text_searchable.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/full_text_searchable.cr#L12"},{"filename":"src/lustra/migration/migration.cr","line_number":67,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L67"},{"filename":"src/lustra/migration/operation/columns.cr","line_number":95,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L95"},{"filename":"src/lustra/migration/operation/indexes.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L48"},{"filename":"src/lustra/migration/operation/table.cr","line_number":229,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L229"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"TYPE_MAPPING","name":"TYPE_MAPPING","value":"{\"string\" => \"text\", \"int32\" => \"int\", \"int64\" => \"bigint\", \"long\" => \"bigint\", \"bigdecimal\" => \"numeric\", \"datetime\" => \"timestamp without time zone\"}"}],"included_modules":[{"html_id":"lustra/Lustra/Migration/FullTextSearchableHelpers","kind":"module","full_name":"Lustra::Migration::FullTextSearchableHelpers","name":"FullTextSearchableHelpers"}],"including_types":[{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"class_methods":[{"html_id":"datatype(type:String)-class-method","name":"datatype","doc":"Replace some common type to their equivalent in postgresql\nif the type is not found in the correspondance table, then return\nitself","summary":"<p>Replace some common type to their equivalent in postgresql if the type is not found in the correspondance table, then return itself</p>","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"String"}],"args_string":"(type : String)","args_html":"(type : String)","location":{"filename":"src/lustra/migration/migration.cr","line_number":82,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L82"},"def":{"name":"datatype","args":[{"name":"type","external_name":"type","restriction":"String"}],"visibility":"Public","body":"ts = type\nTYPE_MAPPING[type]? || ts\n"},"external_var":false}],"instance_methods":[{"html_id":"add_column(table,column,datatype,nullable=false,constraint=nil,default=nil,with_values=false)-instance-method","name":"add_column","doc":"Add a column to a specific table","summary":"<p>Add a column to a specific table</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"datatype","external_name":"datatype","restriction":""},{"name":"nullable","default_value":"false","external_name":"nullable","restriction":""},{"name":"constraint","default_value":"nil","external_name":"constraint","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"with_values","default_value":"false","external_name":"with_values","restriction":""}],"args_string":"(table, column, datatype, nullable = false, constraint = nil, default = nil, with_values = false)","args_html":"(table, column, datatype, nullable = <span class=\"n\">false</span>, constraint = <span class=\"n\">nil</span>, default = <span class=\"n\">nil</span>, with_values = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":97,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L97"},"def":{"name":"add_column","args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"datatype","external_name":"datatype","restriction":""},{"name":"nullable","default_value":"false","external_name":"nullable","restriction":""},{"name":"constraint","default_value":"nil","external_name":"constraint","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"with_values","default_value":"false","external_name":"with_values","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::AddColumn.new(table, column, datatype, nullable, constraint, default, with_values))"},"external_var":false},{"html_id":"add_operation(op:Operation)-instance-method","name":"add_operation","abstract":false,"args":[{"name":"op","external_name":"op","restriction":"Operation"}],"args_string":"(op : Operation)","args_html":"(op : <a href=\"../../Lustra/Migration/Operation.html\">Operation</a>)","location":{"filename":"src/lustra/migration/migration.cr","line_number":95,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L95"},"def":{"name":"add_operation","args":[{"name":"op","external_name":"op","restriction":"Operation"}],"visibility":"Public","body":"op.migration = self\n@operations << op\n"},"external_var":false},{"html_id":"apply(dir:Direction=Lustra::Migration::Direction::Up)-instance-method","name":"apply","doc":"This will apply the migration in a given direction (up or down)","summary":"<p>This will apply the migration in a given direction (up or down)</p>","abstract":false,"args":[{"name":"dir","default_value":"Lustra::Migration::Direction::Up","external_name":"dir","restriction":"Direction"}],"args_string":"(dir : Direction = Lustra::Migration::Direction::Up)","args_html":"(dir : <a href=\"../../Lustra/Migration/Direction.html\">Direction</a> = <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Migration</span><span class=\"t\">::</span><span class=\"t\">Direction</span><span class=\"t\">::</span><span class=\"t\">Up</span>)","location":{"filename":"src/lustra/migration/migration.cr","line_number":103,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L103"},"def":{"name":"apply","args":[{"name":"dir","default_value":"Lustra::Migration::Direction::Up","external_name":"dir","restriction":"Direction"}],"visibility":"Public","body":"Lustra::Migration::Manager.instance.ensure_ready\n\nLustra::SQL.transaction do\n  Log.info do \"[#{dir}] #{self.class.name}\" end\n\n\n\n  @operations.clear\n\n  change(dir)\n\n  dir.up do\n    @operations.each do |op|\n      op.up.each do |x| Lustra::SQL.execute(x.as(String)) end\n    end\n\n    (SQL.insert(\"__lustra_metadatas\", {metatype: \"migration\", value: uid.to_s})).execute\n  end\n\n  dir.down do\n    @operations.reverse_each do |op|\n      op.down.each do |x| Lustra::SQL.execute(x.as(String)) end\n    end\n\n    ((SQL.delete(\"__lustra_metadatas\")).where({metatype: \"migration\", value: uid.to_s})).execute\n  end\n\n  self\nend\n"},"external_var":false},{"html_id":"change(dir)-instance-method","name":"change","abstract":true,"args":[{"name":"dir","external_name":"dir","restriction":""}],"args_string":"(dir)","args_html":"(dir)","location":{"filename":"src/lustra/migration/migration.cr","line_number":100,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L100"},"def":{"name":"change","args":[{"name":"dir","external_name":"dir","restriction":""}],"visibility":"Public","body":""},"external_var":false},{"html_id":"change_column_type(table,column,from,to)-instance-method","name":"change_column_type","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"args_string":"(table, column, from, to)","args_html":"(table, column, from, to)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":110,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L110"},"def":{"name":"change_column_type","args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::ChangeColumnType.new(table, column, from, to))"},"external_var":false},{"html_id":"create_enum(name,arr:Enumerable(T))forallT-instance-method","name":"create_enum","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"arr","external_name":"arr","restriction":"Enumerable(T)"}],"args_string":"(name, arr : Enumerable(T)) forall T","args_html":"(name, arr : Enumerable(T)) forall T","location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L39"},"def":{"name":"create_enum","args":[{"name":"name","external_name":"name","restriction":""},{"name":"arr","external_name":"arr","restriction":"Enumerable(T)"}],"visibility":"Public","body":"add_operation(CreateEnum.new(name.to_s, arr.map(&.to_s)))"},"external_var":false},{"html_id":"create_enum(name,e)-instance-method","name":"create_enum","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"e","external_name":"e","restriction":""}],"args_string":"(name, e)","args_html":"(name, e)","location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":47,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L47"},"def":{"name":"create_enum","args":[{"name":"name","external_name":"name","restriction":""},{"name":"e","external_name":"e","restriction":""}],"visibility":"Public","body":"add_operation(CreateEnum.new(name.to_s, e.authorized_values))"},"external_var":false},{"html_id":"create_index(table,columns:Array(String),name=nil,using=nil,unique=false)-instance-method","name":"create_index","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"columns","external_name":"columns","restriction":"Array(String)"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"args_string":"(table, columns : Array(String), name = nil, using = nil, unique = false)","args_html":"(table, columns : Array(String), name = <span class=\"n\">nil</span>, using = <span class=\"n\">nil</span>, unique = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L56"},"def":{"name":"create_index","args":[{"name":"table","external_name":"table","restriction":""},{"name":"columns","external_name":"columns","restriction":"Array(String)"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::CreateIndex.new(table, fields: columns, name: name, using: using, unique: unique))"},"external_var":false},{"html_id":"create_index(table,column,name=nil,using=nil,unique=false)-instance-method","name":"create_index","doc":"Add a column to a specific table","summary":"<p>Add a column to a specific table</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"args_string":"(table, column, name = nil, using = nil, unique = false)","args_html":"(table, column, name = <span class=\"n\">nil</span>, using = <span class=\"n\">nil</span>, unique = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/indexes.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/indexes.cr#L50"},"def":{"name":"create_index","args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::CreateIndex.new(table, fields: [column], name: name, using: using, unique: unique))"},"external_var":false},{"html_id":"create_table(name,id:Symbol|Bool=true,schema=\"public\",&)-instance-method","name":"create_table","doc":"Helper used in migration to create a new table.\n\nUsage:\n\n```\ncreate_table(:users) do |t|\n  t.column :first_name, :string\n  t.column :last_name, :string\n  t.column :email, :string, unique: true\n  t.timestamps\nend\n```\n\nBy default, a column `id` of type `integer` will be created as primary key of the table.\nThis can be prevented using `primary: false`\n\n```\ncreate_table(:users, id: false) do |t|\n  t.column :user_id, :integer, primary: true # Use custom name for the primary key\n  t.column :first_name, :string\n  t.column :last_name, :string\n  t.column :email, :string, unique: true\n  t.timestamps\nend\n```","summary":"<p>Helper used in migration to create a new table.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"id","default_value":"true","external_name":"id","restriction":"Symbol | Bool"},{"name":"schema","default_value":"\"public\"","external_name":"schema","restriction":""}],"args_string":"(name, id : Symbol | Bool = true, schema = \"public\", &)","args_html":"(name, id : Symbol | Bool = <span class=\"n\">true</span>, schema = <span class=\"s\">&quot;public&quot;</span>, &)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":257,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L257"},"def":{"name":"create_table","args":[{"name":"name","external_name":"name","restriction":""},{"name":"id","default_value":"true","external_name":"id","restriction":"Symbol | Bool"},{"name":"schema","default_value":"\"public\"","external_name":"schema","restriction":""}],"yields":1,"block_arity":1,"visibility":"Public","body":"table = Table.new(name.to_s, schema.to_s, is_create: true)\nadd_operation(table)\n\ncase id\nwhen true, :bigserial\n  table.column(\"id\", \"bigserial\", primary: true, null: false)\nwhen :serial\n  table.column(\"id\", \"serial\", primary: true, null: false)\nwhen :uuid\n  table.column(\"id\", \"uuid\", primary: true, null: false)\nwhen false\nelse\n  raise(\"Unknown key type while try to create new table: `#{id}`. Candidates are :bigserial, :serial and :uuid\" + \"Please proceed with `id: false` and add the column manually\")\nend\n\nyield(table)\n"},"external_var":false},{"html_id":"drop_column(table,column,type)-instance-method","name":"drop_column","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"type","external_name":"type","restriction":""}],"args_string":"(table, column, type)","args_html":"(table, column, type)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":102,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L102"},"def":{"name":"drop_column","args":[{"name":"table","external_name":"table","restriction":""},{"name":"column","external_name":"column","restriction":""},{"name":"type","external_name":"type","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::RemoveColumn.new(table, column, type))"},"external_var":false},{"html_id":"drop_enum(name,arr:Enumerable(T)|Nil=nil)forallT-instance-method","name":"drop_enum","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"arr","default_value":"nil","external_name":"arr","restriction":"Enumerable(T) | ::Nil"}],"args_string":"(name, arr : Enumerable(T) | Nil = nil) forall T","args_html":"(name, arr : Enumerable(T) | Nil = <span class=\"n\">nil</span>) forall T","location":{"filename":"src/lustra/extensions/enum/migration.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/enum/migration.cr#L43"},"def":{"name":"drop_enum","args":[{"name":"name","external_name":"name","restriction":""},{"name":"arr","default_value":"nil","external_name":"arr","restriction":"Enumerable(T) | ::Nil"}],"visibility":"Public","body":"add_operation(DropEnum.new(name.to_s, arr.try(&.map(&.to_s))))"},"external_var":false},{"html_id":"execute(sql:String)-instance-method","name":"execute","abstract":false,"args":[{"name":"sql","external_name":"sql","restriction":"String"}],"args_string":"(sql : String)","args_html":"(sql : String)","location":{"filename":"src/lustra/migration/migration.cr","line_number":91,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L91"},"def":{"name":"execute","args":[{"name":"sql","external_name":"sql","restriction":"String"}],"visibility":"Public","body":"@operations << (Lustra::Migration::Execute.new(sql))"},"external_var":false},{"html_id":"irreversible!-instance-method","name":"irreversible!","abstract":false,"location":{"filename":"src/lustra/migration/migration.cr","line_number":87,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L87"},"def":{"name":"irreversible!","visibility":"Public","body":"raise(IrreversibleMigration.new(migration_irreversible(self.class.name)))"},"external_var":false},{"html_id":"rename_column(table,from,to)-instance-method","name":"rename_column","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"args_string":"(table, from, to)","args_html":"(table, from, to)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":106,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L106"},"def":{"name":"rename_column","args":[{"name":"table","external_name":"table","restriction":""},{"name":"from","external_name":"from","restriction":""},{"name":"to","external_name":"to","restriction":""}],"visibility":"Public","body":"add_operation(Lustra::Migration::RenameColumn.new(table, from, to))"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/IrreversibleMigration","path":"Lustra/Migration/IrreversibleMigration.html","kind":"class","full_name":"Lustra::Migration::IrreversibleMigration","name":"IrreversibleMigration","abstract":false,"superclass":{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/migration.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/migration.cr#L65"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"doc":"This error is throw when you try to revert a migration which is irreversible.","summary":"<p>This error is throw when you try to revert a migration which is irreversible.</p>"},{"html_id":"lustra/Lustra/Migration/Manager","path":"Lustra/Migration/Manager.html","kind":"class","full_name":"Lustra::Migration::Manager","name":"Manager","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/manager.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"METADATA_VERSION","name":"METADATA_VERSION","value":"\"1\"","doc":"Used to migrate between metadata version, in case we need it in the future.","summary":"<p>Used to migrate between metadata version, in case we need it in the future.</p>"}],"included_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"doc":"The migration manager is a singleton, it load all the migrations,\ncheck which one are `up` and `down`, and can trigger one or multiple\ndowngrade / upgrade of the database.\n\nThe migration system needs the creation of a table named `__lustra_metadatas`\nin your database. This table will be created automatically on the first\ninitialization of the Migration Manager.\n","summary":"<p>The migration manager is a singleton, it load all the migrations, check which one are <code><a href=\"../../Lustra/Migration/Manager.html#up%28number%3AInt64%29%3ANil-instance-method\">#up</a></code> and <code><a href=\"../../Lustra/Migration/Manager.html#down%28number%3AInt64%29%3ANil-instance-method\">#down</a></code>, and can trigger one or multiple downgrade / upgrade of the database.</p>","class_methods":[{"html_id":"instance-class-method","name":"instance","doc":"To access to the manager\n\n```\nLustra::Migration::Manager.instance\n```","summary":"<p>To access to the manager</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L22"},"def":{"name":"instance","visibility":"Public","body":"@@instance || (@@instance = Manager.new)"},"external_var":false}],"instance_methods":[{"html_id":"apply_all-instance-method","name":"apply_all","doc":"Apply all the migrations not yet applied.","summary":"<p>Apply all the migrations not yet applied.</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":139,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L139"},"def":{"name":"apply_all","visibility":"Public","body":"ensure_ready\n\nLustra::View.apply(:drop)\n\nlist_of_migrations = @migrations.sort do |a, b| a.uid <=> b.uid end\nlist_of_migrations.reject! do |x| @migrations_up.includes?(x.uid) end\n\nlist_of_migrations.each do |migration|\n  migration.apply\n  @migrations_up.add(migration.uid)\nend\n\nLustra::View.apply(:create)\n"},"external_var":false},{"html_id":"apply_to(version,direction=:both)-instance-method","name":"apply_to","abstract":false,"args":[{"name":"version","external_name":"version","restriction":""},{"name":"direction","default_value":":both","external_name":"direction","restriction":""}],"args_string":"(version, direction = :both)","args_html":"(version, direction = <span class=\"n\">:both</span>)","location":{"filename":"src/lustra/migration/manager.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L71"},"def":{"name":"apply_to","args":[{"name":"version","external_name":"version","restriction":""},{"name":"direction","default_value":":both","external_name":"direction","restriction":""}],"visibility":"Public","body":"ensure_ready\n\nlist_of_migrations = @migrations.sort do |a, b| a.uid <=> b.uid end\n\nversion = compute_version(version, list_of_migrations)\n\noperations = [] of ::Tuple(Int64, Migration::Direction)\n\n\n\n\nuid_to_apply = list_of_migrations.map(&.uid).reject(&.>(version)) - @migrations_up.to_a\n\nuid_to_apply.each do |uid|\n  operations << {uid, Migration::Direction::Up}\nend\n\n\nuid_to_apply = list_of_migrations.map(&.uid).select(&.>(version)) & @migrations_up.to_a\n\nuid_to_apply.each do |uid|\n  operations << {uid, Migration::Direction::Down}\nend\n\n\n\n\noperations.sort! do |a, b|\n  if a[1].up?\n    if b[1].down?\n      1\n    else\n      a[0] <=> b[0]\n    end\n  elsif b[1].down?\n    b[0] <=> a[0]\n  else\n    0\n  end\nend\n\nif operations.empty?\n  Log.info do \"Nothing to do.\" end\n  return\nend\n\nLog.info do \"Migrations will be applied (in this order):\" end\noperations.each do |__temp_148|\n  uid, d = __temp_148\n  Log.info do \"#{d.up? ? \"[ UP ]\" : \"[DOWN]\"} #{uid} - #{(find(uid)).class.name}\" end\nend\n\noperations.each do |__temp_149|\n  uid, d = __temp_149\n  if (direction == (:both)) || (direction == (:up))\n    d.up do up(uid) end\n  end\n\n  if (direction == (:both)) || (direction == (:down))\n    d.down do down(uid) end\n  end\nend\n"},"external_var":false},{"html_id":"commited?(m:Lustra::Migration)-instance-method","name":"commited?","doc":"Return `true` if the migration has been commited (already applied into the database)\nor `false` otherwise","summary":"<p>Return <code>true</code> if the migration has been commited (already applied into the database) or <code>false</code> otherwise</p>","abstract":false,"args":[{"name":"m","external_name":"m","restriction":"Lustra::Migration"}],"args_string":"(m : Lustra::Migration)","args_html":"(m : <a href=\"../../Lustra/Migration.html\">Lustra::Migration</a>)","location":{"filename":"src/lustra/migration/manager.cr","line_number":157,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L157"},"def":{"name":"commited?","args":[{"name":"m","external_name":"m","restriction":"Lustra::Migration"}],"visibility":"Public","body":"@migrations_up.includes?(m.uid)"},"external_var":false},{"html_id":"current_version-instance-method","name":"current_version","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":46,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L46"},"def":{"name":"current_version","visibility":"Public","body":"ensure_ready\n\nif @migrations_up.empty?\n  return nil\nend\n\n@migrations_up.max\n"},"external_var":false},{"html_id":"down(number:Int64):Nil-instance-method","name":"down","doc":"Force down a migration; throw error if the mgiration is already down","summary":"<p>Force down a migration; throw error if the mgiration is already down</p>","abstract":false,"args":[{"name":"number","external_name":"number","restriction":"Int64"}],"args_string":"(number : Int64) : Nil","args_html":"(number : Int64) : Nil","location":{"filename":"src/lustra/migration/manager.cr","line_number":230,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L230"},"def":{"name":"down","args":[{"name":"number","external_name":"number","restriction":"Int64"}],"return_type":"Nil","visibility":"Public","body":"m = find(number)\n\nif migrations_up.includes?(number)\nelse\n  raise(migration_already_down(number))\nend\n\nm.apply(Lustra::Migration::Direction::Down)\n@migrations_up.delete(m.uid)\n"},"external_var":false},{"html_id":"ensure_ready-instance-method","name":"ensure_ready","doc":"Create if needed the metadata table\nto save the migrations.","summary":"<p>Create if needed the metadata table to save the migrations.</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":163,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L163"},"def":{"name":"ensure_ready","visibility":"Public","body":"if @loaded\nelse\n  Lustra::SQL.execute(\"CREATE TABLE IF NOT EXISTS __lustra_metadatas ( metatype text NOT NULL, value text NOT NULL );\")\n\n  Lustra::SQL.execute(\"CREATE UNIQUE INDEX IF NOT EXISTS __lustra_metadatas_idx ON __lustra_metadatas (metatype, value);\")\n\n  load_existing_migrations\n  ensure_unicity!\n\n  @loaded = true\nend"},"external_var":false},{"html_id":"find(number)-instance-method","name":"find","doc":"Fetch the migration instance with the selected number","summary":"<p>Fetch the migration instance with the selected number</p>","abstract":false,"args":[{"name":"number","external_name":"number","restriction":""}],"args_string":"(number)","args_html":"(number)","location":{"filename":"src/lustra/migration/manager.cr","line_number":214,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L214"},"def":{"name":"find","args":[{"name":"number","external_name":"number","restriction":""}],"visibility":"Public","body":"number = Int64.new(number)\n@migrations.find() do |__arg6| __arg6.uid == number end || (raise(migration_not_found(number)))\n"},"external_var":false},{"html_id":"load_existing_migrations-instance-method","name":"load_existing_migrations","doc":"Fetch all the migrations already activated on the database.","summary":"<p>Fetch all the migrations already activated on the database.</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":201,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L201"},"def":{"name":"load_existing_migrations","visibility":"Public","body":"@migrations_up.clear\n\n((Lustra::SQL.select(\"*\"))\n  .from(\"__lustra_metadatas\"))\n  .where(metatype: \"migration\").map do |m| @migrations_up.add(Int64.new(m[\"value\"].as(String))) end\n"},"external_var":false},{"html_id":"max_version:Lustra::Migration|Nil-instance-method","name":"max_version","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L54"},"def":{"name":"max_version","return_type":"Lustra::Migration | ::Nil","visibility":"Public","body":"if @migrations.size > 0\n  @migrations.max_of(&.uid)\nend"},"external_var":false},{"html_id":"migrations_up-instance-method","name":"migrations_up","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L33"},"def":{"name":"migrations_up","visibility":"Public","body":"ensure_ready\n@migrations_up\n"},"external_var":false},{"html_id":"print_status:String-instance-method","name":"print_status","doc":"Print out the status ( up | down ) of all migrations found by the manager.","summary":"<p>Print out the status ( up | down ) of all migrations found by the manager.</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":240,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L240"},"def":{"name":"print_status","return_type":"String","visibility":"Public","body":"ensure_ready\n\n@migrations.sort do |a, b|\n  (a.as(Lustra::Migration)).uid <=> (b.as(Lustra::Migration)).uid\nend.join(\"\\n\") do |m|\n  active = @migrations_up.includes?(m.uid)\n  \"[#{active ? \"✓\".colorize.green : \"✗\".colorize.red}] #{m.uid} - #{m.class.name}\"\nend\n"},"external_var":false},{"html_id":"refresh-instance-method","name":"refresh","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":209,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L209"},"def":{"name":"refresh","visibility":"Public","body":"load_existing_migrations"},"external_var":false},{"html_id":"reinit!-instance-method","name":"reinit!","doc":"Force reloading the migration system\nRecheck all the current up migrations\nand the metadata table.\nThis is useful if you access to the migration process\nthrough another program, or during specs","summary":"<p>Force reloading the migration system Recheck all the current up migrations and the metadata table.</p>","abstract":false,"location":{"filename":"src/lustra/migration/manager.cr","line_number":185,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L185"},"def":{"name":"reinit!","visibility":"Public","body":"@loaded = false\nensure_ready\nself\n"},"external_var":false},{"html_id":"up(number:Int64):Nil-instance-method","name":"up","doc":"Force up a migration; throw error if the migration is already up","summary":"<p>Force up a migration; throw error if the migration is already up</p>","abstract":false,"args":[{"name":"number","external_name":"number","restriction":"Int64"}],"args_string":"(number : Int64) : Nil","args_html":"(number : Int64) : Nil","location":{"filename":"src/lustra/migration/manager.cr","line_number":220,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/manager.cr#L220"},"def":{"name":"up","args":[{"name":"number","external_name":"number","restriction":"Int64"}],"return_type":"Nil","visibility":"Public","body":"m = find(number)\n\nif migrations_up.includes?(number)\n  raise(migration_already_up(number))\nend\n\nm.apply\n@migrations_up.add(m.uid)\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Operation","path":"Lustra/Migration/Operation.html","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation","abstract":true,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/operation.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"subclasses":[{"html_id":"lustra/Lustra/Migration/AddColumn","kind":"class","full_name":"Lustra::Migration::AddColumn","name":"AddColumn"},{"html_id":"lustra/Lustra/Migration/AddTable","kind":"class","full_name":"Lustra::Migration::AddTable","name":"AddTable"},{"html_id":"lustra/Lustra/Migration/ChangeColumnType","kind":"class","full_name":"Lustra::Migration::ChangeColumnType","name":"ChangeColumnType"},{"html_id":"lustra/Lustra/Migration/CreateEnum","kind":"class","full_name":"Lustra::Migration::CreateEnum","name":"CreateEnum"},{"html_id":"lustra/Lustra/Migration/CreateIndex","kind":"class","full_name":"Lustra::Migration::CreateIndex","name":"CreateIndex"},{"html_id":"lustra/Lustra/Migration/DropEnum","kind":"class","full_name":"Lustra::Migration::DropEnum","name":"DropEnum"},{"html_id":"lustra/Lustra/Migration/DropTable","kind":"class","full_name":"Lustra::Migration::DropTable","name":"DropTable"},{"html_id":"lustra/Lustra/Migration/Execute","kind":"class","full_name":"Lustra::Migration::Execute","name":"Execute"},{"html_id":"lustra/Lustra/Migration/FullTextSearchableOperation","kind":"class","full_name":"Lustra::Migration::FullTextSearchableOperation","name":"FullTextSearchableOperation"},{"html_id":"lustra/Lustra/Migration/RemoveColumn","kind":"class","full_name":"Lustra::Migration::RemoveColumn","name":"RemoveColumn"},{"html_id":"lustra/Lustra/Migration/RenameColumn","kind":"class","full_name":"Lustra::Migration::RenameColumn","name":"RenameColumn"},{"html_id":"lustra/Lustra/Migration/Table","kind":"class","full_name":"Lustra::Migration::Table","name":"Table"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":true,"location":{"filename":"src/lustra/migration/operation/operation.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L8"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":""},"external_var":false},{"html_id":"irreversible!(operation_name:String|Nil=nil)-instance-method","name":"irreversible!","abstract":false,"args":[{"name":"operation_name","default_value":"nil","external_name":"operation_name","restriction":"String | ::Nil"}],"args_string":"(operation_name : String | Nil = nil)","args_html":"(operation_name : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/migration/operation/operation.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L10"},"def":{"name":"irreversible!","args":[{"name":"operation_name","default_value":"nil","external_name":"operation_name","restriction":"String | ::Nil"}],"visibility":"Public","body":"operation_name || (operation_name = self.class.name)\nmigration_name = migration ? migration.class.name : nil\nraise(IrreversibleMigration.new(migration_irreversible(migration_name, operation_name)))\n"},"external_var":false},{"html_id":"migration:Lustra::Migration|Nil-instance-method","name":"migration","abstract":false,"location":{"filename":"src/lustra/migration/operation/operation.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L5"},"def":{"name":"migration","return_type":"Lustra::Migration | ::Nil","visibility":"Public","body":"@migration"},"external_var":false},{"html_id":"migration=(migration:Lustra::Migration|Nil)-instance-method","name":"migration=","abstract":false,"args":[{"name":"migration","external_name":"migration","restriction":"Lustra::Migration | ::Nil"}],"args_string":"(migration : Lustra::Migration | Nil)","args_html":"(migration : <a href=\"../../Lustra/Migration.html\">Lustra::Migration</a> | Nil)","location":{"filename":"src/lustra/migration/operation/operation.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L5"},"def":{"name":"migration=","args":[{"name":"migration","external_name":"migration","restriction":"Lustra::Migration | ::Nil"}],"visibility":"Public","body":"@migration = migration"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":true,"location":{"filename":"src/lustra/migration/operation/operation.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/operation.cr#L7"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":""},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/RemoveColumn","path":"Lustra/Migration/RemoveColumn.html","kind":"class","full_name":"Lustra::Migration::RemoveColumn","name":"RemoveColumn","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/columns.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L39"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,column:String,datatype)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column","external_name":"column","restriction":"::String"},{"name":"datatype","external_name":"datatype","restriction":""}],"args_string":"(table : String, column : String, datatype)","args_html":"(table : String, column : String, datatype)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":44,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L44"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"column","external_name":"column","restriction":"::String"},{"name":"datatype","external_name":"datatype","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, column, datatype)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L52"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} ADD #{@column} #{@datatype}\"]"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L48"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} DROP #{@column}\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/RenameColumn","path":"Lustra/Migration/RenameColumn.html","kind":"class","full_name":"Lustra::Migration::RenameColumn","name":"RenameColumn","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/columns.cr","line_number":57,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L57"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"constructors":[{"html_id":"new(table:String,old_column_name:String,new_column_name:String)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"old_column_name","external_name":"old_column_name","restriction":"::String"},{"name":"new_column_name","external_name":"new_column_name","restriction":"::String"}],"args_string":"(table : String, old_column_name : String, new_column_name : String)","args_html":"(table : String, old_column_name : String, new_column_name : String)","location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L62"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String"},{"name":"old_column_name","external_name":"old_column_name","restriction":"::String"},{"name":"new_column_name","external_name":"new_column_name","restriction":"::String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, old_column_name, new_column_name)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":69,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L69"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} RENAME COLUMN #{@new_column_name} TO #{@old_column_name};\"]"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/columns.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/columns.cr#L65"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"[\"ALTER TABLE #{@table} RENAME COLUMN #{@old_column_name} TO #{@new_column_name};\"]"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Table","path":"Lustra/Migration/Table.html","kind":"class","full_name":"Lustra::Migration::Table","name":"Table","abstract":false,"superclass":{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},"ancestors":[{"html_id":"lustra/Lustra/Migration/FullTextSearchableTableHelpers","kind":"module","full_name":"Lustra::Migration::FullTextSearchableTableHelpers","name":"FullTextSearchableTableHelpers"},{"html_id":"lustra/Lustra/Migration/Operation","kind":"class","full_name":"Lustra::Migration::Operation","name":"Operation"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/full_text_searchable.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/full_text_searchable.cr#L8"},{"filename":"src/lustra/migration/operation/table.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Migration/FullTextSearchableTableHelpers","kind":"module","full_name":"Lustra::Migration::FullTextSearchableTableHelpers","name":"FullTextSearchableTableHelpers"}],"namespace":{"html_id":"lustra/Lustra/Migration","kind":"module","full_name":"Lustra::Migration","name":"Migration"},"doc":"Reopen Table to add the helpers","summary":"<p>Reopen Table to add the helpers</p>","constructors":[{"html_id":"new(name:String,schema:String,is_create:Bool)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"},{"name":"is_create","external_name":"is_create","restriction":"::Bool"}],"args_string":"(name : String, schema : String, is_create : Bool)","args_html":"(name : String, schema : String, is_create : Bool)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L23"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"::String"},{"name":"schema","external_name":"schema","restriction":"::String"},{"name":"is_create","external_name":"is_create","restriction":"::Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(name, schema, is_create)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add_column(column,type,default=nil,null=true,primary=false,index=false,unique=false,array=false)-instance-method","name":"add_column","doc":"Add/alter a column for this table.","summary":"<p>Add/alter a column for this table.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":""},{"name":"type","external_name":"type","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"null","default_value":"true","external_name":"null","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"index","default_value":"false","external_name":"index","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""},{"name":"array","default_value":"false","external_name":"array","restriction":""}],"args_string":"(column, type, default = nil, null = true, primary = false, index = false, unique = false, array = false)","args_html":"(column, type, default = <span class=\"n\">nil</span>, null = <span class=\"n\">true</span>, primary = <span class=\"n\">false</span>, index = <span class=\"n\">false</span>, unique = <span class=\"n\">false</span>, array = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L52"},"def":{"name":"add_column","args":[{"name":"column","external_name":"column","restriction":""},{"name":"type","external_name":"type","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"null","default_value":"true","external_name":"null","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"index","default_value":"false","external_name":"index","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""},{"name":"array","default_value":"false","external_name":"array","restriction":""}],"visibility":"Public","body":"self.column_operations << ColumnOperation.new(column: column.to_s, type: type.to_s, default: default, null: null, primary: primary, array: array)\n\nif unique\n  add_index(fields: [column.to_s], unique: true)\nelsif index\n  if index.is_a?(Bool)\n    add_index(fields: [column.to_s], unique: false)\n  else\n    add_index(fields: [column.to_s], unique: false, using: index)\n  end\nend\n"},"external_var":false},{"html_id":"add_fkey(fields:Array(String),table:String,foreign_fields:Array(String),on_delete:String,primary:Bool)-instance-method","name":"add_fkey","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"table","external_name":"table","restriction":"String"},{"name":"foreign_fields","external_name":"foreign_fields","restriction":"Array(String)"},{"name":"on_delete","external_name":"on_delete","restriction":"String"},{"name":"primary","external_name":"primary","restriction":"Bool"}],"args_string":"(fields : Array(String), table : String, foreign_fields : Array(String), on_delete : String, primary : Bool)","args_html":"(fields : Array(String), table : String, foreign_fields : Array(String), on_delete : String, primary : Bool)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":45,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L45"},"def":{"name":"add_fkey","args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"table","external_name":"table","restriction":"String"},{"name":"foreign_fields","external_name":"foreign_fields","restriction":"Array(String)"},{"name":"on_delete","external_name":"on_delete","restriction":"String"},{"name":"primary","external_name":"primary","restriction":"Bool"}],"visibility":"Public","body":"self.fkey_operations << FkeyOperation.new(fields: fields, table: table, foreign_fields: foreign_fields, on_delete: on_delete, primary: primary)"},"external_var":false},{"html_id":"column(name,type,default=nil,null=true,primary=false,index=false,unique=false,array=false)-instance-method","name":"column","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"type","external_name":"type","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"null","default_value":"true","external_name":"null","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"index","default_value":"false","external_name":"index","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""},{"name":"array","default_value":"false","external_name":"array","restriction":""}],"args_string":"(name, type, default = nil, null = true, primary = false, index = false, unique = false, array = false)","args_html":"(name, type, default = <span class=\"n\">nil</span>, null = <span class=\"n\">true</span>, primary = <span class=\"n\">false</span>, index = <span class=\"n\">false</span>, unique = <span class=\"n\">false</span>, array = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":167,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L167"},"def":{"name":"column","args":[{"name":"name","external_name":"name","restriction":""},{"name":"type","external_name":"type","restriction":""},{"name":"default","default_value":"nil","external_name":"default","restriction":""},{"name":"null","default_value":"true","external_name":"null","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"index","default_value":"false","external_name":"index","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""},{"name":"array","default_value":"false","external_name":"array","restriction":""}],"visibility":"Public","body":"type = case type.to_s\nwhen \"string\"\n  \"text\"\nwhen \"int32\", \"integer\"\n  \"integer\"\nwhen \"int64\", \"long\"\n  \"bigint\"\nwhen \"bigdecimal\", \"numeric\"\n  \"numeric\"\nwhen \"datetime\"\n  \"timestamp without time zone\"\nelse\n  type.to_s\nend\n\nadd_column(name.to_s, type: type, default: default, null: null, primary: primary, index: index, unique: unique, array: array)\n"},"external_var":false},{"html_id":"column_operations:Array(ColumnOperation)-instance-method","name":"column_operations","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L19"},"def":{"name":"column_operations","return_type":"Array(ColumnOperation)","visibility":"Public","body":"@column_operations"},"external_var":false},{"html_id":"down:Array(String)-instance-method","name":"down","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":113,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L113"},"def":{"name":"down","return_type":"Array(String)","visibility":"Public","body":"[(if is_create?\n  [\"DROP TABLE\", full_name].join(\" \")\nend)].compact"},"external_var":false},{"html_id":"fkey_operations:Array(FkeyOperation)-instance-method","name":"fkey_operations","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L21"},"def":{"name":"fkey_operations","return_type":"Array(FkeyOperation)","visibility":"Public","body":"@fkey_operations"},"external_var":false},{"html_id":"full_name-instance-method","name":"full_name","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":68,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L68"},"def":{"name":"full_name","visibility":"Public","body":"{Lustra::SQL.escape(@schema), Lustra::SQL.escape(@name)}.join(\".\")"},"external_var":false},{"html_id":"index(field:String|Symbol,name=nil,using=nil,unique=false)-instance-method","name":"index","doc":"Add or replace an index for this table.\nAlias for `add_index`","summary":"<p>Add or replace an index for this table.</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":"String | Symbol"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"args_string":"(field : String | Symbol, name = nil, using = nil, unique = false)","args_html":"(field : String | Symbol, name = <span class=\"n\">nil</span>, using = <span class=\"n\">nil</span>, unique = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L74"},"def":{"name":"index","args":[{"name":"field","external_name":"field","restriction":"String | Symbol"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"visibility":"Public","body":"add_index(fields: [field.to_s], name: name, using: using, unique: unique)"},"external_var":false},{"html_id":"index(fields:Array,name=nil,using=nil,unique=false)-instance-method","name":"index","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Array"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"args_string":"(fields : Array, name = nil, using = nil, unique = false)","args_html":"(fields : Array, name = <span class=\"n\">nil</span>, using = <span class=\"n\">nil</span>, unique = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":78,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L78"},"def":{"name":"index","args":[{"name":"fields","external_name":"fields","restriction":"Array"},{"name":"name","default_value":"nil","external_name":"name","restriction":""},{"name":"using","default_value":"nil","external_name":"using","restriction":""},{"name":"unique","default_value":"false","external_name":"unique","restriction":""}],"visibility":"Public","body":"add_index(fields: fields.map(&.to_s), name: name, using: using, unique: unique)"},"external_var":false},{"html_id":"index_operations:Array(IndexOperation)-instance-method","name":"index_operations","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":20,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L20"},"def":{"name":"index_operations","return_type":"Array(IndexOperation)","visibility":"Public","body":"@index_operations"},"external_var":false},{"html_id":"is_create?:Bool-instance-method","name":"is_create?","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L17"},"def":{"name":"is_create?","return_type":"Bool","visibility":"Public","body":"@is_create"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L14"},"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"references(to,name:String|Nil=nil,on_delete=\"restrict\",type=\"bigint\",null=false,foreign_key=\"id\",primary=false)-instance-method","name":"references","abstract":false,"args":[{"name":"to","external_name":"to","restriction":""},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"},{"name":"on_delete","default_value":"\"restrict\"","external_name":"on_delete","restriction":""},{"name":"type","default_value":"\"bigint\"","external_name":"type","restriction":""},{"name":"null","default_value":"false","external_name":"null","restriction":""},{"name":"foreign_key","default_value":"\"id\"","external_name":"foreign_key","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""}],"args_string":"(to, name : String | Nil = nil, on_delete = \"restrict\", type = \"bigint\", null = false, foreign_key = \"id\", primary = false)","args_html":"(to, name : String | Nil = <span class=\"n\">nil</span>, on_delete = <span class=\"s\">&quot;restrict&quot;</span>, type = <span class=\"s\">&quot;bigint&quot;</span>, null = <span class=\"n\">false</span>, foreign_key = <span class=\"s\">&quot;id&quot;</span>, primary = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L35"},"def":{"name":"references","args":[{"name":"to","external_name":"to","restriction":""},{"name":"name","default_value":"nil","external_name":"name","restriction":"String | ::Nil"},{"name":"on_delete","default_value":"\"restrict\"","external_name":"on_delete","restriction":""},{"name":"type","default_value":"\"bigint\"","external_name":"type","restriction":""},{"name":"null","default_value":"false","external_name":"null","restriction":""},{"name":"foreign_key","default_value":"\"id\"","external_name":"foreign_key","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""}],"visibility":"Public","body":"name || (name = to.singularize.underscore + \"_id\")\n\nadd_column(name, type, null: null, index: true)\n\nadd_fkey(fields: [name.to_s], table: to.to_s, foreign_fields: [foreign_key.to_s], on_delete: on_delete.to_s, primary: primary)\n"},"external_var":false},{"html_id":"schema:String-instance-method","name":"schema","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L15"},"def":{"name":"schema","return_type":"String","visibility":"Public","body":"@schema"},"external_var":false},{"html_id":"timestamps(null=false)-instance-method","name":"timestamps","doc":"Add the timestamps to the field.","summary":"<p>Add the timestamps to the field.</p>","abstract":false,"args":[{"name":"null","default_value":"false","external_name":"null","restriction":""}],"args_string":"(null = false)","args_html":"(null = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L28"},"def":{"name":"timestamps","args":[{"name":"null","default_value":"false","external_name":"null","restriction":""}],"visibility":"Public","body":"add_column(:created_at, \"timestamp without time zone\", null: null, default: \"NOW()\")\nadd_column(:updated_at, \"timestamp without time zone\", null: null, default: \"NOW()\")\nadd_index([\"created_at\"])\nadd_index([\"updated_at\"])\n"},"external_var":false},{"html_id":"up:Array(String)-instance-method","name":"up","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":97,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L97"},"def":{"name":"up","return_type":"Array(String)","visibility":"Public","body":"columns_and_fkeys = print_columns + print_fkeys\n\nif columns_and_fkeys.empty?\nelse\n  content = \"(#{columns_and_fkeys.join(\", \")})\"\nend\n\narr = if is_create?\n  [[\"CREATE TABLE\", full_name, content].compact.join(\" \")]\nelse\n  [] of String\nend\narr + print_indexes\n"},"external_var":false}],"macros":[{"html_id":"method_missing(caller)-macro","name":"method_missing","doc":"DEPRECATED\nMethod missing is used to generate add_column using the method name as\ncolumn type (ActiveRecord's style)","summary":"<p><span class=\"flag red\">DEPRECATED</span>  Method missing is used to generate add_column using the method name as column type (ActiveRecord's style)</p>","abstract":false,"args":[{"name":"caller","external_name":"caller","restriction":""}],"args_string":"(caller)","args_html":"(caller)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":162,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L162"},"def":{"name":"method_missing","args":[{"name":"caller","external_name":"caller","restriction":""}],"visibility":"Public","body":"      \n{% raise(\"Migration: usage of Table##{caller.name} is deprecated.\\n\" + \"Tip: use instead `self.column(NAME, \\\"#{caller.name}\\\", ...)`\") %}\n\n    \n"}}],"types":[{"html_id":"lustra/Lustra/Migration/Table/ColumnOperation","path":"Lustra/Migration/Table/ColumnOperation.html","kind":"struct","full_name":"Lustra::Migration::Table::ColumnOperation","name":"ColumnOperation","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration/Table","kind":"class","full_name":"Lustra::Migration::Table","name":"Table"},"constructors":[{"html_id":"new(column:String,type:String,null:Bool=false,default:SQL::Any=nil,primary:Bool=false,array:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"String"},{"name":"type","external_name":"type","restriction":"String"},{"name":"null","default_value":"false","external_name":"null","restriction":"Bool"},{"name":"default","default_value":"nil","external_name":"default","restriction":"SQL::Any"},{"name":"primary","default_value":"false","external_name":"primary","restriction":"Bool"},{"name":"array","default_value":"false","external_name":"array","restriction":"Bool"}],"args_string":"(column : String, type : String, null : Bool = false, default : SQL::Any = nil, primary : Bool = false, array : Bool = false)","args_html":"(column : String, type : String, null : Bool = <span class=\"n\">false</span>, default : <a href=\"../../../Lustra/SQL/Any.html\">SQL::Any</a> = <span class=\"n\">nil</span>, primary : Bool = <span class=\"n\">false</span>, array : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L4"},"def":{"name":"new","args":[{"name":"column","external_name":"column","restriction":"String"},{"name":"type","external_name":"type","restriction":"String"},{"name":"null","default_value":"false","external_name":"null","restriction":"Bool"},{"name":"default","default_value":"nil","external_name":"default","restriction":"SQL::Any"},{"name":"primary","default_value":"false","external_name":"primary","restriction":"Bool"},{"name":"array","default_value":"false","external_name":"array","restriction":"Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(column, type, null, default, primary, array)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"array:Bool-instance-method","name":"array","abstract":false,"def":{"name":"array","return_type":"Bool","visibility":"Public","body":"@array"},"external_var":false},{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L4"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@column.clone, @type.clone, @null.clone, @default.clone, @primary.clone, @array.clone)"},"external_var":false},{"html_id":"column:String-instance-method","name":"column","abstract":false,"def":{"name":"column","return_type":"String","visibility":"Public","body":"@column"},"external_var":false},{"html_id":"copy_with(column_column=@column,type_type=@type,null_null=@null,default_default=@default,primary_primary=@primary,array_array=@array)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_column","default_value":"@column","external_name":"column","restriction":""},{"name":"_type","default_value":"@type","external_name":"type","restriction":""},{"name":"_null","default_value":"@null","external_name":"null","restriction":""},{"name":"_default","default_value":"@default","external_name":"default","restriction":""},{"name":"_primary","default_value":"@primary","external_name":"primary","restriction":""},{"name":"_array","default_value":"@array","external_name":"array","restriction":""}],"args_string":"(column _column = @column, type _type = @type, null _null = @null, default _default = @default, primary _primary = @primary, array _array = @array)","args_html":"(column _column = @column, type _type = @type, null _null = @null, default _default = @default, primary _primary = @primary, array _array = @array)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L4"},"def":{"name":"copy_with","args":[{"name":"_column","default_value":"@column","external_name":"column","restriction":""},{"name":"_type","default_value":"@type","external_name":"type","restriction":""},{"name":"_null","default_value":"@null","external_name":"null","restriction":""},{"name":"_default","default_value":"@default","external_name":"default","restriction":""},{"name":"_primary","default_value":"@primary","external_name":"primary","restriction":""},{"name":"_array","default_value":"@array","external_name":"array","restriction":""}],"visibility":"Public","body":"self.class.new(_column, _type, _null, _default, _primary, _array)"},"external_var":false},{"html_id":"default:SQL::Any-instance-method","name":"default","abstract":false,"def":{"name":"default","return_type":"SQL::Any","visibility":"Public","body":"@default"},"external_var":false},{"html_id":"null:Bool-instance-method","name":"null","abstract":false,"def":{"name":"null","return_type":"Bool","visibility":"Public","body":"@null"},"external_var":false},{"html_id":"primary:Bool-instance-method","name":"primary","abstract":false,"def":{"name":"primary","return_type":"Bool","visibility":"Public","body":"@primary"},"external_var":false},{"html_id":"type:String-instance-method","name":"type","abstract":false,"def":{"name":"type","return_type":"String","visibility":"Public","body":"@type"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Table/FkeyOperation","path":"Lustra/Migration/Table/FkeyOperation.html","kind":"struct","full_name":"Lustra::Migration::Table::FkeyOperation","name":"FkeyOperation","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/table.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration/Table","kind":"class","full_name":"Lustra::Migration::Table","name":"Table"},"constructors":[{"html_id":"new(fields:Array(String),table:String,foreign_fields:Array(String),on_delete:String,primary:Bool)-class-method","name":"new","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"table","external_name":"table","restriction":"String"},{"name":"foreign_fields","external_name":"foreign_fields","restriction":"Array(String)"},{"name":"on_delete","external_name":"on_delete","restriction":"String"},{"name":"primary","external_name":"primary","restriction":"Bool"}],"args_string":"(fields : Array(String), table : String, foreign_fields : Array(String), on_delete : String, primary : Bool)","args_html":"(fields : Array(String), table : String, foreign_fields : Array(String), on_delete : String, primary : Bool)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L11"},"def":{"name":"new","args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"table","external_name":"table","restriction":"String"},{"name":"foreign_fields","external_name":"foreign_fields","restriction":"Array(String)"},{"name":"on_delete","external_name":"on_delete","restriction":"String"},{"name":"primary","external_name":"primary","restriction":"Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(fields, table, foreign_fields, on_delete, primary)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L11"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@fields.clone, @table.clone, @foreign_fields.clone, @on_delete.clone, @primary.clone)"},"external_var":false},{"html_id":"copy_with(fields_fields=@fields,table_table=@table,foreign_fields_foreign_fields=@foreign_fields,on_delete_on_delete=@on_delete,primary_primary=@primary)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_fields","default_value":"@fields","external_name":"fields","restriction":""},{"name":"_table","default_value":"@table","external_name":"table","restriction":""},{"name":"_foreign_fields","default_value":"@foreign_fields","external_name":"foreign_fields","restriction":""},{"name":"_on_delete","default_value":"@on_delete","external_name":"on_delete","restriction":""},{"name":"_primary","default_value":"@primary","external_name":"primary","restriction":""}],"args_string":"(fields _fields = @fields, table _table = @table, foreign_fields _foreign_fields = @foreign_fields, on_delete _on_delete = @on_delete, primary _primary = @primary)","args_html":"(fields _fields = @fields, table _table = @table, foreign_fields _foreign_fields = @foreign_fields, on_delete _on_delete = @on_delete, primary _primary = @primary)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L11"},"def":{"name":"copy_with","args":[{"name":"_fields","default_value":"@fields","external_name":"fields","restriction":""},{"name":"_table","default_value":"@table","external_name":"table","restriction":""},{"name":"_foreign_fields","default_value":"@foreign_fields","external_name":"foreign_fields","restriction":""},{"name":"_on_delete","default_value":"@on_delete","external_name":"on_delete","restriction":""},{"name":"_primary","default_value":"@primary","external_name":"primary","restriction":""}],"visibility":"Public","body":"self.class.new(_fields, _table, _foreign_fields, _on_delete, _primary)"},"external_var":false},{"html_id":"fields:Array(String)-instance-method","name":"fields","abstract":false,"def":{"name":"fields","return_type":"Array(String)","visibility":"Public","body":"@fields"},"external_var":false},{"html_id":"foreign_fields:Array(String)-instance-method","name":"foreign_fields","abstract":false,"def":{"name":"foreign_fields","return_type":"Array(String)","visibility":"Public","body":"@foreign_fields"},"external_var":false},{"html_id":"on_delete:String-instance-method","name":"on_delete","abstract":false,"def":{"name":"on_delete","return_type":"String","visibility":"Public","body":"@on_delete"},"external_var":false},{"html_id":"primary:Bool-instance-method","name":"primary","abstract":false,"def":{"name":"primary","return_type":"Bool","visibility":"Public","body":"@primary"},"external_var":false},{"html_id":"table:String-instance-method","name":"table","abstract":false,"def":{"name":"table","return_type":"String","visibility":"Public","body":"@table"},"external_var":false}]},{"html_id":"lustra/Lustra/Migration/Table/IndexOperation","path":"Lustra/Migration/Table/IndexOperation.html","kind":"struct","full_name":"Lustra::Migration::Table::IndexOperation","name":"IndexOperation","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/migration/operation/table.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L8"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Migration/Table","kind":"class","full_name":"Lustra::Migration::Table","name":"Table"},"constructors":[{"html_id":"new(fields:Array(String),name:String,using:String|Nil=nil,unique:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"name","external_name":"name","restriction":"String"},{"name":"using","default_value":"nil","external_name":"using","restriction":"String | ::Nil"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"Bool"}],"args_string":"(fields : Array(String), name : String, using : String | Nil = nil, unique : Bool = false)","args_html":"(fields : Array(String), name : String, using : String | Nil = <span class=\"n\">nil</span>, unique : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L8"},"def":{"name":"new","args":[{"name":"fields","external_name":"fields","restriction":"Array(String)"},{"name":"name","external_name":"name","restriction":"String"},{"name":"using","default_value":"nil","external_name":"using","restriction":"String | ::Nil"},{"name":"unique","default_value":"false","external_name":"unique","restriction":"Bool"}],"visibility":"Public","body":"_ = allocate\n_.initialize(fields, name, using, unique)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/migration/operation/table.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L8"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@fields.clone, @name.clone, @using.clone, @unique.clone)"},"external_var":false},{"html_id":"copy_with(fields_fields=@fields,name_name=@name,using_using=@using,unique_unique=@unique)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_fields","default_value":"@fields","external_name":"fields","restriction":""},{"name":"_name","default_value":"@name","external_name":"name","restriction":""},{"name":"_using","default_value":"@using","external_name":"using","restriction":""},{"name":"_unique","default_value":"@unique","external_name":"unique","restriction":""}],"args_string":"(fields _fields = @fields, name _name = @name, using _using = @using, unique _unique = @unique)","args_html":"(fields _fields = @fields, name _name = @name, using _using = @using, unique _unique = @unique)","location":{"filename":"src/lustra/migration/operation/table.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/migration/operation/table.cr#L8"},"def":{"name":"copy_with","args":[{"name":"_fields","default_value":"@fields","external_name":"fields","restriction":""},{"name":"_name","default_value":"@name","external_name":"name","restriction":""},{"name":"_using","default_value":"@using","external_name":"using","restriction":""},{"name":"_unique","default_value":"@unique","external_name":"unique","restriction":""}],"visibility":"Public","body":"self.class.new(_fields, _name, _using, _unique)"},"external_var":false},{"html_id":"fields:Array(String)-instance-method","name":"fields","abstract":false,"def":{"name":"fields","return_type":"Array(String)","visibility":"Public","body":"@fields"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"unique:Bool-instance-method","name":"unique","abstract":false,"def":{"name":"unique","return_type":"Bool","visibility":"Public","body":"@unique"},"external_var":false},{"html_id":"using:String|Nil-instance-method","name":"using","abstract":false,"def":{"name":"using","return_type":"String | ::Nil","visibility":"Public","body":"@using"},"external_var":false}]}]}]},{"html_id":"lustra/Lustra/Model","path":"Lustra/Model.html","kind":"module","full_name":"Lustra::Model","name":"Model","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/Model/FullTextSearchable","kind":"module","full_name":"Lustra::Model::FullTextSearchable","name":"FullTextSearchable"},{"html_id":"lustra/Lustra/Model/JSONDeserialize","kind":"module","full_name":"Lustra::Model::JSONDeserialize","name":"JSONDeserialize"},{"html_id":"lustra/Lustra/Model/Initializer","kind":"module","full_name":"Lustra::Model::Initializer","name":"Initializer"},{"html_id":"lustra/Lustra/Model/HasFactory","kind":"module","full_name":"Lustra::Model::HasFactory","name":"HasFactory"},{"html_id":"lustra/Lustra/Model/ClassMethods","kind":"module","full_name":"Lustra::Model::ClassMethods","name":"ClassMethods"},{"html_id":"lustra/Lustra/Model/HasScope","kind":"module","full_name":"Lustra::Model::HasScope","name":"HasScope"},{"html_id":"lustra/Lustra/Model/HasRelations","kind":"module","full_name":"Lustra::Model::HasRelations","name":"HasRelations"},{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"},{"html_id":"lustra/Lustra/Validation/Helper","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper"},{"html_id":"lustra/Lustra/Model/HasSaving","kind":"module","full_name":"Lustra::Model::HasSaving","name":"HasSaving"},{"html_id":"lustra/Lustra/Model/HasSerialPkey","kind":"module","full_name":"Lustra::Model::HasSerialPkey","name":"HasSerialPkey"},{"html_id":"lustra/Lustra/Model/HasTimestamps","kind":"module","full_name":"Lustra::Model::HasTimestamps","name":"HasTimestamps"},{"html_id":"lustra/Lustra/Model/HasColumns","kind":"module","full_name":"Lustra::Model::HasColumns","name":"HasColumns"},{"html_id":"lustra/Lustra/Model/HasHooks","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks"},{"html_id":"lustra/Lustra/Model/Connection","kind":"module","full_name":"Lustra::Model::Connection","name":"Connection"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/full_text_searchable.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/full_text_searchable.cr#L3"},{"filename":"src/lustra/model/collection.cr","line_number":158,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L158"},{"filename":"src/lustra/model/errors.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L1"},{"filename":"src/lustra/model/model.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/model.cr#L9"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Lustra/Model/ClassMethods","kind":"module","full_name":"Lustra::Model::ClassMethods","name":"ClassMethods"},{"html_id":"lustra/Lustra/Model/Connection","kind":"module","full_name":"Lustra::Model::Connection","name":"Connection"},{"html_id":"lustra/Lustra/Model/FullTextSearchable","kind":"module","full_name":"Lustra::Model::FullTextSearchable","name":"FullTextSearchable"},{"html_id":"lustra/Lustra/Model/HasColumns","kind":"module","full_name":"Lustra::Model::HasColumns","name":"HasColumns"},{"html_id":"lustra/Lustra/Model/HasFactory","kind":"module","full_name":"Lustra::Model::HasFactory","name":"HasFactory"},{"html_id":"lustra/Lustra/Model/HasHooks","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks"},{"html_id":"lustra/Lustra/Model/HasRelations","kind":"module","full_name":"Lustra::Model::HasRelations","name":"HasRelations"},{"html_id":"lustra/Lustra/Model/HasSaving","kind":"module","full_name":"Lustra::Model::HasSaving","name":"HasSaving"},{"html_id":"lustra/Lustra/Model/HasScope","kind":"module","full_name":"Lustra::Model::HasScope","name":"HasScope"},{"html_id":"lustra/Lustra/Model/HasSerialPkey","kind":"module","full_name":"Lustra::Model::HasSerialPkey","name":"HasSerialPkey"},{"html_id":"lustra/Lustra/Model/HasTimestamps","kind":"module","full_name":"Lustra::Model::HasTimestamps","name":"HasTimestamps"},{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"},{"html_id":"lustra/Lustra/Model/Initializer","kind":"module","full_name":"Lustra::Model::Initializer","name":"Initializer"},{"html_id":"lustra/Lustra/Model/JSONDeserialize","kind":"module","full_name":"Lustra::Model::JSONDeserialize","name":"JSONDeserialize"}],"including_types":[{"html_id":"lustra/Lustra/Reflection/Column","kind":"class","full_name":"Lustra::Reflection::Column","name":"Column"},{"html_id":"lustra/Lustra/Reflection/Table","kind":"class","full_name":"Lustra::Reflection::Table","name":"Table"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"Model definition is made by adding the `Lustra::Model` mixin in your class.\n## Simple Model\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column my_column : String\nend\n```\n\nWe just created a new model, linked to your database, mapping the column `my_column` of type String (`text` in postgres).\n\nNow, you can play with your model:\n\n```\nrow = MyModel.new # create an empty row\nrow.my_column = \"This is a content\"\nrow.save! # insert the new row in the database !\n```\n\nBy convention, the table name will follow an underscore, plural version of your model: `my_models`.\nA model into a module will prepend the module name before, so `Logistic::MyModel` will check for `logistic_my_models` in your database.\nYou can force a specific table name using:\n\n```\nclass MyModel\n  include Lustra::Model\n  self.table = \"another_table_name\"\nend\n```\n\n## Presence validation\n\nUnlike many ORM around, Lustra carry about non-nullable pattern in crystal. Meaning `column my_column : String` assume than a call to `row.my_column` will return a String.\n\nBut it exists cases where the column is not yet initialized:\n- When the object is built with constructor without providing the value (See above).\n- When an object is semi-fetched through the database query. This is useful to ignore some large fields non-interesting in the body of the current operation.\n\nFor example, this code will compile:\n\n```\nrow = MyModel.new # create an empty row\nputs row.my_column\n```\n\nHowever, it will throw a runtime exception `You cannot access to the field 'my_column' because it never has been initialized`\n\nSame way, trying to save the object will raise an error:\n\n```\nrow.save      # Will return false\npp row.errors # Will tell you than `my_column` presence is mandatory.\n```\n\nThanks to expressiveness of the Crystal language, we can handle presence validation by simply using the `Nilable` type in crystal:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column my_column : String? # Now, the column can be NULL or text in postgres.\nend\n```\n\nThis time, the code above will works; in case of no value, my_column will be `nil` by default.\n\n## Querying your code\n\nWhenever you want to fetch data from your database, you must create a new collection query:\n\n`MyModel.query # Will setup a vanilla 'SELECT * FROM my_models'`\n\nQueries are fetchable using `each`:\n\n```\nMyModel.query.each do |model|\n  # Do something with your model here.\nend\n```\n\n## Refining your query\n\nA collection query offers a lot of functionalities.\n\n## Column type\n\nBy default, Lustra map theses columns types:\n\n- `String` => `text`\n- `Numbers` (any from 8 to 64 bits, float, double, big number, big float) => `int, large int etc... (depends of your choice)`\n- `Bool` => `text or bool`\n- `Time` => `timestamp without timezone or text`\n- `JSON::Any` => `json and jsonb`\n- `Nilable` => `NULL` (treated as special !)\n\n_NOTE_: The `crystal-pg` gems map also some structures like GIS coordinates, but their implementation is not tested in Lustra. Use them at your own risk. Tell me if it's working 😉\n\nIf you need to map special structure, see [Mapping Your Data](Mapping) guides for more informations.\n\n## Primary key\n\nPrimary key is essential for relational mapping. Currently Lustra support only one column primary key.\n\nA model without primary key can work in sort of degraded mode, throwing error in case of using some methods on them:\n- `collection#first` will be throwing error if no `order_by` has been setup\n\nTo setup a primary key, you can add the modifier `primary: true` to the column:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column id : Int32, primary: true, presence: false\n  column my_column : String?\nend\n```\n\nNote the flag `presence: false` added to the column. This tells Lustra than presence checking on save is not mandatory. Usually this happens if you setup a default value in postgres. In the case of our primary key `id`, we use a serial auto-increment default value.\nTherefore, saving the model without primary key will works. The id will be fetched after insertion:\n\n```\nm = MyModel\nm.save!\nm.id # Now the id value is setup.\n```\n\n## Helpers\n\nLustra provides various built-in helpers to facilitate your life:\n\n### Timestamps\n\n```\nclass MyModel\n  include Lustra::Model\n  timestamps # Will map the two columns 'created_at' and 'updated_at', and map some hooks to update their values.\nend\n```\n\nTheses fields are automatically updated whenever you call `save` methods, and works as Rails ActiveRecord.\n\n### With Serial Pkey\n\n```\nclass MyModel\n  include Lustra::Model\n  primary_key \"my_primary_key\"\nend\n```\n\nBasically rewrite `column id : UInt64, primary: true, presence: false`\n\nArgument is optional (default = id)","summary":"<p>Model definition is made by adding the <code><a href=\"../Lustra/Model.html\">Lustra::Model</a></code> mixin in your class.</p>","instance_methods":[{"html_id":"__pkey__-instance-method","name":"__pkey__","doc":"Alias method for primary key.\n\nIf `Model#id` IS the primary key, then calling `Model#__pkey__` is exactly the same as `Model#id`.\n\nThis method exists to tremendously simplify the meta-programming code.\nIf no primary key has been setup to this model, raise an exception.","summary":"<p>Alias method for primary key.</p>","abstract":false,"location":{"filename":"src/lustra/model/model.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/model.cr#L33"},"def":{"name":"__pkey__","visibility":"Public","body":"raise(lack_of_primary_key(self.class.name))"},"external_var":false},{"html_id":"cache:Lustra::Model::QueryCache|Nil-instance-method","name":"cache","abstract":false,"location":{"filename":"src/lustra/model/model.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/model.cr#L25"},"def":{"name":"cache","return_type":"Lustra::Model::QueryCache | ::Nil","visibility":"Public","body":"@cache"},"external_var":false}],"macros":[{"html_id":"default_scope(&block)-macro","name":"default_scope","doc":"Define a default scope that will be automatically applied to all queries.\nUseful for soft deletes, multi-tenancy, or any filter that should always apply.\n\n**Warning:** Default scopes can be confusing as they're implicit.\nUse sparingly and document clearly.\n\nUsage:\n\n```\nclass Post\n  include Lustra::Model\n\n  column deleted_at : Time?\n\n  default_scope { where { deleted_at == nil } }\nend\n\nPost.query       # SELECT * FROM posts WHERE deleted_at IS NULL\nPost.query.first # Also applies default scope\n```\n\nTo bypass default scope, use `unscoped`:\n\n```\nPost.query.unscoped       # SELECT * FROM posts (no default scope)\nPost.query.unscoped.count # Works with any query method\n```","summary":"<p>Define a default scope that will be automatically applied to all queries.</p>","abstract":false,"location":{"filename":"src/lustra/model/model.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/model.cr#L19"},"def":{"name":"default_scope","block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"      class Collection < Lustra::Model::CollectionBase(\n{{ @type }}\n);\n        def __apply_default_scope__\n          \n{{ yield }}\n\n          return self\n        \nend\n\n        \n# Remove default scope from this query chain.\n\n        \n# Returns a new collection without the default scope applied.\n\n        \n#\n\n        \n# ```\n\n        \n# Post.query.unscoped              # No default scope\n\n        \n# Post.query.unscoped.count        # Count all records\n\n        \n# Post.query.where(...).unscoped   # Start fresh without scope\n\n        \n# ```\n\n        def unscoped\n          \n{{ @type }}\n.__unscoped_query__\n        \nend\n      \nend\n    \n"}},{"html_id":"scope(name,&block)-macro","name":"scope","doc":"A scope allow you to filter in a very human way a set of data.\n\nUsage:\n\n```\nscope(\"admin\") { where({role: \"admin\"}) }\n```\n\nfor example, instead of writing:\n\n```\nUser.query.where { (role == \"admin\") & (active == true) }\n```\n\nYou can write:\n\n```\nUser.admin.active\n```\n\nScope can be used for other purpose than just filter (e.g. ordering),\nbut I would not recommend it.","summary":"<p>A scope allow you to filter in a very human way a set of data.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""}],"args_string":"(name, &block)","args_html":"(name, &block)","location":{"filename":"src/lustra/model/model.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/model.cr#L19"},"def":{"name":"scope","args":[{"name":"name","external_name":"name","restriction":""}],"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"      \n{% parameters = \"\" %}\n\n      \n{% for arg, idx in block.args %}\n        {% if (block.splat_index && (idx == block.splat_index))\n  parameters = parameters + \"*\"\nend %}\n        {% parameters = parameters + \"#{arg}\" %}\n        {% unless (idx == (block.args.size - 1))\n  parameters = parameters + \", \"\nend %}\n      {% end %}\n\n      \n{% parameters = parameters.id %}\n\n\n      def self.\n{{ name.id }}\n(\n{{ parameters }}\n)\n        query.\n{{ name.id }}\n(\n{{ parameters }}\n)\n      \nend\n\n      class Collection < Lustra::Model::CollectionBase(\n{{ @type }}\n);\n        def \n{{ name.id }}\n(\n{{ parameters }}\n)\n          \n{{ yield }}\n\n\n          return self\n        \nend\n      \nend\n    \n"}}],"types":[{"html_id":"lustra/Lustra/Model/ClassMethods","path":"Lustra/Model/ClassMethods.html","kind":"module","full_name":"Lustra::Model::ClassMethods","name":"ClassMethods","abstract":false,"locations":[{"filename":"src/lustra/model/modules/class_methods.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/class_methods.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}},{"html_id":"lustra/Lustra/Model/CollectionBase","path":"Lustra/Model/CollectionBase.html","kind":"class","full_name":"Lustra::Model::CollectionBase(T)","name":"CollectionBase","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/collection.cr","line_number":168,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L168"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"subclasses":[{"html_id":"lustra/Lustra/Reflection/Column/Collection","kind":"class","full_name":"Lustra::Reflection::Column::Collection","name":"Collection"},{"html_id":"lustra/Lustra/Reflection/Table/Collection","kind":"class","full_name":"Lustra::Reflection::Table::Collection","name":"Collection"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"`CollectionBase(T)` is the base class for collection of model.\nCollection of model are a SQL `SELECT` query mapping & building system. They are Enumerable and are\n`Lustra::SQL::SelectBuilder` behavior; therefore, they can be used array-like and are working with low-level SQL\nBuilding.\n\nThe `CollectionBase(T)` is extended by each model. For example, generating the model `MyModel` will generate the\nclass `MyModel::Collection` which inherits from `CollectionBase(MyModel)`\n\nCollection are instantiated using `Model.query` method.","summary":"<p><code><a href=\"../../Lustra/Model/CollectionBase.html\">CollectionBase</a>(T)</code> is the base class for collection of model.</p>","instance_methods":[{"html_id":"<<(item:T)-instance-method","name":"<<","doc":"Add an item to the current collection.\n\nIf the current collection is not originated from a `has_many` or `has_many through:` relation, calling `<<` over\nthe collection will raise a `Lustra::SQL::OperationNotPermittedError`\n\nReturns `self` and therefore can be chained","summary":"<p>Add an item to the current collection.</p>","abstract":false,"args":[{"name":"item","external_name":"item","restriction":"T"}],"args_string":"(item : T)","args_html":"(item : T)","location":{"filename":"src/lustra/model/collection.cr","line_number":508,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L508"},"def":{"name":"<<","args":[{"name":"item","external_name":"item","restriction":"T"}],"visibility":"Public","body":"append_operation = self.append_operation\n\nif append_operation\nelse\n  raise(\"Operation not permitted on this collection.\")\nend\n\nappend_operation.call(item)\n@cached_result.try(&.<<(item))\n\nself\n"},"external_var":false},{"html_id":"[](range:Range(Number,Number),fetch_columns=false):Array(T)-instance-method","name":"[]","doc":"Get a range of models","summary":"<p>Get a range of models</p>","abstract":false,"args":[{"name":"range","external_name":"range","restriction":"Range(Number, Number)"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(range : Range(Number, Number), fetch_columns = false) : Array(T)","args_html":"(range : Range(Number, Number), fetch_columns = <span class=\"n\">false</span>) : Array(T)","location":{"filename":"src/lustra/model/collection.cr","line_number":579,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L579"},"def":{"name":"[]","args":[{"name":"range","external_name":"range","restriction":"Range(Number, Number)"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"Array(T)","visibility":"Public","body":"((offset(range.begin)).limit(range.end - range.begin)).to_a(fetch_columns)"},"external_var":false},{"html_id":"[](off,fetch_columns=false):T-instance-method","name":"[]","doc":"Basically a fancy way to write `OFFSET x LIMIT 1`","summary":"<p>Basically a fancy way to write <code>OFFSET x LIMIT 1</code></p>","abstract":false,"args":[{"name":"off","external_name":"off","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(off, fetch_columns = false) : T","args_html":"(off, fetch_columns = <span class=\"n\">false</span>) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":569,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L569"},"def":{"name":"[]","args":[{"name":"off","external_name":"off","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"self[off, fetch_columns]? || (raise(Lustra::SQL::RecordNotFoundError.new))"},"external_var":false},{"html_id":"[]?(off,fetch_columns=false):T|Nil-instance-method","name":"[]?","doc":"Basically a fancy way to write `OFFSET x LIMIT 1`","summary":"<p>Basically a fancy way to write <code>OFFSET x LIMIT 1</code></p>","abstract":false,"args":[{"name":"off","external_name":"off","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(off, fetch_columns = false) : T | Nil","args_html":"(off, fetch_columns = <span class=\"n\">false</span>) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":574,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L574"},"def":{"name":"[]?","args":[{"name":"off","external_name":"off","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"(offset(off)).first(fetch_columns)"},"external_var":false},{"html_id":"add(item:T)-instance-method","name":"add","doc":"Alias for `Collection#<<`","summary":"<p>Alias for <code>Collection#&lt;&lt;</code></p>","abstract":false,"args":[{"name":"item","external_name":"item","restriction":"T"}],"args_string":"(item : T)","args_html":"(item : T)","location":{"filename":"src/lustra/model/collection.cr","line_number":520,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L520"},"def":{"name":"add","args":[{"name":"item","external_name":"item","restriction":"T"}],"visibility":"Public","body":"self << item"},"external_var":false},{"html_id":"any?-instance-method","name":"any?","doc":"Check whether the query return any row.","summary":"<p>Check whether the query return any row.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":478,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L478"},"def":{"name":"any?","visibility":"Public","body":"cr = @cached_result\n\nif cr\n  return !cr.empty?\nend\n\n((clear_select.select(\"1\")).limit(1)).fetch do |_| return true end\n\nfalse\n"},"external_var":false},{"html_id":"association_name:String|Nil-instance-method","name":"association_name","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":200,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L200"},"def":{"name":"association_name","return_type":"String | ::Nil","visibility":"Public","body":"@association_name"},"external_var":false},{"html_id":"association_name=(association_name:String|Nil)-instance-method","name":"association_name=","abstract":false,"args":[{"name":"association_name","external_name":"association_name","restriction":"String | ::Nil"}],"args_string":"(association_name : String | Nil)","args_html":"(association_name : String | Nil)","location":{"filename":"src/lustra/model/collection.cr","line_number":200,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L200"},"def":{"name":"association_name=","args":[{"name":"association_name","external_name":"association_name","restriction":"String | ::Nil"}],"visibility":"Public","body":"@association_name = association_name"},"external_var":false},{"html_id":"autosave=(autosave:Bool)-instance-method","name":"autosave=","abstract":false,"args":[{"name":"autosave","external_name":"autosave","restriction":"Bool"}],"args_string":"(autosave : Bool)","args_html":"(autosave : Bool)","location":{"filename":"src/lustra/model/collection.cr","line_number":201,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L201"},"def":{"name":"autosave=","args":[{"name":"autosave","external_name":"autosave","restriction":"Bool"}],"visibility":"Public","body":"@autosave = autosave"},"external_var":false},{"html_id":"autosave?:Bool-instance-method","name":"autosave?","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":201,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L201"},"def":{"name":"autosave?","return_type":"Bool","visibility":"Public","body":"@autosave"},"external_var":false},{"html_id":"build(x:NamedTuple,&block:T->Nil):T-instance-method","name":"build","doc":"Build a new collection; if the collection comes from a has_many relation\n(e.g. `my_model.associations.build`), the foreign column which store\nthe primary key of `my_model` will be setup by default, preventing you\nto forget it.\nYou can pass extra parameters using a named tuple:\n`my_model.associations.build({a_column: \"value\"}) `","summary":"<p>Build a new collection; if the collection comes from a has_many relation (e.g.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : T -> Nil) : T","args_html":"(x : NamedTuple, &block : T -> Nil) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":415,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L415"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"build(**x, &block)"},"external_var":false},{"html_id":"build(**tuple,&:T->Nil):T-instance-method","name":"build","doc":"Build a new collection; if the collection comes from a has_many relation\n(e.g. `my_model.associations.build`), the foreign column which store\nthe primary key of `my_model` will be setup by default, preventing you\nto forget it.\nYou can pass extra parameters using a named tuple:\n`my_model.associations.build({a_column: \"value\"}) `","summary":"<p>Build a new collection; if the collection comes from a has_many relation (e.g.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":388,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L388"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"str_hash = @tags.dup\ntuple.map do |k, v| str_hash[k.to_s] = v end\n\nr = Lustra::Model::Factory.build(T, str_hash, persisted: false)\n\nyield(r)\n\n\nif (autosave? && (pm = parent_model)) && (an = association_name)\n  pm.add_built_association(an, r)\nend\n\nr\n"},"external_var":false},{"html_id":"build(x:NamedTuple):T-instance-method","name":"build","doc":"Build a new collection; if the collection comes from a has_many relation\n(e.g. `my_model.associations.build`), the foreign column which store\nthe primary key of `my_model` will be setup by default, preventing you\nto forget it.\nYou can pass extra parameters using a named tuple:\n`my_model.associations.build({a_column: \"value\"}) `","summary":"<p>Build a new collection; if the collection comes from a has_many relation (e.g.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : T","args_html":"(x : NamedTuple) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":410,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L410"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"T","visibility":"Public","body":"build(**x) do\nend"},"external_var":false},{"html_id":"build(**tuple):T-instance-method","name":"build","doc":"Build a new collection; if the collection comes from a has_many relation\n(e.g. `my_model.associations.build`), the foreign column which store\nthe primary key of `my_model` will be setup by default, preventing you\nto forget it.\nYou can pass extra parameters using a named tuple:\n`my_model.associations.build({a_column: \"value\"}) `","summary":"<p>Build a new collection; if the collection comes from a has_many relation (e.g.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":405,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L405"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"build(**tuple) do\nend"},"external_var":false},{"html_id":"count(type:X.class=Int64)forallX-instance-method","name":"count","doc":"Use SQL `COUNT` over your query, and return this number as a Int64","summary":"<p>Use SQL <code>COUNT</code> over your query, and return this number as a Int64</p>","abstract":false,"args":[{"name":"type","default_value":"Int64","external_name":"type","restriction":"X.class"}],"args_string":"(type : X.class = Int64) forall X","args_html":"(type : <span class=\"t\">X</span>.<span class=\"k\">class</span> = <span class=\"t\">Int64</span>) forall X","location":{"filename":"src/lustra/model/collection.cr","line_number":494,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L494"},"def":{"name":"count","args":[{"name":"type","default_value":"Int64","external_name":"type","restriction":"X.class"}],"visibility":"Public","body":"cr = @cached_result\n\nif cr.nil?\nelse\n  return X.new(cr.size)\nend\n\nsuper(type)\n"},"external_var":false},{"html_id":"create(x:NamedTuple,&block:T->Nil):T-instance-method","name":"create","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : T -> Nil) : T","args_html":"(x : NamedTuple, &block : T -> Nil) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":443,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L443"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"create(**x, &block)"},"external_var":false},{"html_id":"create(**tuple,&:T->Nil):T-instance-method","name":"create","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":422,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L422"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"r = build(**tuple) do |mdl| yield(mdl) end\n\nif r.save\n  handle_append_operation(r)\nend\n\nr\n"},"external_var":false},{"html_id":"create(x:NamedTuple):T-instance-method","name":"create","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : T","args_html":"(x : NamedTuple) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":438,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L438"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"T","visibility":"Public","body":"create(**x)"},"external_var":false},{"html_id":"create(**tuple):T-instance-method","name":"create","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":433,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L433"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"create(**tuple) do\nend"},"external_var":false},{"html_id":"create!(x:NamedTuple,&block:T->Nil):T-instance-method","name":"create!","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.\nBut instead of returning self if validation failed,\nraise `Lustra::Model::InvalidError` exception","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : T -> Nil) : T","args_html":"(x : NamedTuple, &block : T -> Nil) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":473,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L473"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"create(**x, &block)"},"external_var":false},{"html_id":"create!(**tuple,&:T->Nil):T-instance-method","name":"create!","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.\nBut instead of returning self if validation failed,\nraise `Lustra::Model::InvalidError` exception","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":452,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L452"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"r = build(**tuple) do |mdl| yield(mdl) end\n\nr.save!\n\nhandle_append_operation(r)\n\nr\n"},"external_var":false},{"html_id":"create!(x:NamedTuple):T-instance-method","name":"create!","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.\nBut instead of returning self if validation failed,\nraise `Lustra::Model::InvalidError` exception","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : T","args_html":"(x : NamedTuple) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":468,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L468"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"T","visibility":"Public","body":"create(**x)"},"external_var":false},{"html_id":"create!(**tuple):T-instance-method","name":"create!","doc":"Build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.\nBut instead of returning self if validation failed,\nraise `Lustra::Model::InvalidError` exception","summary":"<p>Build a new object and setup the fields like setup in the condition tuple.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":463,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L463"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"create!(**tuple) do\nend"},"external_var":false},{"html_id":"delete_all:self-instance-method","name":"delete_all","doc":"Delete all the rows which would have been returned by this collection WITHOUT callbacks.\nThis is a bulk operation that doesn't load models into memory.\nIs equivalent to `collection.to_delete.execute`\n\n```\nUser.query.where { active == false }.delete_all\n```\n\nReturns `self` for chaining.","summary":"<p>Delete all the rows which would have been returned by this collection WITHOUT callbacks.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":889,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L889"},"def":{"name":"delete_all","return_type":"self","visibility":"Public","body":"to_delete.execute\nchange!\n"},"external_var":false},{"html_id":"destroy_all:self-instance-method","name":"destroy_all","doc":"Destroy all the rows which would have been returned by this collection WITH callbacks.\nThis loads each model into memory and calls `destroy` on it, triggering all `:delete` callbacks.\nUse `delete_all` if you don't need callbacks (much faster for large datasets).\n\n```\n# With callbacks - slower but safe\nUser.query.where { active == false }.destroy_all\n\n# Without callbacks - faster\nUser.query.where { active == false }.delete_all\n```\n\nReturns `self` for chaining.","summary":"<p>Destroy all the rows which would have been returned by this collection WITH callbacks.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":907,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L907"},"def":{"name":"destroy_all","return_type":"self","visibility":"Public","body":"each do |model|\n  model.destroy\nend\nchange!\n"},"external_var":false},{"html_id":"dup-instance-method","name":"dup","doc":"Duplicate the query","summary":"<p>Duplicate the query</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":225,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L225"},"def":{"name":"dup","visibility":"Public","body":"if (@polymorphic && (polymorphic_key = @polymorphic_key)) && (polymorphic_scope = @polymorphic_scope)\n  super().flag_as_polymorphic!(polymorphic_key, polymorphic_scope)\nelse\n  super()\nend"},"external_var":false},{"html_id":"each(fetch_columns=false,&:T->):Nil-instance-method","name":"each","doc":"Build the SQL, send the query then iterate through each models\ngathered by the request.","summary":"<p>Build the SQL, send the query then iterate through each models gathered by the request.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, & : T -> ) : Nil","args_html":"(fetch_columns = <span class=\"n\">false</span>, & : T -> ) : Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":327,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L327"},"def":{"name":"each","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T ->)"},"return_type":"Nil","visibility":"Public","body":"result = @cached_result\n\nif result\nelse\n  result = [] of T\n\n  if @polymorphic\n    fetch(fetch_all: false) do |hash|\n      type = hash[@polymorphic_key].as(String)\n      result << ((Lustra::Model::Factory.build(type, hash, persisted: true, fetch_columns: fetch_columns, cache: @cache)).as(T))\n    end\n  else\n    fetch(fetch_all: false) do |hash|\n      result << (Lustra::Model::Factory.build(T, hash, persisted: true, fetch_columns: fetch_columns, cache: @cache))\n    end\n  end\nend\n\nresult.each do |value|\n  yield value\nend\n"},"external_var":false},{"html_id":"each_with_cursor(batch=1000,fetch_columns=false,&block:T->)-instance-method","name":"each_with_cursor","doc":"Build the SQL, send the query then iterate through each models\ngathered by the request.\nUse a postgres cursor to avoid memory bloating.\nUseful to fetch millions of rows at once.","summary":"<p>Build the SQL, send the query then iterate through each models gathered by the request.</p>","abstract":false,"args":[{"name":"batch","default_value":"1000","external_name":"batch","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(batch = 1000, fetch_columns = false, &block : T -> )","args_html":"(batch = <span class=\"n\">1000</span>, fetch_columns = <span class=\"n\">false</span>, &block : T -> )","location":{"filename":"src/lustra/model/collection.cr","line_number":363,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L363"},"def":{"name":"each_with_cursor","args":[{"name":"batch","default_value":"1000","external_name":"batch","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T ->)"},"visibility":"Public","body":"cr = @cached_result\n\nif cr\n  cr.each(&block)\nelsif @polymorphic\n  fetch_with_cursor(count: batch) do |hash|\n    type = hash[@polymorphic_key].as(String)\n    yield((Lustra::Model::Factory.build(type, hash, persisted: true, fetch_columns: fetch_columns, cache: @cache)).as(T))\n  end\nelse\n  fetch_with_cursor(count: batch) do |hash|\n    yield(Lustra::Model::Factory.build(T, hash, persisted: true, fetch_columns: fetch_columns, cache: @cache))\n  end\nend\n"},"external_var":false},{"html_id":"empty?-instance-method","name":"empty?","doc":"Inverse of `any?`, return true if the request return no rows.","summary":"<p>Inverse of <code><a href=\"../../Lustra/Model/CollectionBase.html#any%3F-instance-method\">#any?</a></code>, return true if the request return no rows.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":489,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L489"},"def":{"name":"empty?","visibility":"Public","body":"!any?"},"external_var":false},{"html_id":"find(fetch_columns=false,&):T|Nil-instance-method","name":"find","doc":"A convenient way to write `where { condition }.first(fetch_columns)`","summary":"<p>A convenient way to write <code>where { condition }<a href=\"../../Lustra/Model/CollectionBase.html#first%28fetch_columns%3Dfalse%29%3AT%7CNil-instance-method\">.first(fetch_columns)</a></code></p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, &) : T | Nil","args_html":"(fetch_columns = <span class=\"n\">false</span>, &) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":584,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L584"},"def":{"name":"find","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":0,"block_arity":0,"return_type":"T | ::Nil","visibility":"Public","body":"x = Lustra::Expression.ensure_node!(with Lustra::Expression.new yield)\n\n(where(x)).first(fetch_columns)\n"},"external_var":false},{"html_id":"find(tuple:NamedTuple,fetch_columns=false):T|Nil-instance-method","name":"find","doc":"A convenient way to write `where({any_column: \"any_value\"}).first(fetch_columns)`","summary":"<p>A convenient way to write <code>where({any_column: &quot;any_value&quot;})<a href=\"../../Lustra/Model/CollectionBase.html#first%28fetch_columns%3Dfalse%29%3AT%7CNil-instance-method\">.first(fetch_columns)</a></code></p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(tuple : NamedTuple, fetch_columns = false) : T | Nil","args_html":"(tuple : NamedTuple, fetch_columns = <span class=\"n\">false</span>) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":591,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L591"},"def":{"name":"find","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"(where(tuple)).first(fetch_columns)"},"external_var":false},{"html_id":"find(**tuple):T|Nil-instance-method","name":"find","doc":"A convenient way to write `where({any_column: \"any_value\"}).first`","summary":"<p>A convenient way to write <code>where({any_column: &quot;any_value&quot;})<a href=\"../../Lustra/Model/CollectionBase.html#first%28fetch_columns%3Dfalse%29%3AT%7CNil-instance-method\">.first</a></code></p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":596,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L596"},"def":{"name":"find","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T | ::Nil","visibility":"Public","body":"(where(tuple)).first"},"external_var":false},{"html_id":"find!(fetch_columns=false,&):T-instance-method","name":"find!","doc":"A convenient way to write `where { condition }.first!(fetch_columns)`","summary":"<p>A convenient way to write <code>where { condition }<a href=\"../../Lustra/Model/CollectionBase.html#first%21%28fetch_columns%3Dfalse%29%3AT-instance-method\">.first!(fetch_columns)</a></code></p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, &) : T","args_html":"(fetch_columns = <span class=\"n\">false</span>, &) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":601,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L601"},"def":{"name":"find!","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":0,"block_arity":0,"return_type":"T","visibility":"Public","body":"x = Lustra::Expression.ensure_node!(with Lustra::Expression.new yield)\n\n(where(x)).first!(fetch_columns)\n"},"external_var":false},{"html_id":"find!(tuple:NamedTuple,fetch_columns=false):T-instance-method","name":"find!","doc":"A convenient way to write `where({any_column: \"any_value\"}).first!(fetch_columns)`","summary":"<p>A convenient way to write <code>where({any_column: &quot;any_value&quot;})<a href=\"../../Lustra/Model/CollectionBase.html#first%21%28fetch_columns%3Dfalse%29%3AT-instance-method\">.first!(fetch_columns)</a></code></p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(tuple : NamedTuple, fetch_columns = false) : T","args_html":"(tuple : NamedTuple, fetch_columns = <span class=\"n\">false</span>) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":608,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L608"},"def":{"name":"find!","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"(where(tuple)).first!(fetch_columns)"},"external_var":false},{"html_id":"find!(**tuple):T-instance-method","name":"find!","doc":"A convenient way to write `where({any_column: \"any_value\"}).first!`","summary":"<p>A convenient way to write <code>where({any_column: &quot;any_value&quot;})<a href=\"../../Lustra/Model/CollectionBase.html#first%21%28fetch_columns%3Dfalse%29%3AT-instance-method\">.first!</a></code></p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":613,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L613"},"def":{"name":"find!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"(where(tuple)).first!"},"external_var":false},{"html_id":"find_by(tuple:NamedTuple,fetch_columns=false):T|Nil-instance-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `find(**tuple)` with better naming.\n\n```\nuser = User.query.find_by(email: \"test@example.com\")\nuser = User.query.where { active == true }.find_by(role: \"admin\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(tuple : NamedTuple, fetch_columns = false) : T | Nil","args_html":"(tuple : NamedTuple, fetch_columns = <span class=\"n\">false</span>) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":629,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L629"},"def":{"name":"find_by","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"find(tuple, fetch_columns)"},"external_var":false},{"html_id":"find_by(**tuple):T|Nil-instance-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `find(**tuple)` with better naming.\n\n```\nuser = User.query.find_by(email: \"test@example.com\")\nuser = User.query.where { active == true }.find_by(role: \"admin\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":624,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L624"},"def":{"name":"find_by","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T | ::Nil","visibility":"Public","body":"find(**tuple)"},"external_var":false},{"html_id":"find_by!(tuple:NamedTuple,fetch_columns=false):T-instance-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `find!(**tuple)` with better naming.\n\n```\nuser = User.query.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(tuple : NamedTuple, fetch_columns = false) : T","args_html":"(tuple : NamedTuple, fetch_columns = <span class=\"n\">false</span>) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":644,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L644"},"def":{"name":"find_by!","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"find!(tuple, fetch_columns)"},"external_var":false},{"html_id":"find_by!(**tuple):T-instance-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `find!(**tuple)` with better naming.\n\n```\nuser = User.query.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":639,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L639"},"def":{"name":"find_by!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"find!(**tuple)"},"external_var":false},{"html_id":"find_or_build(x:NamedTuple,&block:T->Nil):T-instance-method","name":"find_or_build","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : T -> Nil) : T","args_html":"(x : NamedTuple, &block : T -> Nil) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":676,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L676"},"def":{"name":"find_or_build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"find_or_build(**x, &block)"},"external_var":false},{"html_id":"find_or_build(**tuple,&:T->Nil):T-instance-method","name":"find_or_build","doc":"Try to fetch a row. If not found, build a new object and setup\nthe fields like setup in the condition tuple.","summary":"<p>Try to fetch a row.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":650,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L650"},"def":{"name":"find_or_build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"if tuple.size == 0\nelse\n  where(tuple)\nend\nr = first\n\nif r\n  return r\nend\n\nstr_hash = @tags.dup\ntuple.map do |k, v| str_hash[k.to_s] = v end\n\nr = Lustra::Model::Factory.build(T, str_hash)\n\nyield(r)\n\nr\n"},"external_var":false},{"html_id":"find_or_build(x:NamedTuple):T-instance-method","name":"find_or_build","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : T","args_html":"(x : NamedTuple) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":671,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L671"},"def":{"name":"find_or_build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"T","visibility":"Public","body":"find_or_build(**x)"},"external_var":false},{"html_id":"find_or_build(**tuple):T-instance-method","name":"find_or_build","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":666,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L666"},"def":{"name":"find_or_build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"find_or_build(**tuple) do\nend"},"external_var":false},{"html_id":"find_or_create(x:NamedTuple,&block:T->Nil):T-instance-method","name":"find_or_create","doc":"Try to fetch a row. If not found, build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Try to fetch a row.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : T -> Nil) : T","args_html":"(x : NamedTuple, &block : T -> Nil) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":704,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L704"},"def":{"name":"find_or_create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"find_or_create(**x, &block)"},"external_var":false},{"html_id":"find_or_create(**tuple,&:T->Nil):T-instance-method","name":"find_or_create","doc":"Try to fetch a row. If not found, build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Try to fetch a row.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":683,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L683"},"def":{"name":"find_or_create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(T -> Nil)"},"return_type":"T","visibility":"Public","body":"r = find_or_build(**tuple) do |mdl| yield(mdl) end\n\nr.save!\n\nhandle_append_operation(r)\n\nr\n"},"external_var":false},{"html_id":"find_or_create(x:NamedTuple):T-instance-method","name":"find_or_create","doc":"Try to fetch a row. If not found, build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Try to fetch a row.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : T","args_html":"(x : NamedTuple) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":699,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L699"},"def":{"name":"find_or_create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"T","visibility":"Public","body":"find_or_create(**x)"},"external_var":false},{"html_id":"find_or_create(**tuple):T-instance-method","name":"find_or_create","doc":"Try to fetch a row. If not found, build a new object and setup\nthe fields like setup in the condition tuple.\nJust after building, save the object.","summary":"<p>Try to fetch a row.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":694,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L694"},"def":{"name":"find_or_create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"T","visibility":"Public","body":"find_or_create(**tuple) do\nend"},"external_var":false},{"html_id":"first(fetch_columns=false):T|Nil-instance-method","name":"first","doc":"Get the first row from the collection query.\nif not found, return `nil`","summary":"<p>Get the first row from the collection query.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : T | Nil","args_html":"(fetch_columns = <span class=\"n\">false</span>) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":710,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L710"},"def":{"name":"first","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"if T.__pkey__ || order_bys.empty?\n  order_by(Lustra::SQL.escape(\"#{T.__pkey__}\"), :asc)\nend\n\n(limit(1)).fetch do |hash|\n  return Lustra::Model::Factory.build(T, hash, persisted: true, cache: @cache, fetch_columns: fetch_columns)\nend\n\nnil\n"},"external_var":false},{"html_id":"first!(fetch_columns=false):T-instance-method","name":"first!","doc":"Get the first row from the collection query.\nif not found, throw an error","summary":"<p>Get the first row from the collection query.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : T","args_html":"(fetch_columns = <span class=\"n\">false</span>) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":722,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L722"},"def":{"name":"first!","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"(first(fetch_columns)) || (raise(Lustra::SQL::RecordNotFoundError.new))"},"external_var":false},{"html_id":"full_outer_join(association:Lustra::SQL::Symbolic,lateral=false)-instance-method","name":"full_outer_join","doc":"FULL_OUTER JOIN using association name (auto-detects join conditions)","summary":"<p>FULL_OUTER JOIN using association name (auto-detects join conditions)</p>","abstract":false,"args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(association : Lustra::SQL::Symbolic, lateral = false)","args_html":"(association : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/collection.cr","line_number":771,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L771"},"def":{"name":"full_outer_join","args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"auto_join_association(association, :full_outer, lateral)"},"external_var":false},{"html_id":"ids:Array(Lustra::SQL::Any)-instance-method","name":"ids","doc":"Convenient shortcut to get an array of primary key values.\nEquivalent to `pluck_col(T.__pkey__)` but more readable.\n\n```\nUser.query.where { active == true }.ids\n# => [1, 2, 3, 4, 5]\n\nPost.query.where { published == true }.ids\n# => [10, 25, 42, 100]\n```\n\nReturns an array of primary key values (typically `Array(Int64)` or `Array(Int32)`).","summary":"<p>Convenient shortcut to get an array of primary key values.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":959,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L959"},"def":{"name":"ids","return_type":"Array(Lustra::SQL::Any)","visibility":"Public","body":"pluck_col(T.__pkey__)"},"external_var":false},{"html_id":"inner_join(association:Lustra::SQL::Symbolic,lateral=false)-instance-method","name":"inner_join","doc":"INNER JOIN using association name (auto-detects join conditions)","summary":"<p>INNER JOIN using association name (auto-detects join conditions)</p>","abstract":false,"args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(association : Lustra::SQL::Symbolic, lateral = false)","args_html":"(association : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/collection.cr","line_number":771,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L771"},"def":{"name":"inner_join","args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"auto_join_association(association, :inner, lateral)"},"external_var":false},{"html_id":"item_class-instance-method","name":"item_class","doc":"Return the model class for this collection","summary":"<p>Return the model class for this collection</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":240,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L240"},"def":{"name":"item_class","visibility":"Public","body":"T"},"external_var":false},{"html_id":"join(association:Lustra::SQL::Symbolic,type=:inner,lateral=false)-instance-method","name":"join","doc":"Join a relation using association name (auto-detects join conditions)\nOverrides the parent join to handle association names without blocks","summary":"<p>Join a relation using association name (auto-detects join conditions) Overrides the parent join to handle association names without blocks</p>","abstract":false,"args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(association : Lustra::SQL::Symbolic, type = :inner, lateral = false)","args_html":"(association : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, type = <span class=\"n\">:inner</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/collection.cr","line_number":767,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L767"},"def":{"name":"join","args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"auto_join_association(association, type, lateral)"},"external_var":false},{"html_id":"last(fetch_columns=false):T|Nil-instance-method","name":"last","doc":"Get the last row from the collection query.\nif not found, return `nil`","summary":"<p>Get the last row from the collection query.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : T | Nil","args_html":"(fetch_columns = <span class=\"n\">false</span>) : T | Nil","location":{"filename":"src/lustra/model/collection.cr","line_number":728,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L728"},"def":{"name":"last","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T | ::Nil","visibility":"Public","body":"if T.__pkey__ || order_bys.empty?\n  order_by(\"#{T.__pkey__}\", :asc)\nend\n\narr = order_bys.dup\n\nbegin\n  new_order = arr.map do |x|\n    Lustra::SQL::Query::OrderBy::Record.new(x.op, (x.dir == (:asc) ? :desc : :asc), nil)\n  end\n\n  clear_order_bys.order_by(new_order)\n\n  (limit(1)).fetch do |hash|\n    return Lustra::Model::Factory.build(T, hash, persisted: true, cache: @cache, fetch_columns: fetch_columns)\n  end\n\n  nil\nensure\n  clear_order_bys.order_by(order_bys)\nend\n"},"external_var":false},{"html_id":"last!(fetch_columns=false):T-instance-method","name":"last!","doc":"Get the last row from the collection query.\nif not found, throw an error","summary":"<p>Get the last row from the collection query.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : T","args_html":"(fetch_columns = <span class=\"n\">false</span>) : T","location":{"filename":"src/lustra/model/collection.cr","line_number":753,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L753"},"def":{"name":"last!","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"(last(fetch_columns)) || (raise(Lustra::SQL::RecordNotFoundError.new))"},"external_var":false},{"html_id":"left_join(association:Lustra::SQL::Symbolic,lateral=false)-instance-method","name":"left_join","doc":"LEFT JOIN using association name (auto-detects join conditions)","summary":"<p>LEFT JOIN using association name (auto-detects join conditions)</p>","abstract":false,"args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(association : Lustra::SQL::Symbolic, lateral = false)","args_html":"(association : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/collection.cr","line_number":771,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L771"},"def":{"name":"left_join","args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"auto_join_association(association, :left, lateral)"},"external_var":false},{"html_id":"map(fetch_columns=false,&block:T->X):Array(X)forallX-instance-method","name":"map","doc":"Build the SQL, send the query then build and array by applying the\nblock transformation over it.","summary":"<p>Build the SQL, send the query then build and array by applying the block transformation over it.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, &block : T -> X) : Array(X) forall X","args_html":"(fetch_columns = <span class=\"n\">false</span>, &block : T -> X) : Array(X) forall X","location":{"filename":"src/lustra/model/collection.cr","line_number":352,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L352"},"def":{"name":"map","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(T -> X)"},"return_type":"Array(X)","visibility":"Public","body":"o = [] of X\neach(fetch_columns) do |mdl| o << (block.call(mdl)) end\n\no\n"},"external_var":false},{"html_id":"parent_model:Lustra::Model|Nil-instance-method","name":"parent_model","doc":"Parent model context for autosave functionality","summary":"<p>Parent model context for autosave functionality</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":199,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L199"},"def":{"name":"parent_model","return_type":"Lustra::Model | ::Nil","visibility":"Public","body":"@parent_model"},"external_var":false},{"html_id":"parent_model=(parent_model:Lustra::Model|Nil)-instance-method","name":"parent_model=","doc":"Parent model context for autosave functionality","summary":"<p>Parent model context for autosave functionality</p>","abstract":false,"args":[{"name":"parent_model","external_name":"parent_model","restriction":"Lustra::Model | ::Nil"}],"args_string":"(parent_model : Lustra::Model | Nil)","args_html":"(parent_model : <a href=\"../../Lustra/Model.html\">Lustra::Model</a> | Nil)","location":{"filename":"src/lustra/model/collection.cr","line_number":199,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L199"},"def":{"name":"parent_model=","args":[{"name":"parent_model","external_name":"parent_model","restriction":"Lustra::Model | ::Nil"}],"visibility":"Public","body":"@parent_model = parent_model"},"external_var":false},{"html_id":"right_join(association:Lustra::SQL::Symbolic,lateral=false)-instance-method","name":"right_join","doc":"RIGHT JOIN using association name (auto-detects join conditions)","summary":"<p>RIGHT JOIN using association name (auto-detects join conditions)</p>","abstract":false,"args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(association : Lustra::SQL::Symbolic, lateral = false)","args_html":"(association : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/collection.cr","line_number":771,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L771"},"def":{"name":"right_join","args":[{"name":"association","external_name":"association","restriction":"Lustra::SQL::Symbolic"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"auto_join_association(association, :right, lateral)"},"external_var":false},{"html_id":"save!(item:T)-instance-method","name":"save!","doc":"Save a model and handle append_operation for has_many through relationships\nThis allows the build + save pattern to work","summary":"<p>Save a model and handle append_operation for has_many through relationships This allows the build + save pattern to work</p>","abstract":false,"args":[{"name":"item","external_name":"item","restriction":"T"}],"args_string":"(item : T)","args_html":"(item : T)","location":{"filename":"src/lustra/model/collection.cr","line_number":533,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L533"},"def":{"name":"save!","args":[{"name":"item","external_name":"item","restriction":"T"}],"visibility":"Public","body":"item.save!\nhandle_append_operation(item)\nitem\n"},"external_var":false},{"html_id":"tags-instance-method","name":"tags","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":297,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L297"},"def":{"name":"tags","visibility":"Public","body":"@tags"},"external_var":false},{"html_id":"to_a(fetch_columns=false):Array(T)-instance-method","name":"to_a","doc":"Create an array from the query.","summary":"<p>Create an array from the query.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : Array(T)","args_html":"(fetch_columns = <span class=\"n\">false</span>) : Array(T)","location":{"filename":"src/lustra/model/collection.cr","line_number":557,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L557"},"def":{"name":"to_a","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"Array(T)","visibility":"Public","body":"cr = @cached_result\n\nif cr\n  return cr\nend\n\no = [] of T\neach(fetch_columns: fetch_columns) do |m| o << m end\n\no\n"},"external_var":false},{"html_id":"unlink(item:T)-instance-method","name":"unlink","doc":"Unlink the model currently referenced through a relation `has_many through`\n\nIf the current colleciton doesn't come from a `has_many through` relation,\nthis method will throw `Lustra::SQL::OperationNotPermittedError`\n\nReturns `true` if unlinking is successful (e.g. one or more rows have been updated), or `false` otherwise","summary":"<p>Unlink the model currently referenced through a relation <code>has_many through</code></p>","abstract":false,"args":[{"name":"item","external_name":"item","restriction":"T"}],"args_string":"(item : T)","args_html":"(item : T)","location":{"filename":"src/lustra/model/collection.cr","line_number":545,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L545"},"def":{"name":"unlink","args":[{"name":"item","external_name":"item","restriction":"T"}],"visibility":"Public","body":"unlink_operation = self.unlink_operation\n\nif unlink_operation\nelse\n  raise(\"Operation not permitted on this collection.\")\nend\n\nunlink_operation.call(item)\n@cached_result.try(&.delete(item))\n\nself\n"},"external_var":false},{"html_id":"update_all(fields:NamedTuple):Int64-instance-method","name":"update_all","doc":"Update all the rows which would have been returned by this collection\nwithout loading the models into memory. Bypasses validations and callbacks.\n\nThis is useful for bulk updates where you don't need to run validations\nor callbacks on each individual model.\n\n```\n# Update all inactive users to have a specific status\naffected = User.query.where { active == false }.update_all(status: \"inactive\")\nputs \"Updated #{affected} users\"\n\n# Update multiple columns at once\nPost.query.where { published == false }.update_all(published: true, published_at: Time.utc)\n\n# With complex conditions\nUser.query.where { created_at < 1.year.ago }.update_all(archived: true)\n```\n\nReturns the number of rows affected.","summary":"<p>Update all the rows which would have been returned by this collection without loading the models into memory.</p>","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"NamedTuple"}],"args_string":"(fields : NamedTuple) : Int64","args_html":"(fields : NamedTuple) : Int64","location":{"filename":"src/lustra/model/collection.cr","line_number":938,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L938"},"def":{"name":"update_all","args":[{"name":"fields","external_name":"fields","restriction":"NamedTuple"}],"return_type":"Int64","visibility":"Public","body":"(to_update.set(fields)).execute_and_count"},"external_var":false},{"html_id":"update_all(fields:Hash(String,Lustra::SQL::Any)):Int64-instance-method","name":"update_all","doc":"Update all the rows which would have been returned by this collection\nwithout loading the models into memory. Bypasses validations and callbacks.\n\nThis is useful for bulk updates where you don't need to run validations\nor callbacks on each individual model.\n\n```\n# Update all inactive users to have a specific status\naffected = User.query.where { active == false }.update_all(status: \"inactive\")\nputs \"Updated #{affected} users\"\n\n# Update multiple columns at once\nPost.query.where { published == false }.update_all(published: true, published_at: Time.utc)\n\n# With complex conditions\nUser.query.where { created_at < 1.year.ago }.update_all(archived: true)\n```\n\nReturns the number of rows affected.","summary":"<p>Update all the rows which would have been returned by this collection without loading the models into memory.</p>","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Hash(String, Lustra::SQL::Any)"}],"args_string":"(fields : Hash(String, Lustra::SQL::Any)) : Int64","args_html":"(fields : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>)) : Int64","location":{"filename":"src/lustra/model/collection.cr","line_number":943,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L943"},"def":{"name":"update_all","args":[{"name":"fields","external_name":"fields","restriction":"Hash(String, Lustra::SQL::Any)"}],"return_type":"Int64","visibility":"Public","body":"(to_update.set(fields)).execute_and_count"},"external_var":false},{"html_id":"update_all(**fields):Int64-instance-method","name":"update_all","doc":"Update all the rows which would have been returned by this collection\nwithout loading the models into memory. Bypasses validations and callbacks.\n\nThis is useful for bulk updates where you don't need to run validations\nor callbacks on each individual model.\n\n```\n# Update all inactive users to have a specific status\naffected = User.query.where { active == false }.update_all(status: \"inactive\")\nputs \"Updated #{affected} users\"\n\n# Update multiple columns at once\nPost.query.where { published == false }.update_all(published: true, published_at: Time.utc)\n\n# With complex conditions\nUser.query.where { created_at < 1.year.ago }.update_all(archived: true)\n```\n\nReturns the number of rows affected.","summary":"<p>Update all the rows which would have been returned by this collection without loading the models into memory.</p>","abstract":false,"location":{"filename":"src/lustra/model/collection.cr","line_number":933,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/collection.cr#L933"},"def":{"name":"update_all","double_splat":{"name":"fields","external_name":"fields","restriction":""},"return_type":"Int64","visibility":"Public","body":"(to_update.set(**fields)).execute_and_count"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Column","path":"Lustra/Model/Column.html","kind":"class","full_name":"Lustra::Model::Column(T, C)","name":"Column","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/column.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L9"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"UNKNOWN","name":"UNKNOWN","value":"UnknownClass.new"}],"included_modules":[{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"A column of a Model\nProvide some methods like:\n  - Informations persistance (value before, value changed?)\n  - Raise error if we try to access the value of a field\n    which is not gathered through the query system (uninitialized column).\n    Or use the `get_def` to get with default value","summary":"<p>A column of a Model Provide some methods like:   - Informations persistance (value before, value changed?)   - Raise error if we try to access the value of a field     which is not gathered through the query system (uninitialized column).</p>","constructors":[{"html_id":"new(name:String,value:T|UnknownClass=UNKNOWN,has_db_default:Bool=false)-class-method","name":"new","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"value","default_value":"UNKNOWN","external_name":"value","restriction":"T | UnknownClass"},{"name":"has_db_default","default_value":"false","external_name":"has_db_default","restriction":"::Bool"}],"args_string":"(name : String, value : T | UnknownClass = UNKNOWN, has_db_default : Bool = false)","args_html":"(name : String, value : T | <a href=\"../../Lustra/Model/Column/UnknownClass.html\">UnknownClass</a> = <span class=\"t\">UNKNOWN</span>, has_db_default : Bool = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/column.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L24"},"def":{"name":"new","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"value","default_value":"UNKNOWN","external_name":"value","restriction":"T | UnknownClass"},{"name":"has_db_default","default_value":"false","external_name":"has_db_default","restriction":"::Bool"}],"visibility":"Public","body":"_ = Column(T, C).allocate\n_.initialize(name, value, has_db_default)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"change:Tuple(T,T)|Nil-instance-method","name":"change","doc":"Returns the change for this column as a tuple of {old_value, new_value}.\nReturns `nil` if the column hasn't changed or if old_value is not defined.\n\n```\nuser.email = \"new@test.com\"\nuser.email_column.change # => {\"old@test.com\", \"new@test.com\"}\nuser.name_column.change  # => nil (if not changed)\n```","summary":"<p>Returns the change for this column as a tuple of {old_value, new_value}.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":170,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L170"},"def":{"name":"change","return_type":"Tuple(T, T) | ::Nil","visibility":"Public","body":"if @changed\nelse\n  return nil\nend\nif @old_value.is_a?(UnknownClass)\n  return nil\nend\n{@old_value.as(T), @value.as(T)}\n"},"external_var":false},{"html_id":"changed?:Bool-instance-method","name":"changed?","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L21"},"def":{"name":"changed?","return_type":"Bool","visibility":"Public","body":"@changed"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","doc":"Completely clear the column, remove both `value` and `old_value` and turning the column in a non-defined state.","summary":"<p>Completely clear the column, remove both <code><a href=\"../../Lustra/Model/Column.html#value%3AT-instance-method\">#value</a></code> and <code><a href=\"../../Lustra/Model/Column.html#old_value%3AT%7CUnknownClass-instance-method\">#old_value</a></code> and turning the column in a non-defined state.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":140,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L140"},"def":{"name":"clear","visibility":"Public","body":"self.value = UNKNOWN\n@old_value = UNKNOWN\n\n@changed = false\n\nself\n"},"external_var":false},{"html_id":"clear_change_flag-instance-method","name":"clear_change_flag","doc":"Reset `changed?` flag to `false`. See `Column(T)#dirty!` for the counter part.","summary":"<p>Reset <code><a href=\"../../Lustra/Model/Column.html#changed%3F%3ABool-instance-method\">#changed?</a></code> flag to <code>false</code>.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":156,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L156"},"def":{"name":"clear_change_flag","visibility":"Public","body":"@changed = false\n@old_value = @value\nself\n"},"external_var":false},{"html_id":"defined?-instance-method","name":"defined?","doc":"Check whether the column is defined or not.","summary":"<p>Check whether the column is defined or not.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":128,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L128"},"def":{"name":"defined?","visibility":"Public","body":"UNKNOWN != @value"},"external_var":false},{"html_id":"dirty!-instance-method","name":"dirty!","doc":"Reset `changed?` flag to `true`. See `Column(T)#clear_change_flag` for the counter part.","summary":"<p>Reset <code><a href=\"../../Lustra/Model/Column.html#changed%3F%3ABool-instance-method\">#changed?</a></code> flag to <code>true</code>.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":150,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L150"},"def":{"name":"dirty!","visibility":"Public","body":"@changed = true\nself\n"},"external_var":false},{"html_id":"has_db_default?:Bool-instance-method","name":"has_db_default?","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L22"},"def":{"name":"has_db_default?","return_type":"Bool","visibility":"Public","body":"@has_db_default"},"external_var":false},{"html_id":"inspect-instance-method","name":"inspect","doc":"Inspect this column.\nIf a column is not loaded (e.g. not defined once), it will show \"#undef\".\nIf a column is dirty (e.g. change hasn't be saved), it will show a \"*\" after the value.","summary":"<p>Inspect this column.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":114,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L114"},"def":{"name":"inspect","visibility":"Public","body":"if defined?\n  @value.inspect + (changed? ? \"*\" : \"\")\nelse\n  \"#undef\"\nend"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":20,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L20"},"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"nilable?-instance-method","name":"nilable?","doc":"Return `true` if the value is an union of a Type with Nilable, `false` otherwise.","summary":"<p>Return <code>true</code> if the value is an union of a Type with Nilable, <code>false</code> otherwise.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":107,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L107"},"def":{"name":"nilable?","visibility":"Public","body":"T.nilable?"},"external_var":false},{"html_id":"old_value:T|UnknownClass-instance-method","name":"old_value","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L19"},"def":{"name":"old_value","return_type":"T | UnknownClass","visibility":"Public","body":"@old_value"},"external_var":false},{"html_id":"reset(x:T|Nil)-instance-method","name":"reset","doc":"Reset the current field.\nRestore the `old_value` state to current value.\nReset the flag `changed` to false.","summary":"<p>Reset the current field.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"T | ::Nil"}],"args_string":"(x : T | Nil)","args_html":"(x : T | Nil)","location":{"filename":"src/lustra/model/column.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L79"},"def":{"name":"reset","args":[{"name":"x","external_name":"x","restriction":"T | ::Nil"}],"visibility":"Public","body":"{% if T.nilable? %}\n      @value = x.as(T)\n    {% else %}\n      raise null_column_mapping_error(@name, T) if x.nil?\n      @value = x.not_nil!\n    {% end %}\n\n@changed = false\n@old_value = @value\n"},"external_var":false},{"html_id":"reset_convert(x)-instance-method","name":"reset_convert","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/column.cr","line_number":55,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L55"},"def":{"name":"reset_convert","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"reset(C.to_column(x))"},"external_var":false},{"html_id":"revert-instance-method","name":"revert","doc":"If the column is dirty (e.g the value has been changed), return to the previous state.","summary":"<p>If the column is dirty (e.g the value has been changed), return to the previous state.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":46,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L46"},"def":{"name":"revert","visibility":"Public","body":"if (@value != @old_value) && (@old_value != UNKNOWN)\n  @changed = true\n  @value = @old_value\nend\n\n@value\n"},"external_var":false},{"html_id":"set(x:T|Nil)-instance-method","name":"set","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"T | ::Nil"}],"args_string":"(x : T | Nil)","args_html":"(x : T | Nil)","location":{"filename":"src/lustra/model/column.cr","line_number":63,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L63"},"def":{"name":"set","args":[{"name":"x","external_name":"x","restriction":"T | ::Nil"}],"visibility":"Public","body":"old_value = @value\n{% if T.nilable? %}\n      @value = x.as(T)\n    {% else %}\n      raise null_column_mapping_error(@name, T) if x.nil?\n      @value = x.not_nil!\n    {% end %}\n\n@old_value = old_value\n@changed = true\n"},"external_var":false},{"html_id":"set_convert(x)-instance-method","name":"set_convert","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/column.cr","line_number":59,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L59"},"def":{"name":"set_convert","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"set(C.to_column(x))"},"external_var":false},{"html_id":"to_sql_value(default=nil):Lustra::SQL::Any-instance-method","name":"to_sql_value","doc":"Return the database converted value using the converter","summary":"<p>Return the database converted value using the converter</p>","abstract":false,"args":[{"name":"default","default_value":"nil","external_name":"default","restriction":""}],"args_string":"(default = nil) : Lustra::SQL::Any","args_html":"(default = <span class=\"n\">nil</span>) : <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/column.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L36"},"def":{"name":"to_sql_value","args":[{"name":"default","default_value":"nil","external_name":"default","restriction":""}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"C.to_db(value(default))"},"external_var":false},{"html_id":"value(default:X):T|XforallX-instance-method","name":"value","doc":"Returns the current value of this column or `default` if the value is undefined.","summary":"<p>Returns the current value of this column or <code>default</code> if the value is undefined.</p>","abstract":false,"args":[{"name":"default","external_name":"default","restriction":"X"}],"args_string":"(default : X) : T | X forall X","args_html":"(default : X) : T | X forall X","location":{"filename":"src/lustra/model/column.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L41"},"def":{"name":"value","args":[{"name":"default","external_name":"default","restriction":"X"}],"return_type":"T | X","visibility":"Public","body":"defined? ? @value.as(T) : default"},"external_var":false},{"html_id":"value:T-instance-method","name":"value","doc":"Returns the current value of this column.\nIf the value has never been initialized, throw an exception","summary":"<p>Returns the current value of this column.</p>","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L30"},"def":{"name":"value","return_type":"T","visibility":"Public","body":"if defined?\nelse\n  raise(illegal_setter_access_to_undefined_column(@name))\nend\n@value.as(T)\n"},"external_var":false},{"html_id":"value=(x:T)-instance-method","name":"value=","doc":"Set the value of the column to the value `x`. If `x` is not equal to the old value, then the column `changed?`\nflag is set to `true`.","summary":"<p>Set the value of the column to the value <code>x</code>.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"T"}],"args_string":"(x : T)","args_html":"(x : T)","location":{"filename":"src/lustra/model/column.cr","line_number":101,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L101"},"def":{"name":"value=","args":[{"name":"x","external_name":"x","restriction":"T"}],"visibility":"Public","body":"@changed = (@old_value != x)\n@value = x\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Model/Column/UnknownClass","path":"Lustra/Model/Column/UnknownClass.html","kind":"struct","full_name":"Lustra::Model::Column::UnknownClass","name":"UnknownClass","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/column.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L12"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Column","kind":"class","full_name":"Lustra::Model::Column(T, C)","name":"Column"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L12"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/lustra/model/column.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/column.cr#L12"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/Connection","path":"Lustra/Model/Connection.html","kind":"module","full_name":"Lustra::Model::Connection","name":"Connection","abstract":false,"locations":[{"filename":"src/lustra/model/modules/connection.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/connection.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}},{"html_id":"lustra/Lustra/Model/Converter","path":"Lustra/Model/Converter.html","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter","abstract":false,"locations":[{"filename":"src/lustra/model/converters/base.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/base.cr#L4"},{"filename":"src/lustra/model/converters/number_converters.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"CONVERTERS","name":"CONVERTERS","value":"{\"Array(Bool)\" => Lustra::Model::Converter::ArrayConverterBool, \"Array(Bool | Nil)\" => Lustra::Model::Converter::ArrayConverterBool, \"Array(String)\" => Lustra::Model::Converter::ArrayConverterString, \"Array(String | Nil)\" => Lustra::Model::Converter::ArrayConverterString, \"Array(Float32)\" => Lustra::Model::Converter::ArrayConverterFloat32, \"Array(Float32 | Nil)\" => Lustra::Model::Converter::ArrayConverterFloat32, \"Array(Float64)\" => Lustra::Model::Converter::ArrayConverterFloat64, \"Array(Float64 | Nil)\" => Lustra::Model::Converter::ArrayConverterFloat64, \"Array(Int32)\" => Lustra::Model::Converter::ArrayConverterInt32, \"Array(Int32 | Nil)\" => Lustra::Model::Converter::ArrayConverterInt32, \"Array(Int64)\" => Lustra::Model::Converter::ArrayConverterInt64, \"Array(Int64 | Nil)\" => Lustra::Model::Converter::ArrayConverterInt64, \"Bool\" => Lustra::Model::Converter::BoolConverter, \"JSON::Any\" => Lustra::Model::Converter::JSON::AnyConverter, \"Int8\" => ::Lustra::Model::Converter::Int8Converter, \"Int16\" => ::Lustra::Model::Converter::Int16Converter, \"Int32\" => ::Lustra::Model::Converter::Int32Converter, \"Int64\" => ::Lustra::Model::Converter::Int64Converter, \"UInt8\" => ::Lustra::Model::Converter::UInt8Converter, \"UInt16\" => ::Lustra::Model::Converter::UInt16Converter, \"UInt32\" => ::Lustra::Model::Converter::UInt32Converter, \"UInt64\" => ::Lustra::Model::Converter::UInt64Converter, \"Float32\" => ::Lustra::Model::Converter::Float32Converter, \"Float64\" => ::Lustra::Model::Converter::Float64Converter, \"BigInt\" => ::Lustra::Model::Converter::BigIntConverter, \"BigFloat\" => ::Lustra::Model::Converter::BigFloatConverter, \"BigDecimal\" => ::Lustra::Model::Converter::BigDecimalConverter, \"String\" => Lustra::Model::Converter::StringConverter, \"Time\" => Lustra::Model::Converter::TimeConverter, \"Crypto::Bcrypt::Password\" => Lustra::Model::Converter::BcryptPasswordConverter, \"Lustra::TSVector\" => Lustra::TSVector::Converter, \"Lustra::Interval\" => Lustra::Interval::Converter, \"Lustra::TimeInDay\" => Lustra::TimeInDay::Converter, \"UUID\" => Lustra::Model::Converter::UUIDConverter} of String => Base.class"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"macros":[{"html_id":"add_converter(name,klass)-macro","name":"add_converter","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"klass","external_name":"klass","restriction":""}],"args_string":"(name, klass)","args_html":"(name, klass)","location":{"filename":"src/lustra/model/converters/base.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/base.cr#L10"},"def":{"name":"add_converter","args":[{"name":"name","external_name":"name","restriction":""},{"name":"klass","external_name":"klass","restriction":""}],"visibility":"Public","body":"    \n{% CONVERTERS[name] = klass %}\n\n  \n"}},{"html_id":"to_column(name,value)-macro","name":"to_column","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"args_string":"(name, value)","args_html":"(name, value)","location":{"filename":"src/lustra/model/converters/base.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/base.cr#L14"},"def":{"name":"to_column","args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"    \n{% if !name.is_a?(StringLiteral) %}\n      {% name = \"#{name}\" %}\n    {% end %}\n\n\n    \n{% if CONVERTERS[name] == nil %}\n      {% raise(\"Unknown converter: #{name}\") %}\n    {% end %}\n\n\n    \n{{ CONVERTERS[name] }}\n.to_column(\n{{ value }}\n)\n  \n"}},{"html_id":"to_db(name,value)-macro","name":"to_db","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"args_string":"(name, value)","args_html":"(name, value)","location":{"filename":"src/lustra/model/converters/base.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/base.cr#L26"},"def":{"name":"to_db","args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"    \n{% if !name.is_a?(StringLiteral) %}\n      {% name = \"#{name.resolve}\" %}\n    {% end %}\n\n\n    \n{% if CONVERTERS[name] == nil %}\n      {% raise(\"Unknown converter: #{name}\") %}\n    {% end %}\n\n\n    \n{{ CONVERTERS[name] }}\n.to_db(\n{{ value }}\n)\n  \n"}}],"types":[{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterBool","path":"Lustra/Model/Converter/ArrayConverterBool.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterBool","name":"ArrayConverterBool","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(Bool)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(Bool) | Nil","args_html":"(x) : Array(Bool) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::Bool) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::Bool\n  [x]\nwhen Array(::Bool)\n  x\nwhen Array(::PG::BoolArray)\n  x.map do |i|\n    case i\n    when ::Bool\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_bool)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_bool)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(Bool) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(Bool) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(Bool)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::Bool) | ::Nil"}],"args_string":"(x : Array(Bool) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(Bool) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::Bool) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::boolean[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterFloat32","path":"Lustra/Model/Converter/ArrayConverterFloat32.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterFloat32","name":"ArrayConverterFloat32","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(Float32)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(Float32) | Nil","args_html":"(x) : Array(Float32) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::Float32) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::Float32\n  [x]\nwhen Array(::Float32)\n  x\nwhen Array(::PG::Float32Array)\n  x.map do |i|\n    case i\n    when ::Float32\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_f32)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_f32)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(Float32) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(Float32) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(Float32)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::Float32) | ::Nil"}],"args_string":"(x : Array(Float32) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(Float32) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::Float32) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::real[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterFloat64","path":"Lustra/Model/Converter/ArrayConverterFloat64.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterFloat64","name":"ArrayConverterFloat64","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(Float64)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(Float64) | Nil","args_html":"(x) : Array(Float64) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::Float64) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::Float64\n  [x]\nwhen Array(::Float64)\n  x\nwhen Array(::PG::Float64Array)\n  x.map do |i|\n    case i\n    when ::Float64\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_f)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_f)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(Float64) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(Float64) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(Float64)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::Float64) | ::Nil"}],"args_string":"(x : Array(Float64) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(Float64) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::Float64) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::double precision[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterInt32","path":"Lustra/Model/Converter/ArrayConverterInt32.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterInt32","name":"ArrayConverterInt32","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(Int32)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(Int32) | Nil","args_html":"(x) : Array(Int32) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::Int32) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::Int32\n  [x]\nwhen Array(::Int32)\n  x\nwhen Array(::PG::Int32Array)\n  x.map do |i|\n    case i\n    when ::Int32\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_i)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_i)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(Int32) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(Int32) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(Int32)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::Int32) | ::Nil"}],"args_string":"(x : Array(Int32) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(Int32) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::Int32) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::int[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterInt64","path":"Lustra/Model/Converter/ArrayConverterInt64.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterInt64","name":"ArrayConverterInt64","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(Int64)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(Int64) | Nil","args_html":"(x) : Array(Int64) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::Int64) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::Int64\n  [x]\nwhen Array(::Int64)\n  x\nwhen Array(::PG::Int64Array)\n  x.map do |i|\n    case i\n    when ::Int64\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_i64)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_i64)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(Int64) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(Int64) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(Int64)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::Int64) | ::Nil"}],"args_string":"(x : Array(Int64) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(Int64) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::Int64) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::bigint[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/ArrayConverterString","path":"Lustra/Model/Converter/ArrayConverterString.html","kind":"module","full_name":"Lustra::Model::Converter::ArrayConverterString","name":"ArrayConverterString","abstract":false,"locations":[{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Array(String)|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Array(String) | Nil","args_html":"(x) : Array(String) | Nil","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Array(::String) | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::String\n  [x]\nwhen Array(::String)\n  x\nwhen Array(::PG::StringArray)\n  x.map do |i|\n    case i\n    when ::String\n      i\n    else\n      nil\n    end\n  end.compact\nwhen Array(::JSON::Any)\n  x.map(&.as_s)\nwhen ::JSON::Any\n  if arr = x.as_a?\n    arr.map(&.as_s)\n  else\n    raise(\"Cannot convert from #{x.class} to Array(String) [1]\")\n  end\nelse\n  raise(\"Cannot convert from #{x.class} to Array(String) [2]\")\nend"},"external_var":false},{"html_id":"to_db(x:Array(String)|Nil):Lustra::SQL::Any-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Array(::String) | ::Nil"}],"args_string":"(x : Array(String) | Nil) : Lustra::SQL::Any","args_html":"(x : Array(String) | Nil) : <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Array(::String) | ::Nil"}],"return_type":"Lustra::SQL::Any","visibility":"Public","body":"if x\nelse\n  return\nend\n\nLustra::Expression.unsafe({\"Array[\", to_string(x), \"]::text[]\"}.join)\n"},"external_var":false},{"html_id":"to_string(x):String-class-method","name":"to_string","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/model/converters/array_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/array_converter.cr#L21"},"def":{"name":"to_string","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"case x\nwhen Array\n  x.join(\", \") do |it| to_string(it) end\nelse\n  \"\" + Lustra::Expression[x]\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Base","path":"Lustra/Model/Converter/Base.html","kind":"class","full_name":"Lustra::Model::Converter::Base","name":"Base","abstract":true,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/base.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/base.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"}},{"html_id":"lustra/Lustra/Model/Converter/BcryptPasswordConverter","path":"Lustra/Model/Converter/BcryptPasswordConverter.html","kind":"module","full_name":"Lustra::Model::Converter::BcryptPasswordConverter","name":"BcryptPasswordConverter","abstract":false,"locations":[{"filename":"src/lustra/extensions/bcrypt/bcrypt.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/bcrypt/bcrypt.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Crypto::Bcrypt::Password|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Crypto::Bcrypt::Password | Nil","args_html":"(x) : <a href=\"../../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Nil","location":{"filename":"src/lustra/extensions/bcrypt/bcrypt.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/bcrypt/bcrypt.cr#L2"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"::Crypto::Bcrypt::Password | ::Nil","visibility":"Public","body":"case x\nwhen String\n  ::Crypto::Bcrypt::Password.new(x)\nwhen ::Crypto::Bcrypt::Password\n  x\nwhen Nil\n  nil\nelse\n  raise(Lustra::ErrorMessages.converter_error(x.class.name, \"Crypto::Bcrypt::Password\"))\nend"},"external_var":false},{"html_id":"to_db(x:Crypto::Bcrypt::Password|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"::Crypto::Bcrypt::Password | ::Nil"}],"args_string":"(x : Crypto::Bcrypt::Password | Nil)","args_html":"(x : <a href=\"../../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Nil)","location":{"filename":"src/lustra/extensions/bcrypt/bcrypt.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/bcrypt/bcrypt.cr#L15"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"::Crypto::Bcrypt::Password | ::Nil"}],"visibility":"Public","body":"case x\nwhen ::Union(::Crypto::Bcrypt::Password, ::Nil)\n  x.to_s\nwhen Nil\n  nil\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/BigDecimalConverter","path":"Lustra/Model/Converter/BigDecimalConverter.html","kind":"class","full_name":"Lustra::Model::Converter::BigDecimalConverter","name":"BigDecimalConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L43"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to BigDecimal","summary":"<p>Convert from and to BigDecimal</p>","class_methods":[{"html_id":"to_column(x):BigDecimal|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : BigDecimal | Nil","args_html":"(x) : <a href=\"../../../BigDecimal.html\">BigDecimal</a> | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L43"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"BigDecimal | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  BigDecimal.new(x)\nelse\n  BigDecimal.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:BigDecimal|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"BigDecimal | ::Nil"}],"args_string":"(x : BigDecimal | Nil)","args_html":"(x : <a href=\"../../../BigDecimal.html\">BigDecimal</a> | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L43"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"BigDecimal | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/BigFloatConverter","path":"Lustra/Model/Converter/BigFloatConverter.html","kind":"class","full_name":"Lustra::Model::Converter::BigFloatConverter","name":"BigFloatConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":42,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L42"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to BigFloat","summary":"<p>Convert from and to BigFloat</p>","class_methods":[{"html_id":"to_column(x):BigFloat|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : BigFloat | Nil","args_html":"(x) : BigFloat | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":42,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L42"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"BigFloat | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  BigFloat.new(x)\nelse\n  BigFloat.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:BigFloat|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"BigFloat | ::Nil"}],"args_string":"(x : BigFloat | Nil)","args_html":"(x : BigFloat | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":42,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L42"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"BigFloat | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/BigIntConverter","path":"Lustra/Model/Converter/BigIntConverter.html","kind":"class","full_name":"Lustra::Model::Converter::BigIntConverter","name":"BigIntConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L41"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to BigInt","summary":"<p>Convert from and to BigInt</p>","class_methods":[{"html_id":"to_column(x):BigInt|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : BigInt | Nil","args_html":"(x) : BigInt | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L41"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"BigInt | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  BigInt.new(x)\nelse\n  BigInt.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:BigInt|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"BigInt | ::Nil"}],"args_string":"(x : BigInt | Nil)","args_html":"(x : BigInt | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L41"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"BigInt | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/BoolConverter","path":"Lustra/Model/Converter/BoolConverter.html","kind":"module","full_name":"Lustra::Model::Converter::BoolConverter","name":"BoolConverter","abstract":false,"locations":[{"filename":"src/lustra/model/converters/bool_converter.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/bool_converter.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert the column to a boolean\nIf value is not boolean (e.g. string or number), rules of `falsey`\nvalue is used:\n\nfalsey's values are:\n`false`, `nil`, `0`, `\"0\"`, `\"\"` (empty string), `\"false\"`, `\"f\"`\n\nAnything else is considered `true`","summary":"<p>Convert the column to a boolean If value is not boolean (e.g.</p>","class_methods":[{"html_id":"to_column(x):Bool|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Bool | Nil","args_html":"(x) : Bool | Nil","location":{"filename":"src/lustra/model/converters/bool_converter.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/bool_converter.cr#L12"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Bool | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Bool\n  x\nwhen Number\n  x != 0\nwhen String\n  x = x.downcase\n  (((x != \"f\") && (x != \"false\")) && (x != \"\")) && (x != \"0\")\nelse\n  true\nend"},"external_var":false},{"html_id":"to_db(x:Bool|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Bool | ::Nil"}],"args_string":"(x : Bool | Nil)","args_html":"(x : Bool | Nil)","location":{"filename":"src/lustra/model/converters/bool_converter.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/bool_converter.cr#L28"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Bool | ::Nil"}],"visibility":"Public","body":"x.nil? ? nil : (\n  x ? \"t\" : \"f\"\n)"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Float32Converter","path":"Lustra/Model/Converter/Float32Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Float32Converter","name":"Float32Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L38"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Float32","summary":"<p>Convert from and to Float32</p>","class_methods":[{"html_id":"to_column(x):Float32|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Float32 | Nil","args_html":"(x) : Float32 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L38"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Float32 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Float32.new(x)\nelse\n  Float32.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Float32|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Float32 | ::Nil"}],"args_string":"(x : Float32 | Nil)","args_html":"(x : Float32 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L38"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Float32 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Float64Converter","path":"Lustra/Model/Converter/Float64Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Float64Converter","name":"Float64Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L39"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Float64","summary":"<p>Convert from and to Float64</p>","class_methods":[{"html_id":"to_column(x):Float64|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Float64 | Nil","args_html":"(x) : Float64 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L39"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Float64 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Float64.new(x)\nelse\n  Float64.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Float64|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Float64 | ::Nil"}],"args_string":"(x : Float64 | Nil)","args_html":"(x : Float64 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L39"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Float64 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Int16Converter","path":"Lustra/Model/Converter/Int16Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Int16Converter","name":"Int16Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L29"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Int16","summary":"<p>Convert from and to Int16</p>","class_methods":[{"html_id":"to_column(x):Int16|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Int16 | Nil","args_html":"(x) : Int16 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L29"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Int16 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Int16.new(x)\nelse\n  Int16.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Int16|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int16 | ::Nil"}],"args_string":"(x : Int16 | Nil)","args_html":"(x : Int16 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L29"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Int16 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Int32Converter","path":"Lustra/Model/Converter/Int32Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Int32Converter","name":"Int32Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L30"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Int32","summary":"<p>Convert from and to Int32</p>","class_methods":[{"html_id":"to_column(x):Int32|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Int32 | Nil","args_html":"(x) : Int32 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L30"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Int32 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Int32.new(x)\nelse\n  Int32.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Int32|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int32 | ::Nil"}],"args_string":"(x : Int32 | Nil)","args_html":"(x : Int32 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L30"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Int32 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Int64Converter","path":"Lustra/Model/Converter/Int64Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Int64Converter","name":"Int64Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":31,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L31"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Int64","summary":"<p>Convert from and to Int64</p>","class_methods":[{"html_id":"to_column(x):Int64|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Int64 | Nil","args_html":"(x) : Int64 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":31,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L31"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Int64 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Int64.new(x)\nelse\n  Int64.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Int64|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int64 | ::Nil"}],"args_string":"(x : Int64 | Nil)","args_html":"(x : Int64 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":31,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L31"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Int64 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/Int8Converter","path":"Lustra/Model/Converter/Int8Converter.html","kind":"class","full_name":"Lustra::Model::Converter::Int8Converter","name":"Int8Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L28"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to Int8","summary":"<p>Convert from and to Int8</p>","class_methods":[{"html_id":"to_column(x):Int8|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Int8 | Nil","args_html":"(x) : Int8 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L28"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Int8 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  Int8.new(x)\nelse\n  Int8.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:Int8|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int8 | ::Nil"}],"args_string":"(x : Int8 | Nil)","args_html":"(x : Int8 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L28"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Int8 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/JSON","path":"Lustra/Model/Converter/JSON.html","kind":"module","full_name":"Lustra::Model::Converter::JSON","name":"JSON","abstract":false,"locations":[{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"types":[{"html_id":"lustra/Lustra/Model/Converter/JSON/AnyConverter","path":"Lustra/Model/Converter/JSON/AnyConverter.html","kind":"module","full_name":"Lustra::Model::Converter::JSON::AnyConverter","name":"AnyConverter","abstract":false,"locations":[{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter/JSON","kind":"module","full_name":"Lustra::Model::Converter::JSON","name":"JSON"},"class_methods":[{"html_id":"to_column(x):::JSON::Any|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : ::JSON::Any | Nil","args_html":"(x) : ::JSON::Any | Nil","location":{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L4"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"::JSON::Any | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen ::JSON::Any\n  x\nwhen ::JSON::PullParser\n  ::JSON::Any.new(x)\nelse\n  ::JSON.parse(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:::JSON::Any|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"::JSON::Any | ::Nil"}],"args_string":"(x : ::JSON::Any | Nil)","args_html":"(x : ::JSON::Any | Nil)","location":{"filename":"src/lustra/model/converters/json_any_converter.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/json_any_converter.cr#L17"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"::JSON::Any | ::Nil"}],"visibility":"Public","body":"x.to_json"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/Converter/StringConverter","path":"Lustra/Model/Converter/StringConverter.html","kind":"class","full_name":"Lustra::Model::Converter::StringConverter","name":"StringConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/string_converter.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/string_converter.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):String|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String | Nil","args_html":"(x) : String | Nil","location":{"filename":"src/lustra/model/converters/string_converter.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/string_converter.cr#L4"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Slice(UInt8)\n  String.new(x)\nelse\n  x.to_s\nend"},"external_var":false},{"html_id":"to_db(x:String|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String | ::Nil"}],"args_string":"(x : String | Nil)","args_html":"(x : String | Nil)","location":{"filename":"src/lustra/model/converters/string_converter.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/string_converter.cr#L15"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"String | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/TimeConverter","path":"Lustra/Model/Converter/TimeConverter.html","kind":"class","full_name":"Lustra::Model::Converter::TimeConverter","name":"TimeConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/time_converter.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/time_converter.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"class_methods":[{"html_id":"to_column(x):Time|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Time | Nil","args_html":"(x) : <a href=\"../../../Time.html\">Time</a> | Nil","location":{"filename":"src/lustra/model/converters/time_converter.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/time_converter.cr#L4"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Time | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Time\n  x.to_local\nelse\n  time = x.to_s\n  case time\n  when /[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9]+/\n    Time.parse_local(x.to_s, \"%F %X.%L\")\n  else\n    Time::Format::RFC_3339.parse(time)\n  end\nend"},"external_var":false},{"html_id":"to_db(x:Time|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Time | ::Nil"}],"args_string":"(x : Time | Nil)","args_html":"(x : <a href=\"../../../Time.html\">Time</a> | Nil)","location":{"filename":"src/lustra/model/converters/time_converter.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/time_converter.cr#L21"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"Time | ::Nil"}],"visibility":"Public","body":"case x\nwhen Nil\n  nil\nelse\n  x.to_utc.to_s(Lustra::Expression::DATABASE_DATE_TIME_FORMAT)\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/UInt16Converter","path":"Lustra/Model/Converter/UInt16Converter.html","kind":"class","full_name":"Lustra::Model::Converter::UInt16Converter","name":"UInt16Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":34,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L34"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to UInt16","summary":"<p>Convert from and to UInt16</p>","class_methods":[{"html_id":"to_column(x):UInt16|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : UInt16 | Nil","args_html":"(x) : UInt16 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":34,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L34"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"UInt16 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  UInt16.new(x)\nelse\n  UInt16.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:UInt16|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"UInt16 | ::Nil"}],"args_string":"(x : UInt16 | Nil)","args_html":"(x : UInt16 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":34,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L34"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"UInt16 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/UInt32Converter","path":"Lustra/Model/Converter/UInt32Converter.html","kind":"class","full_name":"Lustra::Model::Converter::UInt32Converter","name":"UInt32Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L35"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to UInt32","summary":"<p>Convert from and to UInt32</p>","class_methods":[{"html_id":"to_column(x):UInt32|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : UInt32 | Nil","args_html":"(x) : UInt32 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L35"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"UInt32 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  UInt32.new(x)\nelse\n  UInt32.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:UInt32|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"UInt32 | ::Nil"}],"args_string":"(x : UInt32 | Nil)","args_html":"(x : UInt32 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L35"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"UInt32 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/UInt64Converter","path":"Lustra/Model/Converter/UInt64Converter.html","kind":"class","full_name":"Lustra::Model::Converter::UInt64Converter","name":"UInt64Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L36"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to UInt64","summary":"<p>Convert from and to UInt64</p>","class_methods":[{"html_id":"to_column(x):UInt64|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : UInt64 | Nil","args_html":"(x) : UInt64 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L36"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"UInt64 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  UInt64.new(x)\nelse\n  UInt64.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:UInt64|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"UInt64 | ::Nil"}],"args_string":"(x : UInt64 | Nil)","args_html":"(x : UInt64 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L36"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"UInt64 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/UInt8Converter","path":"Lustra/Model/Converter/UInt8Converter.html","kind":"class","full_name":"Lustra::Model::Converter::UInt8Converter","name":"UInt8Converter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/converters/number_converters.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L33"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from and to UInt8","summary":"<p>Convert from and to UInt8</p>","class_methods":[{"html_id":"to_column(x):UInt8|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : UInt8 | Nil","args_html":"(x) : UInt8 | Nil","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L33"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"UInt8 | ::Nil","visibility":"Public","body":"case x\nwhen Nil\n  nil\nwhen Number\n  UInt8.new(x)\nelse\n  UInt8.new(x.to_s)\nend"},"external_var":false},{"html_id":"to_db(x:UInt8|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"UInt8 | ::Nil"}],"args_string":"(x : UInt8 | Nil)","args_html":"(x : UInt8 | Nil)","location":{"filename":"src/lustra/model/converters/number_converters.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/converters/number_converters.cr#L33"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"UInt8 | ::Nil"}],"visibility":"Public","body":"x"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Converter/UUIDConverter","path":"Lustra/Model/Converter/UUIDConverter.html","kind":"class","full_name":"Lustra::Model::Converter::UUIDConverter","name":"UUIDConverter","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/uuid/uuid.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/uuid/uuid.cr#L8"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/Converter","kind":"module","full_name":"Lustra::Model::Converter","name":"Converter"},"doc":"Convert from UUID column to Crystal's UUID","summary":"<p>Convert from UUID column to Crystal's UUID</p>","class_methods":[{"html_id":"to_column(x):UUID|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : UUID | Nil","args_html":"(x) : <a href=\"../../../UUID.html\">UUID</a> | Nil","location":{"filename":"src/lustra/extensions/uuid/uuid.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/uuid/uuid.cr#L9"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"UUID | ::Nil","visibility":"Public","body":"case x\nwhen String\n  UUID.new(x)\nwhen Slice(UInt8)\n  UUID.new(x)\nwhen UUID\n  x\nwhen Nil\n  nil\nelse\n  raise(Lustra::ErrorMessages.converter_error(x.class.name, \"UUID\"))\nend"},"external_var":false},{"html_id":"to_db(x:UUID|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"UUID | ::Nil"}],"args_string":"(x : UUID | Nil)","args_html":"(x : <a href=\"../../../UUID.html\">UUID</a> | Nil)","location":{"filename":"src/lustra/extensions/uuid/uuid.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/uuid/uuid.cr#L24"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"UUID | ::Nil"}],"visibility":"Public","body":"if x.nil?\n  nil\nelse\n  x.to_s\nend"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/Error","path":"Lustra/Model/Error.html","kind":"class","full_name":"Lustra::Model::Error","name":"Error","abstract":false,"superclass":{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/errors.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"lustra/Lustra/Model/InvalidError","kind":"class","full_name":"Lustra::Model::InvalidError","name":"InvalidError"},{"html_id":"lustra/Lustra/Model/ReadOnlyError","kind":"class","full_name":"Lustra::Model::ReadOnlyError","name":"ReadOnlyError"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}},{"html_id":"lustra/Lustra/Model/EventManager","path":"Lustra/Model/EventManager.html","kind":"class","full_name":"Lustra::Model::EventManager","name":"EventManager","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/event_manager.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L12"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"EVENT_CALLBACKS","name":"EVENT_CALLBACKS","value":"{} of EventKey => Array(HookFunction)"},{"id":"INHERITANCE_MAP","name":"INHERITANCE_MAP","value":"{} of String => String"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"This class manages the storage and execution of model lifecycle callbacks.\nIt acts as a singleton that stores callbacks for all models and triggers them\nduring appropriate lifecycle events.\n\nKey concepts:\n- `EVENT_CALLBACKS`: Hash storing all registered callbacks by `{class_name, direction, event}`\n- Direction: `:before` or `:after`\n- Events: `:create`, `:update`, `:validate`, `:save`, etc.\n\nUsage: This is used internally by `Lustra::Model::HasHooks`\nGlobal storage for model lifecycle event management","summary":"<p>This class manages the storage and execution of model lifecycle callbacks.</p>","class_methods":[{"html_id":"add_inheritance(parent,child)-class-method","name":"add_inheritance","doc":"Map the inheritance between models. Events which belongs to parent model are triggered when child model lifecycle\nactions occurs","summary":"<p>Map the inheritance between models.</p>","abstract":false,"args":[{"name":"parent","external_name":"parent","restriction":""},{"name":"child","external_name":"child","restriction":""}],"args_string":"(parent, child)","args_html":"(parent, child)","location":{"filename":"src/lustra/model/event_manager.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L50"},"def":{"name":"add_inheritance","args":[{"name":"parent","external_name":"parent","restriction":""},{"name":"child","external_name":"child","restriction":""}],"visibility":"Public","body":"INHERITANCE_MAP[child.to_s] = parent.to_s"},"external_var":false},{"html_id":"attach(klass,direction:Symbol,event:Symbol,block:HookFunction)-class-method","name":"attach","doc":"Register a callback for a specific model class, direction, and event\n\n`klass` - The model class\n`direction` - `:before` or `:after`\n`event` - The lifecycle event (`:create`, `:update`, `:validate`, etc.)\n`block` - The callback function to execute\n\nThis is called internally by `Lustra::Model::HasHooks` when you define\n`before` or `after` callbacks in your model.","summary":"<p>Register a callback for a specific model class, direction, and event</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":""},{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"event","external_name":"event","restriction":"Symbol"},{"name":"block","external_name":"block","restriction":"HookFunction"}],"args_string":"(klass, direction : Symbol, event : Symbol, block : HookFunction)","args_html":"(klass, direction : Symbol, event : Symbol, block : <a href=\"../../Lustra/Model/EventManager/HookFunction.html\">HookFunction</a>)","location":{"filename":"src/lustra/model/event_manager.cr","line_number":63,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L63"},"def":{"name":"attach","args":[{"name":"klass","external_name":"klass","restriction":""},{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"event","external_name":"event","restriction":"Symbol"},{"name":"block","external_name":"block","restriction":"HookFunction"}],"visibility":"Public","body":"tuple = {klass.to_s, direction, event}\narr = EVENT_CALLBACKS.fetch(tuple) do [] of HookFunction end\n\narr.push(block)\nEVENT_CALLBACKS[tuple] = arr\n"},"external_var":false},{"html_id":"trigger(klass,direction:Symbol,event:Symbol,mdl:Lustra::Model)-class-method","name":"trigger","doc":"Trigger all callbacks for a specific model, direction, and event\n\n`klass` - the model class\n`direction` - `:before` or `:after`\n`event` - the lifecycle event (`:create`, `:update`, `:validate`, etc.)\n`mdl` - the model instance\n\nCallback execution order:\n- `:before` callbacks: Last defined → First defined (reverse order)\n- `:after` callbacks: First defined → Last defined (normal order)\n\nThis ensures that the most recently defined callbacks run first for `:before`\nand last for `:after`, allowing for proper layering of functionality.","summary":"<p>Trigger all callbacks for a specific model, direction, and event</p>","abstract":false,"args":[{"name":"klass","external_name":"klass","restriction":""},{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"event","external_name":"event","restriction":"Symbol"},{"name":"mdl","external_name":"mdl","restriction":"Lustra::Model"}],"args_string":"(klass, direction : Symbol, event : Symbol, mdl : Lustra::Model)","args_html":"(klass, direction : Symbol, event : Symbol, mdl : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>)","location":{"filename":"src/lustra/model/event_manager.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L32"},"def":{"name":"trigger","args":[{"name":"klass","external_name":"klass","restriction":""},{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"event","external_name":"event","restriction":"Symbol"},{"name":"mdl","external_name":"mdl","restriction":"Lustra::Model"}],"visibility":"Public","body":"arr = EVENT_CALLBACKS.fetch({klass.to_s, direction, event}) do [] of HookFunction end\n\nparent = INHERITANCE_MAP[klass.to_s]?\n\nif direction == (:after)\n  arr = arr.reverse\n\n  arr.each(&.call(mdl))\n  if parent.nil?\n  else\n    trigger(parent, direction, event, mdl)\n  end\nelse\n  if parent.nil?\n  else\n    trigger(parent, direction, event, mdl)\n  end\n  arr.each(&.call(mdl))\nend\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Model/EventManager/EventKey","path":"Lustra/Model/EventManager/EventKey.html","kind":"alias","full_name":"Lustra::Model::EventManager::EventKey","name":"EventKey","abstract":false,"locations":[{"filename":"src/lustra/model/event_manager.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L14"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"Tuple(String, Symbol, Symbol)","aliased_html":"{String, Symbol, Symbol}","const":false,"namespace":{"html_id":"lustra/Lustra/Model/EventManager","kind":"class","full_name":"Lustra::Model::EventManager","name":"EventManager"}},{"html_id":"lustra/Lustra/Model/EventManager/HookFunction","path":"Lustra/Model/EventManager/HookFunction.html","kind":"alias","full_name":"Lustra::Model::EventManager::HookFunction","name":"HookFunction","abstract":false,"locations":[{"filename":"src/lustra/model/event_manager.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/event_manager.cr#L13"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"Proc(Lustra::Model, Nil)","aliased_html":"<a href=\"../../../Lustra/Model.html\">Lustra::Model</a> -> Nil","const":false,"namespace":{"html_id":"lustra/Lustra/Model/EventManager","kind":"class","full_name":"Lustra::Model::EventManager","name":"EventManager"}}]},{"html_id":"lustra/Lustra/Model/Factory","path":"Lustra/Model/Factory.html","kind":"module","full_name":"Lustra::Model::Factory","name":"Factory","abstract":false,"locations":[{"filename":"src/lustra/model/factories/base.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/base.cr#L1"},{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L3"},{"filename":"src/lustra/model/factories/simple_factory.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/simple_factory.cr#L3"},{"filename":"src/lustra/model/factory.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factory.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"FACTORIES","name":"FACTORIES","value":"{\"Lustra::Reflection::Column\" => ::Lustra::Model::Factory::SimpleFactory(Lustra::Reflection::Column).new, \"Lustra::Reflection::Table\" => ::Lustra::Model::Factory::SimpleFactory(Lustra::Reflection::Table).new} of String => Lustra::Model::Factory::Base"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"class_methods":[{"html_id":"build(type:String,h:Hash,cache:Lustra::Model::QueryCache|Nil=nil,persisted=false,fetch_columns=false):Lustra::Model-class-method","name":"build","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"String"},{"name":"h","external_name":"h","restriction":"Hash"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(type : String, h : Hash, cache : Lustra::Model::QueryCache | Nil = nil, persisted = false, fetch_columns = false) : Lustra::Model","args_html":"(type : String, h : Hash, cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>, fetch_columns = <span class=\"n\">false</span>) : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>","location":{"filename":"src/lustra/model/factory.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factory.cr#L10"},"def":{"name":"build","args":[{"name":"type","external_name":"type","restriction":"String"},{"name":"h","external_name":"h","restriction":"Hash"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"Lustra::Model","visibility":"Public","body":"factory = FACTORIES[type].as(Base)\n\nfactory.build(h, cache, persisted, fetch_columns)\n"},"external_var":false},{"html_id":"build(type:T.class,h:Hash,cache:Lustra::Model::QueryCache|Nil=nil,persisted=false,fetch_columns=false):TforallT-class-method","name":"build","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"T.class"},{"name":"h","external_name":"h","restriction":"Hash"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(type : T.class, h : Hash, cache : Lustra::Model::QueryCache | Nil = nil, persisted = false, fetch_columns = false) : T forall T","args_html":"(type : <span class=\"t\">T</span>.<span class=\"k\">class</span>, h : Hash, cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>, fetch_columns = <span class=\"n\">false</span>) : T forall T","location":{"filename":"src/lustra/model/factory.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factory.cr#L22"},"def":{"name":"build","args":[{"name":"type","external_name":"type","restriction":"T.class"},{"name":"h","external_name":"h","restriction":"Hash"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"T","visibility":"Public","body":"(build(T.name, h, cache, persisted, fetch_columns)).as(T)"},"external_var":false}],"macros":[{"html_id":"add(type,factory)-macro","name":"add","abstract":false,"args":[{"name":"type","external_name":"type","restriction":""},{"name":"factory","external_name":"factory","restriction":""}],"args_string":"(type, factory)","args_html":"(type, factory)","location":{"filename":"src/lustra/model/factory.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factory.cr#L6"},"def":{"name":"add","args":[{"name":"type","external_name":"type","restriction":""},{"name":"factory","external_name":"factory","restriction":""}],"visibility":"Public","body":"    \n{% Lustra::Model::Factory::FACTORIES[type] = factory %}\n\n  \n"}}],"types":[{"html_id":"lustra/Lustra/Model/Factory/Base","path":"Lustra/Model/Factory/Base.html","kind":"module","full_name":"Lustra::Model::Factory::Base","name":"Base","abstract":false,"locations":[{"filename":"src/lustra/model/factories/base.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/base.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model/Factory/PolymorphicFactory","kind":"class","full_name":"Lustra::Model::Factory::PolymorphicFactory(T)","name":"PolymorphicFactory"},{"html_id":"lustra/Lustra/Model/Factory/SimpleFactory","kind":"class","full_name":"Lustra::Model::Factory::SimpleFactory(T)","name":"SimpleFactory"}],"namespace":{"html_id":"lustra/Lustra/Model/Factory","kind":"module","full_name":"Lustra::Model::Factory","name":"Factory"},"instance_methods":[{"html_id":"build(h:Hash(String,Lustra::SQL::Any),cache:Lustra::Model::QueryCache|Nil=nil,persisted:Bool=false,fetch_columns:Bool=false):Lustra::Model-instance-method","name":"build","abstract":true,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"args_string":"(h : Hash(String, Lustra::SQL::Any), cache : Lustra::Model::QueryCache | Nil = nil, persisted : Bool = false, fetch_columns : Bool = false) : Lustra::Model","args_html":"(h : Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>), cache : <a href=\"../../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted : Bool = <span class=\"n\">false</span>, fetch_columns : Bool = <span class=\"n\">false</span>) : <a href=\"../../../Lustra/Model.html\">Lustra::Model</a>","location":{"filename":"src/lustra/model/factories/base.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/base.cr#L3"},"def":{"name":"build","args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"return_type":"Lustra::Model","visibility":"Public","body":""},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Factory/PolymorphicFactory","path":"Lustra/Model/Factory/PolymorphicFactory.html","kind":"class","full_name":"Lustra::Model::Factory::PolymorphicFactory(T)","name":"PolymorphicFactory","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Model/Factory/Base","kind":"module","full_name":"Lustra::Model::Factory::Base","name":"Base"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Model/Factory/Base","kind":"module","full_name":"Lustra::Model::Factory::Base","name":"Base"}],"namespace":{"html_id":"lustra/Lustra/Model/Factory","kind":"module","full_name":"Lustra::Model::Factory","name":"Factory"},"constructors":[{"html_id":"new(type_field:String,self_class:String)-class-method","name":"new","abstract":false,"args":[{"name":"type_field","external_name":"type_field","restriction":"::String"},{"name":"self_class","external_name":"self_class","restriction":"::String"}],"args_string":"(type_field : String, self_class : String)","args_html":"(type_field : String, self_class : String)","location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L9"},"def":{"name":"new","args":[{"name":"type_field","external_name":"type_field","restriction":"::String"},{"name":"self_class","external_name":"self_class","restriction":"::String"}],"visibility":"Public","body":"_ = PolymorphicFactory(T).allocate\n_.initialize(type_field, self_class)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"build(h:Hash(String,Lustra::SQL::Any),cache:Lustra::Model::QueryCache|Nil=nil,persisted:Bool=false,fetch_columns:Bool=false):Lustra::Model-instance-method","name":"build","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"args_string":"(h : Hash(String, Lustra::SQL::Any), cache : Lustra::Model::QueryCache | Nil = nil, persisted : Bool = false, fetch_columns : Bool = false) : Lustra::Model","args_html":"(h : Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>), cache : <a href=\"../../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted : Bool = <span class=\"n\">false</span>, fetch_columns : Bool = <span class=\"n\">false</span>) : <a href=\"../../../Lustra/Model.html\">Lustra::Model</a>","location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L12"},"def":{"name":"build","args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"return_type":"Lustra::Model","visibility":"Public","body":"v = h[@type_field]\n\ncase v\nwhen String\n  if v == T.name\n    {% if T.abstract? %}\n            raise \"Cannot instantiate #{@type_field} because it is abstract class\"\n          {% else %}\n            T.new(v, h, cache, persisted, fetch_columns).as(Lustra::Model)\n          {% end %}\n  else\n    (Lustra::Model::Factory.build(v, h, cache, persisted, fetch_columns)).as(Lustra::Model)\n  end\nwhen Nil\n  raise(Lustra::ErrorMessages.polymorphic_nil(@type_field))\nelse\n  raise(Lustra::ErrorMessages.polymorphic_nil(@type_field))\nend\n"},"external_var":false},{"html_id":"self_class:String-instance-method","name":"self_class","abstract":false,"location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L7"},"def":{"name":"self_class","return_type":"String","visibility":"Public","body":"@self_class"},"external_var":false},{"html_id":"self_class=(self_class:String)-instance-method","name":"self_class=","abstract":false,"args":[{"name":"self_class","external_name":"self_class","restriction":"String"}],"args_string":"(self_class : String)","args_html":"(self_class : String)","location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L7"},"def":{"name":"self_class=","args":[{"name":"self_class","external_name":"self_class","restriction":"String"}],"visibility":"Public","body":"@self_class = self_class"},"external_var":false},{"html_id":"type_field:String-instance-method","name":"type_field","abstract":false,"location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L6"},"def":{"name":"type_field","return_type":"String","visibility":"Public","body":"@type_field"},"external_var":false},{"html_id":"type_field=(type_field:String)-instance-method","name":"type_field=","abstract":false,"args":[{"name":"type_field","external_name":"type_field","restriction":"String"}],"args_string":"(type_field : String)","args_html":"(type_field : String)","location":{"filename":"src/lustra/model/factories/polymorphic_factory.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/polymorphic_factory.cr#L6"},"def":{"name":"type_field=","args":[{"name":"type_field","external_name":"type_field","restriction":"String"}],"visibility":"Public","body":"@type_field = type_field"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Factory/SimpleFactory","path":"Lustra/Model/Factory/SimpleFactory.html","kind":"class","full_name":"Lustra::Model::Factory::SimpleFactory(T)","name":"SimpleFactory","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Model/Factory/Base","kind":"module","full_name":"Lustra::Model::Factory::Base","name":"Base"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/factories/simple_factory.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/simple_factory.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Model/Factory/Base","kind":"module","full_name":"Lustra::Model::Factory::Base","name":"Base"}],"namespace":{"html_id":"lustra/Lustra/Model/Factory","kind":"module","full_name":"Lustra::Model::Factory","name":"Factory"},"instance_methods":[{"html_id":"build(h:Hash(String,Lustra::SQL::Any),cache:Lustra::Model::QueryCache|Nil=nil,persisted:Bool=false,fetch_columns:Bool=false):Lustra::Model-instance-method","name":"build","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"args_string":"(h : Hash(String, Lustra::SQL::Any), cache : Lustra::Model::QueryCache | Nil = nil, persisted : Bool = false, fetch_columns : Bool = false) : Lustra::Model","args_html":"(h : Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>), cache : <a href=\"../../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted : Bool = <span class=\"n\">false</span>, fetch_columns : Bool = <span class=\"n\">false</span>) : <a href=\"../../../Lustra/Model.html\">Lustra::Model</a>","location":{"filename":"src/lustra/model/factories/simple_factory.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/factories/simple_factory.cr#L7"},"def":{"name":"build","args":[{"name":"h","external_name":"h","restriction":"Hash(String, ::Lustra::SQL::Any)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":"Bool"},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":"Bool"}],"return_type":"Lustra::Model","visibility":"Public","body":"(T.new(h, cache, persisted, fetch_columns)).as(Lustra::Model)"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/FullTextSearchable","path":"Lustra/Model/FullTextSearchable.html","kind":"module","full_name":"Lustra::Model::FullTextSearchable","name":"FullTextSearchable","abstract":false,"locations":[{"filename":"src/lustra/extensions/full_text_searchable/model.cr","line_number":87,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/model.cr#L87"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"Full text search plugin offers full integration with `tsvector` capabilities of\nPostgresql.\n\nIt allows you to query models through the text content of one or multiple fields.\n\n### The blog example\n\nLet's assume we have a blog and want to implement full text search over title and content:\n\n```\ncreate_table \"posts\" do |t|\n  t.column :title, :string, null: false\n  t.column :content, :string, null: false\n\n  t.full_text_searchable on: [{\"title\", 'A'}, {\"content\", 'C'}]\nend\n```\n\nThis migration will create a 3rd column named `full_text_vector` of type `tsvector`,\na gin index, a trigger and a function to update automatically this column.\n\nOver the `on` keyword, `'{\"title\", 'A'}'` means it allows search of the content of \"title\", with level of priority (weight) \"A\", which tells postgres than title content is more meaningful than the article content itself.\n\nNow, let's build some models:\n\n```\n\n  model Post\n    include Lustra::Model\n    #...\n\n    full_text_searchable\n  end\n\n  Post.create!({title: \"About poney\", content: \"Poney are cool\"})\n  Post.create!({title: \"About dog and cat\", content: \"Cat and dog are cool. But not as much as poney\"})\n  Post.create!({title: \"You won't believe: She raises her poney like as star!\", content: \"She's cool because poney are cool\"})\n```\n\nSearch is now easily done\n\n```\nPost.query.search(\"poney\") # Return all the articles !\n```\n\nObviously, search call can be chained:\n\n```\nuser = User.find! { email == \"some_email@example.com\" }\nPost.query.from_user(user).search(\"orm\")\n```\n\n### Additional parameters\n\n#### `catalog`\n\nSelect the catalog to use to build the tsquery. By default, `pg_catalog.english` is used.\n\n```\n# in your migration:\nt.full_text_searchable on: [{\"title\", 'A'}, {\"content\", 'C'}], catalog: \"pg_catalog.french\"\n\n# in your model\nfull_text_searchable catalog: \"pg_catalog.french\"\n```\n\nNote: For now, Lustra doesn't offers dynamic selection of catalog (for let's say multi-lang service).\nIf your app need this feature, do not hesitate to open an issue.\n\n#### `trigger_name`, `function_name`\n\nIn migration, you can change the name generated for the trigger and the function, using theses two keys.\n\n#### `dest_field`\n\nThe field created in the database, which will contains your ts vector. Default is `full_text_vector`.\n\n```\n# in your migration\nt.full_text_searchable on: [{\"title\", 'A'}, {\"content\", 'C'}], dest_field: \"tsv\"\n\n# in your model\nfull_text_searchable \"tsv\"\n```","summary":"<p>Full text search plugin offers full integration with <code>tsvector</code> capabilities of Postgresql.</p>","class_methods":[{"html_id":"to_tsq(text)-class-method","name":"to_tsq","doc":"Parse client side text and generate string ready to be ingested by PG's `to_tsquery`.\n\nAuthor note: pg `to_tsquery` is awesome but can easily fail to parse.\n  `search` method use then a wrapper text_to_search used to ensure than\n  request is understood and produce ALWAYS legal string for `to_tsquery`\nThis is a good helper then to use with the input of your end-users !\n\nHowever, this helper can be improved, as it doesn't use all the features\nof tsvector (parentesis, OR operator etc...)","summary":"<p>Parse client side text and generate string ready to be ingested by PG's <code>to_tsquery</code>.</p>","abstract":false,"args":[{"name":"text","external_name":"text","restriction":""}],"args_string":"(text)","args_html":"(text)","location":{"filename":"src/lustra/extensions/full_text_searchable/model.cr","line_number":185,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/model.cr#L185"},"def":{"name":"to_tsq","args":[{"name":"text","external_name":"text","restriction":""}],"visibility":"Public","body":"text = text.gsub(/\\+/, \" \")\ntokens = split_to_exp(text)\n\ntokens.join(\" & \") do |__temp_151|\n  modifier, value = __temp_151\n  if modifier == (:-)\n    \"!\" + Lustra::Expression[value]\n  else\n    Lustra::Expression[value]\n  end\nend\n"},"external_var":false}],"macros":[{"html_id":"full_text_searchable(through=\"full_text_vector\",catalog=\"pg_catalog.english\",scope_name=\"search\")-macro","name":"full_text_searchable","doc":"Set this model as searchable using tsvector","summary":"<p>Set this model as searchable using tsvector</p>","abstract":false,"args":[{"name":"through","default_value":"\"full_text_vector\"","external_name":"through","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"scope_name","default_value":"\"search\"","external_name":"scope_name","restriction":""}],"args_string":"(through = \"full_text_vector\", catalog = \"pg_catalog.english\", scope_name = \"search\")","args_html":"(through = <span class=\"s\">&quot;full_text_vector&quot;</span>, catalog = <span class=\"s\">&quot;pg_catalog.english&quot;</span>, scope_name = <span class=\"s\">&quot;search&quot;</span>)","location":{"filename":"src/lustra/extensions/full_text_searchable/model.cr","line_number":89,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/model.cr#L89"},"def":{"name":"full_text_searchable","args":[{"name":"through","default_value":"\"full_text_vector\"","external_name":"through","restriction":""},{"name":"catalog","default_value":"\"pg_catalog.english\"","external_name":"catalog","restriction":""},{"name":"scope_name","default_value":"\"search\"","external_name":"scope_name","restriction":""}],"visibility":"Public","body":"    column( \n{{ through.id }}\n : Lustra::TSVector, presence: false)\n\n    scope \"\n{{ scope_name.id }}\n\" do |str|\n      table = self.item_class.table\n      where \n{\n        op(\n          var(table, \"\n{{ through.id }}\n\"),\n          to_tsquery(\n{{ catalog }}\n, Lustra::Model::FullTextSearchable.to_tsq(str)),\n          \"@@\"\n        )\n      }\n    \nend\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasColumns","path":"Lustra/Model/HasColumns.html","kind":"module","full_name":"Lustra::Model::HasColumns","name":"HasColumns","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_columns.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L5"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"This module declare all the methods and macro related to columns in `Lustra::Model`","summary":"<p>This module declare all the methods and macro related to columns in <code><a href=\"../../Lustra/Model.html\">Lustra::Model</a></code></p>","instance_methods":[{"html_id":"[](x):Lustra::SQL::Any-instance-method","name":"[]","doc":"Access to direct SQL attributes given by the request used to build the model.\nAccess is read only and updating the model columns will not apply change to theses columns.\n\n```\nmodel = Model.query.select(\"MIN(id) AS min_id\").first(fetch_columns: true)\nid = model[\"min_id\"].to_i32\n```","summary":"<p>Access to direct SQL attributes given by the request used to build the model.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Lustra::SQL::Any","args_html":"(x) : <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":72,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L72"},"def":{"name":"[]","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"::Lustra::SQL::Any","visibility":"Public","body":"attributes[x]"},"external_var":false},{"html_id":"[]?(x):Lustra::SQL::Any-instance-method","name":"[]?","doc":"Access to direct SQL attributes given by the request and used to build the model\nor Nil if not found.\n\nAccess is read only and updating the model columns will not apply change to theses columns.\nYou must set `fetch_column: true` in your model to access the attributes.","summary":"<p>Access to direct SQL attributes given by the request and used to build the model or Nil if not found.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Lustra::SQL::Any","args_html":"(x) : <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":81,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L81"},"def":{"name":"[]?","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"::Lustra::SQL::Any","visibility":"Public","body":"attributes[x]?"},"external_var":false},{"html_id":"reset(h:Hash(String,_))-instance-method","name":"reset","doc":"See `reset(**t : **T)`","summary":"<p>See <code><a href=\"../../Lustra/Model/HasColumns.html#reset%28h%3AHash%28String%2C_%29%29-instance-method\">#reset(**t : **T)</a></code></p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L35"},"def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"reset(h:Hash(Symbol,_))-instance-method","name":"reset","doc":"See `reset(**t : **T)`","summary":"<p>See <code><a href=\"../../Lustra/Model/HasColumns.html#reset%28h%3AHash%28String%2C_%29%29-instance-method\">#reset(**t : **T)</a></code></p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L39"},"def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"reset(**t:**T)forallT-instance-method","name":"reset","doc":"Reset one or multiple columns; Reseting set the current value of the column\nto the given value, while the `changed?` flag remains false.\nIf you call save on a persisted model, the reset columns won't be\ncommited in the UPDATE query.","summary":"<p>Reset one or multiple columns; Reseting set the current value of the column to the given value, while the <code>changed?</code> flag remains false.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L26"},"def":{"name":"reset","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":""},"external_var":false},{"html_id":"set(h:Hash(String,_))-instance-method","name":"set","doc":"See `set(**t : **T)`","summary":"<p>See <code><a href=\"../../Lustra/Model/HasColumns.html#set%28h%3AHash%28String%2C_%29%29-instance-method\">#set(**t : **T)</a></code></p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":58,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L58"},"def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"set(h:Hash(Symbol,_))-instance-method","name":"set","doc":"See `set(**t : **T)`","summary":"<p>See <code><a href=\"../../Lustra/Model/HasColumns.html#set%28h%3AHash%28String%2C_%29%29-instance-method\">#set(**t : **T)</a></code></p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L62"},"def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":""},"external_var":false},{"html_id":"set(**t:**T)forallT-instance-method","name":"set","doc":"Set one or multiple columns to a specific value\nThis two are equivalents:\n\n```\nmodel.set(a: 1)\nmodel.a = 1\n```","summary":"<p>Set one or multiple columns to a specific value This two are equivalents:</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L49"},"def":{"name":"set","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":""},"external_var":false},{"html_id":"to_h(full=false)-instance-method","name":"to_h","doc":"Returns the model columns as Hash.\nCalling `to_h` will returns only the defined columns, while settings the optional parameter `full` to `true`\n  will return all the column and fill the undefined columns by `nil` values.\nExample:\n\n```\n# Assuming our model has a primary key, a first name and last name and two timestamp columns:\nmodel = Model.query.select(\"first_name, last_name\").first!\nmodel.to_h             # => { \"first_name\" => \"Johnny\", \"last_name\" => \"Walker\" }\nmodel.to_h(full: true) # => {\"id\" => nil, \"first_name\" => \"Johnny\", \"last_name\" => \"Walker\", \"created_at\" => nil, \"updated_at\" => nil}\n```","summary":"<p>Returns the model columns as Hash.</p>","abstract":false,"args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"args_string":"(full = false)","args_html":"(full = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":110,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L110"},"def":{"name":"to_h","args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"visibility":"Public","body":"{} of String => ::Lustra::SQL::Any"},"external_var":false},{"html_id":"update_h-instance-method","name":"update_h","doc":"Returns the current hash of the modified values:\n\n```\nmodel = Model.query.first!\nmodel.update_h # => {}\nmodel.first_name = \"hello\"\nmodel.update_h # => { \"first_name\" => \"hello\" }\nmodel.save!\nmodel.update_h # => {}\n```","summary":"<p>Returns the current hash of the modified values:</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":95,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L95"},"def":{"name":"update_h","visibility":"Public","body":"{} of String => ::Lustra::SQL::Any"},"external_var":false}],"macros":[{"html_id":"column(name,primary=false,converter=nil,column_name=nil,presence=true,mass_assign=true)-macro","name":"column","doc":"Bind a column to the model.\n\nSimple example:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column some_id : Int32, primary: true\n  column nullable_column : String?\nend\n```\noptions:\n\n* `primary : Bool`: Let Lustra ORM know which column is the primary key.\nCurrently compound primary key are not compatible with Lustra ORM.\n\n* `converter : Class | Module`: Use this class to convert the data from the\nSQL. This class must possess the class methods\n`to_column(::Lustra::SQL::Any) : T` and `to_db(T) : ::Lustra::SQL::Any`\nwith `T` the type of the column.\n\n* `column_name : String`: If the name of the column in the model doesn't fit the name of the\n  column in the SQL, you can use the parameter `column_name` to tell Lustra about\n  which db column is linked to current field.\n\n* `presence : Bool (default = true)`: Use this option to let know Lustra that\n  your column is not nullable but with default value generated by the database\n  on insert (e.g. serial)\nDuring validation before saving, the presence will not be checked on this field\n  and Lustra will try to insert without the field value.\n\n* `mass_assign : Bool (default = true)`: Use this option to turn on/ off mass assignment\n  when instantiating or updating a new model from json through `.from_json` methods from\n  the `Lustra::Model::JSONDeserialize` module.\n","summary":"<p>Bind a column to the model.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"converter","default_value":"nil","external_name":"converter","restriction":""},{"name":"column_name","default_value":"nil","external_name":"column_name","restriction":""},{"name":"presence","default_value":"true","external_name":"presence","restriction":""},{"name":"mass_assign","default_value":"true","external_name":"mass_assign","restriction":""}],"args_string":"(name, primary = false, converter = nil, column_name = nil, presence = true, mass_assign = true)","args_html":"(name, primary = <span class=\"n\">false</span>, converter = <span class=\"n\">nil</span>, column_name = <span class=\"n\">nil</span>, presence = <span class=\"n\">true</span>, mass_assign = <span class=\"n\">true</span>)","location":{"filename":"src/lustra/model/modules/has_columns.cr","line_number":150,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_columns.cr#L150"},"def":{"name":"column","args":[{"name":"name","external_name":"name","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"converter","default_value":"nil","external_name":"converter","restriction":""},{"name":"column_name","default_value":"nil","external_name":"column_name","restriction":""},{"name":"presence","default_value":"true","external_name":"presence","restriction":""},{"name":"mass_assign","default_value":"true","external_name":"mass_assign","restriction":""}],"visibility":"Public","body":"    \n{% _type = name.type %}\n\n    \n{%\n  unless converter\n    if _type.is_a?(Path)\n      if _type.resolve.stringify =~ (/\\(/)\n        converter = _type.stringify\n      else\n        converter = _type.resolve.stringify\n      end\n    elsif _type.is_a?(Generic)\n      if _type.name.stringify == \"::Union\"\n        converter = (_type.type_vars.map(&.resolve).map(&.stringify).sort.reject do |x| (x == \"Nil\") || (x == \"::Nil\") end.join(\"\")).id.stringify\n      else\n        converter = _type.resolve.stringify\n      end\n    elsif _type.is_a?(Union)\n      converter = (_type.types.map(&.resolve).map(&.stringify).sort.reject do |x| (x == \"Nil\") || (x == \"::Nil\") end.join(\"\")).id.stringify\n    else\n      raise(\"Unknown: #{_type}, #{_type.class}\")\n    end\n  end\n%}\n\n\n    \n{%\n  db_column_name = column_name == nil ? name.var : column_name.id\n\n  COLUMNS[\"#{db_column_name.id}\"] = {\n    type: _type,\n    primary: primary,\n    converter: converter,\n    db_column_name: \"#{db_column_name.id}\",\n    crystal_variable_name: name.var,\n    presence: presence,\n    mass_assign: mass_assign,\n  }\n%}\n\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasFactory","path":"Lustra/Model/HasFactory.html","kind":"module","full_name":"Lustra::Model::HasFactory","name":"HasFactory","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_factory.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_factory.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"macros":[{"html_id":"polymorphic(through=\"type\")-macro","name":"polymorphic","doc":"Define a polymorphic factory, if the model is tagged as polymorphic","summary":"<p>Define a polymorphic factory, if the model is tagged as polymorphic</p>","abstract":false,"args":[{"name":"through","default_value":"\"type\"","external_name":"through","restriction":""}],"args_string":"(through = \"type\")","args_html":"(through = <span class=\"s\">&quot;type&quot;</span>)","location":{"filename":"src/lustra/model/modules/has_factory.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_factory.cr#L36"},"def":{"name":"polymorphic","args":[{"name":"through","default_value":"\"type\"","external_name":"through","restriction":""}],"visibility":"Public","body":"    \n{% POLYMORPHISM_SETTINGS[:has_factory] = true %}\n\n\n    column \n{{ through.id }}\n : String\n\n    before(:validate) do |model|\n      model = model.as(self)\n      model.\n{{ through.id }}\n = model.class.name\n    \nend\n\n    \n# Subclasses are refined using a default scope\n\n    \n# to filter by type.\n\n    macro inherited\n      class Collection < Lustra::Model::CollectionBase(\n\\{\n{@type}}); \nend\n\n      def self.query\n        Collection.new.from(table).where \n{ \n{{ through.id }}\n == self.name }\n      \nend\n    \nend\n\n    \n# Base class can be refined too, only if the baseclass is not abstract.\n\n    \n{% unless @type.abstract? %}\n      def self.query\n        Collection.new.from(table).where { {{ through.id }} == self.name }\n      end\n    {% end %}\n\n\n    def self.polymorphic?\n      true\n    \nend\n\n    Lustra::Model::Factory.add(\n      \"\n{{ @type }}\n\",\n      Lustra::Model::Factory::PolymorphicFactory(\n{{ @type }}\n).new(\n{{ through.id.stringify }}\n, \"\n{{ @type }}\n\")\n    )\n\n    macro inherited\n      Lustra::Model::Factory.add(\n        \"\n\\{\n{@type}}\",\n        Lustra::Model::Factory::SimpleFactory(\n\\{\n{@type}}).new\n      )\n    \nend\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasHooks","path":"Lustra/Model/HasHooks.html","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"This module provides the callback system for `Lustra::Model`, allowing you to hook into\nmodel lifecycle events like `:create`, `:update`, `:validate`, etc.","summary":"<p>This module provides the callback system for <code><a href=\"../../Lustra/Model.html\">Lustra::Model</a></code>, allowing you to hook into model lifecycle events like <code>:create</code>, <code>:update</code>, <code>:validate</code>, etc.</p>","instance_methods":[{"html_id":"trigger_after_events(event_name)-instance-method","name":"trigger_after_events","doc":"Triggers the events hooked after `event_name`","summary":"<p>Triggers the events hooked after <code>event_name</code></p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":""}],"args_string":"(event_name)","args_html":"(event_name)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L32"},"def":{"name":"trigger_after_events","args":[{"name":"event_name","external_name":"event_name","restriction":""}],"visibility":"Public","body":"Lustra::Model::EventManager.trigger(self.class, :after, event_name, self)"},"external_var":false},{"html_id":"trigger_before_events(event_name)-instance-method","name":"trigger_before_events","doc":"Triggers the events hooked before `event_name`","summary":"<p>Triggers the events hooked before <code>event_name</code></p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":""}],"args_string":"(event_name)","args_html":"(event_name)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L27"},"def":{"name":"trigger_before_events","args":[{"name":"event_name","external_name":"event_name","restriction":""}],"visibility":"Public","body":"Lustra::Model::EventManager.trigger(self.class, :before, event_name, self)"},"external_var":false},{"html_id":"with_triggers(event_name,&)-instance-method","name":"with_triggers","doc":"This performs theses operations:\n\n- Call triggers `before` the event\n- Yield the given block\n- Call triggers `after` the event\n\n```\nmodel.with_triggers(\"email_sent\") do |m|\n  model.send_email\nend\n```\n\nReturns `self`","summary":"<p>This performs theses operations:</p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":""}],"args_string":"(event_name, &)","args_html":"(event_name, &)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L17"},"def":{"name":"with_triggers","args":[{"name":"event_name","external_name":"event_name","restriction":""}],"yields":1,"block_arity":1,"visibility":"Public","body":"Lustra::SQL.transaction do |cnx|\n  trigger_before_events(event_name)\n  yield(cnx)\n  trigger_after_events(event_name)\nend\nself\n"},"external_var":false}],"macros":[{"html_id":"after(event_name,method_name)-macro","name":"after","doc":"Macro version of `after` - calls a method instead of a block\n\nExample: `after(:create, :send_welcome_email)`\nEquivalent to: `after(:create) { |model| model.as(User).send_welcome_email }`\n\nThe macro automatically casts to the correct type for you.","summary":"<p>Macro version of <code><a href=\"../../Lustra/Model/HasHooks.html#after%28event_name%2Cmethod_name%29-macro\">after</a></code> - calls a method instead of a block</p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":""},{"name":"method_name","external_name":"method_name","restriction":""}],"args_string":"(event_name, method_name)","args_html":"(event_name, method_name)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":94,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L94"},"def":{"name":"after","args":[{"name":"event_name","external_name":"event_name","restriction":""},{"name":"method_name","external_name":"method_name","restriction":""}],"visibility":"Public","body":"    after(\n{{ event_name }}\n) \n{ |mdl|\n      mdl.as(\n{{ @type }}\n).\n{{ method_name.id }}\n\n    }\n  \n"}},{"html_id":"before(event_name,method_name)-macro","name":"before","doc":"Macro version of `before` - calls a method instead of a block\n\nExample: `before(:validate, :sanitize_data)`\nEquivalent to: `before(:validate) { |model| model.as(User).sanitize_data }`\n\nThe macro automatically casts to the correct type for you.","summary":"<p>Macro version of <code><a href=\"../../Lustra/Model/HasHooks.html#before%28event_name%2Cmethod_name%29-macro\">before</a></code> - calls a method instead of a block</p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":""},{"name":"method_name","external_name":"method_name","restriction":""}],"args_string":"(event_name, method_name)","args_html":"(event_name, method_name)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":82,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L82"},"def":{"name":"before","args":[{"name":"event_name","external_name":"event_name","restriction":""},{"name":"method_name","external_name":"method_name","restriction":""}],"visibility":"Public","body":"    before(\n{{ event_name }}\n) \n{ |mdl|\n      mdl.as(\n{{ @type }}\n).\n{{ method_name.id }}\n\n    }\n  \n"}}],"types":[{"html_id":"lustra/Lustra/Model/HasHooks/ClassMethods","path":"Lustra/Model/HasHooks/ClassMethods.html","kind":"module","full_name":"Lustra::Model::HasHooks::ClassMethods","name":"ClassMethods","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L36"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/HasHooks","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks"},"instance_methods":[{"html_id":"after(event_name:Symbol,&block:Lustra::Model->Nil)-instance-method","name":"after","doc":"Register a callback to be executed AFTER the specified lifecycle event\n\n`event_name` - the lifecycle event (`:create`, `:update`, `:validate`, etc.)\n`block` - the callback block to execute\n\nNote: The block parameter has type `Lustra::Model`. Use `.as(YourModel)` to access\nmodel-specific methods and columns.\n\nExample:\n```\nafter(:create) do |model|\n  user = model.as(User)\n  user.send_welcome_email\nend\n```","summary":"<p>Register a callback to be executed AFTER the specified lifecycle event</p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":"Symbol"}],"args_string":"(event_name : Symbol, &block : Lustra::Model -> Nil)","args_html":"(event_name : Symbol, &block : <a href=\"../../../Lustra/Model.html\">Lustra::Model</a> -> Nil)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L71"},"def":{"name":"after","args":[{"name":"event_name","external_name":"event_name","restriction":"Symbol"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Lustra::Model -> Nil)"},"visibility":"Public","body":"Lustra::Model::EventManager.attach(self, :after, event_name, block)"},"external_var":false},{"html_id":"before(event_name:Symbol,&block:Lustra::Model->Nil)-instance-method","name":"before","doc":"Register a callback to be executed BEFORE the specified lifecycle event\n\n`event_name` - the lifecycle event (`:create`, `:update`, `:validate`, etc.)\n`block` - the callback block to execute\n\nNote: The block parameter has type `Lustra::Model`. Use `.as(YourModel)` to access\nmodel-specific methods and columns.\n\nExample:\n```\nbefore(:validate) do |model|\n  user = model.as(User)\n  user.email = user.email.downcase\nend\n```","summary":"<p>Register a callback to be executed BEFORE the specified lifecycle event</p>","abstract":false,"args":[{"name":"event_name","external_name":"event_name","restriction":"Symbol"}],"args_string":"(event_name : Symbol, &block : Lustra::Model -> Nil)","args_html":"(event_name : Symbol, &block : <a href=\"../../../Lustra/Model.html\">Lustra::Model</a> -> Nil)","location":{"filename":"src/lustra/model/modules/has_hooks.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_hooks.cr#L52"},"def":{"name":"before","args":[{"name":"event_name","external_name":"event_name","restriction":"Symbol"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Lustra::Model -> Nil)"},"visibility":"Public","body":"Lustra::Model::EventManager.attach(self, :before, event_name, block)"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/HasRelations","path":"Lustra/Model/HasRelations.html","kind":"module","full_name":"Lustra::Model::HasRelations","name":"HasRelations","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_relations.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_relations.cr#L13"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"```\nclass Model\n  include Lustra::Model\n\n  has_many posts : Post, foreign_key: Model.underscore_name + \"_id\", no_cache : false\n\n  has_one passport : Passport\n  has_many posts\nend\n```","summary":"<pre><code class=\"language-class\"></code></pre>","macros":[{"html_id":"belongs_to(name,foreign_key=nil,no_cache=false,primary=false,foreign_key_type=Int64,touch=nil,counter_cache=nil)-macro","name":"belongs_to","doc":"```\nclass Model\n  include Lustra::Model\n\n  belongs_to user : User, foreign_key: \"the_user_id\"\nend\n```","summary":"<pre><code class=\"language-class\"></code></pre>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"foreign_key_type","default_value":"Int64","external_name":"foreign_key_type","restriction":""},{"name":"touch","default_value":"nil","external_name":"touch","restriction":""},{"name":"counter_cache","default_value":"nil","external_name":"counter_cache","restriction":""}],"args_string":"(name, foreign_key = nil, no_cache = false, primary = false, foreign_key_type = Int64, touch = nil, counter_cache = nil)","args_html":"(name, foreign_key = <span class=\"n\">nil</span>, no_cache = <span class=\"n\">false</span>, primary = <span class=\"n\">false</span>, foreign_key_type = <span class=\"t\">Int64</span>, touch = <span class=\"n\">nil</span>, counter_cache = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/modules/has_relations.cr","line_number":138,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_relations.cr#L138"},"def":{"name":"belongs_to","args":[{"name":"name","external_name":"name","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"primary","default_value":"false","external_name":"primary","restriction":""},{"name":"foreign_key_type","default_value":"Int64","external_name":"foreign_key_type","restriction":""},{"name":"touch","default_value":"nil","external_name":"touch","restriction":""},{"name":"counter_cache","default_value":"nil","external_name":"counter_cache","restriction":""}],"visibility":"Public","body":"    \n{%\n  if foreign_key.is_a?(SymbolLiteral) || foreign_key.is_a?(StringLiteral)\n    foreign_key = foreign_key.id\n  end\n  if touch.is_a?(SymbolLiteral) || touch.is_a?(StringLiteral)\n    touch = touch.id\n  end\n\n  nilable = false\n\n  if name.type.is_a?(Union)\n    types = name.type.types.map do |x| \"#{x.id}\" end\n\n    nilable = types.includes?(\"Nil\")\n\n    type = name.type.types.first\n  else\n    type = name.type\n  end\n\n  if nilable\n    unless foreign_key_type.resolve.nilable?\n      foreign_key_type = \"#{foreign_key_type.id}?\".id\n    end\n  end\n\n  RELATIONS[name.var.id] = {\n    relation_type: :belongs_to,\n    type: type,\n    foreign_key: foreign_key,\n    nilable: nilable,\n    primary: primary,\n    no_cache: no_cache,\n    foreign_key_type: foreign_key_type,\n    touch: touch,\n    counter_cache: counter_cache,\n  }\n%}\n\n  \n"}},{"html_id":"has_many(name,through=nil,foreign_key=nil,own_key=nil,primary_key=nil,no_cache=false,polymorphic=false,foreign_key_type=nil,autosave=false)-macro","name":"has_many","doc":"Has Many and Has One are the relations where the model share its primary key into a foreign table. In our example above, we can assume than a User has many Post as author.\n\nBasically, for each `belongs_to` declaration, you must have a `has_many` or `has_one` declaration on the other model.\n\nWhile `has_many` relation returns a list of models, `has_one` returns only one model when called.\n\nExample:\n\n```\nclass User\n  include Lustra::Model\n\n  has_many posts : Post, foreign_key: \"author_id\"\nend\n```","summary":"<p>Has Many and Has One are the relations where the model share its primary key into a foreign table.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"through","default_value":"nil","external_name":"through","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"own_key","default_value":"nil","external_name":"own_key","restriction":""},{"name":"primary_key","default_value":"nil","external_name":"primary_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"polymorphic","default_value":"false","external_name":"polymorphic","restriction":""},{"name":"foreign_key_type","default_value":"nil","external_name":"foreign_key_type","restriction":""},{"name":"autosave","default_value":"false","external_name":"autosave","restriction":""}],"args_string":"(name, through = nil, foreign_key = nil, own_key = nil, primary_key = nil, no_cache = false, polymorphic = false, foreign_key_type = nil, autosave = false)","args_html":"(name, through = <span class=\"n\">nil</span>, foreign_key = <span class=\"n\">nil</span>, own_key = <span class=\"n\">nil</span>, primary_key = <span class=\"n\">nil</span>, no_cache = <span class=\"n\">false</span>, polymorphic = <span class=\"n\">false</span>, foreign_key_type = <span class=\"n\">nil</span>, autosave = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/modules/has_relations.cr","line_number":80,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_relations.cr#L80"},"def":{"name":"has_many","args":[{"name":"name","external_name":"name","restriction":""},{"name":"through","default_value":"nil","external_name":"through","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"own_key","default_value":"nil","external_name":"own_key","restriction":""},{"name":"primary_key","default_value":"nil","external_name":"primary_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"polymorphic","default_value":"false","external_name":"polymorphic","restriction":""},{"name":"foreign_key_type","default_value":"nil","external_name":"foreign_key_type","restriction":""},{"name":"autosave","default_value":"false","external_name":"autosave","restriction":""}],"visibility":"Public","body":"    \n{%\n  if through != nil\n    if own_key.is_a?(SymbolLiteral) || own_key.is_a?(StringLiteral)\n      own_key = own_key.id\n    end\n    if foreign_key.is_a?(SymbolLiteral) || foreign_key.is_a?(StringLiteral)\n      foreign_key = foreign_key.id\n    end\n    if foreign_key_type.is_a?(SymbolLiteral) || foreign_key_type.is_a?(StringLiteral)\n      foreign_key_type = foreign_key_type.id\n    end\n\n    RELATIONS[name.var.id] = {\n      relation_type: :has_many_through,\n      type: name.type,\n\n      through: through,\n      own_key: own_key,\n\n      foreign_key: foreign_key,\n      foreign_key_type: foreign_key_type,\n\n      polymorphic: polymorphic,\n      autosave: autosave,\n    }\n  else\n    if foreign_key.is_a?(SymbolLiteral) || foreign_key.is_a?(StringLiteral)\n      foreign_key = foreign_key.id\n    end\n    if primary_key.is_a?(SymbolLiteral) || primary_key.is_a?(StringLiteral)\n      primary_key = primary_key.id\n    end\n    if foreign_key_type.is_a?(SymbolLiteral) || foreign_key_type.is_a?(StringLiteral)\n      foreign_key_type = foreign_key_type.id\n    end\n\n    RELATIONS[name.var.id] = {\n      relation_type: :has_many,\n      type: name.type,\n\n      foreign_key: foreign_key,\n      primary_key: primary_key,\n      foreign_key_type: foreign_key_type,\n\n      no_cache: no_cache,\n      polymorphic: polymorphic,\n      autosave: autosave,\n    }\n  end\n%}\n\n  \n"}},{"html_id":"has_one(name,foreign_key=nil,primary_key=nil,no_cache=false,polymorphic=false,foreign_key_type=nil,autosave=false)-macro","name":"has_one","doc":"The method `has_one` declare a relation 1 to [0,1]\nwhere the current model primary key is stored in the foreign table.\n`primary_key` method (default: `self#__pkey__`) and `foreign_key` method\n(default: table_name in singular, plus \"_id\" appended)\ncan be redefined\n\nExample:\n\n```\nmodel Passport\n  column id : Int32, primary : true\n  has_one user : User It assumes the table `users` have a column `passport_id`\nend\n\nmodel Passport\n  column id : Int32, primary : true\n  has_one owner : User # It assumes the table `users` have a column `passport_id`\nend\n```","summary":"<p>The method <code><a href=\"../../Lustra/Model/HasRelations.html#has_one%28name%2Cforeign_key%3Dnil%2Cprimary_key%3Dnil%2Cno_cache%3Dfalse%2Cpolymorphic%3Dfalse%2Cforeign_key_type%3Dnil%2Cautosave%3Dfalse%29-macro\">has_one</a></code> declare a relation 1 to [0,1] where the current model primary key is stored in the foreign table.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"primary_key","default_value":"nil","external_name":"primary_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"polymorphic","default_value":"false","external_name":"polymorphic","restriction":""},{"name":"foreign_key_type","default_value":"nil","external_name":"foreign_key_type","restriction":""},{"name":"autosave","default_value":"false","external_name":"autosave","restriction":""}],"args_string":"(name, foreign_key = nil, primary_key = nil, no_cache = false, polymorphic = false, foreign_key_type = nil, autosave = false)","args_html":"(name, foreign_key = <span class=\"n\">nil</span>, primary_key = <span class=\"n\">nil</span>, no_cache = <span class=\"n\">false</span>, polymorphic = <span class=\"n\">false</span>, foreign_key_type = <span class=\"n\">nil</span>, autosave = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/modules/has_relations.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_relations.cr#L40"},"def":{"name":"has_one","args":[{"name":"name","external_name":"name","restriction":""},{"name":"foreign_key","default_value":"nil","external_name":"foreign_key","restriction":""},{"name":"primary_key","default_value":"nil","external_name":"primary_key","restriction":""},{"name":"no_cache","default_value":"false","external_name":"no_cache","restriction":""},{"name":"polymorphic","default_value":"false","external_name":"polymorphic","restriction":""},{"name":"foreign_key_type","default_value":"nil","external_name":"foreign_key_type","restriction":""},{"name":"autosave","default_value":"false","external_name":"autosave","restriction":""}],"visibility":"Public","body":"    \n{%\n  if foreign_key.is_a?(SymbolLiteral) || foreign_key.is_a?(StringLiteral)\n    foreign_key = foreign_key.id\n  end\n  if primary_key.is_a?(SymbolLiteral) || primary_key.is_a?(StringLiteral)\n    primary_key = primary_key.id\n  end\n\n  RELATIONS[name.var.id] = {\n    relation_type: :has_one,\n\n    type: name.type,\n\n    foreign_key: foreign_key,\n    primary_key: primary_key,\n    no_cache: no_cache,\n  }\n%}\n\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasSaving","path":"Lustra/Model/HasSaving.html","kind":"module","full_name":"Lustra::Model::HasSaving","name":"HasSaving","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_saving.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"This module handles saving models to the database and triggers lifecycle callbacks.\nIt's where the actual `:create`, `:update`, `:destroy`, and `:save` callbacks are triggered.\n\nKey callback trigger points:\n- `:save` callbacks: triggered for the entire save operation (wraps create/update)\n- `:create` callbacks: triggered when a new record is created\n- `:update` callbacks: triggered when an existing record is updated\n- `:destroy` callbacks: triggered when a record is destroyed\n\nThe callbacks are triggered via `with_triggers` which calls `Lustra::Model::EventManager`","summary":"<p>This module handles saving models to the database and triggers lifecycle callbacks.</p>","instance_methods":[{"html_id":"decrement(column:Symbol|String,by=1)-instance-method","name":"decrement","doc":"Decrement a numeric column without saving to the database.\nOnly updates the in-memory value. Call `save!` to persist.\n\n```\nuser.decrement(:attempts_left)\nuser.save! # Persist the change\n```\n\nReturns `self` for chaining.","summary":"<p>Decrement a numeric column without saving to the database.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"args_string":"(column : Symbol | String, by = 1)","args_html":"(column : Symbol | String, by = <span class=\"n\">1</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":347,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L347"},"def":{"name":"decrement","args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"visibility":"Public","body":"increment(column, -by)"},"external_var":false},{"html_id":"decrement!(column:Symbol|String,by=1)-instance-method","name":"decrement!","doc":"Decrement a numeric column by a specific amount (default 1) without running validations or callbacks.\nUpdates the database directly and updates the in-memory value.\n\n```\nuser.decrement!(:attempts_left) # Decrement by 1\nuser.decrement!(:balance, 10.5) # Decrement by 10.5\n```\n\nReturns `self` for chaining.","summary":"<p>Decrement a numeric column by a specific amount (default 1) without running validations or callbacks.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"args_string":"(column : Symbol | String, by = 1)","args_html":"(column : Symbol | String, by = <span class=\"n\">1</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":334,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L334"},"def":{"name":"decrement!","args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"visibility":"Public","body":"increment!(column, -by)"},"external_var":false},{"html_id":"delete-instance-method","name":"delete","doc":"Delete the model from the database WITHOUT running callbacks.\nUse this for performance when you don't need to trigger callbacks.\nThe deleted model is not persisted anymore and can be saved again.\n\n```\nuser.delete\nuser.persisted? # => false\n```\n\nReturns `true` if successfully deleted, `false` otherwise.","summary":"<p>Delete the model from the database WITHOUT running callbacks.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":233,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L233"},"def":{"name":"delete","visibility":"Public","body":"if persisted?\nelse\n  return false\nend\n\n(Lustra::SQL::DeleteQuery.new.from(self.class.full_table_name)).where do (var(\"#{self.class.__pkey__}\")) == __pkey__ end.execute(@@connection)\n\n@persisted = false\nclear_change_flags\n\ntrue\n"},"external_var":false},{"html_id":"destroy-instance-method","name":"destroy","doc":"Destroy the model from the database WITH callbacks and validations.\nThis is the safe way to delete records as it triggers all `:destroy` callbacks.\nThe destroyed model is not persisted anymore and can be saved again.\n\n```\nuser.destroy    # Triggers before(:destroy) and after(:destroy) callbacks\nuser.persisted? # => false\n```\n\nReturns `true` if successfully destroyed, `false` otherwise.","summary":"<p>Destroy the model from the database WITH callbacks and validations.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":254,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L254"},"def":{"name":"destroy","visibility":"Public","body":"if persisted?\nelse\n  return false\nend\n\nwith_triggers(:destroy) do\n  (Lustra::SQL::DeleteQuery.new.from(self.class.full_table_name)).where do (var(\"#{self.class.__pkey__}\")) == __pkey__ end.execute(@@connection)\n\n  @persisted = false\n  clear_change_flags\nend\n\ntrue\n"},"external_var":false},{"html_id":"increment(column:Symbol|String,by=1)-instance-method","name":"increment","doc":"Increment a numeric column without saving to the database.\nOnly updates the in-memory value. Call `save!` to persist.\n\n```\nuser.increment(:login_count)\nuser.save! # Persist the change\n```\n\nReturns `self` for chaining.","summary":"<p>Increment a numeric column without saving to the database.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"args_string":"(column : Symbol | String, by = 1)","args_html":"(column : Symbol | String, by = <span class=\"n\">1</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":303,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L303"},"def":{"name":"increment","args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"visibility":"Public","body":"column_name = column.to_s\n\n\nresult = ((Lustra::SQL.select(column_name)).from(self.class.full_table_name)).where do (raw(self.class.__pkey__)) == __pkey__ end.fetch_first!\ncurrent_value = result[column_name]\n\n\nnew_value = case current_value\nwhen Int32\n  current_value + by.to_i32\nwhen Int64\n  current_value + by.to_i64\nwhen Float32\n  current_value + by.to_f32\nwhen Float64\n  current_value + by.to_f64\nelse\n  raise(\"Column #{column_name} is not a numeric type\")\nend\n\nset({column_name => new_value})\nself\n"},"external_var":false},{"html_id":"increment!(column:Symbol|String,by=1)-instance-method","name":"increment!","doc":"Increment a numeric column by a specific amount (default 1) without running validations or callbacks.\nUpdates the database directly and updates the in-memory value.\n\n```\nuser.increment!(:login_count)   # Increment by 1\nuser.increment!(:score, 10)     # Increment by 10\nuser.increment!(:balance, -5.5) # Can use negative values\n```\n\nReturns `self` for chaining.","summary":"<p>Increment a numeric column by a specific amount (default 1) without running validations or callbacks.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"args_string":"(column : Symbol | String, by = 1)","args_html":"(column : Symbol | String, by = <span class=\"n\">1</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":277,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L277"},"def":{"name":"increment!","args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"by","default_value":"1","external_name":"by","restriction":""}],"visibility":"Public","body":"if persisted?\nelse\n  raise(\"Model must be persisted before incrementing\")\nend\n\ncolumn_name = column.to_s\n\n\nsql = \"UPDATE #{self.class.full_table_name} SET #{Lustra::SQL.escape(column_name)} = #{Lustra::SQL.escape(column_name)} + #{by} WHERE #{self.class.__pkey__} = #{__pkey__}\"\nLustra::SQL.execute(@@connection, sql)\n\n\nresult = ((Lustra::SQL.select(column_name)).from(self.class.full_table_name)).where do (raw(self.class.__pkey__)) == __pkey__ end.fetch_first!\nset({column_name => result[column_name]})\nclear_change_flags\n\nself\n"},"external_var":false},{"html_id":"persisted?:Bool-instance-method","name":"persisted?","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":61,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L61"},"def":{"name":"persisted?","return_type":"Bool","visibility":"Public","body":"@persisted"},"external_var":false},{"html_id":"reload:self-instance-method","name":"reload","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":211,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L211"},"def":{"name":"reload","return_type":"self","visibility":"Public","body":"set(self.class.query.where do (var(\"#{self.class.__pkey__}\")) == __pkey__ end.fetch_first!)\n\ninvalidate_caching\n\n@attributes.clear\nclear_change_flags\n@persisted = true\n\nself\n"},"external_var":false},{"html_id":"save(on_conflict:Lustra::SQL::InsertQuery->|Nil=nil)-instance-method","name":"save","doc":"Save the model. If the model is already persisted, will call `UPDATE` query.\nIf the model is not persisted, will call `INSERT`\n\nOptionally, you can pass a `Proc` to refine the `INSERT` with on conflict\nresolution functions.\n\nReturn `false` if the model cannot be saved (validation issue)\nReturn `true` if the model has been correctly saved.\n\nExample:\n\n```\nu = User.new\nif u.save\n  puts \"User correctly saved !\"\nelse\n  puts \"There was a problem during save: \"\n  # do something with `u.errors`\nend\n```\n\n## `on_conflict` optional parameter\n\nExample:\n\n```\nu = User.new id: 123, email: \"email@example.com\"\nu.save(-> (qry) { qry.on_conflict.do_update { |u| u.set(email: \"email@example.com\") } #update\n# IMPORTANT NOTICE: user may not be saved, but will be still detected as persisted !\n```\n\nYou may want to use a block for `on_conflict` optional parameter:\n\n```\nu = User.new id: 123, email: \"email@example.com\"\nu.save do |qry|\n   qry.on_conflict.do_update { |u| u.set(email: \"email@example.com\")\nend\n```","summary":"<p>Save the model.</p>","abstract":false,"args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"args_string":"(on_conflict : Lustra::SQL::InsertQuery ->  | Nil = nil)","args_html":"(on_conflict : <a href=\"../../Lustra/SQL/InsertQuery.html\">Lustra::SQL::InsertQuery</a> ->  | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":103,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L103"},"def":{"name":"save","args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"visibility":"Public","body":"if self.class.read_only?\n  return false\nend\n\nwith_triggers(:save) do\n  if valid?\n    if persisted?\n      h = update_h\n      if h.empty?\n      else\n        with_triggers(:update) do\n          save_main_model(on_conflict)\n        end\n      end\n    else\n      with_triggers(:create) do\n        save_main_model(on_conflict)\n      end\n    end\n\n    clear_change_flags\n\n    return true\n  else\n    return false\n  end\nend\n"},"external_var":false},{"html_id":"save(&block)-instance-method","name":"save","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":130,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L130"},"def":{"name":"save","yields":0,"block_arity":0,"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"save(on_conflict: block)"},"external_var":false},{"html_id":"save!(on_conflict:Lustra::SQL::InsertQuery->|Nil=nil)-instance-method","name":"save!","doc":"Performs `save` call, but instead of returning `false` if validation failed,\nraise `Lustra::Model::InvalidError` exception\nAutomatically handles built associations","summary":"<p>Performs <code><a href=\"../../Lustra/Model/HasSaving.html#save%28%26block%29-instance-method\">#save</a></code> call, but instead of returning <code>false</code> if validation failed, raise <code><a href=\"../../Lustra/Model/InvalidError.html\">Lustra::Model::InvalidError</a></code> exception Automatically handles built associations</p>","abstract":false,"args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"args_string":"(on_conflict : Lustra::SQL::InsertQuery ->  | Nil = nil)","args_html":"(on_conflict : <a href=\"../../Lustra/SQL/InsertQuery.html\">Lustra::SQL::InsertQuery</a> ->  | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":137,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L137"},"def":{"name":"save!","args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"visibility":"Public","body":"if self.class.read_only?\n  raise(Lustra::Model::ReadOnlyError.new(self))\nend\n\nif has_built_associations?\n  if save_with_associations(on_conflict)\n  else\n    raise(Lustra::Model::InvalidError.new(self))\n  end\nelsif save(on_conflict)\nelse\n  raise(Lustra::Model::InvalidError.new(self))\nend\n\nself\n"},"external_var":false},{"html_id":"save!(&block:Lustra::SQL::InsertQuery->)-instance-method","name":"save!","doc":"Pass the `on_conflict` optional parameter via block.","summary":"<p>Pass the <code>on_conflict</code> optional parameter via block.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":150,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L150"},"def":{"name":"save!","yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Lustra::SQL::InsertQuery ->)"},"visibility":"Public","body":"save!(block)"},"external_var":false},{"html_id":"save_with_associations(on_conflict:Lustra::SQL::InsertQuery->|Nil=nil)-instance-method","name":"save_with_associations","doc":"Save the model along with all built associations","summary":"<p>Save the model along with all built associations</p>","abstract":false,"args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"args_string":"(on_conflict : Lustra::SQL::InsertQuery ->  | Nil = nil)","args_html":"(on_conflict : <a href=\"../../Lustra/SQL/InsertQuery.html\">Lustra::SQL::InsertQuery</a> ->  | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":155,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L155"},"def":{"name":"save_with_associations","args":[{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"visibility":"Public","body":"if self.class.read_only?\n  return false\nend\n\nwith_triggers(:save) do\n  if valid?\n    save_built_associations\n\n    if persisted?\n      h = update_h\n      if h.empty?\n      else\n        with_triggers(:update) do\n          save_main_model(on_conflict)\n        end\n      end\n    else\n      with_triggers(:create) do\n        save_main_model(on_conflict)\n      end\n    end\n\n    handle_through_associations\n\n    clear_change_flags\n    clear_built_associations\n\n    return true\n  else\n    return false\n  end\nend\n"},"external_var":false},{"html_id":"update(**args)-instance-method","name":"update","doc":"Set the fields passed as argument and call `save` on the object","summary":"<p>Set the fields passed as argument and call <code><a href=\"../../Lustra/Model/HasSaving.html#save%28%26block%29-instance-method\">#save</a></code> on the object</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":188,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L188"},"def":{"name":"update","double_splat":{"name":"args","external_name":"args","restriction":""},"visibility":"Public","body":"set(**args)\nsave\n"},"external_var":false},{"html_id":"update!(**args)-instance-method","name":"update!","doc":"Set the fields passed as argument and call `save!` on the object","summary":"<p>Set the fields passed as argument and call <code><a href=\"../../Lustra/Model/HasSaving.html#save%21%28%26block%3ALustra%3A%3ASQL%3A%3AInsertQuery-%3E%29-instance-method\">#save!</a></code> on the object</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":194,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L194"},"def":{"name":"update!","double_splat":{"name":"args","external_name":"args","restriction":""},"visibility":"Public","body":"set(**args)\nsave!\n"},"external_var":false},{"html_id":"update_column(column:Symbol|String,value)-instance-method","name":"update_column","doc":"Update a single column directly in the database without running validations or callbacks.\nThis is useful for updating columns that don't need validation (like counters, flags, timestamps).\n\n```\nuser.update_column(:login_count, 10)\nuser.update_column(:last_login_at, Time.utc)\n```\n\n**Warning:** This bypasses:\n- Validations\n- Callbacks\n- Timestamp updates (updated_at will NOT change)\n\nReturns `self` for chaining.","summary":"<p>Update a single column directly in the database without running validations or callbacks.</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"value","external_name":"value","restriction":""}],"args_string":"(column : Symbol | String, value)","args_html":"(column : Symbol | String, value)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":365,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L365"},"def":{"name":"update_column","args":[{"name":"column","external_name":"column","restriction":"Symbol | String"},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"if persisted?\nelse\n  raise(\"Model must be persisted before updating columns\")\nend\n\ncolumn_name = column.to_s\n\n\n((Lustra::SQL.update(self.class.full_table_name))\n  .set({column_name => value}))\n  .where do (raw(self.class.__pkey__)) == __pkey__ end\n  .execute(@@connection)\n\n\nset({column_name => value})\nclear_change_flags\n\nself\n"},"external_var":false},{"html_id":"update_columns(columns:NamedTuple)-instance-method","name":"update_columns","doc":"Update multiple columns directly in the database without running validations or callbacks.\n\n```\nuser.update_columns(login_count: 10, last_login_at: Time.utc)\nuser.update_columns({status: \"active\", verified: true})\n```\n\n**Warning:** This bypasses:\n- Validations\n- Callbacks\n- Timestamp updates (updated_at will NOT change)\n\nReturns `self` for chaining.","summary":"<p>Update multiple columns directly in the database without running validations or callbacks.</p>","abstract":false,"args":[{"name":"columns","external_name":"columns","restriction":"NamedTuple"}],"args_string":"(columns : NamedTuple)","args_html":"(columns : NamedTuple)","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":413,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L413"},"def":{"name":"update_columns","args":[{"name":"columns","external_name":"columns","restriction":"NamedTuple"}],"visibility":"Public","body":"update_columns(**columns)"},"external_var":false},{"html_id":"update_columns(columns:Hash(String,Lustra::SQL::Any))-instance-method","name":"update_columns","doc":"Update multiple columns directly in the database without running validations or callbacks.\n\n```\nuser.update_columns(login_count: 10, last_login_at: Time.utc)\nuser.update_columns({status: \"active\", verified: true})\n```\n\n**Warning:** This bypasses:\n- Validations\n- Callbacks\n- Timestamp updates (updated_at will NOT change)\n\nReturns `self` for chaining.","summary":"<p>Update multiple columns directly in the database without running validations or callbacks.</p>","abstract":false,"args":[{"name":"columns","external_name":"columns","restriction":"Hash(String, Lustra::SQL::Any)"}],"args_string":"(columns : Hash(String, Lustra::SQL::Any))","args_html":"(columns : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>))","location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":418,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L418"},"def":{"name":"update_columns","args":[{"name":"columns","external_name":"columns","restriction":"Hash(String, Lustra::SQL::Any)"}],"visibility":"Public","body":"if persisted?\nelse\n  raise(\"Model must be persisted before updating columns\")\nend\n\n\n((Lustra::SQL.update(self.class.full_table_name))\n  .set(columns))\n  .where do (raw(self.class.__pkey__)) == __pkey__ end\n  .execute(@@connection)\n\n\nset(columns)\nclear_change_flags\n\nself\n"},"external_var":false},{"html_id":"update_columns(**columns)-instance-method","name":"update_columns","doc":"Update multiple columns directly in the database without running validations or callbacks.\n\n```\nuser.update_columns(login_count: 10, last_login_at: Time.utc)\nuser.update_columns({status: \"active\", verified: true})\n```\n\n**Warning:** This bypasses:\n- Validations\n- Callbacks\n- Timestamp updates (updated_at will NOT change)\n\nReturns `self` for chaining.","summary":"<p>Update multiple columns directly in the database without running validations or callbacks.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_saving.cr","line_number":396,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_saving.cr#L396"},"def":{"name":"update_columns","double_splat":{"name":"columns","external_name":"columns","restriction":""},"visibility":"Public","body":"if persisted?\nelse\n  raise(\"Model must be persisted before updating columns\")\nend\n\n\n((Lustra::SQL.update(self.class.full_table_name))\n  .set(**columns))\n  .where do (raw(self.class.__pkey__)) == __pkey__ end\n  .execute(@@connection)\n\n\nset(**columns)\nclear_change_flags\n\nself\n"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/HasScope","path":"Lustra/Model/HasScope.html","kind":"module","full_name":"Lustra::Model::HasScope","name":"HasScope","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_scope.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_scope.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}},{"html_id":"lustra/Lustra/Model/HasSerialPkey","path":"Lustra/Model/HasSerialPkey.html","kind":"module","full_name":"Lustra::Model::HasSerialPkey","name":"HasSerialPkey","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_serial_pkey.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_serial_pkey.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"PKEY_TYPE","name":"PKEY_TYPE","value":"{\"bigserial\" => \"column(__name__ : Int64, primary: true, presence: false)\", \"serial\" => \"column(__name__ : Int32, primary: true, presence: false)\", \"text\" => \"column(__name__ : String, primary: true, presence: true)\", \"int\" => \"column(__name__ : Int32, primary: true, presence: true)\", \"bigint\" => \"column(__name__ : Int64, primary: true, presence: true)\", \"uuid\" => \"column(__name__ : UUID, primary: true, presence: true)\\nbefore(:validate) do |m|\\n  if !m.persisted? && (m.as(self)).__name___column.value(nil).nil?\\n    (m.as(self)).__name__ = UUID.random\\n  end\\nend\\n\"} of Nil => Nil"}],"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"macros":[{"html_id":"add_pkey_type(type,&block)-macro","name":"add_pkey_type","doc":"Add a hook for the `primary_key`\nIn the hook, __name__ will be replaced by the column name required by calling primary_key\n\n## Example\n\n```\nLustra::Model::HasSerialPkey.add_pkey_type(\"awesomepkeysystem\") do\n  column __name__ : AwesomePkey, primary: true, presence: false\n\n  before_validate do\n    # ...\n  end\nend\n```","summary":"<p>Add a hook for the <code><a href=\"../../Lustra/Model/HasSerialPkey.html#primary_key%28name%3D%22id%22%2Ctype%3D%3Abigserial%29-macro\">primary_key</a></code> In the hook, <strong>name</strong> will be replaced by the column name required by calling primary_key</p>","abstract":false,"args":[{"name":"type","external_name":"type","restriction":""}],"args_string":"(type, &block)","args_html":"(type, &block)","location":{"filename":"src/lustra/model/modules/has_serial_pkey.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_serial_pkey.cr#L41"},"def":{"name":"add_pkey_type","args":[{"name":"type","external_name":"type","restriction":""}],"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"    \n{% PKEY_TYPE[type] = \"#{block.body}\" %}\n\n  \n"}},{"html_id":"primary_key(name=\"id\",type=:bigserial)-macro","name":"primary_key","doc":"Macro used to define serializable primary keys.\nCurrently support `bigserial`, `serial` and `uuid`.\n\nFor `bigserial` and `serial`, let to PostgreSQL the handling of sequence numbers.\nFor `uuid`, will generate a new `UUID` number on creation.","summary":"<p>Macro used to define serializable primary keys.</p>","abstract":false,"args":[{"name":"name","default_value":"\"id\"","external_name":"name","restriction":""},{"name":"type","default_value":":bigserial","external_name":"type","restriction":""}],"args_string":"(name = \"id\", type = :bigserial)","args_html":"(name = <span class=\"s\">&quot;id&quot;</span>, type = <span class=\"n\">:bigserial</span>)","location":{"filename":"src/lustra/model/modules/has_serial_pkey.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_serial_pkey.cr#L11"},"def":{"name":"primary_key","args":[{"name":"name","default_value":"\"id\"","external_name":"name","restriction":""},{"name":"type","default_value":":bigserial","external_name":"type","restriction":""}],"visibility":"Public","body":"    \n# Transform symbols to string\n\n    \n{%\n  name = \"#{name.id}\"\n  type = \"#{type.id}\"\n%}\n\n\n    \n{% cb = PKEY_TYPE[type] %}\n\n\n    \n{% if cb %}\n      {{ (cb.gsub(/__name__/, name)).id }}\n    {% else %}\n      {% raise(\"Cannot define primary key of type #{type}. Candidates are: #{PKEY_TYPE.keys.join(\", \")}\") %}\n    {% end %}\n\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasTimestamps","path":"Lustra/Model/HasTimestamps.html","kind":"module","full_name":"Lustra::Model::HasTimestamps","name":"HasTimestamps","abstract":false,"locations":[{"filename":"src/lustra/model/modules/has_timestamps.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_timestamps.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"macros":[{"html_id":"timestamps-macro","name":"timestamps","doc":"Generate the columns `updated_at` and `created_at`\nThe two column values are automatically set during insertion\n  or update of the model.","summary":"<p>Generate the columns <code>updated_at</code> and <code>created_at</code> The two column values are automatically set during insertion   or update of the model.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_timestamps.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_timestamps.cr#L5"},"def":{"name":"timestamps","visibility":"Public","body":"    column(updated_at : Time)\n    column(created_at : Time)\n\n    before(:validate) do |model|\n      model = model.as(self)\n\n      unless model.persisted?\n        now = Time.local\n        model.created_at = now unless model.created_at_column.defined?\n        model.updated_at = now unless model.updated_at_column.defined?\n      \nend\n    \nend\n\n    after(:validate) do |model|\n      model = model.as(self)\n\n      \n# In the case the updated_at has been changed, we do not override.\n\n      \n# It happens on first insert, in the before validation setup.\n\n      model.updated_at = Time.local if model.changed? && !model.updated_at_column.changed?\n    \nend\n\n    \n# Updates timestamp columns without triggering validations or callbacks.\n\n    \n#\n\n    \n# ```\n\n    \n# user.touch             # Updates updated_at\n\n    \n# user.touch(2.days.ago) # Updates updated_at to specific time\n\n    \n# ```\n\n    def touch(time : Time = Time.local) : Lustra::Model\n      raise Lustra::Model::Error.new(\"Model must be persisted before touching\") unless persisted?\n\n      update_columns(updated_at: time)\n\n      self\n    \nend\n\n    \n# Updates the specified column and updated_at without triggering validations or callbacks.\n\n    \n#\n\n    \n# ```\n\n    \n# user.touch(:last_login_at) # Updates last_login_at and updated_at\n\n    \n# user.touch(:last_seen_at, 1.hour.ago)\n\n    \n# ```\n\n    def touch(column : Symbol | String, time : Time = Time.local) : Lustra::Model\n      raise Lustra::Model::Error.new(\"Model must be persisted before touching\") unless persisted?\n\n      column_name = column.to_s\n\n      \n# Update the specified column and updated_at (unless the column is updated_at itself)\n\n      if column_name == \"updated_at\"\n        update_columns(updated_at: time)\n      \nelse\n        updates = \n{column_name => time, \"updated_at\" => time} of String => Lustra::SQL::Any\n        update_columns(updates)\n      \nend\n\n      self\n    \nend\n\n    \n# Updates multiple timestamp columns without triggering validations or callbacks.\n\n    \n#\n\n    \n# ```\n\n    \n# user.touch([:last_login_at, :last_seen_at])\n\n    \n# user.touch([:last_login_at, :last_seen_at], 3.days.ago)\n\n    \n# ```\n\n    def touch(columns : Array(Symbol | String), time : Time = Time.local) : Lustra::Model\n      raise Lustra::Model::Error.new(\"Model must be persisted before touching\") unless persisted?\n\n      updates = \n{} of String => Lustra::SQL::Any\n      columns.each do |column|\n        updates[column.to_s] = time\n      \nend\n\n      \n# Also update updated_at unless it was explicitly included\n\n      unless columns.any? \n{ |c| c.to_s == \"updated_at\" }\n        updates[\"updated_at\"] = time\n      \nend\n\n      update_columns(updates)\n\n      self\n    \nend\n\n    \n# Updates multiple timestamp columns at once.\n\n    \n#\n\n    \n# ```\n\n    \n# user.touch(:last_login_at, :last_seen_at)\n\n    \n# user.touch(:last_login_at, :last_seen_at, time: 1.day.ago)\n\n    \n# ```\n\n    def touch(*columns, time : Time = Time.local) : Lustra::Model\n      touch(columns.to_a, time)\n    \nend\n  \n"}}]},{"html_id":"lustra/Lustra/Model/HasValidation","path":"Lustra/Model/HasValidation.html","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/Validation/Helper","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper"}],"locations":[{"filename":"src/lustra/model/modules/has_validation.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/Validation/Helper","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper"}],"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"instance_methods":[{"html_id":"add_error(column,reason)-instance-method","name":"add_error","doc":"Add validation error related to a specific column","summary":"<p>Add validation error related to a specific column</p>","abstract":false,"args":[{"name":"column","external_name":"column","restriction":""},{"name":"reason","external_name":"reason","restriction":""}],"args_string":"(column, reason)","args_html":"(column, reason)","location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L15"},"def":{"name":"add_error","args":[{"name":"column","external_name":"column","restriction":""},{"name":"reason","external_name":"reason","restriction":""}],"visibility":"Public","body":"@errors << Error.new(reason: reason, column: column.to_s)"},"external_var":false},{"html_id":"add_error(reason)-instance-method","name":"add_error","doc":"Add validation error not related to a specific column","summary":"<p>Add validation error not related to a specific column</p>","abstract":false,"args":[{"name":"reason","external_name":"reason","restriction":""}],"args_string":"(reason)","args_html":"(reason)","location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L10"},"def":{"name":"add_error","args":[{"name":"reason","external_name":"reason","restriction":""}],"visibility":"Public","body":"@errors << Error.new(reason: reason, column: nil)"},"external_var":false},{"html_id":"clear_errors-instance-method","name":"clear_errors","doc":"Clear the errors log (if any) of the model and return itself","summary":"<p>Clear the errors log (if any) of the model and return itself</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L26"},"def":{"name":"clear_errors","visibility":"Public","body":"@errors.clear\n\nself\n"},"external_var":false},{"html_id":"error?-instance-method","name":"error?","doc":"Return `true` if saving has been declined because of validation issues.\nThe error list can be found by calling `Lustra::Model#errors`","summary":"<p>Return <code>true</code> if saving has been declined because of validation issues.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L21"},"def":{"name":"error?","visibility":"Public","body":"!@errors.empty?"},"external_var":false},{"html_id":"errors:Array(Error)-instance-method","name":"errors","doc":"List of errors raised during validation, in case the model hasn't been saved properly.","summary":"<p>List of errors raised during validation, in case the model hasn't been saved properly.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L7"},"def":{"name":"errors","return_type":"Array(Error)","visibility":"Public","body":"@errors"},"external_var":false},{"html_id":"print_errors-instance-method","name":"print_errors","doc":"Print the errors in string. Useful for debugging or simple error handling.","summary":"<p>Print the errors in string.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L33"},"def":{"name":"print_errors","visibility":"Public","body":"@errors.group_by(&.column).to_a.sort do |__temp_146, __temp_147| f1, _ = __temp_146\nf2, _ = __temp_147\n(f1 || \"\") <=> (f2 || \"\")\n end.join(\"\\n\") do |column, errors|\n  [column, errors.join(\", \", &.reason)].compact.join(\": \")\nend"},"external_var":false},{"html_id":"valid!-instance-method","name":"valid!","doc":"Check whether the model is valid. If not, raise `InvalidModelError`.\nReturn the model itself","summary":"<p>Check whether the model is valid.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":47,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L47"},"def":{"name":"valid!","visibility":"Public","body":"if valid?\nelse\n  raise(InvalidError.new(self))\nend\n\nself\n"},"external_var":false},{"html_id":"valid?-instance-method","name":"valid?","doc":"Return `true` if the model","summary":"<p>Return <code>true</code> if the model</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L54"},"def":{"name":"valid?","visibility":"Public","body":"clear_errors\n\nwith_triggers(:validate) do\n  validate\n  validate_fields_presence\nend\n\n!error?\n"},"external_var":false},{"html_id":"validate-instance-method","name":"validate","doc":"This method is called whenever `valid?` or `save` is called.\nBy default, `validate` is empty and must be overriden by your own validation code.","summary":"<p>This method is called whenever <code><a href=\"../../Lustra/Model/HasValidation.html#valid%3F-instance-method\">#valid?</a></code> or <code>save</code> is called.</p>","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":41,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L41"},"def":{"name":"validate","visibility":"Public","body":""},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Model/HasValidation/Error","path":"Lustra/Model/HasValidation/Error.html","kind":"struct","full_name":"Lustra::Model::HasValidation::Error","name":"Error","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/modules/has_validation.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"},"constructors":[{"html_id":"new(reason:String,column:String|Nil)-class-method","name":"new","abstract":false,"args":[{"name":"reason","external_name":"reason","restriction":"String"},{"name":"column","external_name":"column","restriction":"String | ::Nil"}],"args_string":"(reason : String, column : String | Nil)","args_html":"(reason : String, column : String | Nil)","location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L4"},"def":{"name":"new","args":[{"name":"reason","external_name":"reason","restriction":"String"},{"name":"column","external_name":"column","restriction":"String | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(reason, column)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L4"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@reason.clone, @column.clone)"},"external_var":false},{"html_id":"column:String|Nil-instance-method","name":"column","abstract":false,"def":{"name":"column","return_type":"String | ::Nil","visibility":"Public","body":"@column"},"external_var":false},{"html_id":"copy_with(reason_reason=@reason,column_column=@column)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_reason","default_value":"@reason","external_name":"reason","restriction":""},{"name":"_column","default_value":"@column","external_name":"column","restriction":""}],"args_string":"(reason _reason = @reason, column _column = @column)","args_html":"(reason _reason = @reason, column _column = @column)","location":{"filename":"src/lustra/model/modules/has_validation.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/has_validation.cr#L4"},"def":{"name":"copy_with","args":[{"name":"_reason","default_value":"@reason","external_name":"reason","restriction":""},{"name":"_column","default_value":"@column","external_name":"column","restriction":""}],"visibility":"Public","body":"self.class.new(_reason, _column)"},"external_var":false},{"html_id":"reason:String-instance-method","name":"reason","abstract":false,"def":{"name":"reason","return_type":"String","visibility":"Public","body":"@reason"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Model/InvalidError","path":"Lustra/Model/InvalidError.html","kind":"class","full_name":"Lustra::Model::InvalidError","name":"InvalidError","abstract":false,"superclass":{"html_id":"lustra/Lustra/Model/Error","kind":"class","full_name":"Lustra::Model::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/Model/Error","kind":"class","full_name":"Lustra::Model::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/errors.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"constructors":[{"html_id":"new(model:Lustra::Model)-class-method","name":"new","abstract":false,"args":[{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"args_string":"(model : Lustra::Model)","args_html":"(model : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>)","location":{"filename":"src/lustra/model/errors.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L7"},"def":{"name":"new","args":[{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"visibility":"Public","body":"_ = allocate\n_.initialize(model)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"model:Lustra::Model-instance-method","name":"model","abstract":false,"location":{"filename":"src/lustra/model/errors.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L5"},"def":{"name":"model","return_type":"Lustra::Model","visibility":"Public","body":"@model"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/JSONDeserialize","path":"Lustra/Model/JSONDeserialize.html","kind":"module","full_name":"Lustra::Model::JSONDeserialize","name":"JSONDeserialize","abstract":false,"locations":[{"filename":"src/lustra/model/json_deserialize.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/json_deserialize.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"This module declare all the methods and macro related to deserializing json in `Lustra::Model`","summary":"<p>This module declare all the methods and macro related to deserializing json in <code><a href=\"../../Lustra/Model.html\">Lustra::Model</a></code></p>"},{"html_id":"lustra/Lustra/Model/QueryCache","path":"Lustra/Model/QueryCache.html","kind":"class","full_name":"Lustra::Model::QueryCache","name":"QueryCache","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/query_cache.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L9"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"doc":"The Lustra::Model::QueryCache\nis a __fire-and-forget__ cache used when caching associations and preventing N+1 queries anti-pattern.\n\nThis is not a global cache: One cache instance exists per collection, and the cache\ndisappear at the same time the Collection is unreferenced.\n\nEach cache can references multiples relations at the same time.\nThis cache use an underlying hash to access to the references keys.","summary":"<p>The Lustra::Model::QueryCache is a <strong>fire-and-forget</strong> cache used when caching associations and preventing N+1 queries anti-pattern.</p>","instance_methods":[{"html_id":"active(relation_name)-instance-method","name":"active","doc":"Tell this cache than we active the cache over a specific relation name.\nReturns `self`","summary":"<p>Tell this cache than we active the cache over a specific relation name.</p>","abstract":false,"args":[{"name":"relation_name","external_name":"relation_name","restriction":""}],"args_string":"(relation_name)","args_html":"(relation_name)","location":{"filename":"src/lustra/model/query_cache.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L28"},"def":{"name":"active","args":[{"name":"relation_name","external_name":"relation_name","restriction":""}],"visibility":"Public","body":"@cache_activation.add(relation_name)\n\nself\n"},"external_var":false},{"html_id":"active?(relation_name)-instance-method","name":"active?","doc":"Check whether the cache is active on a certain association.\nReturns `true` if `relation_name` is flagged as encached, or `false` otherwise.","summary":"<p>Check whether the cache is active on a certain association.</p>","abstract":false,"args":[{"name":"relation_name","external_name":"relation_name","restriction":""}],"args_string":"(relation_name)","args_html":"(relation_name)","location":{"filename":"src/lustra/model/query_cache.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L36"},"def":{"name":"active?","args":[{"name":"relation_name","external_name":"relation_name","restriction":""}],"visibility":"Public","body":"@cache_activation.includes?(relation_name)"},"external_var":false},{"html_id":"clear-instance-method","name":"clear","doc":"Empty the cache and flag all relations has unactive","summary":"<p>Empty the cache and flag all relations has unactive</p>","abstract":false,"location":{"filename":"src/lustra/model/query_cache.cr","line_number":70,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L70"},"def":{"name":"clear","visibility":"Public","body":"@cache.clear\n@cache_activation.clear\n"},"external_var":false},{"html_id":"fetch-instance-method","name":"fetch","abstract":false,"location":{"filename":"src/lustra/model/query_cache.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L22"},"def":{"name":"fetch","visibility":"Public","body":"query"},"external_var":false},{"html_id":"hit(relation_name,relation_value,klass:T.class):Array(T)forallT-instance-method","name":"hit","doc":"Try to hit the cache. If an array is found, it will be returned.\nOtherwise, empty array is returned.\n\nThis methods do not check if a relation flagged as is actively cached or not. Therefore, hitting a non-cached\nrelation will return always an empty-array.","summary":"<p>Try to hit the cache.</p>","abstract":false,"args":[{"name":"relation_name","external_name":"relation_name","restriction":""},{"name":"relation_value","external_name":"relation_value","restriction":""},{"name":"klass","external_name":"klass","restriction":"T.class"}],"args_string":"(relation_name, relation_value, klass : T.class) : Array(T) forall T","args_html":"(relation_name, relation_value, klass : <span class=\"t\">T</span>.<span class=\"k\">class</span>) : Array(T) forall T","location":{"filename":"src/lustra/model/query_cache.cr","line_number":45,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L45"},"def":{"name":"hit","args":[{"name":"relation_name","external_name":"relation_name","restriction":""},{"name":"relation_value","external_name":"relation_value","restriction":""},{"name":"klass","external_name":"klass","restriction":"T.class"}],"return_type":"Array(T)","visibility":"Public","body":"(@cache.fetch(CacheKey.new(relation_name, relation_value, T.name)) do\n  [] of T\nend).unsafe_as(Array(T))"},"external_var":false},{"html_id":"set(relation_name,relation_value,arr:Array(T))forallT-instance-method","name":"set","doc":"Set the cached array for a specific key `{relation_name,relation_value}`","summary":"<p>Set the cached array for a specific key <code>{relation_name,relation_value}</code></p>","abstract":false,"args":[{"name":"relation_name","external_name":"relation_name","restriction":""},{"name":"relation_value","external_name":"relation_value","restriction":""},{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"args_string":"(relation_name, relation_value, arr : Array(T)) forall T","args_html":"(relation_name, relation_value, arr : Array(T)) forall T","location":{"filename":"src/lustra/model/query_cache.cr","line_number":52,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L52"},"def":{"name":"set","args":[{"name":"relation_name","external_name":"relation_name","restriction":""},{"name":"relation_value","external_name":"relation_value","restriction":""},{"name":"arr","external_name":"arr","restriction":"Array(T)"}],"visibility":"Public","body":"@cache[CacheKey.new(relation_name, relation_value, T.name)] = arr.unsafe_as(Pointer(Nil))"},"external_var":false},{"html_id":"with_cache(&)-instance-method","name":"with_cache","doc":"Perform some operations with the cache then eventually clear the cache.","summary":"<p>Perform some operations with the cache then eventually clear the cache.</p>","abstract":false,"location":{"filename":"src/lustra/model/query_cache.cr","line_number":63,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/query_cache.cr#L63"},"def":{"name":"with_cache","yields":0,"block_arity":0,"visibility":"Public","body":"begin\n  yield\nensure\n  clear\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/ReadOnlyError","path":"Lustra/Model/ReadOnlyError.html","kind":"class","full_name":"Lustra::Model::ReadOnlyError","name":"ReadOnlyError","abstract":false,"superclass":{"html_id":"lustra/Lustra/Model/Error","kind":"class","full_name":"Lustra::Model::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/Model/Error","kind":"class","full_name":"Lustra::Model::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/errors.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L12"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},"constructors":[{"html_id":"new(model:Lustra::Model)-class-method","name":"new","abstract":false,"args":[{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"args_string":"(model : Lustra::Model)","args_html":"(model : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>)","location":{"filename":"src/lustra/model/errors.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L15"},"def":{"name":"new","args":[{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"visibility":"Public","body":"_ = allocate\n_.initialize(model)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"model:Lustra::Model-instance-method","name":"model","abstract":false,"location":{"filename":"src/lustra/model/errors.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/errors.cr#L13"},"def":{"name":"model","return_type":"Lustra::Model","visibility":"Public","body":"@model"},"external_var":false}]},{"html_id":"lustra/Lustra/Model/Relations","path":"Lustra/Model/Relations.html","kind":"module","full_name":"Lustra::Model::Relations","name":"Relations","abstract":false,"locations":[{"filename":"src/lustra/model/modules/relations/belongs_to_macro.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/modules/relations/belongs_to_macro.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}}]},{"html_id":"lustra/Lustra/Reflection","path":"Lustra/Reflection.html","kind":"module","full_name":"Lustra::Reflection","name":"Reflection","abstract":false,"locations":[{"filename":"src/lustra/model/reflection/column.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"types":[{"html_id":"lustra/Lustra/Reflection/Column","path":"Lustra/Reflection/Column.html","kind":"class","full_name":"Lustra::Reflection::Column","name":"Column","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},{"html_id":"lustra/Lustra/Model/FullTextSearchable","kind":"module","full_name":"Lustra::Model::FullTextSearchable","name":"FullTextSearchable"},{"html_id":"lustra/Lustra/Model/JSONDeserialize","kind":"module","full_name":"Lustra::Model::JSONDeserialize","name":"JSONDeserialize"},{"html_id":"lustra/Lustra/Model/Initializer","kind":"module","full_name":"Lustra::Model::Initializer","name":"Initializer"},{"html_id":"lustra/Lustra/Model/HasFactory","kind":"module","full_name":"Lustra::Model::HasFactory","name":"HasFactory"},{"html_id":"lustra/Lustra/Model/ClassMethods","kind":"module","full_name":"Lustra::Model::ClassMethods","name":"ClassMethods"},{"html_id":"lustra/Lustra/Model/HasScope","kind":"module","full_name":"Lustra::Model::HasScope","name":"HasScope"},{"html_id":"lustra/Lustra/Model/HasRelations","kind":"module","full_name":"Lustra::Model::HasRelations","name":"HasRelations"},{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"},{"html_id":"lustra/Lustra/Validation/Helper","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper"},{"html_id":"lustra/Lustra/Model/HasSaving","kind":"module","full_name":"Lustra::Model::HasSaving","name":"HasSaving"},{"html_id":"lustra/Lustra/Model/HasSerialPkey","kind":"module","full_name":"Lustra::Model::HasSerialPkey","name":"HasSerialPkey"},{"html_id":"lustra/Lustra/Model/HasTimestamps","kind":"module","full_name":"Lustra::Model::HasTimestamps","name":"HasTimestamps"},{"html_id":"lustra/Lustra/Model/HasColumns","kind":"module","full_name":"Lustra::Model::HasColumns","name":"HasColumns"},{"html_id":"lustra/Lustra/Model/HasHooks","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks"},{"html_id":"lustra/Lustra/Model/Connection","kind":"module","full_name":"Lustra::Model::Connection","name":"Connection"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/reflection/column.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"COLUMNS","name":"COLUMNS","value":"{\"table_catalog\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_catalog\", crystal_variable_name: table_catalog, presence: true, mass_assign: true}, \"table_schema\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_schema\", crystal_variable_name: table_schema, presence: true, mass_assign: true}, \"table_name\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_name\", crystal_variable_name: table_name, presence: false,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  mass_assign: true}, \"column_name\" => {type: String, primary: true, converter: \"String\", db_column_name: \"column_name\", crystal_variable_name: column_name, presence: true, mass_assign: true}} of Nil => Nil"},{"id":"POLYMORPHISM_SETTINGS","name":"POLYMORPHISM_SETTINGS","value":"{} of Nil => Nil"}],"included_modules":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"extended_modules":[{"html_id":"lustra/Lustra/Model/HasHooks/ClassMethods","kind":"module","full_name":"Lustra::Model::HasHooks::ClassMethods","name":"ClassMethods"}],"namespace":{"html_id":"lustra/Lustra/Reflection","kind":"module","full_name":"Lustra::Reflection","name":"Reflection"},"doc":"Reflection of the columns using information_schema in postgreSQL.\nTODO: Usage of view instead of model","summary":"<p>Reflection of the columns using information_schema in postgreSQL.</p>","class_methods":[{"html_id":"build(**tuple:**T)forallT-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":"**T"},"visibility":"Public","body":"{% if T.size > 0 %}\n          self.new(tuple)\n        {% else %}\n          self.new\n        {% end %}"},"external_var":false},{"html_id":"build(**tuple)-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"build(**tuple) do\nend"},"external_var":false},{"html_id":"build(**tuple,&)-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"visibility":"Public","body":"r = build(**tuple)\n\nyield(r)\n\nr\n"},"external_var":false},{"html_id":"columns-class-method","name":"columns","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"columns","visibility":"Public","body":"@@columns"},"external_var":false},{"html_id":"connection:String-class-method","name":"connection","doc":"Define on which connection the model is living. Useful in case of models living in different databases.\n\nIs set to \"default\" by default.\n\nSee `Lustra::SQL#init(URI, *opts)` for more information about multi-connections.\n\nExample:\n\n```\nLustra::SQL.init(\"postgres://postgres@localhost/database_1\")\nLustra::SQL.init(\"secondary\", \"postgres://postgres@localhost/database_2\")\n\nclass ModelA\n  include Lustra::Model\n\n  # Performs all the queries on `database_1`\n  # self.connection = \"default\"\n  column id : Int32, primary: true, presence: false\n  column title : String\nend\n\nclass ModelB\n  include Lustra::Model\n\n  # Performs all the queries on `database_2`\n  self.connection = \"secondary\"\n\n  column id : Int32, primary: true, presence: false\nend\n```","summary":"<p>Define on which connection the model is living.</p>","abstract":false,"def":{"name":"connection","return_type":"String","visibility":"Public","body":"@@connection"},"external_var":false},{"html_id":"connection=(connection:String)-class-method","name":"connection=","doc":"Define on which connection the model is living. Useful in case of models living in different databases.\n\nIs set to \"default\" by default.\n\nSee `Lustra::SQL#init(URI, *opts)` for more information about multi-connections.\n\nExample:\n\n```\nLustra::SQL.init(\"postgres://postgres@localhost/database_1\")\nLustra::SQL.init(\"secondary\", \"postgres://postgres@localhost/database_2\")\n\nclass ModelA\n  include Lustra::Model\n\n  # Performs all the queries on `database_1`\n  # self.connection = \"default\"\n  column id : Int32, primary: true, presence: false\n  column title : String\nend\n\nclass ModelB\n  include Lustra::Model\n\n  # Performs all the queries on `database_2`\n  self.connection = \"secondary\"\n\n  column id : Int32, primary: true, presence: false\nend\n```","summary":"<p>Define on which connection the model is living.</p>","abstract":false,"args":[{"name":"connection","external_name":"connection","restriction":"String"}],"args_string":"(connection : String)","args_html":"(connection : String)","def":{"name":"connection=","args":[{"name":"connection","external_name":"connection","restriction":"String"}],"visibility":"Public","body":"@@connection = connection"},"external_var":false},{"html_id":"create_from_json(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"create_from_json","doc":"Create a new model from json and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new model from json and save it.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"create_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"mdl = self.from_json(string_or_io, trusted)\nmdl.save\nmdl\n"},"external_var":false},{"html_id":"create_from_json!(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"create_from_json!","doc":"Create a new model from json and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new model from json and save it.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"create_from_json!","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(self.from_json(string_or_io, trusted)).save!"},"external_var":false},{"html_id":"find(ids:Array)-class-method","name":"find","doc":"Find multiple models by an array of primary keys.\nReturns an array of models (may be empty if none found).\n\n```\nusers = User.find([1, 2, 3])\nusers.size # => 0..3 depending on how many were found\n```","summary":"<p>Find multiple models by an array of primary keys.</p>","abstract":false,"args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"args_string":"(ids : Array)","args_html":"(ids : Array)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find","args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"visibility":"Public","body":"query.where do (raw(__pkey__)).in?(ids) end.to_a"},"external_var":false},{"html_id":"find(x)-class-method","name":"find","doc":"Returns a model using primary key equality\nReturns `nil` if not found.","summary":"<p>Returns a model using primary key equality Returns <code>nil</code> if not found.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"query.where do (raw(__pkey__)) == x end.first"},"external_var":false},{"html_id":"find!(ids:Array)-class-method","name":"find!","doc":"Find multiple models by an array of primary keys.\nRaises error if ANY of the IDs are not found.\n\n```\nusers = User.find!([1, 2, 3]) # Raises if any ID is not found\n```","summary":"<p>Find multiple models by an array of primary keys.</p>","abstract":false,"args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"args_string":"(ids : Array)","args_html":"(ids : Array)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find!","args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"visibility":"Public","body":"results = find(ids)\nif results.size != ids.size\n  raise(Lustra::SQL::RecordNotFoundError.new(\"Couldn't find all records with IDs: #{ids.inspect}\"))\nend\nresults\n"},"external_var":false},{"html_id":"find!(x)-class-method","name":"find!","doc":"Returns a model using primary key equality.\nRaises error if the model is not found.","summary":"<p>Returns a model using primary key equality.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find!","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"(find(x)) || (raise(Lustra::SQL::RecordNotFoundError.new))"},"external_var":false},{"html_id":"find_by(tuple:NamedTuple)-class-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `query.find(**tuple)` with better naming.\n\n```\nuser = User.find_by(email: \"test@example.com\")\nuser = User.find_by(first_name: \"John\", last_name: \"Doe\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find_by","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"query.find(tuple)"},"external_var":false},{"html_id":"find_by(**tuple)-class-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `query.find(**tuple)` with better naming.\n\n```\nuser = User.find_by(email: \"test@example.com\")\nuser = User.find_by(first_name: \"John\", last_name: \"Doe\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find_by","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"query.find(**tuple)"},"external_var":false},{"html_id":"find_by!(tuple:NamedTuple)-class-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `query.find!(**tuple)` with better naming.\n\n```\nuser = User.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find_by!","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"query.find!(tuple)"},"external_var":false},{"html_id":"find_by!(**tuple)-class-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `query.find!(**tuple)` with better naming.\n\n```\nuser = User.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"find_by!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"query.find!(**tuple)"},"external_var":false},{"html_id":"from_json(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"from_json","doc":"Create a new empty model and fill the columns from json. Returns the new model\n\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new empty model and fill the columns from json.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(Assigner.from_json(string_or_io)).create(trusted)"},"external_var":false},{"html_id":"full_table_name-class-method","name":"full_table_name","doc":"returns the fully qualified and escaped name for this table.\nadd schema if schema is different from 'public' (default schema)\n\nex: \"schema\".\"table\"","summary":"<p>returns the fully qualified and escaped name for this table.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"full_table_name","visibility":"Public","body":"if s = schema\n  {schema, table}.map do |x| Lustra::SQL.escape(x.to_s) end.join(\".\")\nelse\n  Lustra::SQL.escape(table)\nend"},"external_var":false},{"html_id":"import(array:Enumerable(self),on_conflict:Lustra::SQL::InsertQuery->|Nil=nil)-class-method","name":"import","doc":"Import a bulk of models in one SQL insert query.\nEach model must be non-persisted.\n\n`on_conflict` callback can be optionnaly turned on\nto manage constraints of the database.\n\nNote: Old models are not modified. This method return a copy of the\nmodels as saved in the database.\n\n## Example:\n\n```\nusers = [User.new(id: 1), User.new(id: 2), User.new(id: 3)]\nusers = User.import(users)\n```","summary":"<p>Import a bulk of models in one SQL insert query.</p>","abstract":false,"args":[{"name":"array","external_name":"array","restriction":"Enumerable(self)"},{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"args_string":"(array : Enumerable(self), on_conflict : Lustra::SQL::InsertQuery ->  | Nil = nil)","args_html":"(array : Enumerable(<span class=\"k\">self</span>), on_conflict : <a href=\"../../Lustra/SQL/InsertQuery.html\">Lustra::SQL::InsertQuery</a> ->  | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"import","args":[{"name":"array","external_name":"array","restriction":"Enumerable(self)"},{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"visibility":"Public","body":"array.each do |item|\n  if item.persisted?\n    raise(\"One of your model is persisted while calling import\")\n  end\nend\n\nhashes = array.map do |item|\n  item.trigger_before_events(:save)\n  if item.valid?\n  else\n    raise(\"import: Validation failed for `#{item}`\")\n  end\n  item.trigger_before_events(:create)\n  item.to_h\nend\n\nquery = (Lustra::SQL.insert_into(self.table, hashes)).returning(\"*\")\nif on_conflict\n  on_conflict.call(query)\nend\n\no = [] of self\nquery.fetch(@@connection) do |hash|\n  o << ((Lustra::Model::Factory.build(self.name, hash, persisted: true, fetch_columns: false, cache: nil)).as(self))\nend\n\no.each(&.trigger_after_events(:create))\no.each(&.trigger_after_events(:save))\n\no\n"},"external_var":false},{"html_id":"polymorphic?:Bool-class-method","name":"polymorphic?","abstract":false,"def":{"name":"polymorphic?","return_type":"Bool","visibility":"Public","body":"@@polymorphic"},"external_var":false},{"html_id":"query-class-method","name":"query","doc":"Return a new query `SELECT * FROM [my_model_table]`. Can be refined after that.\nAutomatically applies default_scope if defined.","summary":"<p>Return a new query <code>SELECT * FROM [my_model_table]</code>.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"query","visibility":"Public","body":"q = (Collection.new.use_connection(connection)).from(self.full_table_name)\n\nq.responds_to?(:__apply_default_scope__) ? q.__apply_default_scope__ : q\n"},"external_var":false},{"html_id":"read_only=(read_only:Bool)-class-method","name":"read_only=","abstract":false,"args":[{"name":"read_only","external_name":"read_only","restriction":"Bool"}],"args_string":"(read_only : Bool)","args_html":"(read_only : Bool)","def":{"name":"read_only=","args":[{"name":"read_only","external_name":"read_only","restriction":"Bool"}],"visibility":"Public","body":"@@read_only = read_only"},"external_var":false},{"html_id":"read_only?:Bool-class-method","name":"read_only?","abstract":false,"def":{"name":"read_only?","return_type":"Bool","visibility":"Public","body":"@@read_only"},"external_var":false},{"html_id":"register_counter_cache(association_model:Class,counter_column:String,foreign_key:String)-class-method","name":"register_counter_cache","doc":"Register a counter cache for this model using model class","summary":"<p>Register a counter cache for this model using model class</p>","abstract":false,"args":[{"name":"association_model","external_name":"association_model","restriction":"Class"},{"name":"counter_column","external_name":"counter_column","restriction":"String"},{"name":"foreign_key","external_name":"foreign_key","restriction":"String"}],"args_string":"(association_model : Class, counter_column : String, foreign_key : String)","args_html":"(association_model : Class, counter_column : String, foreign_key : String)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"register_counter_cache","args":[{"name":"association_model","external_name":"association_model","restriction":"Class"},{"name":"counter_column","external_name":"counter_column","restriction":"String"},{"name":"foreign_key","external_name":"foreign_key","restriction":"String"}],"visibility":"Public","body":"association_name = association_model.table.to_s\n\nCOUNTER_CACHES[association_name] = {\n  counter_column: counter_column,\n  foreign_key: foreign_key,\n}\n"},"external_var":false},{"html_id":"reset_counters(id,*counter_models)-class-method","name":"reset_counters","doc":"Reset counter cache columns to their correct values.\nThis is useful when counter caches become out of sync due to direct SQL operations.\n\nExample:\n```\nUser.reset_counters(user.id, Post)\nUser.reset_counters(user.id, Post, Comment)\n```","summary":"<p>Reset counter cache columns to their correct values.</p>","abstract":false,"args":[{"name":"id","external_name":"id","restriction":""},{"name":"counter_models","external_name":"counter_models","restriction":""}],"args_string":"(id, *counter_models)","args_html":"(id, *counter_models)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"reset_counters","args":[{"name":"id","external_name":"id","restriction":""},{"name":"counter_models","external_name":"counter_models","restriction":""}],"splat_index":1,"visibility":"Public","body":"counter_models.each do |counter_model|\n  association_name = counter_model.table.to_s\n\n  counter_info = COUNTER_CACHES[association_name]?\n\n  if counter_info\n  else\n    raise(\"Counter cache for #{counter_model.name} not found for #{self.name}\")\n  end\n\n\n  actual_count = ((Lustra::SQL\n    .select(\"COUNT(*)\"))\n    .from(association_name))\n    .where do (raw(counter_info[:foreign_key])) == id end\n    .scalar(Int64)\n\n\n  update_counters(id, {counter_info[:counter_column] => actual_count})\nend"},"external_var":false},{"html_id":"schema:Lustra::SQL::Symbolic|Nil-class-method","name":"schema","doc":"Define the current schema used in PostgreSQL. The value is `nil` by default, which lead to non-specified\n  schema during the querying, and usage of \"public\" by PostgreSQL.\n\nThis property can be redefined on initialization. Example:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.schema = \"my_schema\"\nend\nMyModel.query.to_sql # SELECT * FROM \"my_schema\".\"my_models\"\n```","summary":"<p>Define the current schema used in PostgreSQL.</p>","abstract":false,"def":{"name":"schema","return_type":"Lustra::SQL::Symbolic | ::Nil","visibility":"Public","body":"@@schema"},"external_var":false},{"html_id":"schema=(schema:Lustra::SQL::Symbolic|Nil)-class-method","name":"schema=","doc":"Define the current schema used in PostgreSQL. The value is `nil` by default, which lead to non-specified\n  schema during the querying, and usage of \"public\" by PostgreSQL.\n\nThis property can be redefined on initialization. Example:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.schema = \"my_schema\"\nend\nMyModel.query.to_sql # SELECT * FROM \"my_schema\".\"my_models\"\n```","summary":"<p>Define the current schema used in PostgreSQL.</p>","abstract":false,"args":[{"name":"schema","external_name":"schema","restriction":"Lustra::SQL::Symbolic | ::Nil"}],"args_string":"(schema : Lustra::SQL::Symbolic | Nil)","args_html":"(schema : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a> | Nil)","def":{"name":"schema=","args":[{"name":"schema","external_name":"schema","restriction":"Lustra::SQL::Symbolic | ::Nil"}],"visibility":"Public","body":"@@schema = schema"},"external_var":false},{"html_id":"table:Lustra::SQL::Symbolic-class-method","name":"table","doc":"Return the table name setup for this model.\nBy convention, the class name is by default equals to the pluralized underscored string form of the model name.\nExample:\n\n```\nMyModel => \"my_models\"\nPerson => \"people\"\nProject::Info => \"project_infos\"\n```\n\nThe property can be updated at initialization to a custom table name:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.table = \"another_table_name\"\nend\nMyModel.query.to_sql # SELECT * FROM \"another_table_name\"\n```","summary":"<p>Return the table name setup for this model.</p>","abstract":false,"def":{"name":"table","return_type":"Lustra::SQL::Symbolic","visibility":"Public","body":"@@table"},"external_var":false},{"html_id":"table=(table:Lustra::SQL::Symbolic)-class-method","name":"table=","doc":"Return the table name setup for this model.\nBy convention, the class name is by default equals to the pluralized underscored string form of the model name.\nExample:\n\n```\nMyModel => \"my_models\"\nPerson => \"people\"\nProject::Info => \"project_infos\"\n```\n\nThe property can be updated at initialization to a custom table name:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.table = \"another_table_name\"\nend\nMyModel.query.to_sql # SELECT * FROM \"another_table_name\"\n```","summary":"<p>Return the table name setup for this model.</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Lustra::SQL::Symbolic"}],"args_string":"(table : Lustra::SQL::Symbolic)","args_html":"(table : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>)","def":{"name":"table=","args":[{"name":"table","external_name":"table","restriction":"Lustra::SQL::Symbolic"}],"visibility":"Public","body":"@@table = table"},"external_var":false}],"constructors":[{"html_id":"build(x:NamedTuple):self-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"build(**x) do\nend"},"external_var":false},{"html_id":"build(x:NamedTuple,&block:self->Nil):self-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"build(**x, &block)"},"external_var":false},{"html_id":"create(x:NamedTuple,&block:self->Nil):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"create(**x, &block)"},"external_var":false},{"html_id":"create(**tuple,&block:self->Nil):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"r = build(**tuple) do |mdl|\n  yield(mdl)\nend\n\nr.save\n\nr\n"},"external_var":false},{"html_id":"create(x:NamedTuple):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"create(**x) do\nend"},"external_var":false},{"html_id":"create(**tuple):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"self","visibility":"Public","body":"create(**tuple) do\nend"},"external_var":false},{"html_id":"create!(x:NamedTuple,&block:self->Nil):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"create!(**x, &block)"},"external_var":false},{"html_id":"create!(**tuple,&block:self->Nil):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"r = build(**tuple) do |mdl|\n  yield(mdl)\nend\n\nr.save!\n\nr\n"},"external_var":false},{"html_id":"create!(x:NamedTuple):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"create!(**x) do\nend"},"external_var":false},{"html_id":"create!(**tuple):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"self","visibility":"Public","body":"create!(**tuple) do\nend"},"external_var":false},{"html_id":"new(h:Hash(String,_),cache:Lustra::Model::QueryCache|Nil=nil,persisted=false,fetch_columns=false)-class-method","name":"new","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(h : Hash(String, _), cache : Lustra::Model::QueryCache | Nil = nil, persisted = false, fetch_columns = false)","args_html":"(h : Hash(String, _), cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>, fetch_columns = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"new","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(h, cache, persisted, fetch_columns)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(json:JSON::Any,cache:Lustra::Model::QueryCache|Nil=nil,persisted=false)-class-method","name":"new","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"::JSON::Any"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"args_string":"(json : JSON::Any, cache : Lustra::Model::QueryCache | Nil = nil, persisted = false)","args_html":"(json : JSON::Any, cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"new","args":[{"name":"json","external_name":"json","restriction":"::JSON::Any"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(json, cache, persisted)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(t:NamedTuple,persisted=false)-class-method","name":"new","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"args_string":"(t : NamedTuple, persisted = false)","args_html":"(t : NamedTuple, persisted = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"new","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(t, persisted)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"_cached_table:Lustra::Reflection::Table|Nil-instance-method","name":"_cached_table","abstract":false,"def":{"name":"_cached_table","return_type":"Lustra::Reflection::Table | ::Nil","visibility":"Public","body":"@_cached_table"},"external_var":false},{"html_id":"add_built_association(association_name:String,model:Lustra::Model)-instance-method","name":"add_built_association","doc":"Add a built association to track for autosave","summary":"<p>Add a built association to track for autosave</p>","abstract":false,"args":[{"name":"association_name","external_name":"association_name","restriction":"String"},{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"args_string":"(association_name : String, model : Lustra::Model)","args_html":"(association_name : String, model : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"add_built_association","args":[{"name":"association_name","external_name":"association_name","restriction":"String"},{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"visibility":"Public","body":"__temp_603c9724_1 = association_name\n__temp_603c9724_2 = built_associations\n__temp_603c9724_2[__temp_603c9724_1]? || (__temp_603c9724_2[__temp_603c9724_1] = [] of Lustra::Model)\nbuilt_associations[association_name] << model\n"},"external_var":false},{"html_id":"attributes:Hash(String,Lustra::SQL::Any)-instance-method","name":"attributes","doc":"Attributes, used when fetch_columns is true","summary":"<p>Attributes, used when fetch_columns is true</p>","abstract":false,"def":{"name":"attributes","return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"@attributes"},"external_var":false},{"html_id":"built_associations:Hash(String,Array(Lustra::Model))-instance-method","name":"built_associations","doc":"Track built associations for autosave functionality","summary":"<p>Track built associations for autosave functionality</p>","abstract":false,"def":{"name":"built_associations","return_type":"Hash(String, Array(Lustra::Model))","visibility":"Public","body":"@built_associations"},"external_var":false},{"html_id":"built_associations=(built_associations:Hash(String,Array(Lustra::Model)))-instance-method","name":"built_associations=","doc":"Track built associations for autosave functionality","summary":"<p>Track built associations for autosave functionality</p>","abstract":false,"args":[{"name":"built_associations","external_name":"built_associations","restriction":"Hash(String, Array(Lustra::Model))"}],"args_string":"(built_associations : Hash(String, Array(Lustra::Model)))","args_html":"(built_associations : Hash(String, Array(<a href=\"../../Lustra/Model.html\">Lustra::Model</a>)))","def":{"name":"built_associations=","args":[{"name":"built_associations","external_name":"built_associations","restriction":"Hash(String, Array(Lustra::Model))"}],"visibility":"Public","body":"@built_associations = built_associations"},"external_var":false},{"html_id":"cache:Lustra::Model::QueryCache|Nil-instance-method","name":"cache","abstract":false,"def":{"name":"cache","return_type":"Lustra::Model::QueryCache | ::Nil","visibility":"Public","body":"@cache"},"external_var":false},{"html_id":"changed:Array(String)-instance-method","name":"changed","doc":"Returns an array of names of all changed attributes.\n\n```\nuser.email = \"new@test.com\"\nuser.first_name = \"John\"\nuser.changed  # => [\"email\", \"first_name\"]\n```","summary":"<p>Returns an array of names of all changed attributes.</p>","abstract":false,"def":{"name":"changed","return_type":"Array(String)","visibility":"Public","body":"changed_attrs = [] of String\n\n\nif @table_catalog_column.changed?\n  changed_attrs << \"table_catalog\"\nend\n\nif @table_schema_column.changed?\n  changed_attrs << \"table_schema\"\nend\n\nif @table_name_column.changed?\n  changed_attrs << \"table_name\"\nend\n\nif @column_name_column.changed?\n  changed_attrs << \"column_name\"\nend\n\n\nchanged_attrs\n"},"external_var":false},{"html_id":"changed?-instance-method","name":"changed?","doc":"Return `true` if the model is dirty (e.g. one or more fields\n  have been changed.). Return `false` otherwise.","summary":"<p>Return <code>true</code> if the model is dirty (e.g.</p>","abstract":false,"def":{"name":"changed?","visibility":"Public","body":"if @table_catalog_column.changed?\n  return true\nend\n\nif @table_schema_column.changed?\n  return true\nend\n\nif @table_name_column.changed?\n  return true\nend\n\nif @column_name_column.changed?\n  return true\nend\n\n\nreturn false\n"},"external_var":false},{"html_id":"changes:Hash(String,Tuple(Lustra::SQL::Any,Lustra::SQL::Any))-instance-method","name":"changes","doc":"Returns a hash of all changed attributes with their [old_value, new_value].\n\n```\nuser.email = \"new@test.com\"\nuser.first_name = \"John\"\nuser.changes  # => {\"email\" => [\"old@test.com\", \"new@test.com\"], \"first_name\" => [nil, \"John\"]}\n```","summary":"<p>Returns a hash of all changed attributes with their [old_value, new_value].</p>","abstract":false,"def":{"name":"changes","return_type":"Hash(String, Tuple(Lustra::SQL::Any, Lustra::SQL::Any))","visibility":"Public","body":"changes_hash = {} of String => Tuple(Lustra::SQL::Any, Lustra::SQL::Any)\n\n\nif @table_catalog_column.changed?\n  old_val = @table_catalog_column.old_value\n  new_val = @table_catalog_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_catalog\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @table_schema_column.changed?\n  old_val = @table_schema_column.old_value\n  new_val = @table_schema_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_schema\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @table_name_column.changed?\n  old_val = @table_name_column.old_value\n  new_val = @table_name_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_name\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @column_name_column.changed?\n  old_val = @column_name_column.old_value\n  new_val = @column_name_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"column_name\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\n\nchanges_hash\n"},"external_var":false},{"html_id":"clear_built_associations-instance-method","name":"clear_built_associations","doc":"Clear all built associations (called after successful save)","summary":"<p>Clear all built associations (called after successful save)</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"clear_built_associations","visibility":"Public","body":"built_associations.clear"},"external_var":false},{"html_id":"clear_change_flags-instance-method","name":"clear_change_flags","doc":"Reset the `changed?` flag on all columns\n\nThe model behave like its not dirty anymore\nand call to save would apply no changes.\n\nReturns `self`","summary":"<p>Reset the <code><a href=\"../../Lustra/Reflection/Column.html#changed%3F-instance-method\">#changed?</a></code> flag on all columns</p>","abstract":false,"def":{"name":"clear_change_flags","visibility":"Public","body":"@table_catalog_column.clear_change_flag\n\n@table_schema_column.clear_change_flag\n\n@table_name_column.clear_change_flag\n\n@column_name_column.clear_change_flag\n\n\nself\n"},"external_var":false},{"html_id":"column_name:String-instance-method","name":"column_name","doc":"Returns the value of `column_name` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Column.html#column_name%3AString-instance-method\">#column_name</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"column_name","return_type":"String","visibility":"Public","body":"@column_name_column.value"},"external_var":false},{"html_id":"column_name=(x:String)-instance-method","name":"column_name=","doc":"Setter for `column_name` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Column.html#column_name%3AString-instance-method\">#column_name</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"column_name=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@column_name_column.value = x"},"external_var":false},{"html_id":"column_name_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"column_name_column","doc":"Returns the column object used to manage `column_name` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Column.html#column_name%3AString-instance-method\">#column_name</a></code> field</p>","abstract":false,"def":{"name":"column_name_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@column_name_column"},"external_var":false},{"html_id":"has_built_associations?:Bool-instance-method","name":"has_built_associations?","doc":"Check if there are any pending built associations","summary":"<p>Check if there are any pending built associations</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"has_built_associations?","return_type":"Bool","visibility":"Public","body":"!built_associations.empty?"},"external_var":false},{"html_id":"reset(h:Hash(Symbol,_))-instance-method","name":"reset","doc":"Set the columns from hash","summary":"<p>Set the columns from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch(:\\{{settings[:db_column_name]}}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.reset_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset(h:Hash(String,_))-instance-method","name":"reset","doc":"Set the model fields from hash","summary":"<p>Set the model fields from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch({{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.reset_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset(t:NamedTuple)-instance-method","name":"reset","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"args_string":"(t : NamedTuple)","args_html":"(t : NamedTuple)","def":{"name":"reset","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"visibility":"Public","body":"reset(**t)"},"external_var":false},{"html_id":"reset(from_json:JSON::Any)-instance-method","name":"reset","abstract":false,"args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"args_string":"(from_json : JSON::Any)","args_html":"(from_json : JSON::Any)","def":{"name":"reset","args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"visibility":"Public","body":"reset(from_json.as_h)"},"external_var":false},{"html_id":"reset(**t:**T)forallT-instance-method","name":"reset","doc":"reset flavors","summary":"<p>reset flavors</p>","abstract":false,"def":{"name":"reset","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":"super(**t)\n\n\n{% for name, typ in T %}\n          {% if settings = COLUMNS[\"#{name}\"] %}\n            @{{ settings[:crystal_variable_name] }}_column.reset_convert(t[:{{ name }}])\n          {% else %}\n            {% if !(@type.has_method?(\"#{name}=\")) %}\n              {% raise(\"Cannot find the column `#{name}` of the model `#{@type}`\") %}\n            {% end %}\n            self.{{ name }} = t[:{{ name }}]\n          {% end %}\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset_counters(*counter_models)-instance-method","name":"reset_counters","doc":"Reset counter cache columns\n\nExample:\n```\nuser = User.find(1)\nuser.reset_counters(Post)\nuser.reset_counters(Post, Comment)\n```","summary":"<p>Reset counter cache columns</p>","abstract":false,"args":[{"name":"counter_models","external_name":"counter_models","restriction":""}],"args_string":"(*counter_models)","args_html":"(*counter_models)","location":{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"},"def":{"name":"reset_counters","args":[{"name":"counter_models","external_name":"counter_models","restriction":""}],"splat_index":0,"visibility":"Public","body":"self.class.reset_counters(self.__pkey__, *counter_models)\n\nreload\n"},"external_var":false},{"html_id":"set(h:Hash(Symbol,_))-instance-method","name":"set","doc":"Set the columns from hash","summary":"<p>Set the columns from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch(:{{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.set_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set(h:Hash(String,_))-instance-method","name":"set","doc":"Set the model fields from hash","summary":"<p>Set the model fields from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch({{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.set_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set(t:NamedTuple)-instance-method","name":"set","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"args_string":"(t : NamedTuple)","args_html":"(t : NamedTuple)","def":{"name":"set","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"visibility":"Public","body":"set(**t)"},"external_var":false},{"html_id":"set(from_json:JSON::Any)-instance-method","name":"set","abstract":false,"args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"args_string":"(from_json : JSON::Any)","args_html":"(from_json : JSON::Any)","def":{"name":"set","args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"visibility":"Public","body":"set(from_json.as_h)"},"external_var":false},{"html_id":"set(**t:**T)forallT-instance-method","name":"set","doc":"Set one or multiple columns to a specific value\nThis two are equivalents:\n\n```\nmodel.set(a: 1)\nmodel.a = 1\n```","summary":"<p>Set one or multiple columns to a specific value This two are equivalents:</p>","abstract":false,"def":{"name":"set","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":"super(**t)\n\n\n{% for name, typ in T %}\n          {% if settings = COLUMNS[\"#{name}\".id] %}\n            @{{ settings[:crystal_variable_name] }}_column.set_convert(t[:{{ name }}])\n          {% else %}\n            {% if !(@type.has_method?(\"#{name}=\")) %}\n              {% raise(\"No method #{@type}##{name}= while trying to set value of #{name}\") %}\n            {% end %}\n            self.{{ name }} = t[:{{ name }}]\n          {% end %}\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set_from_json(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"set_from_json","doc":"Set the fields from json passed as argument\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"set_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(Assigner.from_json(string_or_io)).update(self, trusted)"},"external_var":false},{"html_id":"table:Lustra::Reflection::Table-instance-method","name":"table","doc":"The method table is a `belongs_to` relation to Lustra::Reflection::Table","summary":"<p>The method table is a <code>belongs_to</code> relation to Lustra::Reflection::Table</p>","abstract":false,"def":{"name":"table","return_type":"Lustra::Reflection::Table","visibility":"Public","body":"if cached = @_cached_table\n  cached\nelse\n  cache = @cache\n\n  if cache && (cache.active?(\"table\"))\n    @_cached_table = (cache.hit(\"table\", self.table_name_column.to_sql_value, Lustra::Reflection::Table)).first? || (raise(Lustra::SQL::RecordNotFoundError.new))\n  else\n    @_cached_table = Lustra::Reflection::Table\n      .query.where do (raw(Lustra::Reflection::Table\n      .__pkey__)) == self.table_name end.first!\n  end\nend"},"external_var":false},{"html_id":"table=(model:Lustra::Reflection::Table)-instance-method","name":"table=","abstract":false,"args":[{"name":"model","external_name":"model","restriction":"Lustra::Reflection::Table"}],"args_string":"(model : Lustra::Reflection::Table)","args_html":"(model : <a href=\"../../Lustra/Reflection/Table.html\">Lustra::Reflection::Table</a>)","def":{"name":"table=","args":[{"name":"model","external_name":"model","restriction":"Lustra::Reflection::Table"}],"visibility":"Public","body":"if model.persisted?\n  if model.__pkey_column__.defined?\n  else\n    raise(\"#{model.__pkey_column__.name} must be defined when assigning a belongs_to relation.\")\n  end\n\n  @table_name_column.value = model.__pkey__\nend\n\n@_cached_table = model\n"},"external_var":false},{"html_id":"table_catalog:String-instance-method","name":"table_catalog","doc":"Returns the value of `table_catalog` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Column.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_catalog","return_type":"String","visibility":"Public","body":"@table_catalog_column.value"},"external_var":false},{"html_id":"table_catalog=(x:String)-instance-method","name":"table_catalog=","doc":"Setter for `table_catalog` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Column.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_catalog=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_catalog_column.value = x"},"external_var":false},{"html_id":"table_catalog_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_catalog_column","doc":"Returns the column object used to manage `table_catalog` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Column.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> field</p>","abstract":false,"def":{"name":"table_catalog_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_catalog_column"},"external_var":false},{"html_id":"table_name:String-instance-method","name":"table_name","doc":"Returns the value of `table_name` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Column.html#table_name%3AString-instance-method\">#table_name</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_name","return_type":"String","visibility":"Public","body":"@table_name_column.value"},"external_var":false},{"html_id":"table_name=(x:String)-instance-method","name":"table_name=","doc":"Setter for `table_name` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Column.html#table_name%3AString-instance-method\">#table_name</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_name=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_name_column.value = x"},"external_var":false},{"html_id":"table_name_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_name_column","doc":"Returns the column object used to manage `table_name` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Column.html#table_name%3AString-instance-method\">#table_name</a></code> field</p>","abstract":false,"def":{"name":"table_name_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_name_column"},"external_var":false},{"html_id":"table_schema:String-instance-method","name":"table_schema","doc":"Returns the value of `table_schema` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Column.html#table_schema%3AString-instance-method\">#table_schema</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_schema","return_type":"String","visibility":"Public","body":"@table_schema_column.value"},"external_var":false},{"html_id":"table_schema=(x:String)-instance-method","name":"table_schema=","doc":"Setter for `table_schema` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Column.html#table_schema%3AString-instance-method\">#table_schema</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_schema=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_schema_column.value = x"},"external_var":false},{"html_id":"table_schema_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_schema_column","doc":"Returns the column object used to manage `table_schema` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Column.html#table_schema%3AString-instance-method\">#table_schema</a></code> field</p>","abstract":false,"def":{"name":"table_schema_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_schema_column"},"external_var":false},{"html_id":"to_h(full=false):Hash(String,Lustra::SQL::Any)-instance-method","name":"to_h","doc":"Return a hash version of the columns of this model.","summary":"<p>Return a hash version of the columns of this model.</p>","abstract":false,"args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"args_string":"(full = false) : Hash(String, Lustra::SQL::Any)","args_html":"(full = <span class=\"n\">false</span>) : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>)","def":{"name":"to_h","args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"out = super(full)\n\n\nif full || @table_catalog_column.defined?\n  out[\"table_catalog\"] = @table_catalog_column.to_sql_value(nil)\nend\n\nif full || @table_schema_column.defined?\n  out[\"table_schema\"] = @table_schema_column.to_sql_value(nil)\nend\n\nif full || @table_name_column.defined?\n  out[\"table_name\"] = @table_name_column.to_sql_value(nil)\nend\n\nif full || @column_name_column.defined?\n  out[\"column_name\"] = @column_name_column.to_sql_value(nil)\nend\n\n\nout\n"},"external_var":false},{"html_id":"to_json(emit_nulls:Bool=false)-instance-method","name":"to_json","abstract":false,"args":[{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":"Bool"}],"args_string":"(emit_nulls : Bool = false)","args_html":"(emit_nulls : Bool = <span class=\"n\">false</span>)","def":{"name":"to_json","args":[{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":"Bool"}],"visibility":"Public","body":"JSON.build do |json| to_json(json, emit_nulls) end"},"external_var":false},{"html_id":"to_json(json,emit_nulls=false)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":""},{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":""}],"args_string":"(json, emit_nulls = false)","args_html":"(json, emit_nulls = <span class=\"n\">false</span>)","def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":""},{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":""}],"visibility":"Public","body":"json.object do\n\n  if emit_nulls || @table_catalog_column.defined?\n    json.field(\"table_catalog\") do\n      (@table_catalog_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @table_schema_column.defined?\n    json.field(\"table_schema\") do\n      (@table_schema_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @table_name_column.defined?\n    json.field(\"table_name\") do\n      (@table_name_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @column_name_column.defined?\n    json.field(\"column_name\") do\n      (@column_name_column.value(nil)).to_json(json)\n    end\n  end\nend"},"external_var":false},{"html_id":"update_from_json(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"update_from_json","doc":"Set the fields from json passed as argument and call `save` on the object\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument and call <code>save</code> on the object Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"update_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"mdl = set_from_json(string_or_io, trusted)\nmdl.save\nmdl\n"},"external_var":false},{"html_id":"update_from_json!(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"update_from_json!","doc":"Set the fields from json passed as argument and call `save!` on the object\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument and call <code>save!</code> on the object Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"update_from_json!","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(set_from_json(string_or_io, trusted)).save!"},"external_var":false},{"html_id":"update_h:Hash(String,Lustra::SQL::Any)-instance-method","name":"update_h","doc":"Generate the hash for update request (like during save)","summary":"<p>Generate the hash for update request (like during save)</p>","abstract":false,"def":{"name":"update_h","return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"o = super()\n\n\nif @table_catalog_column.defined? &&\n@table_catalog_column.changed?\n  o[\"table_catalog\"] = @table_catalog_column.to_sql_value\nend\n\nif @table_schema_column.defined? &&\n@table_schema_column.changed?\n  o[\"table_schema\"] = @table_schema_column.to_sql_value\nend\n\nif @table_name_column.defined? &&\n@table_name_column.changed?\n  o[\"table_name\"] = @table_name_column.to_sql_value\nend\n\nif @column_name_column.defined? &&\n@column_name_column.changed?\n  o[\"column_name\"] = @column_name_column.to_sql_value\nend\n\n\no\n"},"external_var":false},{"html_id":"validate_fields_presence-instance-method","name":"validate_fields_presence","doc":"For each column, ensure than when needed the column has present\ninformation into it.\n\nThis method is called on validation.","summary":"<p>For each column, ensure than when needed the column has present information into it.</p>","abstract":false,"def":{"name":"validate_fields_presence","visibility":"Public","body":"if persisted?\nelsif @table_catalog_column.failed_to_be_present?\n  add_error(\"table_catalog\", \"must be present\")\nend\n\nif persisted?\nelsif @table_schema_column.failed_to_be_present?\n  add_error(\"table_schema\", \"must be present\")\nend\n\nif persisted?\nelsif @table_name_column.failed_to_be_present?\n  add_error(\"table_name\", \"must be present\")\nend\n\nif persisted?\nelsif @column_name_column.failed_to_be_present?\n  add_error(\"column_name\", \"must be present\")\nend\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Reflection/Column/Collection","path":"Lustra/Reflection/Column/Collection.html","kind":"class","full_name":"Lustra::Reflection::Column::Collection","name":"Collection","abstract":false,"superclass":{"html_id":"lustra/Lustra/Model/CollectionBase","kind":"class","full_name":"Lustra::Model::CollectionBase","name":"CollectionBase"},"ancestors":[{"html_id":"lustra/Lustra/Model/CollectionBase","kind":"class","full_name":"Lustra::Model::CollectionBase","name":"CollectionBase"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/reflection/column.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/column.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Reflection/Column","kind":"class","full_name":"Lustra::Reflection::Column","name":"Column"},"doc":":doc:\nLustra::Model::Collection\n\nThis is the object managing a `SELECT` request.\nA new collection is created by calling `Lustra::Model.query`\n\nCollection are mutable and refining the SQL will mutate the collection.\nYou may want to copy the collection by calling `dup`\n\nSee `Lustra::Model::CollectionBase`","summary":"<p>:doc: Lustra::Model::Collection</p>","instance_methods":[{"html_id":"with_table(fetch_columns=false,&block:Lustra::Reflection::Table::Collection->):self-instance-method","name":"with_table","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, &block : Lustra::Reflection::Table::Collection -> ) : self","args_html":"(fetch_columns = <span class=\"n\">false</span>, &block : <a href=\"../../../Lustra/Reflection/Table/Collection.html\">Lustra::Reflection::Table::Collection</a> -> ) : <span class=\"k\">self</span>","def":{"name":"with_table","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Lustra::Reflection::Table::Collection ->)"},"return_type":"self","visibility":"Public","body":"before_query do\n  sub_query = self.dup.clear_select.select(\"#{Lustra::Reflection::Column.table}.table_name\")\n\n  cached_qry = Lustra::Reflection::Table\n    .query.where do (raw(\"#{Lustra::Reflection::Table\n    .table}.#{Lustra::Reflection::Table\n    .__pkey__}\")).in?(sub_query) end\n\n  block.call(cached_qry)\n\n  @cache.active(\"table\")\n\n  cached_qry.each(fetch_columns: fetch_columns) do |mdl|\n    @cache.set(\"table\", mdl.__pkey__, [mdl])\n  end\nend\n\nself\n"},"external_var":false},{"html_id":"with_table(fetch_columns=false):self-instance-method","name":"with_table","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false) : self","args_html":"(fetch_columns = <span class=\"n\">false</span>) : <span class=\"k\">self</span>","def":{"name":"with_table","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"return_type":"self","visibility":"Public","body":"with_table(fetch_columns) do\nend\n\nself\n"},"external_var":false}]}]},{"html_id":"lustra/Lustra/Reflection/Table","path":"Lustra/Reflection/Table.html","kind":"class","full_name":"Lustra::Reflection::Table","name":"Table","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"},{"html_id":"lustra/Lustra/Model/FullTextSearchable","kind":"module","full_name":"Lustra::Model::FullTextSearchable","name":"FullTextSearchable"},{"html_id":"lustra/Lustra/Model/JSONDeserialize","kind":"module","full_name":"Lustra::Model::JSONDeserialize","name":"JSONDeserialize"},{"html_id":"lustra/Lustra/Model/Initializer","kind":"module","full_name":"Lustra::Model::Initializer","name":"Initializer"},{"html_id":"lustra/Lustra/Model/HasFactory","kind":"module","full_name":"Lustra::Model::HasFactory","name":"HasFactory"},{"html_id":"lustra/Lustra/Model/ClassMethods","kind":"module","full_name":"Lustra::Model::ClassMethods","name":"ClassMethods"},{"html_id":"lustra/Lustra/Model/HasScope","kind":"module","full_name":"Lustra::Model::HasScope","name":"HasScope"},{"html_id":"lustra/Lustra/Model/HasRelations","kind":"module","full_name":"Lustra::Model::HasRelations","name":"HasRelations"},{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"},{"html_id":"lustra/Lustra/Validation/Helper","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper"},{"html_id":"lustra/Lustra/Model/HasSaving","kind":"module","full_name":"Lustra::Model::HasSaving","name":"HasSaving"},{"html_id":"lustra/Lustra/Model/HasSerialPkey","kind":"module","full_name":"Lustra::Model::HasSerialPkey","name":"HasSerialPkey"},{"html_id":"lustra/Lustra/Model/HasTimestamps","kind":"module","full_name":"Lustra::Model::HasTimestamps","name":"HasTimestamps"},{"html_id":"lustra/Lustra/Model/HasColumns","kind":"module","full_name":"Lustra::Model::HasColumns","name":"HasColumns"},{"html_id":"lustra/Lustra/Model/HasHooks","kind":"module","full_name":"Lustra::Model::HasHooks","name":"HasHooks"},{"html_id":"lustra/Lustra/Model/Connection","kind":"module","full_name":"Lustra::Model::Connection","name":"Connection"},{"html_id":"lustra/Lustra/ErrorMessages","kind":"module","full_name":"Lustra::ErrorMessages","name":"ErrorMessages"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/reflection/table.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"COLUMNS","name":"COLUMNS","value":"{\"table_catalog\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_catalog\", crystal_variable_name: table_catalog, presence: true, mass_assign: true}, \"table_schema\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_schema\", crystal_variable_name: table_schema, presence: true, mass_assign: true}, \"table_name\" => {type: String, primary: true, converter: \"String\", db_column_name: \"table_name\", crystal_variable_name: table_name, presence: true, mass_assign: true}, \"table_type\" => {type: String,\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  primary: false, converter: \"String\", db_column_name: \"table_type\", crystal_variable_name: table_type, presence: true, mass_assign: true}} of Nil => Nil"},{"id":"POLYMORPHISM_SETTINGS","name":"POLYMORPHISM_SETTINGS","value":"{} of Nil => Nil"}],"included_modules":[{"html_id":"lustra/Lustra/Model","kind":"module","full_name":"Lustra::Model","name":"Model"}],"extended_modules":[{"html_id":"lustra/Lustra/Model/HasHooks/ClassMethods","kind":"module","full_name":"Lustra::Model::HasHooks::ClassMethods","name":"ClassMethods"}],"namespace":{"html_id":"lustra/Lustra/Reflection","kind":"module","full_name":"Lustra::Reflection","name":"Reflection"},"doc":"Reflection of the tables using information_schema in postgreSQL.\nTODO: Usage of view instead of model","summary":"<p>Reflection of the tables using information_schema in postgreSQL.</p>","class_methods":[{"html_id":"build(**tuple:**T)forallT-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":"**T"},"visibility":"Public","body":"{% if T.size > 0 %}\n          self.new(tuple)\n        {% else %}\n          self.new\n        {% end %}"},"external_var":false},{"html_id":"build(**tuple)-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"build(**tuple) do\nend"},"external_var":false},{"html_id":"build(**tuple,&)-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"build","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"visibility":"Public","body":"r = build(**tuple)\n\nyield(r)\n\nr\n"},"external_var":false},{"html_id":"columns-class-method","name":"columns","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"columns","visibility":"Public","body":"@@columns"},"external_var":false},{"html_id":"connection:String-class-method","name":"connection","doc":"Define on which connection the model is living. Useful in case of models living in different databases.\n\nIs set to \"default\" by default.\n\nSee `Lustra::SQL#init(URI, *opts)` for more information about multi-connections.\n\nExample:\n\n```\nLustra::SQL.init(\"postgres://postgres@localhost/database_1\")\nLustra::SQL.init(\"secondary\", \"postgres://postgres@localhost/database_2\")\n\nclass ModelA\n  include Lustra::Model\n\n  # Performs all the queries on `database_1`\n  # self.connection = \"default\"\n  column id : Int32, primary: true, presence: false\n  column title : String\nend\n\nclass ModelB\n  include Lustra::Model\n\n  # Performs all the queries on `database_2`\n  self.connection = \"secondary\"\n\n  column id : Int32, primary: true, presence: false\nend\n```","summary":"<p>Define on which connection the model is living.</p>","abstract":false,"def":{"name":"connection","return_type":"String","visibility":"Public","body":"@@connection"},"external_var":false},{"html_id":"connection=(connection:String)-class-method","name":"connection=","doc":"Define on which connection the model is living. Useful in case of models living in different databases.\n\nIs set to \"default\" by default.\n\nSee `Lustra::SQL#init(URI, *opts)` for more information about multi-connections.\n\nExample:\n\n```\nLustra::SQL.init(\"postgres://postgres@localhost/database_1\")\nLustra::SQL.init(\"secondary\", \"postgres://postgres@localhost/database_2\")\n\nclass ModelA\n  include Lustra::Model\n\n  # Performs all the queries on `database_1`\n  # self.connection = \"default\"\n  column id : Int32, primary: true, presence: false\n  column title : String\nend\n\nclass ModelB\n  include Lustra::Model\n\n  # Performs all the queries on `database_2`\n  self.connection = \"secondary\"\n\n  column id : Int32, primary: true, presence: false\nend\n```","summary":"<p>Define on which connection the model is living.</p>","abstract":false,"args":[{"name":"connection","external_name":"connection","restriction":"String"}],"args_string":"(connection : String)","args_html":"(connection : String)","def":{"name":"connection=","args":[{"name":"connection","external_name":"connection","restriction":"String"}],"visibility":"Public","body":"@@connection = connection"},"external_var":false},{"html_id":"create_from_json(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"create_from_json","doc":"Create a new model from json and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new model from json and save it.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"create_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"mdl = self.from_json(string_or_io, trusted)\nmdl.save\nmdl\n"},"external_var":false},{"html_id":"create_from_json!(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"create_from_json!","doc":"Create a new model from json and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new model from json and save it.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"create_from_json!","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(self.from_json(string_or_io, trusted)).save!"},"external_var":false},{"html_id":"find(ids:Array)-class-method","name":"find","doc":"Find multiple models by an array of primary keys.\nReturns an array of models (may be empty if none found).\n\n```\nusers = User.find([1, 2, 3])\nusers.size # => 0..3 depending on how many were found\n```","summary":"<p>Find multiple models by an array of primary keys.</p>","abstract":false,"args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"args_string":"(ids : Array)","args_html":"(ids : Array)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find","args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"visibility":"Public","body":"query.where do (raw(__pkey__)).in?(ids) end.to_a"},"external_var":false},{"html_id":"find(x)-class-method","name":"find","doc":"Returns a model using primary key equality\nReturns `nil` if not found.","summary":"<p>Returns a model using primary key equality Returns <code>nil</code> if not found.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"query.where do (raw(__pkey__)) == x end.first"},"external_var":false},{"html_id":"find!(ids:Array)-class-method","name":"find!","doc":"Find multiple models by an array of primary keys.\nRaises error if ANY of the IDs are not found.\n\n```\nusers = User.find!([1, 2, 3]) # Raises if any ID is not found\n```","summary":"<p>Find multiple models by an array of primary keys.</p>","abstract":false,"args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"args_string":"(ids : Array)","args_html":"(ids : Array)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find!","args":[{"name":"ids","external_name":"ids","restriction":"Array"}],"visibility":"Public","body":"results = find(ids)\nif results.size != ids.size\n  raise(Lustra::SQL::RecordNotFoundError.new(\"Couldn't find all records with IDs: #{ids.inspect}\"))\nend\nresults\n"},"external_var":false},{"html_id":"find!(x)-class-method","name":"find!","doc":"Returns a model using primary key equality.\nRaises error if the model is not found.","summary":"<p>Returns a model using primary key equality.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find!","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"(find(x)) || (raise(Lustra::SQL::RecordNotFoundError.new))"},"external_var":false},{"html_id":"find_by(tuple:NamedTuple)-class-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `query.find(**tuple)` with better naming.\n\n```\nuser = User.find_by(email: \"test@example.com\")\nuser = User.find_by(first_name: \"John\", last_name: \"Doe\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find_by","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"query.find(tuple)"},"external_var":false},{"html_id":"find_by(**tuple)-class-method","name":"find_by","doc":"Find a model by column values. Returns `nil` if not found.\nThis is an alias for `query.find(**tuple)` with better naming.\n\n```\nuser = User.find_by(email: \"test@example.com\")\nuser = User.find_by(first_name: \"John\", last_name: \"Doe\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find_by","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"query.find(**tuple)"},"external_var":false},{"html_id":"find_by!(tuple:NamedTuple)-class-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `query.find!(**tuple)` with better naming.\n\n```\nuser = User.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find_by!","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"query.find!(tuple)"},"external_var":false},{"html_id":"find_by!(**tuple)-class-method","name":"find_by!","doc":"Find a model by column values. Raises error if not found.\nThis is an alias for `query.find!(**tuple)` with better naming.\n\n```\nuser = User.find_by!(email: \"test@example.com\")\n```","summary":"<p>Find a model by column values.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"find_by!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"query.find!(**tuple)"},"external_var":false},{"html_id":"from_json(string_or_io:String|IO,trusted:Bool=false)-class-method","name":"from_json","doc":"Create a new empty model and fill the columns from json. Returns the new model\n\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Create a new empty model and fill the columns from json.</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(Assigner.from_json(string_or_io)).create(trusted)"},"external_var":false},{"html_id":"full_table_name-class-method","name":"full_table_name","doc":"returns the fully qualified and escaped name for this table.\nadd schema if schema is different from 'public' (default schema)\n\nex: \"schema\".\"table\"","summary":"<p>returns the fully qualified and escaped name for this table.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"full_table_name","visibility":"Public","body":"if s = schema\n  {schema, table}.map do |x| Lustra::SQL.escape(x.to_s) end.join(\".\")\nelse\n  Lustra::SQL.escape(table)\nend"},"external_var":false},{"html_id":"import(array:Enumerable(self),on_conflict:Lustra::SQL::InsertQuery->|Nil=nil)-class-method","name":"import","doc":"Import a bulk of models in one SQL insert query.\nEach model must be non-persisted.\n\n`on_conflict` callback can be optionnaly turned on\nto manage constraints of the database.\n\nNote: Old models are not modified. This method return a copy of the\nmodels as saved in the database.\n\n## Example:\n\n```\nusers = [User.new(id: 1), User.new(id: 2), User.new(id: 3)]\nusers = User.import(users)\n```","summary":"<p>Import a bulk of models in one SQL insert query.</p>","abstract":false,"args":[{"name":"array","external_name":"array","restriction":"Enumerable(self)"},{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"args_string":"(array : Enumerable(self), on_conflict : Lustra::SQL::InsertQuery ->  | Nil = nil)","args_html":"(array : Enumerable(<span class=\"k\">self</span>), on_conflict : <a href=\"../../Lustra/SQL/InsertQuery.html\">Lustra::SQL::InsertQuery</a> ->  | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"import","args":[{"name":"array","external_name":"array","restriction":"Enumerable(self)"},{"name":"on_conflict","default_value":"nil","external_name":"on_conflict","restriction":"(Lustra::SQL::InsertQuery ->) | ::Nil"}],"visibility":"Public","body":"array.each do |item|\n  if item.persisted?\n    raise(\"One of your model is persisted while calling import\")\n  end\nend\n\nhashes = array.map do |item|\n  item.trigger_before_events(:save)\n  if item.valid?\n  else\n    raise(\"import: Validation failed for `#{item}`\")\n  end\n  item.trigger_before_events(:create)\n  item.to_h\nend\n\nquery = (Lustra::SQL.insert_into(self.table, hashes)).returning(\"*\")\nif on_conflict\n  on_conflict.call(query)\nend\n\no = [] of self\nquery.fetch(@@connection) do |hash|\n  o << ((Lustra::Model::Factory.build(self.name, hash, persisted: true, fetch_columns: false, cache: nil)).as(self))\nend\n\no.each(&.trigger_after_events(:create))\no.each(&.trigger_after_events(:save))\n\no\n"},"external_var":false},{"html_id":"polymorphic?:Bool-class-method","name":"polymorphic?","abstract":false,"def":{"name":"polymorphic?","return_type":"Bool","visibility":"Public","body":"@@polymorphic"},"external_var":false},{"html_id":"public-class-method","name":"public","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L16"},"def":{"name":"public","visibility":"Public","body":"query.public()"},"external_var":false},{"html_id":"query-class-method","name":"query","doc":"Return a new query `SELECT * FROM [my_model_table]`. Can be refined after that.\nAutomatically applies default_scope if defined.","summary":"<p>Return a new query <code>SELECT * FROM [my_model_table]</code>.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"query","visibility":"Public","body":"q = (Collection.new.use_connection(connection)).from(self.full_table_name)\n\nq.responds_to?(:__apply_default_scope__) ? q.__apply_default_scope__ : q\n"},"external_var":false},{"html_id":"read_only=(read_only:Bool)-class-method","name":"read_only=","abstract":false,"args":[{"name":"read_only","external_name":"read_only","restriction":"Bool"}],"args_string":"(read_only : Bool)","args_html":"(read_only : Bool)","def":{"name":"read_only=","args":[{"name":"read_only","external_name":"read_only","restriction":"Bool"}],"visibility":"Public","body":"@@read_only = read_only"},"external_var":false},{"html_id":"read_only?:Bool-class-method","name":"read_only?","abstract":false,"def":{"name":"read_only?","return_type":"Bool","visibility":"Public","body":"@@read_only"},"external_var":false},{"html_id":"register_counter_cache(association_model:Class,counter_column:String,foreign_key:String)-class-method","name":"register_counter_cache","doc":"Register a counter cache for this model using model class","summary":"<p>Register a counter cache for this model using model class</p>","abstract":false,"args":[{"name":"association_model","external_name":"association_model","restriction":"Class"},{"name":"counter_column","external_name":"counter_column","restriction":"String"},{"name":"foreign_key","external_name":"foreign_key","restriction":"String"}],"args_string":"(association_model : Class, counter_column : String, foreign_key : String)","args_html":"(association_model : Class, counter_column : String, foreign_key : String)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"register_counter_cache","args":[{"name":"association_model","external_name":"association_model","restriction":"Class"},{"name":"counter_column","external_name":"counter_column","restriction":"String"},{"name":"foreign_key","external_name":"foreign_key","restriction":"String"}],"visibility":"Public","body":"association_name = association_model.table.to_s\n\nCOUNTER_CACHES[association_name] = {\n  counter_column: counter_column,\n  foreign_key: foreign_key,\n}\n"},"external_var":false},{"html_id":"reset_counters(id,*counter_models)-class-method","name":"reset_counters","doc":"Reset counter cache columns to their correct values.\nThis is useful when counter caches become out of sync due to direct SQL operations.\n\nExample:\n```\nUser.reset_counters(user.id, Post)\nUser.reset_counters(user.id, Post, Comment)\n```","summary":"<p>Reset counter cache columns to their correct values.</p>","abstract":false,"args":[{"name":"id","external_name":"id","restriction":""},{"name":"counter_models","external_name":"counter_models","restriction":""}],"args_string":"(id, *counter_models)","args_html":"(id, *counter_models)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"reset_counters","args":[{"name":"id","external_name":"id","restriction":""},{"name":"counter_models","external_name":"counter_models","restriction":""}],"splat_index":1,"visibility":"Public","body":"counter_models.each do |counter_model|\n  association_name = counter_model.table.to_s\n\n  counter_info = COUNTER_CACHES[association_name]?\n\n  if counter_info\n  else\n    raise(\"Counter cache for #{counter_model.name} not found for #{self.name}\")\n  end\n\n\n  actual_count = ((Lustra::SQL\n    .select(\"COUNT(*)\"))\n    .from(association_name))\n    .where do (raw(counter_info[:foreign_key])) == id end\n    .scalar(Int64)\n\n\n  update_counters(id, {counter_info[:counter_column] => actual_count})\nend"},"external_var":false},{"html_id":"schema:Lustra::SQL::Symbolic|Nil-class-method","name":"schema","doc":"Define the current schema used in PostgreSQL. The value is `nil` by default, which lead to non-specified\n  schema during the querying, and usage of \"public\" by PostgreSQL.\n\nThis property can be redefined on initialization. Example:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.schema = \"my_schema\"\nend\nMyModel.query.to_sql # SELECT * FROM \"my_schema\".\"my_models\"\n```","summary":"<p>Define the current schema used in PostgreSQL.</p>","abstract":false,"def":{"name":"schema","return_type":"Lustra::SQL::Symbolic | ::Nil","visibility":"Public","body":"@@schema"},"external_var":false},{"html_id":"schema=(schema:Lustra::SQL::Symbolic|Nil)-class-method","name":"schema=","doc":"Define the current schema used in PostgreSQL. The value is `nil` by default, which lead to non-specified\n  schema during the querying, and usage of \"public\" by PostgreSQL.\n\nThis property can be redefined on initialization. Example:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.schema = \"my_schema\"\nend\nMyModel.query.to_sql # SELECT * FROM \"my_schema\".\"my_models\"\n```","summary":"<p>Define the current schema used in PostgreSQL.</p>","abstract":false,"args":[{"name":"schema","external_name":"schema","restriction":"Lustra::SQL::Symbolic | ::Nil"}],"args_string":"(schema : Lustra::SQL::Symbolic | Nil)","args_html":"(schema : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a> | Nil)","def":{"name":"schema=","args":[{"name":"schema","external_name":"schema","restriction":"Lustra::SQL::Symbolic | ::Nil"}],"visibility":"Public","body":"@@schema = schema"},"external_var":false},{"html_id":"table:Lustra::SQL::Symbolic-class-method","name":"table","doc":"Return the table name setup for this model.\nBy convention, the class name is by default equals to the pluralized underscored string form of the model name.\nExample:\n\n```\nMyModel => \"my_models\"\nPerson => \"people\"\nProject::Info => \"project_infos\"\n```\n\nThe property can be updated at initialization to a custom table name:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.table = \"another_table_name\"\nend\nMyModel.query.to_sql # SELECT * FROM \"another_table_name\"\n```","summary":"<p>Return the table name setup for this model.</p>","abstract":false,"def":{"name":"table","return_type":"Lustra::SQL::Symbolic","visibility":"Public","body":"@@table"},"external_var":false},{"html_id":"table=(table:Lustra::SQL::Symbolic)-class-method","name":"table=","doc":"Return the table name setup for this model.\nBy convention, the class name is by default equals to the pluralized underscored string form of the model name.\nExample:\n\n```\nMyModel => \"my_models\"\nPerson => \"people\"\nProject::Info => \"project_infos\"\n```\n\nThe property can be updated at initialization to a custom table name:\n\n```\nclass MyModel\n  include Lustra::Model\n\n  self.table = \"another_table_name\"\nend\nMyModel.query.to_sql # SELECT * FROM \"another_table_name\"\n```","summary":"<p>Return the table name setup for this model.</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Lustra::SQL::Symbolic"}],"args_string":"(table : Lustra::SQL::Symbolic)","args_html":"(table : <a href=\"../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>)","def":{"name":"table=","args":[{"name":"table","external_name":"table","restriction":"Lustra::SQL::Symbolic"}],"visibility":"Public","body":"@@table = table"},"external_var":false},{"html_id":"tables_only-class-method","name":"tables_only","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L18"},"def":{"name":"tables_only","visibility":"Public","body":"query.tables_only()"},"external_var":false},{"html_id":"views_only-class-method","name":"views_only","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L19"},"def":{"name":"views_only","visibility":"Public","body":"query.views_only()"},"external_var":false}],"constructors":[{"html_id":"build(x:NamedTuple):self-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"build(**x) do\nend"},"external_var":false},{"html_id":"build(x:NamedTuple,&block:self->Nil):self-class-method","name":"build","doc":"Build a new empty model and fill the columns using the NamedTuple in argument.\n\nReturns the new model","summary":"<p>Build a new empty model and fill the columns using the NamedTuple in argument.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"build","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"build(**x, &block)"},"external_var":false},{"html_id":"create(x:NamedTuple,&block:self->Nil):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"create(**x, &block)"},"external_var":false},{"html_id":"create(**tuple,&block:self->Nil):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"r = build(**tuple) do |mdl|\n  yield(mdl)\nend\n\nr.save\n\nr\n"},"external_var":false},{"html_id":"create(x:NamedTuple):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"create(**x) do\nend"},"external_var":false},{"html_id":"create(**tuple):self-class-method","name":"create","doc":"Build and new model and save it. Returns the model.\n\nThe model may not be saved due to validation failure;\ncheck the returned model `errors?` and `persisted?` flags.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"self","visibility":"Public","body":"create(**tuple) do\nend"},"external_var":false},{"html_id":"create!(x:NamedTuple,&block:self->Nil):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple, &block : self -> Nil) : self","args_html":"(x : NamedTuple, &block : <span class=\"k\">self</span> -> Nil) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"create!(**x, &block)"},"external_var":false},{"html_id":"create!(**tuple,&block:self->Nil):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(self -> Nil)"},"return_type":"self","visibility":"Public","body":"r = build(**tuple) do |mdl|\n  yield(mdl)\nend\n\nr.save!\n\nr\n"},"external_var":false},{"html_id":"create!(x:NamedTuple):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"args_string":"(x : NamedTuple) : self","args_html":"(x : NamedTuple) : <span class=\"k\">self</span>","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create!","args":[{"name":"x","external_name":"x","restriction":"NamedTuple"}],"return_type":"self","visibility":"Public","body":"create!(**x) do\nend"},"external_var":false},{"html_id":"create!(**tuple):self-class-method","name":"create!","doc":"Build and new model and save it. Returns the model.\n\nReturns the newly inserted model\nRaises an exception if validation failed during the saving process.","summary":"<p>Build and new model and save it.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"create!","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"return_type":"self","visibility":"Public","body":"create!(**tuple) do\nend"},"external_var":false},{"html_id":"new(h:Hash(String,_),cache:Lustra::Model::QueryCache|Nil=nil,persisted=false,fetch_columns=false)-class-method","name":"new","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(h : Hash(String, _), cache : Lustra::Model::QueryCache | Nil = nil, persisted = false, fetch_columns = false)","args_html":"(h : Hash(String, _), cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>, fetch_columns = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"new","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""},{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(h, cache, persisted, fetch_columns)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(json:JSON::Any,cache:Lustra::Model::QueryCache|Nil=nil,persisted=false)-class-method","name":"new","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"::JSON::Any"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"args_string":"(json : JSON::Any, cache : Lustra::Model::QueryCache | Nil = nil, persisted = false)","args_html":"(json : JSON::Any, cache : <a href=\"../../Lustra/Model/QueryCache.html\">Lustra::Model::QueryCache</a> | Nil = <span class=\"n\">nil</span>, persisted = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"new","args":[{"name":"json","external_name":"json","restriction":"::JSON::Any"},{"name":"cache","default_value":"nil","external_name":"cache","restriction":"Lustra::Model::QueryCache | ::Nil"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(json, cache, persisted)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(t:NamedTuple,persisted=false)-class-method","name":"new","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"args_string":"(t : NamedTuple, persisted = false)","args_html":"(t : NamedTuple, persisted = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"new","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"},{"name":"persisted","default_value":"false","external_name":"persisted","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(t, persisted)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"add_built_association(association_name:String,model:Lustra::Model)-instance-method","name":"add_built_association","doc":"Add a built association to track for autosave","summary":"<p>Add a built association to track for autosave</p>","abstract":false,"args":[{"name":"association_name","external_name":"association_name","restriction":"String"},{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"args_string":"(association_name : String, model : Lustra::Model)","args_html":"(association_name : String, model : <a href=\"../../Lustra/Model.html\">Lustra::Model</a>)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"add_built_association","args":[{"name":"association_name","external_name":"association_name","restriction":"String"},{"name":"model","external_name":"model","restriction":"Lustra::Model"}],"visibility":"Public","body":"__temp_0be961d9_1 = association_name\n__temp_0be961d9_2 = built_associations\n__temp_0be961d9_2[__temp_0be961d9_1]? || (__temp_0be961d9_2[__temp_0be961d9_1] = [] of Lustra::Model)\nbuilt_associations[association_name] << model\n"},"external_var":false},{"html_id":"attributes:Hash(String,Lustra::SQL::Any)-instance-method","name":"attributes","doc":"Attributes, used when fetch_columns is true","summary":"<p>Attributes, used when fetch_columns is true</p>","abstract":false,"def":{"name":"attributes","return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"@attributes"},"external_var":false},{"html_id":"built_associations:Hash(String,Array(Lustra::Model))-instance-method","name":"built_associations","doc":"Track built associations for autosave functionality","summary":"<p>Track built associations for autosave functionality</p>","abstract":false,"def":{"name":"built_associations","return_type":"Hash(String, Array(Lustra::Model))","visibility":"Public","body":"@built_associations"},"external_var":false},{"html_id":"built_associations=(built_associations:Hash(String,Array(Lustra::Model)))-instance-method","name":"built_associations=","doc":"Track built associations for autosave functionality","summary":"<p>Track built associations for autosave functionality</p>","abstract":false,"args":[{"name":"built_associations","external_name":"built_associations","restriction":"Hash(String, Array(Lustra::Model))"}],"args_string":"(built_associations : Hash(String, Array(Lustra::Model)))","args_html":"(built_associations : Hash(String, Array(<a href=\"../../Lustra/Model.html\">Lustra::Model</a>)))","def":{"name":"built_associations=","args":[{"name":"built_associations","external_name":"built_associations","restriction":"Hash(String, Array(Lustra::Model))"}],"visibility":"Public","body":"@built_associations = built_associations"},"external_var":false},{"html_id":"cache:Lustra::Model::QueryCache|Nil-instance-method","name":"cache","abstract":false,"def":{"name":"cache","return_type":"Lustra::Model::QueryCache | ::Nil","visibility":"Public","body":"@cache"},"external_var":false},{"html_id":"changed:Array(String)-instance-method","name":"changed","doc":"Returns an array of names of all changed attributes.\n\n```\nuser.email = \"new@test.com\"\nuser.first_name = \"John\"\nuser.changed  # => [\"email\", \"first_name\"]\n```","summary":"<p>Returns an array of names of all changed attributes.</p>","abstract":false,"def":{"name":"changed","return_type":"Array(String)","visibility":"Public","body":"changed_attrs = [] of String\n\n\nif @table_catalog_column.changed?\n  changed_attrs << \"table_catalog\"\nend\n\nif @table_schema_column.changed?\n  changed_attrs << \"table_schema\"\nend\n\nif @table_name_column.changed?\n  changed_attrs << \"table_name\"\nend\n\nif @table_type_column.changed?\n  changed_attrs << \"table_type\"\nend\n\n\nchanged_attrs\n"},"external_var":false},{"html_id":"changed?-instance-method","name":"changed?","doc":"Return `true` if the model is dirty (e.g. one or more fields\n  have been changed.). Return `false` otherwise.","summary":"<p>Return <code>true</code> if the model is dirty (e.g.</p>","abstract":false,"def":{"name":"changed?","visibility":"Public","body":"if @table_catalog_column.changed?\n  return true\nend\n\nif @table_schema_column.changed?\n  return true\nend\n\nif @table_name_column.changed?\n  return true\nend\n\nif @table_type_column.changed?\n  return true\nend\n\n\nreturn false\n"},"external_var":false},{"html_id":"changes:Hash(String,Tuple(Lustra::SQL::Any,Lustra::SQL::Any))-instance-method","name":"changes","doc":"Returns a hash of all changed attributes with their [old_value, new_value].\n\n```\nuser.email = \"new@test.com\"\nuser.first_name = \"John\"\nuser.changes  # => {\"email\" => [\"old@test.com\", \"new@test.com\"], \"first_name\" => [nil, \"John\"]}\n```","summary":"<p>Returns a hash of all changed attributes with their [old_value, new_value].</p>","abstract":false,"def":{"name":"changes","return_type":"Hash(String, Tuple(Lustra::SQL::Any, Lustra::SQL::Any))","visibility":"Public","body":"changes_hash = {} of String => Tuple(Lustra::SQL::Any, Lustra::SQL::Any)\n\n\nif @table_catalog_column.changed?\n  old_val = @table_catalog_column.old_value\n  new_val = @table_catalog_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_catalog\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @table_schema_column.changed?\n  old_val = @table_schema_column.old_value\n  new_val = @table_schema_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_schema\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @table_name_column.changed?\n  old_val = @table_name_column.old_value\n  new_val = @table_name_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_name\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\nif @table_type_column.changed?\n  old_val = @table_type_column.old_value\n  new_val = @table_type_column.value\n\n  if old_val.is_a?(Lustra::Model::Column::UnknownClass)\n  else\n    changes_hash[\"table_type\"] = {old_val.as(Lustra::SQL::Any), new_val.as(Lustra::SQL::Any)}\n  end\nend\n\n\nchanges_hash\n"},"external_var":false},{"html_id":"clear_built_associations-instance-method","name":"clear_built_associations","doc":"Clear all built associations (called after successful save)","summary":"<p>Clear all built associations (called after successful save)</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"clear_built_associations","visibility":"Public","body":"built_associations.clear"},"external_var":false},{"html_id":"clear_change_flags-instance-method","name":"clear_change_flags","doc":"Reset the `changed?` flag on all columns\n\nThe model behave like its not dirty anymore\nand call to save would apply no changes.\n\nReturns `self`","summary":"<p>Reset the <code><a href=\"../../Lustra/Reflection/Table.html#changed%3F-instance-method\">#changed?</a></code> flag on all columns</p>","abstract":false,"def":{"name":"clear_change_flags","visibility":"Public","body":"@table_catalog_column.clear_change_flag\n\n@table_schema_column.clear_change_flag\n\n@table_name_column.clear_change_flag\n\n@table_type_column.clear_change_flag\n\n\nself\n"},"external_var":false},{"html_id":"columns:Lustra::Reflection::Column::Collection-instance-method","name":"columns","doc":"The method columns is a `has_many` relation to Lustra::Reflection::Column","summary":"<p>The method columns is a <code>has_many</code> relation to Lustra::Reflection::Column</p>","abstract":false,"def":{"name":"columns","return_type":"Lustra::Reflection::Column::Collection","visibility":"Public","body":"__temp_153 = table_name\n\n__temp_154 = \"table_name\"\n\n\ncache = @cache\n\nquery = if cache && (cache.active?(\"columns\"))\n  arr = cache.hit(\"columns\", self.__pkey_column__.to_sql_value, Lustra::Reflection::Column)\n\n\n  (Lustra::Reflection::Column\n    .query\n    .tags({\"#{__temp_154}\" => \"#{__temp_153}\"}))\n    .where do (raw(__temp_154)) == __temp_153 end\n    .with_cached_result(arr)\nelse\n  (Lustra::Reflection::Column\n    .query\n    .tags({\"#{__temp_154}\" => \"#{__temp_153}\"}))\n    .where do (raw(__temp_154)) == __temp_153 end\nend\n\nquery.append_operation = ->(x : Lustra::Reflection::Column) do\n  x.reset(query.tags)\n  x.save!\n  x\nend\n\n\n\n\nquery\n"},"external_var":false},{"html_id":"has_built_associations?:Bool-instance-method","name":"has_built_associations?","doc":"Check if there are any pending built associations","summary":"<p>Check if there are any pending built associations</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"has_built_associations?","return_type":"Bool","visibility":"Public","body":"!built_associations.empty?"},"external_var":false},{"html_id":"indexes:Hash(String,Array(String))-instance-method","name":"indexes","doc":"List all the indexes related to the current table.\nreturn an hash where the key is the name of the column\nand the value is an array containing all the indexes related to this specific\nfield.","summary":"<p>List all the indexes related to the current table.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L27"},"def":{"name":"indexes","return_type":"Hash(String, Array(String))","visibility":"Public","body":"o = {} of String => Array(String)\n\n((((SQL.select({\n  index_name: \"i.relname\",\n  column_name: \"a.attname\",\n}))\n  .from({t: \"pg_class\", i: \"pg_class\", ix: \"pg_index\", a: \"pg_attribute\"}))\n  .where do\n    (((((t.oid == ix.indrelid) & (i.oid == ix.indexrelid)) & (a.attrelid == t.oid)) & (a.attnum == (raw(\"ANY(ix.indkey)\")))) & (t.relkind == \"r\")) & (t.relname == self.table_name)\n  end\n  .order_by(\"t.relname\")).order_by(\"i.relname\"))\n  .fetch do |h|\n    col = h[\"column_name\"].to_s\n    v = h[\"index_name\"].to_s\n\n    arr = o[col]? ? o[col] : (o[col] = [] of String)\n\n    arr << v\n  end\n\no\n"},"external_var":false},{"html_id":"invalidate_caching:self-instance-method","name":"invalidate_caching","doc":"Force to clean-up the caches for the relations\nconnected to this model.","summary":"<p>Force to clean-up the caches for the relations connected to this model.</p>","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"invalidate_caching","return_type":"self","visibility":"Public","body":"@cache = nil\nself\n"},"external_var":false},{"html_id":"reset(h:Hash(Symbol,_))-instance-method","name":"reset","doc":"Set the columns from hash","summary":"<p>Set the columns from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch(:\\{{settings[:db_column_name]}}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.reset_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset(h:Hash(String,_))-instance-method","name":"reset","doc":"Set the model fields from hash","summary":"<p>Set the model fields from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","def":{"name":"reset","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch({{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.reset_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset(t:NamedTuple)-instance-method","name":"reset","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"args_string":"(t : NamedTuple)","args_html":"(t : NamedTuple)","def":{"name":"reset","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"visibility":"Public","body":"reset(**t)"},"external_var":false},{"html_id":"reset(from_json:JSON::Any)-instance-method","name":"reset","abstract":false,"args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"args_string":"(from_json : JSON::Any)","args_html":"(from_json : JSON::Any)","def":{"name":"reset","args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"visibility":"Public","body":"reset(from_json.as_h)"},"external_var":false},{"html_id":"reset(**t:**T)forallT-instance-method","name":"reset","doc":"reset flavors","summary":"<p>reset flavors</p>","abstract":false,"def":{"name":"reset","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":"super(**t)\n\n\n{% for name, typ in T %}\n          {% if settings = COLUMNS[\"#{name}\"] %}\n            @{{ settings[:crystal_variable_name] }}_column.reset_convert(t[:{{ name }}])\n          {% else %}\n            {% if !(@type.has_method?(\"#{name}=\")) %}\n              {% raise(\"Cannot find the column `#{name}` of the model `#{@type}`\") %}\n            {% end %}\n            self.{{ name }} = t[:{{ name }}]\n          {% end %}\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"reset_counters(*counter_models)-instance-method","name":"reset_counters","doc":"Reset counter cache columns\n\nExample:\n```\nuser = User.find(1)\nuser.reset_counters(Post)\nuser.reset_counters(Post, Comment)\n```","summary":"<p>Reset counter cache columns</p>","abstract":false,"args":[{"name":"counter_models","external_name":"counter_models","restriction":""}],"args_string":"(*counter_models)","args_html":"(*counter_models)","location":{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},"def":{"name":"reset_counters","args":[{"name":"counter_models","external_name":"counter_models","restriction":""}],"splat_index":0,"visibility":"Public","body":"self.class.reset_counters(self.__pkey__, *counter_models)\n\nreload\n"},"external_var":false},{"html_id":"set(h:Hash(Symbol,_))-instance-method","name":"set","doc":"Set the columns from hash","summary":"<p>Set the columns from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"args_string":"(h : Hash(Symbol, _))","args_html":"(h : Hash(Symbol, _))","def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(Symbol, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch(:{{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.set_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set(h:Hash(String,_))-instance-method","name":"set","doc":"Set the model fields from hash","summary":"<p>Set the model fields from hash</p>","abstract":false,"args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"args_string":"(h : Hash(String, _))","args_html":"(h : Hash(String, _))","def":{"name":"set","args":[{"name":"h","external_name":"h","restriction":"Hash(String, _)"}],"visibility":"Public","body":"super(h)\n\n\n{% for name, settings in COLUMNS %}\n          v = h.fetch({{ settings[:db_column_name] }}) { Lustra::Model::Column::UNKNOWN }\n          @{{ settings[:crystal_variable_name] }}_column.set_convert(v) unless v.is_a?(Lustra::Model::Column::UnknownClass)\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set(t:NamedTuple)-instance-method","name":"set","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"args_string":"(t : NamedTuple)","args_html":"(t : NamedTuple)","def":{"name":"set","args":[{"name":"t","external_name":"t","restriction":"NamedTuple"}],"visibility":"Public","body":"set(**t)"},"external_var":false},{"html_id":"set(from_json:JSON::Any)-instance-method","name":"set","abstract":false,"args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"args_string":"(from_json : JSON::Any)","args_html":"(from_json : JSON::Any)","def":{"name":"set","args":[{"name":"from_json","external_name":"from_json","restriction":"JSON::Any"}],"visibility":"Public","body":"set(from_json.as_h)"},"external_var":false},{"html_id":"set(**t:**T)forallT-instance-method","name":"set","doc":"Set one or multiple columns to a specific value\nThis two are equivalents:\n\n```\nmodel.set(a: 1)\nmodel.a = 1\n```","summary":"<p>Set one or multiple columns to a specific value This two are equivalents:</p>","abstract":false,"def":{"name":"set","double_splat":{"name":"t","external_name":"t","restriction":"**T"},"visibility":"Public","body":"super(**t)\n\n\n{% for name, typ in T %}\n          {% if settings = COLUMNS[\"#{name}\".id] %}\n            @{{ settings[:crystal_variable_name] }}_column.set_convert(t[:{{ name }}])\n          {% else %}\n            {% if !(@type.has_method?(\"#{name}=\")) %}\n              {% raise(\"No method #{@type}##{name}= while trying to set value of #{name}\") %}\n            {% end %}\n            self.{{ name }} = t[:{{ name }}]\n          {% end %}\n        {% end %}\n\n\nself\n"},"external_var":false},{"html_id":"set_from_json(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"set_from_json","doc":"Set the fields from json passed as argument\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"set_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(Assigner.from_json(string_or_io)).update(self, trusted)"},"external_var":false},{"html_id":"table_catalog:String-instance-method","name":"table_catalog","doc":"Returns the value of `table_catalog` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Table.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_catalog","return_type":"String","visibility":"Public","body":"@table_catalog_column.value"},"external_var":false},{"html_id":"table_catalog=(x:String)-instance-method","name":"table_catalog=","doc":"Setter for `table_catalog` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Table.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_catalog=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_catalog_column.value = x"},"external_var":false},{"html_id":"table_catalog_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_catalog_column","doc":"Returns the column object used to manage `table_catalog` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Table.html#table_catalog%3AString-instance-method\">#table_catalog</a></code> field</p>","abstract":false,"def":{"name":"table_catalog_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_catalog_column"},"external_var":false},{"html_id":"table_name:String-instance-method","name":"table_name","doc":"Returns the value of `table_name` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Table.html#table_name%3AString-instance-method\">#table_name</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_name","return_type":"String","visibility":"Public","body":"@table_name_column.value"},"external_var":false},{"html_id":"table_name=(x:String)-instance-method","name":"table_name=","doc":"Setter for `table_name` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Table.html#table_name%3AString-instance-method\">#table_name</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_name=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_name_column.value = x"},"external_var":false},{"html_id":"table_name_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_name_column","doc":"Returns the column object used to manage `table_name` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Table.html#table_name%3AString-instance-method\">#table_name</a></code> field</p>","abstract":false,"def":{"name":"table_name_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_name_column"},"external_var":false},{"html_id":"table_schema:String-instance-method","name":"table_schema","doc":"Returns the value of `table_schema` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Table.html#table_schema%3AString-instance-method\">#table_schema</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_schema","return_type":"String","visibility":"Public","body":"@table_schema_column.value"},"external_var":false},{"html_id":"table_schema=(x:String)-instance-method","name":"table_schema=","doc":"Setter for `table_schema` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Table.html#table_schema%3AString-instance-method\">#table_schema</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_schema=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_schema_column.value = x"},"external_var":false},{"html_id":"table_schema_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_schema_column","doc":"Returns the column object used to manage `table_schema` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Table.html#table_schema%3AString-instance-method\">#table_schema</a></code> field</p>","abstract":false,"def":{"name":"table_schema_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_schema_column"},"external_var":false},{"html_id":"table_type:String-instance-method","name":"table_type","doc":"Returns the value of `table_type` column or throw an exception if the column is not defined.","summary":"<p>Returns the value of <code><a href=\"../../Lustra/Reflection/Table.html#table_type%3AString-instance-method\">#table_type</a></code> column or throw an exception if the column is not defined.</p>","abstract":false,"def":{"name":"table_type","return_type":"String","visibility":"Public","body":"@table_type_column.value"},"external_var":false},{"html_id":"table_type=(x:String)-instance-method","name":"table_type=","doc":"Setter for `table_type` column.","summary":"<p>Setter for <code><a href=\"../../Lustra/Reflection/Table.html#table_type%3AString-instance-method\">#table_type</a></code> column.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String"}],"args_string":"(x : String)","args_html":"(x : String)","def":{"name":"table_type=","args":[{"name":"x","external_name":"x","restriction":"String"}],"visibility":"Public","body":"@table_type_column.value = x"},"external_var":false},{"html_id":"table_type_column:Lustra::Model::Column(String,Lustra::Model::Converter::StringConverter)-instance-method","name":"table_type_column","doc":"Returns the column object used to manage `table_type` field\n\nSee `Lustra::Model::Column`","summary":"<p>Returns the column object used to manage <code><a href=\"../../Lustra/Reflection/Table.html#table_type%3AString-instance-method\">#table_type</a></code> field</p>","abstract":false,"def":{"name":"table_type_column","return_type":"Lustra::Model::Column(String, Lustra::Model::Converter::StringConverter)","visibility":"Public","body":"@table_type_column"},"external_var":false},{"html_id":"to_h(full=false):Hash(String,Lustra::SQL::Any)-instance-method","name":"to_h","doc":"Return a hash version of the columns of this model.","summary":"<p>Return a hash version of the columns of this model.</p>","abstract":false,"args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"args_string":"(full = false) : Hash(String, Lustra::SQL::Any)","args_html":"(full = <span class=\"n\">false</span>) : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>)","def":{"name":"to_h","args":[{"name":"full","default_value":"false","external_name":"full","restriction":""}],"return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"out = super(full)\n\n\nif full || @table_catalog_column.defined?\n  out[\"table_catalog\"] = @table_catalog_column.to_sql_value(nil)\nend\n\nif full || @table_schema_column.defined?\n  out[\"table_schema\"] = @table_schema_column.to_sql_value(nil)\nend\n\nif full || @table_name_column.defined?\n  out[\"table_name\"] = @table_name_column.to_sql_value(nil)\nend\n\nif full || @table_type_column.defined?\n  out[\"table_type\"] = @table_type_column.to_sql_value(nil)\nend\n\n\nout\n"},"external_var":false},{"html_id":"to_json(emit_nulls:Bool=false)-instance-method","name":"to_json","abstract":false,"args":[{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":"Bool"}],"args_string":"(emit_nulls : Bool = false)","args_html":"(emit_nulls : Bool = <span class=\"n\">false</span>)","def":{"name":"to_json","args":[{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":"Bool"}],"visibility":"Public","body":"JSON.build do |json| to_json(json, emit_nulls) end"},"external_var":false},{"html_id":"to_json(json,emit_nulls=false)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":""},{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":""}],"args_string":"(json, emit_nulls = false)","args_html":"(json, emit_nulls = <span class=\"n\">false</span>)","def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":""},{"name":"emit_nulls","default_value":"false","external_name":"emit_nulls","restriction":""}],"visibility":"Public","body":"json.object do\n\n  if emit_nulls || @table_catalog_column.defined?\n    json.field(\"table_catalog\") do\n      (@table_catalog_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @table_schema_column.defined?\n    json.field(\"table_schema\") do\n      (@table_schema_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @table_name_column.defined?\n    json.field(\"table_name\") do\n      (@table_name_column.value(nil)).to_json(json)\n    end\n  end\n\n  if emit_nulls || @table_type_column.defined?\n    json.field(\"table_type\") do\n      (@table_type_column.value(nil)).to_json(json)\n    end\n  end\nend"},"external_var":false},{"html_id":"update_from_json(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"update_from_json","doc":"Set the fields from json passed as argument and call `save` on the object\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument and call <code>save</code> on the object Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"update_from_json","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"mdl = set_from_json(string_or_io, trusted)\nmdl.save\nmdl\n"},"external_var":false},{"html_id":"update_from_json!(string_or_io:String|IO,trusted:Bool=false)-instance-method","name":"update_from_json!","doc":"Set the fields from json passed as argument and call `save!` on the object\nTrusted flag set to true will allow mass assignment without protection, FALSE by default","summary":"<p>Set the fields from json passed as argument and call <code>save!</code> on the object Trusted flag set to true will allow mass assignment without protection, FALSE by default</p>","abstract":false,"args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"args_string":"(string_or_io : String | IO, trusted : Bool = false)","args_html":"(string_or_io : String | IO, trusted : Bool = <span class=\"n\">false</span>)","def":{"name":"update_from_json!","args":[{"name":"string_or_io","external_name":"string_or_io","restriction":"String | IO"},{"name":"trusted","default_value":"false","external_name":"trusted","restriction":"Bool"}],"visibility":"Public","body":"(set_from_json(string_or_io, trusted)).save!"},"external_var":false},{"html_id":"update_h:Hash(String,Lustra::SQL::Any)-instance-method","name":"update_h","doc":"Generate the hash for update request (like during save)","summary":"<p>Generate the hash for update request (like during save)</p>","abstract":false,"def":{"name":"update_h","return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"o = super()\n\n\nif @table_catalog_column.defined? &&\n@table_catalog_column.changed?\n  o[\"table_catalog\"] = @table_catalog_column.to_sql_value\nend\n\nif @table_schema_column.defined? &&\n@table_schema_column.changed?\n  o[\"table_schema\"] = @table_schema_column.to_sql_value\nend\n\nif @table_name_column.defined? &&\n@table_name_column.changed?\n  o[\"table_name\"] = @table_name_column.to_sql_value\nend\n\nif @table_type_column.defined? &&\n@table_type_column.changed?\n  o[\"table_type\"] = @table_type_column.to_sql_value\nend\n\n\no\n"},"external_var":false},{"html_id":"validate_fields_presence-instance-method","name":"validate_fields_presence","doc":"For each column, ensure than when needed the column has present\ninformation into it.\n\nThis method is called on validation.","summary":"<p>For each column, ensure than when needed the column has present information into it.</p>","abstract":false,"def":{"name":"validate_fields_presence","visibility":"Public","body":"if persisted?\nelsif @table_catalog_column.failed_to_be_present?\n  add_error(\"table_catalog\", \"must be present\")\nend\n\nif persisted?\nelsif @table_schema_column.failed_to_be_present?\n  add_error(\"table_schema\", \"must be present\")\nend\n\nif persisted?\nelsif @table_name_column.failed_to_be_present?\n  add_error(\"table_name\", \"must be present\")\nend\n\nif persisted?\nelsif @table_type_column.failed_to_be_present?\n  add_error(\"table_type\", \"must be present\")\nend\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/Reflection/Table/Collection","path":"Lustra/Reflection/Table/Collection.html","kind":"class","full_name":"Lustra::Reflection::Table::Collection","name":"Collection","abstract":false,"superclass":{"html_id":"lustra/Lustra/Model/CollectionBase","kind":"class","full_name":"Lustra::Model::CollectionBase","name":"CollectionBase"},"ancestors":[{"html_id":"lustra/Lustra/Model/CollectionBase","kind":"class","full_name":"Lustra::Model::CollectionBase","name":"CollectionBase"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/model/reflection/table.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L4"},{"filename":"src/lustra/model/reflection/table.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L16"},{"filename":"src/lustra/model/reflection/table.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L18"},{"filename":"src/lustra/model/reflection/table.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L19"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/Reflection/Table","kind":"class","full_name":"Lustra::Reflection::Table","name":"Table"},"doc":"Addition of the method for eager loading and N+1 avoidance.","summary":"<p>Addition of the method for eager loading and N+1 avoidance.</p>","instance_methods":[{"html_id":"public-instance-method","name":"public","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L16"},"def":{"name":"public","visibility":"Public","body":"where do table_schema == \"public\" end\nreturn self\n"},"external_var":false},{"html_id":"tables_only-instance-method","name":"tables_only","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L18"},"def":{"name":"tables_only","visibility":"Public","body":"where do table_type == \"BASE TABLE\" end\nreturn self\n"},"external_var":false},{"html_id":"views_only-instance-method","name":"views_only","abstract":false,"location":{"filename":"src/lustra/model/reflection/table.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/reflection/table.cr#L19"},"def":{"name":"views_only","visibility":"Public","body":"where do table_type == \"VIEW\" end\nreturn self\n"},"external_var":false},{"html_id":"with_columns(fetch_columns=false,&block:Lustra::Reflection::Column::Collection->):self-instance-method","name":"with_columns","doc":"Eager load the has many relation columns.\nUse it to avoid N+1 queries.","summary":"<p>Eager load the has many relation columns.</p>","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false, &block : Lustra::Reflection::Column::Collection -> ) : self","args_html":"(fetch_columns = <span class=\"n\">false</span>, &block : <a href=\"../../../Lustra/Reflection/Column/Collection.html\">Lustra::Reflection::Column::Collection</a> -> ) : <span class=\"k\">self</span>","def":{"name":"with_columns","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(Lustra::Reflection::Column::Collection ->)"},"return_type":"self","visibility":"Public","body":"before_query do\n  __temp_153 = table_name\n  __temp_154 = \"table_name\"\n\n\n  sub_query = self.dup.clear_select.select(\"#{Lustra::Reflection::Table.table}.#{__temp_153}\")\n\n  qry = Lustra::Reflection::Column\n    .query.where do (raw(__temp_154)).in?(sub_query) end\n  block.call(qry)\n\n  @cache.active(\"columns\")\n\n  h = {} of Lustra::SQL::Any => Array(Lustra::Reflection::Column)\n\n  qry.each(fetch_columns: true) do |mdl|\n    if h[mdl.attributes[__temp_154]]?\n    else\n      h[mdl.attributes[__temp_154]] = [] of Lustra::Reflection::Column\n    end\n\n    h[mdl.attributes[__temp_154]] << mdl\n  end\n\n  h.each do |key, value|\n    @cache.set(\"columns\", key, value)\n  end\nend\n\nself\n"},"external_var":false},{"html_id":"with_columns(fetch_columns=false)-instance-method","name":"with_columns","abstract":false,"args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"args_string":"(fetch_columns = false)","args_html":"(fetch_columns = <span class=\"n\">false</span>)","def":{"name":"with_columns","args":[{"name":"fetch_columns","default_value":"false","external_name":"fetch_columns","restriction":""}],"visibility":"Public","body":"with_columns(fetch_columns) do\nend"},"external_var":false}]}]}]},{"html_id":"lustra/Lustra/SQL","path":"Lustra/SQL.html","kind":"module","full_name":"Lustra::SQL","name":"SQL","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/SQL/Transaction","kind":"module","full_name":"Lustra::SQL::Transaction","name":"Transaction"},{"html_id":"lustra/Lustra/SQL/Logger","kind":"module","full_name":"Lustra::SQL::Logger","name":"Logger"}],"locations":[{"filename":"src/lustra/sql/connection_pool.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/connection_pool.cr#L1"},{"filename":"src/lustra/sql/errors.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L1"},{"filename":"src/lustra/sql/fragment/column.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L9"},{"filename":"src/lustra/sql/fragment/fragment.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/fragment.cr#L1"},{"filename":"src/lustra/sql/fragment/from.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L3"},{"filename":"src/lustra/sql/fragment/join.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L3"},{"filename":"src/lustra/sql/lock.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/lock.cr#L2"},{"filename":"src/lustra/sql/query/connection.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/connection.cr#L1"},{"filename":"src/lustra/sql/query/from.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L1"},{"filename":"src/lustra/sql/sql.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L50"},{"filename":"src/lustra/sql/truncate.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/truncate.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Logger","kind":"module","full_name":"Lustra::SQL::Logger","name":"Logger"},{"html_id":"lustra/Lustra/SQL/Transaction","kind":"module","full_name":"Lustra::SQL::Transaction","name":"Transaction"}],"extended_modules":[{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"\n## Lustra::SQL\n\nLustra is made like an onion:\n\n```\n+------------------------------------+\n|          THE ORM STACK             +\n+------------------------------------+\n|  Model | DB Views |  Migrations    | < High Level Tools\n+---------------+--------------------+\n|  Columns | Validation | Converters | < Mapping system\n+---------------+--------------------+\n|  Lustra::SQL  | Lustra::Expression | < Low Level SQL Builder\n+------------------------------------+\n|  Crystal DB   |    Crystal PG      | < Low Level connection\n+------------------------------------+\n```\n\nOn the bottom stack, Lustra offer SQL query building.\nTheses features are then used by top level parts of the engine.\n\nThe SQL module provide a simple API to generate `delete`, `insert`, `select`\nand `update` methods.\n\nEach requests can be duplicated then modified and executed.\n\nNote: Each request object is mutable. Therefore, to update and store a request,\nyou must use manually the `dup` method.\n","summary":"<h2><a id=\"lustrasql\" class=\"anchor\" href=\"#lustrasql\">  <svg class=\"octicon-link\" aria-hidden=\"true\">\n    <use href=\"#octicon-link\"/>\n  </svg>\n</a>Lustra::SQL</h2>","class_methods":[{"html_id":"lock(table:String|Symbol,mode=\"ACCESSEXCLUSIVE\",connection=\"default\",&)-class-method","name":"lock","doc":"Lock completetly a table.\n\n```\nLustra::SQL.lock(\"my_table\") do\nend\n```\n\nOptional parameter `mode` allow you to decide over the lock level\nModes are:\n- ACCESS EXCLUSIVE (default)\n- ACCESS SHARE\n- ROW SHARE\n- ROW EXCLUSIVE\n- SHARE UPDATE EXCLUSIVE\n- SHARE\n- SHARE ROW EXCLUSIVE\n- EXCLUSIVE\n\nSee [Official PG documentation for more informations](https://www.postgresql.org/docs/12/explicit-locking.html)","summary":"<p>Lock completetly a table.</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"String | Symbol"},{"name":"mode","default_value":"\"ACCESS EXCLUSIVE\"","external_name":"mode","restriction":""},{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":""}],"args_string":"(table : String | Symbol, mode = \"ACCESS EXCLUSIVE\", connection = \"default\", &)","args_html":"(table : String | Symbol, mode = <span class=\"s\">&quot;ACCESS EXCLUSIVE&quot;</span>, connection = <span class=\"s\">&quot;default&quot;</span>, &)","location":{"filename":"src/lustra/sql/lock.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/lock.cr#L23"},"def":{"name":"lock","args":[{"name":"table","external_name":"table","restriction":"String | Symbol"},{"name":"mode","default_value":"\"ACCESS EXCLUSIVE\"","external_name":"mode","restriction":""},{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":""}],"yields":1,"block_arity":1,"visibility":"Public","body":"Lustra::SQL::ConnectionPool.with_connection(connection) do |cnx|\n  transaction do\n    execute(\"LOCK TABLE #{table} IN #{mode} MODE\")\n    return yield(cnx)\n  end\nend"},"external_var":false},{"html_id":"truncate(tablename:Lustra::Model.class|String|Symbol,restart_sequence:Bool=false,cascade:Bool=false,truncate_inherited:Bool=true,connection_name:String=\"default\")forallT-class-method","name":"truncate","doc":"Truncate a table or a model\n\n```\nUser.query.count           # => 200\nLustra::SQL.truncate(User) # equivalent to Lustra::SQL.truncate(User.table, connection_name: User.connection)\nUser.query.count           # => 0\n```\n\nSEE https://www.postgresql.org/docs/current/sql-truncate.html\nfor more information.\n\n- `restart_sequence` set to true will append `RESTART IDENTITY` to the query\n- `cascade` set to true will append `CASCADE` to the query\n- `truncate_inherited` set to false will append `ONLY` to the query\n- `connection_name` will be: `Model.connection` or `default` unless optionally defined.","summary":"<p>Truncate a table or a model</p>","abstract":false,"args":[{"name":"tablename","external_name":"tablename","restriction":"Lustra::Model.class | String | Symbol"},{"name":"restart_sequence","default_value":"false","external_name":"restart_sequence","restriction":"Bool"},{"name":"cascade","default_value":"false","external_name":"cascade","restriction":"Bool"},{"name":"truncate_inherited","default_value":"true","external_name":"truncate_inherited","restriction":"Bool"},{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"args_string":"(tablename : Lustra::Model.class | String | Symbol, restart_sequence : Bool = false, cascade : Bool = false, truncate_inherited : Bool = true, connection_name : String = \"default\") forall T","args_html":"(tablename : <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Model</span>.<span class=\"k\">class</span> | String | Symbol, restart_sequence : Bool = <span class=\"n\">false</span>, cascade : Bool = <span class=\"n\">false</span>, truncate_inherited : Bool = <span class=\"n\">true</span>, connection_name : String = <span class=\"s\">&quot;default&quot;</span>) forall T","location":{"filename":"src/lustra/sql/truncate.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/truncate.cr#L18"},"def":{"name":"truncate","args":[{"name":"tablename","external_name":"tablename","restriction":"Lustra::Model.class | String | Symbol"},{"name":"restart_sequence","default_value":"false","external_name":"restart_sequence","restriction":"Bool"},{"name":"cascade","default_value":"false","external_name":"cascade","restriction":"Bool"},{"name":"truncate_inherited","default_value":"true","external_name":"truncate_inherited","restriction":"Bool"},{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"visibility":"Public","body":"case tablename\nwhen String\nwhen Symbol\n  tablename = Lustra::SQL.escape(tablename.to_s)\nelse\n  connection_name = tablename.connection\n  tablename = tablename.full_table_name\nend\n\nonly = truncate_inherited ? \"\" : \" ONLY \"\nrestart_sequence = restart_sequence ? \" RESTART IDENTITY \" : \"\"\ncascade = cascade ? \" CASCADE \" : \"\"\n\nexecute(connection_name, {\"TRUNCATE TABLE \", only, tablename, restart_sequence, cascade}.join)\n"},"external_var":false}],"instance_methods":[{"html_id":"add_connection(name:String,url:String)-instance-method","name":"add_connection","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"url","external_name":"url","restriction":"String"}],"args_string":"(name : String, url : String)","args_html":"(name : String, url : String)","location":{"filename":"src/lustra/sql/sql.cr","line_number":125,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L125"},"def":{"name":"add_connection","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"url","external_name":"url","restriction":"String"}],"visibility":"Public","body":"Lustra::SQL::ConnectionPool.init(url, name)"},"external_var":false},{"html_id":"delete(table:Symbolic)-instance-method","name":"delete","doc":"Start a DELETE table query","summary":"<p>Start a DELETE table query</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbolic"}],"args_string":"(table : Symbolic)","args_html":"(table : <a href=\"../Lustra/SQL/Symbolic.html\">Symbolic</a>)","location":{"filename":"src/lustra/sql/sql.cr","line_number":185,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L185"},"def":{"name":"delete","args":[{"name":"table","external_name":"table","restriction":"Symbolic"}],"visibility":"Public","body":"Lustra::SQL::DeleteQuery.new.from(table)"},"external_var":false},{"html_id":"escape(x:String|Symbol)-instance-method","name":"escape","doc":"Escape the expression, double quoting it.\n\nIt allows use of reserved keywords as table or column name\nNOTE: Escape is used for escaping postgresql keyword. For example\nif you have a column named order (which is a reserved word), you want\nto escape it by double-quoting it.\n\nFor escaping STRING value, please use Lustra::SQL.sanitize","summary":"<p>Escape the expression, double quoting it.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"String | Symbol"}],"args_string":"(x : String | Symbol)","args_html":"(x : String | Symbol)","location":{"filename":"src/lustra/sql/sql.cr","line_number":103,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L103"},"def":{"name":"escape","args":[{"name":"x","external_name":"x","restriction":"String | Symbol"}],"visibility":"Public","body":"(\"\\\"\" + (x.to_s.gsub(\"\\\"\", \"\\\"\\\"\"))) + \"\\\"\""},"external_var":false},{"html_id":"execute(connection_name:String,sql)-instance-method","name":"execute","doc":"Execute a SQL statement on a specific connection.\n\nUsage:\nLustra::SQL.execute(\"seconddatabase\", \"SELECT 1 FROM users\")","summary":"<p>Execute a SQL statement on a specific connection.</p>","abstract":false,"args":[{"name":"connection_name","external_name":"connection_name","restriction":"String"},{"name":"sql","external_name":"sql","restriction":""}],"args_string":"(connection_name : String, sql)","args_html":"(connection_name : String, sql)","location":{"filename":"src/lustra/sql/sql.cr","line_number":175,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L175"},"def":{"name":"execute","args":[{"name":"connection_name","external_name":"connection_name","restriction":"String"},{"name":"sql","external_name":"sql","restriction":""}],"visibility":"Public","body":"log_query(sql) do Lustra::SQL::ConnectionPool.with_connection(connection_name, &.exec_all(sql)) end"},"external_var":false},{"html_id":"execute(sql)-instance-method","name":"execute","doc":"Execute a SQL statement.\n\nUsage:\nLustra::SQL.execute(\"SELECT 1 FROM users\")","summary":"<p>Execute a SQL statement.</p>","abstract":false,"args":[{"name":"sql","external_name":"sql","restriction":""}],"args_string":"(sql)","args_html":"(sql)","location":{"filename":"src/lustra/sql/sql.cr","line_number":167,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L167"},"def":{"name":"execute","args":[{"name":"sql","external_name":"sql","restriction":""}],"visibility":"Public","body":"execute(\"default\", sql)"},"external_var":false},{"html_id":"init(name:String,url:String)-instance-method","name":"init","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"url","external_name":"url","restriction":"String"}],"args_string":"(name : String, url : String)","args_html":"(name : String, url : String)","location":{"filename":"src/lustra/sql/sql.cr","line_number":115,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L115"},"def":{"name":"init","args":[{"name":"name","external_name":"name","restriction":"String"},{"name":"url","external_name":"url","restriction":"String"}],"visibility":"Public","body":"Lustra::SQL::ConnectionPool.init(url, name)"},"external_var":false},{"html_id":"init(url:String)-instance-method","name":"init","abstract":false,"args":[{"name":"url","external_name":"url","restriction":"String"}],"args_string":"(url : String)","args_html":"(url : String)","location":{"filename":"src/lustra/sql/sql.cr","line_number":111,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L111"},"def":{"name":"init","args":[{"name":"url","external_name":"url","restriction":"String"}],"visibility":"Public","body":"Lustra::SQL::ConnectionPool.init(url, \"default\")"},"external_var":false},{"html_id":"init(connections:Hash(Symbolic,String))-instance-method","name":"init","abstract":false,"args":[{"name":"connections","external_name":"connections","restriction":"Hash(Symbolic, String)"}],"args_string":"(connections : Hash(Symbolic, String))","args_html":"(connections : Hash(<a href=\"../Lustra/SQL/Symbolic.html\">Symbolic</a>, String))","location":{"filename":"src/lustra/sql/sql.cr","line_number":119,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L119"},"def":{"name":"init","args":[{"name":"connections","external_name":"connections","restriction":"Hash(Symbolic, String)"}],"visibility":"Public","body":"connections.each do |name, url|\n  Lustra::SQL::ConnectionPool.init(url, name)\nend"},"external_var":false},{"html_id":"insert(table,args:NamedTuple)-instance-method","name":"insert","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"args","external_name":"args","restriction":"NamedTuple"}],"args_string":"(table, args : NamedTuple)","args_html":"(table, args : NamedTuple)","location":{"filename":"src/lustra/sql/sql.cr","line_number":214,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L214"},"def":{"name":"insert","args":[{"name":"table","external_name":"table","restriction":""},{"name":"args","external_name":"args","restriction":"NamedTuple"}],"visibility":"Public","body":"insert_into(table, args)"},"external_var":false},{"html_id":"insert(table,*args)-instance-method","name":"insert","doc":"Alias of `insert_into`, for hurry developers","summary":"<p>Alias of <code><a href=\"../Lustra/SQL.html#insert_into%28table%3ASymbolic%29-instance-method\">#insert_into</a></code>, for hurry developers</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""},{"name":"args","external_name":"args","restriction":""}],"args_string":"(table, *args)","args_html":"(table, *args)","location":{"filename":"src/lustra/sql/sql.cr","line_number":210,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L210"},"def":{"name":"insert","args":[{"name":"table","external_name":"table","restriction":""},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"insert_into(table, *args)"},"external_var":false},{"html_id":"insert-instance-method","name":"insert","doc":"Create a new INSERT query","summary":"<p>Create a new INSERT query</p>","abstract":false,"location":{"filename":"src/lustra/sql/sql.cr","line_number":205,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L205"},"def":{"name":"insert","visibility":"Public","body":"Lustra::SQL::InsertQuery.new"},"external_var":false},{"html_id":"insert_into(table:Symbolic)-instance-method","name":"insert_into","doc":"Prepare a new INSERT INTO table query\n:ditto:","summary":"<p>Prepare a new INSERT INTO table query :ditto:</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbolic"}],"args_string":"(table : Symbolic)","args_html":"(table : <a href=\"../Lustra/SQL/Symbolic.html\">Symbolic</a>)","location":{"filename":"src/lustra/sql/sql.cr","line_number":200,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L200"},"def":{"name":"insert_into","args":[{"name":"table","external_name":"table","restriction":"Symbolic"}],"visibility":"Public","body":"Lustra::SQL::InsertQuery.new(table)"},"external_var":false},{"html_id":"insert_into(table:Symbolic,*args)-instance-method","name":"insert_into","doc":"Start an INSERT INTO table query\n\n```\nLustra::SQL.insert_into(\"table\", {id: 1, name: \"hello\"}, {id: 2, name: \"World\"})\n```","summary":"<p>Start an INSERT INTO table query</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbolic"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(table : Symbolic, *args)","args_html":"(table : <a href=\"../Lustra/SQL/Symbolic.html\">Symbolic</a>, *args)","location":{"filename":"src/lustra/sql/sql.cr","line_number":194,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L194"},"def":{"name":"insert_into","args":[{"name":"table","external_name":"table","restriction":"Symbolic"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"(Lustra::SQL::InsertQuery.new(table)).values(*args)"},"external_var":false},{"html_id":"raw(x,*params)-instance-method","name":"raw","doc":"This provide a fast way to create SQL fragment while escaping items, both with `?` and `:key` system:\n\n```\nquery = Model.query.select(Lustra::SQL.raw(\"CASE WHEN x=:x THEN 1 ELSE 0 END AS check\", x: \"blabla\"))\nquery = Model.query.select(Lustra::SQL.raw(\"CASE WHEN x=? THEN 1 ELSE 0 END AS check\", \"blabla\"))\n```","summary":"<p>This provide a fast way to create SQL fragment while escaping items, both with <code>?</code> and <code>:key</code> system:</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""},{"name":"params","external_name":"params","restriction":""}],"args_string":"(x, *params)","args_html":"(x, *params)","location":{"filename":"src/lustra/sql/sql.cr","line_number":81,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L81"},"def":{"name":"raw","args":[{"name":"x","external_name":"x","restriction":""},{"name":"params","external_name":"params","restriction":""}],"splat_index":1,"visibility":"Public","body":"Lustra::Expression.raw(x, *params)"},"external_var":false},{"html_id":"raw(__template,**params)-instance-method","name":"raw","abstract":false,"args":[{"name":"__template","external_name":"__template","restriction":""}],"args_string":"(__template, **params)","args_html":"(__template, **params)","location":{"filename":"src/lustra/sql/sql.cr","line_number":91,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L91"},"def":{"name":"raw","args":[{"name":"__template","external_name":"__template","restriction":""}],"double_splat":{"name":"params","external_name":"params","restriction":""},"visibility":"Public","body":"Lustra::Expression.raw(__template, **params)"},"external_var":false},{"html_id":"raw_enum(x,params:Enumerable(T))forallT-instance-method","name":"raw_enum","doc":"See `self.raw`\nCan pass an array to this version","summary":"<p>See <code>self<a href=\"../Lustra/SQL.html#raw%28x%2C%2Aparams%29-instance-method\">.raw</a></code> Can pass an array to this version</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""},{"name":"params","external_name":"params","restriction":"Enumerable(T)"}],"args_string":"(x, params : Enumerable(T)) forall T","args_html":"(x, params : Enumerable(T)) forall T","location":{"filename":"src/lustra/sql/sql.cr","line_number":87,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L87"},"def":{"name":"raw_enum","args":[{"name":"x","external_name":"x","restriction":""},{"name":"params","external_name":"params","restriction":"Enumerable(T)"}],"visibility":"Public","body":"Lustra::Expression.raw_enum(x, params)"},"external_var":false},{"html_id":"rollback-instance-method","name":"rollback","doc":"Raise a rollback, in case of transaction","summary":"<p>Raise a rollback, in case of transaction</p>","abstract":false,"location":{"filename":"src/lustra/sql/sql.cr","line_number":158,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L158"},"def":{"name":"rollback","visibility":"Public","body":"raise(RollbackError.new)"},"external_var":false},{"html_id":"sanitize(x)-instance-method","name":"sanitize","doc":"Sanitize string and convert some literals (e.g. `Time`)","summary":"<p>Sanitize string and convert some literals (e.g.</p>","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/sql/sql.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L71"},"def":{"name":"sanitize","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"Lustra::Expression[x]"},"external_var":false},{"html_id":"select(*args)-instance-method","name":"select","doc":"Start a SELECT FROM table query","summary":"<p>Start a SELECT FROM table query</p>","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args)","args_html":"(*args)","location":{"filename":"src/lustra/sql/sql.cr","line_number":224,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L224"},"def":{"name":"select","args":[{"name":"args","external_name":"args","restriction":""}],"splat_index":0,"visibility":"Public","body":"if args.size > 0\n  Lustra::SQL::SelectQuery.new.select(*args)\nelse\n  Lustra::SQL::SelectQuery.new\nend"},"external_var":false},{"html_id":"unsafe(x)-instance-method","name":"unsafe","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x)","args_html":"(x)","location":{"filename":"src/lustra/sql/sql.cr","line_number":107,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L107"},"def":{"name":"unsafe","args":[{"name":"x","external_name":"x","restriction":""}],"visibility":"Public","body":"Lustra::Expression::UnsafeSql.new(x)"},"external_var":false},{"html_id":"update(table)-instance-method","name":"update","doc":"Start a UPDATE table query","summary":"<p>Start a UPDATE table query</p>","abstract":false,"args":[{"name":"table","external_name":"table","restriction":""}],"args_string":"(table)","args_html":"(table)","location":{"filename":"src/lustra/sql/sql.cr","line_number":219,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L219"},"def":{"name":"update","args":[{"name":"table","external_name":"table","restriction":""}],"visibility":"Public","body":"Lustra::SQL::UpdateQuery.new(table)"},"external_var":false},{"html_id":"with_savepoint(connection_name=\"default\",&)-instance-method","name":"with_savepoint","doc":"Create a transaction, but this one is stackable\nusing savepoints.\n\nExample:\n\n```\nLustra::SQL.with_savepoint do\n  # do something\n  Lustra::SQL.with_savepoint do\n    rollback # < Rollback only the last `with_savepoint` block\n  end\nend\n```","summary":"<p>Create a transaction, but this one is stackable using savepoints.</p>","abstract":false,"args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":""}],"args_string":"(connection_name = \"default\", &)","args_html":"(connection_name = <span class=\"s\">&quot;default&quot;</span>, &)","location":{"filename":"src/lustra/sql/sql.cr","line_number":144,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L144"},"def":{"name":"with_savepoint","args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"transaction do |cnx|\n  sp_name = \"sp_#{@@savepoint_uid = @@savepoint_uid + 1}\"\n  begin\n    execute(connection_name, \"SAVEPOINT #{sp_name}\")\n    yield\n    if cnx._in_transaction?\n      execute(connection_name, \"RELEASE SAVEPOINT #{sp_name}\")\n    end\n  rescue e : RollbackError\n    if cnx._in_transaction?\n      execute(connection_name, \"ROLLBACK TO SAVEPOINT #{sp_name}\")\n    end\n  end\nend"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/Any","path":"Lustra/SQL/Any.html","kind":"alias","full_name":"Lustra::SQL::Any","name":"Any","abstract":false,"locations":[{"filename":"src/lustra/sql/sql.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L56"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | BigDecimal | Bool | Char | Crypto::Bcrypt::Password | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | JSON::PullParser | Lustra::Expression::Literal | PG::Geo::Box | PG::Geo::Circle | PG::Geo::Line | PG::Geo::LineSegment | PG::Geo::Path | PG::Geo::Point | PG::Geo::Polygon | PG::Interval | PG::Numeric | Slice(UInt8) | String | Time | UInt16 | UInt32 | UInt64 | UInt8 | UUID | Nil)","aliased_html":"Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | <a href=\"../../BigDecimal.html\">BigDecimal</a> | Bool | <a href=\"../../Char.html\">Char</a> | <a href=\"../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | <a href=\"../../JSON/PullParser.html\">JSON::PullParser</a> | <a href=\"../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | <a href=\"../../PG/Geo/Box.html\">PG::Geo::Box</a> | <a href=\"../../PG/Geo/Circle.html\">PG::Geo::Circle</a> | <a href=\"../../PG/Geo/Line.html\">PG::Geo::Line</a> | <a href=\"../../PG/Geo/LineSegment.html\">PG::Geo::LineSegment</a> | <a href=\"../../PG/Geo/Path.html\">PG::Geo::Path</a> | <a href=\"../../PG/Geo/Point.html\">PG::Geo::Point</a> | <a href=\"../../PG/Geo/Polygon.html\">PG::Geo::Polygon</a> | <a href=\"../../PG/Interval.html\">PG::Interval</a> | <a href=\"../../PG/Numeric.html\">PG::Numeric</a> | <a href=\"../../Slice.html\">Slice(UInt8)</a> | String | <a href=\"../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | <a href=\"../../UUID.html\">UUID</a> | Nil","const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/CancelTransactionError","path":"Lustra/SQL/CancelTransactionError.html","kind":"class","full_name":"Lustra::SQL::CancelTransactionError","name":"CancelTransactionError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L16"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"doc":"Like rollback, but used into savepoint, it will revert completely the transaction","summary":"<p>Like rollback, but used into savepoint, it will revert completely the transaction</p>"},{"html_id":"lustra/Lustra/SQL/Column","path":"Lustra/SQL/Column.html","kind":"struct","full_name":"Lustra::SQL::Column","name":"Column","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/fragment/column.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L10"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new(value:Lustra::SQL::SelectBuilder|String|Symbol,var:String|Symbol|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"var","default_value":"nil","external_name":"var","restriction":"::String | ::Symbol | ::Nil"}],"args_string":"(value : Lustra::SQL::SelectBuilder | String | Symbol, var : String | Symbol | Nil = nil)","args_html":"(value : <a href=\"../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a> | String | Symbol, var : String | Symbol | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L14"},"def":{"name":"new","args":[{"name":"value","external_name":"value","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"var","default_value":"nil","external_name":"var","restriction":"::String | ::Symbol | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(value, var)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L17"},"def":{"name":"to_sql","visibility":"Public","body":"v = value\ncase v\nwhen String\n  [v, @var].compact.join(\" AS \")\nwhen Symbol\n  [SQL.escape(v.to_s), @var].compact.join(\" AS \")\nwhen SQL::SelectBuilder\n  [\"( #{v.to_sql} )\", @var].compact.join(\" AS \")\nelse\n  raise(QueryBuildingError.new(\"Only String and SelectQuery are allowed as column declaration\"))\nend\n"},"external_var":false},{"html_id":"value:Selectable-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L11"},"def":{"name":"value","return_type":"Selectable","visibility":"Public","body":"@value"},"external_var":false},{"html_id":"value=(value:Selectable)-instance-method","name":"value=","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"Selectable"}],"args_string":"(value : Selectable)","args_html":"(value : <a href=\"../../Lustra/SQL/Selectable.html\">Selectable</a>)","location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L11"},"def":{"name":"value=","args":[{"name":"value","external_name":"value","restriction":"Selectable"}],"visibility":"Public","body":"@value = value"},"external_var":false},{"html_id":"var:Symbolic|Nil-instance-method","name":"var","abstract":false,"location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L12"},"def":{"name":"var","return_type":"Symbolic | ::Nil","visibility":"Public","body":"@var"},"external_var":false},{"html_id":"var=(var:Symbolic|Nil)-instance-method","name":"var=","abstract":false,"args":[{"name":"var","external_name":"var","restriction":"Symbolic | ::Nil"}],"args_string":"(var : Symbolic | Nil)","args_html":"(var : <a href=\"../../Lustra/SQL/Symbolic.html\">Symbolic</a> | Nil)","location":{"filename":"src/lustra/sql/fragment/column.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/column.cr#L12"},"def":{"name":"var=","args":[{"name":"var","external_name":"var","restriction":"Symbolic | ::Nil"}],"visibility":"Public","body":"@var = var"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/ConnectionPool","path":"Lustra/SQL/ConnectionPool.html","kind":"class","full_name":"Lustra::SQL::ConnectionPool","name":"ConnectionPool","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/connection_pool.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/connection_pool.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"class_methods":[{"html_id":"init(uri,name)-class-method","name":"init","abstract":false,"args":[{"name":"uri","external_name":"uri","restriction":""},{"name":"name","external_name":"name","restriction":""}],"args_string":"(uri, name)","args_html":"(uri, name)","location":{"filename":"src/lustra/sql/connection_pool.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/connection_pool.cr#L6"},"def":{"name":"init","args":[{"name":"uri","external_name":"uri","restriction":""},{"name":"name","external_name":"name","restriction":""}],"visibility":"Public","body":"@@databases[name] = DB.open(uri)"},"external_var":false},{"html_id":"with_connection(target:String,&)-class-method","name":"with_connection","doc":"Retrieve a connection from the connection pool, or wait for it.\nIf the current Fiber already has a connection, the connection is returned;\n  this strategy provides easy usage of multiple statement connection (like BEGIN/ROLLBACK features).","summary":"<p>Retrieve a connection from the connection pool, or wait for it.</p>","abstract":false,"args":[{"name":"target","external_name":"target","restriction":"String"}],"args_string":"(target : String, &)","args_html":"(target : String, &)","location":{"filename":"src/lustra/sql/connection_pool.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/connection_pool.cr#L13"},"def":{"name":"with_connection","args":[{"name":"target","external_name":"target","restriction":"String"}],"yields":1,"block_arity":1,"visibility":"Public","body":"fiber_target = {target, Fiber.current}\n\ndatabase = @@databases.fetch(target) do raise(Lustra::ErrorMessages.uninitialized_db_connection(target)) end\n\ncnx = @@fiber_connections[fiber_target]?\n\nif cnx\n  yield cnx\nelse\n  database.using_connection do |new_connection|\n    begin\n      @@fiber_connections[fiber_target] = new_connection\n      yield new_connection\n    ensure\n      @@fiber_connections.delete(fiber_target)\n    end\n  end\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/DeleteQuery","path":"Lustra/SQL/DeleteQuery.html","kind":"class","full_name":"Lustra::SQL::DeleteQuery","name":"DeleteQuery","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/delete_query.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/delete_query.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new(table:String|Symbol|Nil=nil,wheres:Array(Lustra::Expression::Node)=[]ofLustra::Expression::Node)-class-method","name":"new","abstract":false,"args":[{"name":"table","default_value":"nil","external_name":"table","restriction":"::String | ::Symbol | ::Nil"},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":"::Array(::Lustra::Expression::Node)"}],"args_string":"(table : String | Symbol | Nil = nil, wheres : Array(Lustra::Expression::Node) = [] of Lustra::Expression::Node)","args_html":"(table : String | Symbol | Nil = <span class=\"n\">nil</span>, wheres : Array(<a href=\"../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Expression</span><span class=\"t\">::</span><span class=\"t\">Node</span>)","location":{"filename":"src/lustra/sql/delete_query.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/delete_query.cr#L11"},"def":{"name":"new","args":[{"name":"table","default_value":"nil","external_name":"table","restriction":"::String | ::Symbol | ::Nil"},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":"::Array(::Lustra::Expression::Node)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, wheres)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"from(table:String|Symbol|Nil)-instance-method","name":"from","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String | ::Symbol | ::Nil"}],"args_string":"(table : String | Symbol | Nil)","args_html":"(table : String | Symbol | Nil)","location":{"filename":"src/lustra/sql/delete_query.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/delete_query.cr#L14"},"def":{"name":"from","args":[{"name":"table","external_name":"table","restriction":"::String | ::Symbol | ::Nil"}],"visibility":"Public","body":"@table = table\nchange!\n"},"external_var":false},{"html_id":"table:Symbolic|Nil-instance-method","name":"table","abstract":false,"location":{"filename":"src/lustra/sql/delete_query.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/delete_query.cr#L4"},"def":{"name":"table","return_type":"Symbolic | ::Nil","visibility":"Public","body":"@table"},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/delete_query.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/delete_query.cr#L19"},"def":{"name":"to_sql","visibility":"Public","body":"if table = @table\nelse\n  raise(Lustra::ErrorMessages.query_building_error(\"Delete Query must have a `from` clause.\"))\nend\n\ntable = table.is_a?(Symbol) ? SQL.escape(table.to_s) : table\n\n[\"DELETE FROM\", table, print_wheres].compact.join(\" \")\n"},"external_var":false},{"html_id":"wheres:Array(Lustra::Expression::Node)-instance-method","name":"wheres","doc":"Return the list of where clause; each where clause are transformed into\nLustra::Expression::Node","summary":"<p>Return the list of where clause; each where clause are transformed into Lustra::Expression::Node</p>","abstract":false,"def":{"name":"wheres","return_type":"Array(Lustra::Expression::Node)","visibility":"Public","body":"@wheres"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Error","path":"Lustra/SQL/Error.html","kind":"class","full_name":"Lustra::SQL::Error","name":"Error","abstract":false,"superclass":{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"lustra/Lustra/SQL/CancelTransactionError","kind":"class","full_name":"Lustra::SQL::CancelTransactionError","name":"CancelTransactionError"},{"html_id":"lustra/Lustra/SQL/ExecutionError","kind":"class","full_name":"Lustra::SQL::ExecutionError","name":"ExecutionError"},{"html_id":"lustra/Lustra/SQL/OperationNotPermittedError","kind":"class","full_name":"Lustra::SQL::OperationNotPermittedError","name":"OperationNotPermittedError"},{"html_id":"lustra/Lustra/SQL/QueryBuildingError","kind":"class","full_name":"Lustra::SQL::QueryBuildingError","name":"QueryBuildingError"},{"html_id":"lustra/Lustra/SQL/RecordNotFoundError","kind":"class","full_name":"Lustra::SQL::RecordNotFoundError","name":"RecordNotFoundError"},{"html_id":"lustra/Lustra/SQL/RollbackError","kind":"class","full_name":"Lustra::SQL::RollbackError","name":"RollbackError"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/ExecutionError","path":"Lustra/SQL/ExecutionError.html","kind":"class","full_name":"Lustra::SQL::ExecutionError","name":"ExecutionError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/Fragment","path":"Lustra/SQL/Fragment.html","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment","abstract":true,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/fragment/fragment.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/fragment.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"subclasses":[{"html_id":"lustra/Lustra/SQL/Column","kind":"struct","full_name":"Lustra::SQL::Column","name":"Column"},{"html_id":"lustra/Lustra/SQL/From","kind":"struct","full_name":"Lustra::SQL::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Join","kind":"struct","full_name":"Lustra::SQL::Join","name":"Join"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/sql/fragment/fragment.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/fragment.cr#L2"},"def":{"name":"new","visibility":"Public","body":"x = allocate\nif x.responds_to?(:finalize)\n  ::GC.add_finalizer(x)\nend\nx\n"},"external_var":false}],"instance_methods":[{"html_id":"initialize-instance-method","name":"initialize","abstract":false,"location":{"filename":"src/lustra/sql/fragment/fragment.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/fragment.cr#L2"},"def":{"name":"initialize","visibility":"Public","body":""},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":true,"location":{"filename":"src/lustra/sql/fragment/fragment.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/fragment.cr#L3"},"def":{"name":"to_sql","visibility":"Public","body":""},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/From","path":"Lustra/SQL/From.html","kind":"struct","full_name":"Lustra::SQL::From","name":"From","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/fragment/from.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new(value:Lustra::SQL::SelectBuilder|String|Symbol,var:String|Symbol|Nil=nil)-class-method","name":"new","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"var","default_value":"nil","external_name":"var","restriction":"::String | ::Symbol | ::Nil"}],"args_string":"(value : Lustra::SQL::SelectBuilder | String | Symbol, var : String | Symbol | Nil = nil)","args_html":"(value : <a href=\"../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a> | String | Symbol, var : String | Symbol | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L8"},"def":{"name":"new","args":[{"name":"value","external_name":"value","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"var","default_value":"nil","external_name":"var","restriction":"::String | ::Symbol | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(value, var)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L11"},"def":{"name":"to_sql","visibility":"Public","body":"v = value\ncase v\nwhen Symbol\n  [Lustra::SQL.escape(v), @var].compact.join(\" AS \")\nwhen String\n  [v, @var].compact.join(\" AS \")\nwhen SQL::SelectBuilder\n  if @var.nil?\n    raise(Lustra::ErrorMessages.query_building_error(\"Subquery `from` clause must have variable name\"))\n  end\n  [\"(#{v.to_sql})\", @var].compact.join(\" \")\nelse\n  raise(Lustra::ErrorMessages.query_building_error(\"Only String and SelectQuery objects are allowed as `from` declaration\"))\nend\n"},"external_var":false},{"html_id":"value:Selectable-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L5"},"def":{"name":"value","return_type":"Selectable","visibility":"Public","body":"@value"},"external_var":false},{"html_id":"value=(value:Selectable)-instance-method","name":"value=","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"Selectable"}],"args_string":"(value : Selectable)","args_html":"(value : <a href=\"../../Lustra/SQL/Selectable.html\">Selectable</a>)","location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L5"},"def":{"name":"value=","args":[{"name":"value","external_name":"value","restriction":"Selectable"}],"visibility":"Public","body":"@value = value"},"external_var":false},{"html_id":"var:Symbolic|Nil-instance-method","name":"var","abstract":false,"location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L6"},"def":{"name":"var","return_type":"Symbolic | ::Nil","visibility":"Public","body":"@var"},"external_var":false},{"html_id":"var=(var:Symbolic|Nil)-instance-method","name":"var=","abstract":false,"args":[{"name":"var","external_name":"var","restriction":"Symbolic | ::Nil"}],"args_string":"(var : Symbolic | Nil)","args_html":"(var : <a href=\"../../Lustra/SQL/Symbolic.html\">Symbolic</a> | Nil)","location":{"filename":"src/lustra/sql/fragment/from.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/from.cr#L6"},"def":{"name":"var=","args":[{"name":"var","external_name":"var","restriction":"Symbolic | ::Nil"}],"visibility":"Public","body":"@var = var"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/InsertQuery","path":"Lustra/SQL/InsertQuery.html","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Query/OnConflict","kind":"module","full_name":"Lustra::SQL::Query::OnConflict","name":"OnConflict"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/insert_query.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L18"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/OnConflict","kind":"module","full_name":"Lustra::SQL::Query::OnConflict","name":"OnConflict"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"doc":"\nAn insert query\n\ncf. postgres documentation\n\n```\n[ WITH [ RECURSIVE ] with_query [, ...] ]\nINSERT INTO table_name [ AS alias ] [ ( column_name [, ...] ) ]\n   { DEFAULT VALUES | VALUES ( { expression | DEFAULT } [, ...] ) [, ...] | query }\n   [ ON CONFLICT [ conflict_target ] conflict_action ]\n   [ RETURNING * | output_expression [ [ AS ] output_name ] [, ...] ]\n```","summary":"<p>An insert query</p>","constructors":[{"html_id":"new(table:Symbol|String,values)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbol | String"},{"name":"values","external_name":"values","restriction":""}],"args_string":"(table : Symbol | String, values)","args_html":"(table : Symbol | String, values)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L33"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"Symbol | String"},{"name":"values","external_name":"values","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, values)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(table:Symbol|String)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbol | String"}],"args_string":"(table : Symbol | String)","args_html":"(table : Symbol | String)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L30"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"Symbol | String"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clear_values-instance-method","name":"clear_values","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":85,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L85"},"def":{"name":"clear_values","visibility":"Public","body":"@values = [] of Array(Inserable)\n\nchange!\n"},"external_var":false},{"html_id":"columns(*args:Array(String|Symbol))-instance-method","name":"columns","doc":"Used with values","summary":"<p>Used with values</p>","abstract":false,"args":[{"name":"args","external_name":"args","restriction":"::Array(::String | ::Symbol)"}],"args_string":"(*args : Array(String | Symbol))","args_html":"(*args : Array(String | Symbol))","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":138,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L138"},"def":{"name":"columns","args":[{"name":"args","external_name":"args","restriction":"::Array(::String | ::Symbol)"}],"splat_index":0,"visibility":"Public","body":"@keys = args\n\nchange!\n"},"external_var":false},{"html_id":"execute(connection_name:String=\"default\"):Hash(String,Lustra::SQL::Any)-instance-method","name":"execute","abstract":false,"args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"args_string":"(connection_name : String = \"default\") : Hash(String, Lustra::SQL::Any)","args_html":"(connection_name : String = <span class=\"s\">&quot;default&quot;</span>) : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L71"},"def":{"name":"execute","args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"return_type":"Hash(String, ::Lustra::SQL::Any)","visibility":"Public","body":"o = {} of String => ::Lustra::SQL::Any\n\nif @returning.nil?\n  s = to_sql\n  Lustra::SQL.execute(connection_name, s)\nelse\n  fetch(connection_name) do |x| o = x end\nend\n\no\n"},"external_var":false},{"html_id":"fetch(connection_name:String=\"default\",&:Hash(String,Lustra::SQL::Any)->Nil)-instance-method","name":"fetch","abstract":false,"args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"args_string":"(connection_name : String = \"default\", & : Hash(String, Lustra::SQL::Any) -> Nil)","args_html":"(connection_name : String = <span class=\"s\">&quot;default&quot;</span>, & : Hash(String, <a href=\"../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>) -> Nil)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L40"},"def":{"name":"fetch","args":[{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(Hash(String, ::Lustra::SQL::Any) -> Nil)"},"visibility":"Public","body":"h = {} of String => ::Lustra::SQL::Any\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  begin\n    sql = to_sql\n    rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n    fetch_result_set(h, rs) do |x| yield(x) end\n  ensure\n    rs.try(&.close)\n  end\nend\n"},"external_var":false},{"html_id":"into(table:Symbol|String)-instance-method","name":"into","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"Symbol | String"}],"args_string":"(table : Symbol | String)","args_html":"(table : Symbol | String)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L37"},"def":{"name":"into","args":[{"name":"table","external_name":"table","restriction":"Symbol | String"}],"visibility":"Public","body":"@table = table"},"external_var":false},{"html_id":"keys:Array(Symbolic)-instance-method","name":"keys","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L25"},"def":{"name":"keys","return_type":"Array(Symbolic)","visibility":"Public","body":"@keys"},"external_var":false},{"html_id":"returning(str:String)-instance-method","name":"returning","abstract":false,"args":[{"name":"str","external_name":"str","restriction":"String"}],"args_string":"(str : String)","args_html":"(str : String)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":161,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L161"},"def":{"name":"returning","args":[{"name":"str","external_name":"str","restriction":"String"}],"visibility":"Public","body":"@returning = str\n\nchange!\n"},"external_var":false},{"html_id":"returning:String|Nil-instance-method","name":"returning","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L28"},"def":{"name":"returning","return_type":"String | ::Nil","visibility":"Public","body":"@returning"},"external_var":false},{"html_id":"size:Int32-instance-method","name":"size","doc":"Number of rows of this insertion request","summary":"<p>Number of rows of this insertion request</p>","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":168,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L168"},"def":{"name":"size","return_type":"Int32","visibility":"Public","body":"v = @values\nv.is_a?(Array) ? v.size : -1\n"},"external_var":false},{"html_id":"table:Symbol|String-instance-method","name":"table","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L27"},"def":{"name":"table","return_type":"Symbol | String","visibility":"Public","body":"if (__temp_136 = @table).nil?\n  ::raise(::NilAssertionError.new(\"Lustra::SQL::InsertQuery#table cannot be nil\"))\nelse\n  __temp_136\nend"},"external_var":false},{"html_id":"table?:Symbol|String|Nil-instance-method","name":"table?","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L27"},"def":{"name":"table?","return_type":"Symbol | String | ::Nil","visibility":"Public","body":"@table"},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":187,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L187"},"def":{"name":"to_sql","visibility":"Public","body":"if table = @table\nelse\n  raise(QueryBuildingError.new(\"You must provide a `into` clause\"))\nend\n\ntable = table.is_a?(Symbol) ? Lustra::SQL.escape(table) : table\n\no = [print_ctes, \"INSERT INTO\", table, print_keys]\nv = @values\ncase v\nwhen SelectBuilder\n  o << ((\"(\" + v.to_sql) + \")\")\nelse\n  if v.empty? || ((v.size == 1) && v[0].empty?)\n    o << \"DEFAULT VALUES\"\n  else\n    o << \"VALUES\"\n    o << print_values\n  end\nend\n\nprint_on_conflict(o)\n\nif @returning\n  o << \"RETURNING\"\n  o << @returning\nend\n\no.compact.join(\" \")\n"},"external_var":false},{"html_id":"values(row:Hash(Symbolic,Inserable))-instance-method","name":"values","abstract":false,"args":[{"name":"row","external_name":"row","restriction":"Hash(Symbolic, Inserable)"}],"args_string":"(row : Hash(Symbolic, Inserable))","args_html":"(row : Hash(<a href=\"../../Lustra/SQL/Symbolic.html\">Symbolic</a>, <a href=\"../../Lustra/SQL/InsertQuery/Inserable.html\">Inserable</a>))","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":108,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L108"},"def":{"name":"values","args":[{"name":"row","external_name":"row","restriction":"Hash(Symbolic, Inserable)"}],"visibility":"Public","body":"@keys = row.keys.to_a.map() do |__arg3| __arg3.as(Symbolic) end\n\ncase v = @values\nwhen Array(Array(Inserable))\n  v << row.values.to_a.map() do |__arg4| __arg4.as(Inserable) end\nelse\n  raise(\"Cannot insert both from SELECT query and from data\")\nend\n\nchange!\n"},"external_var":false},{"html_id":"values(rows:Array(Hash(Symbolic,Inserable)))-instance-method","name":"values","abstract":false,"args":[{"name":"rows","external_name":"rows","restriction":"Array(Hash(Symbolic, Inserable))"}],"args_string":"(rows : Array(Hash(Symbolic, Inserable)))","args_html":"(rows : Array(Hash(<a href=\"../../Lustra/SQL/Symbolic.html\">Symbolic</a>, <a href=\"../../Lustra/SQL/InsertQuery/Inserable.html\">Inserable</a>)))","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":129,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L129"},"def":{"name":"values","args":[{"name":"rows","external_name":"rows","restriction":"Array(Hash(Symbolic, Inserable))"}],"visibility":"Public","body":"rows.each do |nt|\n  values(nt)\nend\n\nchange!\n"},"external_var":false},{"html_id":"values(row:NamedTuple)-instance-method","name":"values","doc":"Fast insert system\n\ninsert({field: \"value\"}).into(:table)","summary":"<p>Fast insert system</p>","abstract":false,"args":[{"name":"row","external_name":"row","restriction":"NamedTuple"}],"args_string":"(row : NamedTuple)","args_html":"(row : NamedTuple)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":95,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L95"},"def":{"name":"values","args":[{"name":"row","external_name":"row","restriction":"NamedTuple"}],"visibility":"Public","body":"@keys = row.keys.to_a.map() do |__arg1| __arg1.as(Symbolic) end\n\ncase v = @values\nwhen Array(Array(Inserable))\n  v << row.values.to_a.map() do |__arg2| __arg2.as(Inserable) end\nelse\n  raise(\"Cannot insert both from SELECT query and from data\")\nend\n\nchange!\n"},"external_var":false},{"html_id":"values(rows:Array(NamedTuple))-instance-method","name":"values","abstract":false,"args":[{"name":"rows","external_name":"rows","restriction":"Array(NamedTuple)"}],"args_string":"(rows : Array(NamedTuple))","args_html":"(rows : Array(NamedTuple))","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":121,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L121"},"def":{"name":"values","args":[{"name":"rows","external_name":"rows","restriction":"Array(NamedTuple)"}],"visibility":"Public","body":"rows.each do |nt|\n  values(nt)\nend\n\nchange!\n"},"external_var":false},{"html_id":"values(select_query:SelectBuilder)-instance-method","name":"values","doc":"Insert into ... (...) SELECT","summary":"<p>Insert into ...</p>","abstract":false,"args":[{"name":"select_query","external_name":"select_query","restriction":"SelectBuilder"}],"args_string":"(select_query : SelectBuilder)","args_html":"(select_query : <a href=\"../../Lustra/SQL/SelectBuilder.html\">SelectBuilder</a>)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":151,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L151"},"def":{"name":"values","args":[{"name":"select_query","external_name":"select_query","restriction":"SelectBuilder"}],"visibility":"Public","body":"if @values.is_a?(Array) && (@values.as(Array)).present?\n  raise(QueryBuildingError.new(\"Cannot insert both from SELECT and from data\"))\nend\n\n@values = select_query\n\nchange!\n"},"external_var":false},{"html_id":"values:SelectBuilder|Array(Array(Inserable))-instance-method","name":"values","abstract":false,"location":{"filename":"src/lustra/sql/insert_query.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L26"},"def":{"name":"values","return_type":"SelectBuilder | Array(Array(Inserable))","visibility":"Public","body":"@values"},"external_var":false},{"html_id":"values(*args)-instance-method","name":"values","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args)","args_html":"(*args)","location":{"filename":"src/lustra/sql/insert_query.cr","line_number":144,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L144"},"def":{"name":"values","args":[{"name":"args","external_name":"args","restriction":""}],"splat_index":0,"visibility":"Public","body":"@values << args\n\nchange!\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/InsertQuery/Inserable","path":"Lustra/SQL/InsertQuery/Inserable.html","kind":"alias","full_name":"Lustra::SQL::InsertQuery::Inserable","name":"Inserable","abstract":false,"locations":[{"filename":"src/lustra/sql/insert_query.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/insert_query.cr#L24"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | BigDecimal | BigFloat | BigInt | Bool | Char | Crypto::Bcrypt::Password | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | JSON::PullParser | Lustra::Expression::Literal | PG::Geo::Box | PG::Geo::Circle | PG::Geo::Line | PG::Geo::LineSegment | PG::Geo::Path | PG::Geo::Point | PG::Geo::Polygon | PG::Interval | PG::Numeric | Slice(UInt8) | String | Time | UInt16 | UInt32 | UInt64 | UInt8 | UUID | Nil)","aliased_html":"Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | <a href=\"../../../BigDecimal.html\">BigDecimal</a> | BigFloat | BigInt | Bool | <a href=\"../../../Char.html\">Char</a> | <a href=\"../../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | <a href=\"../../../JSON/PullParser.html\">JSON::PullParser</a> | <a href=\"../../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | <a href=\"../../../PG/Geo/Box.html\">PG::Geo::Box</a> | <a href=\"../../../PG/Geo/Circle.html\">PG::Geo::Circle</a> | <a href=\"../../../PG/Geo/Line.html\">PG::Geo::Line</a> | <a href=\"../../../PG/Geo/LineSegment.html\">PG::Geo::LineSegment</a> | <a href=\"../../../PG/Geo/Path.html\">PG::Geo::Path</a> | <a href=\"../../../PG/Geo/Point.html\">PG::Geo::Point</a> | <a href=\"../../../PG/Geo/Polygon.html\">PG::Geo::Polygon</a> | <a href=\"../../../PG/Interval.html\">PG::Interval</a> | <a href=\"../../../PG/Numeric.html\">PG::Numeric</a> | <a href=\"../../../Slice.html\">Slice(UInt8)</a> | String | <a href=\"../../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | <a href=\"../../../UUID.html\">UUID</a> | Nil","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/InsertQuery","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery"}}]},{"html_id":"lustra/Lustra/SQL/Join","path":"Lustra/SQL/Join.html","kind":"struct","full_name":"Lustra::SQL::Join","name":"Join","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Fragment","kind":"struct","full_name":"Lustra::SQL::Fragment","name":"Fragment"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/fragment/join.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"TYPE","name":"TYPE","value":"{left: \"LEFT JOIN\",\n  inner: \"INNER JOIN\",\n  right: \"RIGHT JOIN\",\n  full_outer: \"FULL OUTER JOIN\",\n  cross: \"CROSS JOIN\"}"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new(from:Lustra::SQL::SelectBuilder|String|Symbol,condition:Lustra::Expression::Node|Nil=nil,lateral:Bool=false,type:Symbol=:inner)-class-method","name":"new","abstract":false,"args":[{"name":"from","external_name":"from","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"condition","default_value":"nil","external_name":"condition","restriction":"::Lustra::Expression::Node | ::Nil"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":"::Bool"},{"name":"type","default_value":":inner","external_name":"type","restriction":"Symbol"}],"args_string":"(from : Lustra::SQL::SelectBuilder | String | Symbol, condition : Lustra::Expression::Node | Nil = nil, lateral : Bool = false, type : Symbol = :inner)","args_html":"(from : <a href=\"../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a> | String | Symbol, condition : <a href=\"../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a> | Nil = <span class=\"n\">nil</span>, lateral : Bool = <span class=\"n\">false</span>, type : Symbol = <span class=\"n\">:inner</span>)","location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":16,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L16"},"def":{"name":"new","args":[{"name":"from","external_name":"from","restriction":"::Lustra::SQL::SelectBuilder | ::String | ::Symbol"},{"name":"condition","default_value":"nil","external_name":"condition","restriction":"::Lustra::Expression::Node | ::Nil"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":"::Bool"},{"name":"type","default_value":":inner","external_name":"type","restriction":"Symbol"}],"visibility":"Public","body":"_ = allocate\n_.initialize(from, condition, lateral, type)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"condition:Lustra::Expression::Node|Nil-instance-method","name":"condition","abstract":false,"location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L13"},"def":{"name":"condition","return_type":"Lustra::Expression::Node | ::Nil","visibility":"Public","body":"@condition"},"external_var":false},{"html_id":"from:Selectable-instance-method","name":"from","abstract":false,"location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L12"},"def":{"name":"from","return_type":"Selectable","visibility":"Public","body":"@from"},"external_var":false},{"html_id":"lateral?:Bool-instance-method","name":"lateral?","abstract":false,"location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L14"},"def":{"name":"lateral?","return_type":"Bool","visibility":"Public","body":"@lateral"},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":20,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L20"},"def":{"name":"to_sql","visibility":"Public","body":"from = @from\n\nfrom = case from\nwhen SQL::SelectBuilder\n  \"(#{from.to_sql})\"\nelse\n  from.to_s\nend\n\nif c = @condition\n  [type, lateral? ? \"LATERAL\" : nil, from, \"ON\", c.resolve].compact.join(\" \")\nelse\n  [type, lateral? ? \"LATERAL\" : nil, SQL.sel_str(from)].compact.join(\" \")\nend\n"},"external_var":false},{"html_id":"type:String-instance-method","name":"type","abstract":false,"location":{"filename":"src/lustra/sql/fragment/join.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/fragment/join.cr#L11"},"def":{"name":"type","return_type":"String","visibility":"Public","body":"@type"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/JSONB","path":"Lustra/SQL/JSONB.html","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L32"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"}],"including_types":[{"html_id":"lustra/Lustra/Expression/Node/JSONB/Equality","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Equality","name":"Equality"},{"html_id":"lustra/Lustra/Expression/Node/JSONB/Field","kind":"class","full_name":"Lustra::Expression::Node::JSONB::Field","name":"Field"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"instance_methods":[{"html_id":"jsonb_all_exists?(field,keys:Array(String))-instance-method","name":"jsonb_all_exists?","doc":"jsonb `?&` operator\nDo all of these array strings exist as top-level keys?","summary":"<p>jsonb <code>?&amp;</code> operator Do all of these array strings exist as top-level keys?</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"keys","external_name":"keys","restriction":"Array(String)"}],"args_string":"(field, keys : Array(String))","args_html":"(field, keys : Array(String))","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L56"},"def":{"name":"jsonb_all_exists?","args":[{"name":"field","external_name":"field","restriction":""},{"name":"keys","external_name":"keys","restriction":"Array(String)"}],"visibility":"Public","body":"{field, (\"array[\" + (keys.join(\",\") do |x| Lustra::SQL.sanitize(x) end)) + \"]\"}.join(\" ?& \")"},"external_var":false},{"html_id":"jsonb_any_exists?(field,keys:Array(String))-instance-method","name":"jsonb_any_exists?","doc":"jsonb `?|` operator\nDo any of these array strings exist as top-level keys?","summary":"<p>jsonb <code>?|</code> operator Do any of these array strings exist as top-level keys?</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"keys","external_name":"keys","restriction":"Array(String)"}],"args_string":"(field, keys : Array(String))","args_html":"(field, keys : Array(String))","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":45,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L45"},"def":{"name":"jsonb_any_exists?","args":[{"name":"field","external_name":"field","restriction":""},{"name":"keys","external_name":"keys","restriction":"Array(String)"}],"visibility":"Public","body":"{field, (\"array[\" + (keys.join(\",\") do |x| Lustra::SQL.sanitize(x) end)) + \"]\"}.join(\" ?| \")"},"external_var":false},{"html_id":"jsonb_eq(field,key,value)-instance-method","name":"jsonb_eq","doc":"Test equality using the `@>` operator\n\n```\njsonb_eq(\"data.sub.key\", \"value\")\n```\n\n=> `data @> '{\"sub\": {\"key\": \"value\"}}' `","summary":"<p>Test equality using the <code>@&gt;</code> operator</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"key","external_name":"key","restriction":""},{"name":"value","external_name":"value","restriction":""}],"args_string":"(field, key, value)","args_html":"(field, key, value)","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":112,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L112"},"def":{"name":"jsonb_eq","args":[{"name":"field","external_name":"field","restriction":""},{"name":"key","external_name":"key","restriction":""},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"arr = jsonb_k2a(key)\n\nif arr.empty?\n  {field, Lustra::Expression[value]}.join(\" = \")\nelse\n  {field, Lustra::Expression[(jsonb_arr2h(arr, value)).to_json]}.join(\" @> \")\nend\n"},"external_var":false},{"html_id":"jsonb_exists?(field,value)-instance-method","name":"jsonb_exists?","doc":"Does the string exist as a top-level key within the JSON value?","summary":"<p>Does the string exist as a top-level key within the JSON value?</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"value","external_name":"value","restriction":""}],"args_string":"(field, value)","args_html":"(field, value)","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":50,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L50"},"def":{"name":"jsonb_exists?","args":[{"name":"field","external_name":"field","restriction":""},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"{field, Lustra::SQL.sanitize(value)}.join(\" ? \")"},"external_var":false},{"html_id":"jsonb_k2h(key:String,value:JSONBKey):JSONBHash-instance-method","name":"jsonb_k2h","doc":"Transform a key to a hash","summary":"<p>Transform a key to a hash</p>","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"value","external_name":"value","restriction":"JSONBKey"}],"args_string":"(key : String, value : JSONBKey) : JSONBHash","args_html":"(key : String, value : <a href=\"../../Lustra/SQL/JSONB/JSONBKey.html\">JSONBKey</a>) : <a href=\"../../Lustra/SQL/JSONB/JSONBHash.html\">JSONBHash</a>","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L39"},"def":{"name":"jsonb_k2h","args":[{"name":"key","external_name":"key","restriction":"String"},{"name":"value","external_name":"value","restriction":"JSONBKey"}],"return_type":"JSONBHash","visibility":"Public","body":"jsonb_arr2h(jsonb_k2a(key), value)"},"external_var":false},{"html_id":"jsonb_resolve(field,arr:Array(String),cast=nil):String-instance-method","name":"jsonb_resolve","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"arr","external_name":"arr","restriction":"Array(String)"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":""}],"args_string":"(field, arr : Array(String), cast = nil) : String","args_html":"(field, arr : Array(String), cast = <span class=\"n\">nil</span>) : String","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":122,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L122"},"def":{"name":"jsonb_resolve","args":[{"name":"field","external_name":"field","restriction":""},{"name":"arr","external_name":"arr","restriction":"Array(String)"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":""}],"return_type":"String","visibility":"Public","body":"if arr.empty?\n  return field\nend\n\no = ([field] + Lustra::Expression[arr]).join(\"->\")\n\nif cast\n  o = \"(#{o})::#{cast}\"\nend\n\no\n"},"external_var":false},{"html_id":"jsonb_resolve(field,key:String,cast=nil)-instance-method","name":"jsonb_resolve","doc":"Return text selector for the field/key :\n\n```\njsonb_text(\"data\", \"sub.key\").like(\"user%\")\n# => \"data->'sub'->>'key' LIKE 'user%'\"\n```","summary":"<p>Return text selector for the field/key :</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"key","external_name":"key","restriction":"String"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":""}],"args_string":"(field, key : String, cast = nil)","args_html":"(field, key : String, cast = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":138,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L138"},"def":{"name":"jsonb_resolve","args":[{"name":"field","external_name":"field","restriction":""},{"name":"key","external_name":"key","restriction":"String"},{"name":"cast","default_value":"nil","external_name":"cast","restriction":""}],"visibility":"Public","body":"arr = jsonb_k2a(key)\njsonb_resolve(field, arr, cast)\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/JSONB/JSONBHash","path":"Lustra/SQL/JSONB/JSONBHash.html","kind":"alias","full_name":"Lustra::SQL::JSONB::JSONBHash","name":"JSONBHash","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L36"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"Hash(String, Lustra::SQL::JSONB::JSONBKey)","aliased_html":"Hash(String, <a href=\"../../../Lustra/SQL/JSONB/JSONBKey.html\">Lustra::SQL::JSONB::JSONBKey</a>)","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"}},{"html_id":"lustra/Lustra/SQL/JSONB/JSONBKey","path":"Lustra/SQL/JSONB/JSONBKey.html","kind":"alias","full_name":"Lustra::SQL::JSONB::JSONBKey","name":"JSONBKey","abstract":false,"locations":[{"filename":"src/lustra/extensions/jsonb/jsonb.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/jsonb/jsonb.cr#L35"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Bool | Float32 | Float64 | Hash(String, Lustra::SQL::JSONB::JSONBKey) | Int16 | Int32 | Int64 | Int8 | Lustra::Expression::Literal | String | Symbol | Time | UInt16 | UInt32 | UInt64 | UInt8 | Nil)","aliased_html":"Bool | Float32 | Float64 | Hash(String, <a href=\"../../../Lustra/SQL/JSONB/JSONBKey.html\">Lustra::SQL::JSONB::JSONBKey</a>) | Int16 | Int32 | Int64 | Int8 | <a href=\"../../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | String | Symbol | <a href=\"../../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | Nil","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/JSONB","kind":"module","full_name":"Lustra::SQL::JSONB","name":"JSONB"}}]},{"html_id":"lustra/Lustra/SQL/Logger","path":"Lustra/SQL/Logger.html","kind":"module","full_name":"Lustra::SQL::Logger","name":"Logger","abstract":false,"locations":[{"filename":"src/lustra/sql/logger.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L4"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"class_methods":[{"html_id":"colorize=(colorize:Bool)-class-method","name":"colorize=","abstract":false,"args":[{"name":"colorize","external_name":"colorize","restriction":"Bool"}],"args_string":"(colorize : Bool)","args_html":"(colorize : Bool)","location":{"filename":"src/lustra/sql/logger.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L5"},"def":{"name":"colorize=","args":[{"name":"colorize","external_name":"colorize","restriction":"Bool"}],"visibility":"Public","body":"@@colorize = colorize"},"external_var":false},{"html_id":"colorize?:Bool-class-method","name":"colorize?","abstract":false,"location":{"filename":"src/lustra/sql/logger.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L5"},"def":{"name":"colorize?","return_type":"Bool","visibility":"Public","body":"@@colorize"},"external_var":false},{"html_id":"colorize_query(qry:String)-class-method","name":"colorize_query","abstract":false,"args":[{"name":"qry","external_name":"qry","restriction":"String"}],"args_string":"(qry : String)","args_html":"(qry : String)","location":{"filename":"src/lustra/sql/logger.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L21"},"def":{"name":"colorize_query","args":[{"name":"qry","external_name":"qry","restriction":"String"}],"visibility":"Public","body":"if @@colorize\nelse\n  return qry\nend\n\no = (qry.to_s.split(/([a-zA-Z0-9_]+)/)).join(\"\") do |word|\n  if SQL_KEYWORDS.includes?(word.upcase)\n    word.colorize.bold.blue.to_s\n  elsif word =~ (/\\d+/)\n    word.colorize.red\n  else\n    word.colorize.white\n  end\nend\n\no.gsub(/(--.*)$/) do |__arg0| __arg0.colorize.dark_gray end\n"},"external_var":false},{"html_id":"display_mn_sec(x):String-class-method","name":"display_mn_sec","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/sql/logger.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L37"},"def":{"name":"display_mn_sec","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"mn = x.to_i / 60\nsc = x.to_i % 60\n\n({mn > 9 ? mn : \"0#{mn}\", sc > 9 ? sc : \"0#{sc}\"}.join(\"mn\")) + \"s\"\n"},"external_var":false},{"html_id":"display_time(x):String-class-method","name":"display_time","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : String","args_html":"(x) : String","location":{"filename":"src/lustra/sql/logger.cr","line_number":44,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L44"},"def":{"name":"display_time","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"String","visibility":"Public","body":"if x > 60\n  display_mn_sec(x)\nelsif x > 1\n  (\"%.2f\" % x) + \"s\"\nelsif x > 0.001\n  (1000 * x).to_i.to_s + \"ms\"\nelse\n  (1000000 * x).to_i.to_s + \"µs\"\nend"},"external_var":false}],"instance_methods":[{"html_id":"log_query(sql,&)-instance-method","name":"log_query","abstract":false,"args":[{"name":"sql","external_name":"sql","restriction":""}],"args_string":"(sql, &)","args_html":"(sql, &)","location":{"filename":"src/lustra/sql/logger.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/logger.cr#L56"},"def":{"name":"log_query","args":[{"name":"sql","external_name":"sql","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"begin\n  start_time = Time.monotonic\n\n  o = yield\n  elapsed_time = Time.monotonic - start_time\n\n  Log.debug do (\"[\" + (Lustra::SQL::Logger.display_time(elapsed_time.to_f)).colorize.bold.white.to_s) + \"] #{SQL::Logger.colorize_query(sql)}\" end\n\n  o\nrescue e\n  raise(Lustra::SQL::Error.new(message: [e.message, \"Error caught, last query was:\", Lustra::SQL::Logger.colorize_query(sql)].compact.join(\"\\n\"), cause: e))\nend"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/OperationNotPermittedError","path":"Lustra/SQL/OperationNotPermittedError.html","kind":"class","full_name":"Lustra::SQL::OperationNotPermittedError","name":"OperationNotPermittedError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L8"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/Query","path":"Lustra/SQL/Query.html","kind":"module","full_name":"Lustra::SQL::Query","name":"Query","abstract":false,"locations":[{"filename":"src/lustra/sql/query/aggregate.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"types":[{"html_id":"lustra/Lustra/SQL/Query/Aggregate","path":"Lustra/SQL/Query/Aggregate.html","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate","abstract":false,"locations":[{"filename":"src/lustra/sql/query/aggregate.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"agg(field,x:X.class)forallX-instance-method","name":"agg","doc":"Call an custom aggregation function, like MEDIAN or other:\n\n```\nquery.agg(\"MEDIAN(age)\", Int64)\n```\n\nNote than COUNT, MIN, MAX, SUM and AVG are already conveniently mapped.\n\nThis return only one row, and should not be used with `group_by` (prefer pluck or fetch)","summary":"<p>Call an custom aggregation function, like MEDIAN or other:</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"args_string":"(field, x : X.class) forall X","args_html":"(field, x : <span class=\"t\">X</span>.<span class=\"k\">class</span>) forall X","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L38"},"def":{"name":"agg","args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"visibility":"Public","body":"(clear_select.select(field)).scalar(X)"},"external_var":false},{"html_id":"avg(field,x:X.class)forallX-instance-method","name":"avg","doc":"SQL aggregation function \"AVG\":\n\n```\nquery.avg(\"field\", Int64)\n```","summary":"<p>SQL aggregation function &quot;AVG&quot;:</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"args_string":"(field, x : X.class) forall X","args_html":"(field, x : <span class=\"t\">X</span>.<span class=\"k\">class</span>) forall X","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L48"},"def":{"name":"avg","args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"visibility":"Public","body":"agg(\"AVG(#{field})\", X)"},"external_var":false},{"html_id":"count(type:X.class=Int64)forallX-instance-method","name":"count","doc":"Use SQL `COUNT` over your query, and return this number as a Int64\n\nas count return always a scalar, the usage of `COUNT(*) OVER GROUP BY` can be done by\nusing `pluck` or `select`","summary":"<p>Use SQL <code>COUNT</code> over your query, and return this number as a Int64</p>","abstract":false,"args":[{"name":"type","default_value":"Int64","external_name":"type","restriction":"X.class"}],"args_string":"(type : X.class = Int64) forall X","args_html":"(type : <span class=\"t\">X</span>.<span class=\"k\">class</span> = <span class=\"t\">Int64</span>) forall X","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L6"},"def":{"name":"count","args":[{"name":"type","default_value":"Int64","external_name":"type","restriction":"X.class"}],"visibility":"Public","body":"columns = @columns.dup\n\n\n\nif (@offset || @limit) || @group_bys\n  subquery = is_distinct? ? self : (dup.clear_order_bys.clear_select.use_connection(connection_name)).select(\"1\")\n\n  o = X.new(((Lustra::SQL.select(\"COUNT(*)\")).from({query_count: subquery})).scalar(Int64))\nelse\n  new_query = dup.clear_select.select(\"COUNT(*)\")\n  o = X.new(new_query.scalar(Int64))\nend\n@columns = columns\n\no\n"},"external_var":false},{"html_id":"exists?:Bool-instance-method","name":"exists?","doc":"Check if any records exist matching the query conditions.\nReturns `true` if at least one record exists, `false` otherwise.\n\n```\nUser.query.where { active == true }.exists? # => true/false\n```","summary":"<p>Check if any records exist matching the query conditions.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L65"},"def":{"name":"exists?","return_type":"Bool","visibility":"Public","body":"((Lustra::SQL.select(\"1\")).from({subquery: dup.limit(1)})).first != nil"},"external_var":false},{"html_id":"max(field,x:X.class)forallX-instance-method","name":"max","doc":"SQL aggregation function \"MAX\":\n\n```\nquery.max(\"field\", Int64)\n```","summary":"<p>SQL aggregation function &quot;MAX&quot;:</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"args_string":"(field, x : X.class) forall X","args_html":"(field, x : <span class=\"t\">X</span>.<span class=\"k\">class</span>) forall X","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L48"},"def":{"name":"max","args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"visibility":"Public","body":"agg(\"MAX(#{field})\", X)"},"external_var":false},{"html_id":"min(field,x:X.class)forallX-instance-method","name":"min","doc":"SQL aggregation function \"MIN\":\n\n```\nquery.min(\"field\", Int64)\n```","summary":"<p>SQL aggregation function &quot;MIN&quot;:</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"args_string":"(field, x : X.class) forall X","args_html":"(field, x : <span class=\"t\">X</span>.<span class=\"k\">class</span>) forall X","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L48"},"def":{"name":"min","args":[{"name":"field","external_name":"field","restriction":""},{"name":"x","external_name":"x","restriction":"X.class"}],"visibility":"Public","body":"agg(\"MIN(#{field})\", X)"},"external_var":false},{"html_id":"sum(field):Float64-instance-method","name":"sum","doc":"SUM through a field and return a Float64\nNote: This function is not safe injection-wise, so beware !.","summary":"<p>SUM through a field and return a Float64 Note: This function is not safe injection-wise, so beware !.</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""}],"args_string":"(field) : Float64","args_html":"(field) : Float64","location":{"filename":"src/lustra/sql/query/aggregate.cr","line_number":44,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/aggregate.cr#L44"},"def":{"name":"sum","args":[{"name":"field","external_name":"field","restriction":""}],"return_type":"Float64","visibility":"Public","body":"(agg(\"SUM(#{field})\", Union(Int64 | PG::Numeric | Nil))).try(&.to_f) || 0.0"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","path":"Lustra/SQL/Query/BeforeQuery.html","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery","abstract":false,"locations":[{"filename":"src/lustra/sql/query/before_query.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/before_query.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"}},{"html_id":"lustra/Lustra/SQL/Query/Change","path":"Lustra/SQL/Query/Change.html","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change","abstract":false,"locations":[{"filename":"src/lustra/sql/query/change.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/change.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/DeleteQuery","kind":"class","full_name":"Lustra::SQL::DeleteQuery","name":"DeleteQuery"},{"html_id":"lustra/Lustra/SQL/InsertQuery","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"change!:self-instance-method","name":"change!","doc":"This method is called everytime the request has been changed\nBy default, this do nothing and return `self`. However, it can be\nreimplemented to change some behavior when the query is changed\n\n(eg. it is by `Lustra::Model::Collection`, to discard cache over collection)","summary":"<p>This method is called everytime the request has been changed By default, this do nothing and return <code>self</code>.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/change.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/change.cr#L7"},"def":{"name":"change!","return_type":"self","visibility":"Public","body":"self"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Connection","path":"Lustra/SQL/Query/Connection.html","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection","abstract":false,"locations":[{"filename":"src/lustra/sql/query/connection.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/connection.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/DeleteQuery","kind":"class","full_name":"Lustra::SQL::DeleteQuery","name":"DeleteQuery"},{"html_id":"lustra/Lustra/SQL/InsertQuery","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"connection_name:String-instance-method","name":"connection_name","doc":"Connection used by the query.\nChange it using `use_connection` method","summary":"<p>Connection used by the query.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/connection.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/connection.cr#L5"},"def":{"name":"connection_name","return_type":"String","visibility":"Public","body":"@connection_name"},"external_var":false},{"html_id":"use_connection(connection_name:String)-instance-method","name":"use_connection","doc":"Change the connection used by the query on execution","summary":"<p>Change the connection used by the query on execution</p>","abstract":false,"args":[{"name":"connection_name","external_name":"connection_name","restriction":"String"}],"args_string":"(connection_name : String)","args_html":"(connection_name : String)","location":{"filename":"src/lustra/sql/query/connection.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/connection.cr#L8"},"def":{"name":"use_connection","args":[{"name":"connection_name","external_name":"connection_name","restriction":"String"}],"visibility":"Public","body":"@connection_name = connection_name\nself\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/CTE","path":"Lustra/SQL/Query/CTE.html","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE","abstract":false,"locations":[{"filename":"src/lustra/sql/query/cte.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/cte.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/InsertQuery","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"doc":"Allow usage of Common Table Expressions (CTE) in the query building","summary":"<p>Allow usage of Common Table Expressions (CTE) in the query building</p>","instance_methods":[{"html_id":"cte:Hash(String,CTEAuthorized)-instance-method","name":"cte","doc":"List the current CTE of the query. The key is the name of the CTE,\nwhile the value is the fragment (string or Sub-select)","summary":"<p>List the current CTE of the query.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/cte.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/cte.cr#L8"},"def":{"name":"cte","return_type":"Hash(String, CTEAuthorized)","visibility":"Public","body":"@cte"},"external_var":false},{"html_id":"with_cte(name,request:CTEAuthorized)-instance-method","name":"with_cte","doc":"Add a CTE to the query.\n\n```\nLustra::SQL.select.with_cte(\"full_year\",\n  \"SELECT DATE(date)\"\n  \"FROM generate_series(NOW() - INTERVAL '1 year', NOW(), '1 day'::interval) date\")\n  .select(\"*\").from(\"full_year\")\n# WITH full_year AS ( SELECT DATE(date) ... ) SELECT * FROM full_year;\n```","summary":"<p>Add a CTE to the query.</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"request","external_name":"request","restriction":"CTEAuthorized"}],"args_string":"(name, request : CTEAuthorized)","args_html":"(name, request : CTEAuthorized)","location":{"filename":"src/lustra/sql/query/cte.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/cte.cr#L19"},"def":{"name":"with_cte","args":[{"name":"name","external_name":"name","restriction":""},{"name":"request","external_name":"request","restriction":"CTEAuthorized"}],"visibility":"Public","body":"cte[name] = request\nchange!\n"},"external_var":false},{"html_id":"with_cte(tuple:NamedTuple)-instance-method","name":"with_cte","doc":"Add a CTE to the query. Use NamedTuple convention:\n\n```\nLustra::SQL.select.with_cte(cte: \"xxx\")\n# WITH cte AS xxx SELECT...\n```","summary":"<p>Add a CTE to the query.</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/sql/query/cte.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/cte.cr#L30"},"def":{"name":"with_cte","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"tuple.each do |k, v|\n  cte[k.to_s] = v\nend\nchange!\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Execute","path":"Lustra/SQL/Query/Execute.html","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute","abstract":false,"locations":[{"filename":"src/lustra/sql/query/execute.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/execute.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/DeleteQuery","kind":"class","full_name":"Lustra::SQL::DeleteQuery","name":"DeleteQuery"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"execute(connection_name:String|Nil=nil)-instance-method","name":"execute","doc":"Execute an SQL statement which does not return anything.\n\nIf an optional `connection_name` parameter is given, this will\n  override the connection used by the query.\n\n```\n%(default secondary).each do |cnx|\n  Lustra::SQL.select(\"pg_shards('xxx')\").execute(cnx)\nend\n```","summary":"<p>Execute an SQL statement which does not return anything.</p>","abstract":false,"args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"args_string":"(connection_name : String | Nil = nil)","args_html":"(connection_name : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/query/execute.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/execute.cr#L15"},"def":{"name":"execute","args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"visibility":"Public","body":"Lustra::SQL.execute(connection_name || self.connection_name, to_sql)"},"external_var":false},{"html_id":"execute_and_count(connection_name:String|Nil=nil):Int64-instance-method","name":"execute_and_count","doc":"Run the query and return the number of rows affected.\nThis is useful for UPDATE and DELETE queries.\n\n```\naffected = User.query.where { active == false }.to_update.set(active: true).execute_and_count\nputs \"Updated #{affected} rows\"\n```","summary":"<p>Run the query and return the number of rows affected.</p>","abstract":false,"args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"args_string":"(connection_name : String | Nil = nil) : Int64","args_html":"(connection_name : String | Nil = <span class=\"n\">nil</span>) : Int64","location":{"filename":"src/lustra/sql/query/execute.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/execute.cr#L26"},"def":{"name":"execute_and_count","args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"return_type":"Int64","visibility":"Public","body":"sql = to_sql\nLustra::SQL.log_query(sql) do\n  Lustra::SQL::ConnectionPool.with_connection(connection_name || self.connection_name) do |cnx|\n    (cnx.exec(sql)).rows_affected\n  end\nend\n"},"external_var":false},{"html_id":"explain(connection_name:String|Nil=nil):String-instance-method","name":"explain","doc":"Returns the PostgreSQL query execution plan.\nShows the execution plan without running the actual query (for SELECT),\nbut for INSERT/UPDATE/DELETE it shows the plan without modifying data.\n\n```\nplan = User.query.where { active == true }.explain\nputs plan\n# => \"Seq Scan on users  (cost=0.00..35.50 rows=10 width=116)\"\n```\n\nReturns the full EXPLAIN output as a string.","summary":"<p>Returns the PostgreSQL query execution plan.</p>","abstract":false,"args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"args_string":"(connection_name : String | Nil = nil) : String","args_html":"(connection_name : String | Nil = <span class=\"n\">nil</span>) : String","location":{"filename":"src/lustra/sql/query/execute.cr","line_number":46,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/execute.cr#L46"},"def":{"name":"explain","args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"return_type":"String","visibility":"Public","body":"sql = \"EXPLAIN #{to_sql}\"\nresult = [] of String\n\nLustra::SQL.log_query(sql) do\n  Lustra::SQL::ConnectionPool.with_connection(connection_name || self.connection_name) do |cnx|\n    cnx.query(sql) do |rs|\n      rs.each do\n        result << (rs.read(String))\n      end\n    end\n  end\nend\n\nresult.join(\"\\n\")\n"},"external_var":false},{"html_id":"explain_analyze(connection_name:String|Nil=nil):String-instance-method","name":"explain_analyze","doc":"Returns the PostgreSQL query execution plan AND executes the query to get actual statistics.\nThis shows actual execution times, row counts, and resource usage.\n\n```\nplan = User.query.where { active == true }.explain_analyze\nputs plan\n# Shows actual execution time, rows processed, and detailed statistics\n```\n\n**Warning:** This EXECUTES the query (including INSERT/UPDATE/DELETE).\nUse with caution on write operations. Wrap in a transaction and rollback if needed.\n\nReturns the full EXPLAIN ANALYZE output as a string.","summary":"<p>Returns the PostgreSQL query execution plan AND executes the query to get actual statistics.</p>","abstract":false,"args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"args_string":"(connection_name : String | Nil = nil) : String","args_html":"(connection_name : String | Nil = <span class=\"n\">nil</span>) : String","location":{"filename":"src/lustra/sql/query/execute.cr","line_number":76,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/execute.cr#L76"},"def":{"name":"explain_analyze","args":[{"name":"connection_name","default_value":"nil","external_name":"connection_name","restriction":"String | ::Nil"}],"return_type":"String","visibility":"Public","body":"sql = \"EXPLAIN ANALYZE #{to_sql}\"\nresult = [] of String\n\nLustra::SQL.log_query(sql) do\n  Lustra::SQL::ConnectionPool.with_connection(connection_name || self.connection_name) do |cnx|\n    cnx.query(sql) do |rs|\n      rs.each do\n        result << (rs.read(String))\n      end\n    end\n  end\nend\n\nresult.join(\"\\n\")\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Fetch","path":"Lustra/SQL/Query/Fetch.html","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch","abstract":false,"locations":[{"filename":"src/lustra/sql/query/fetch.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"fetch(fetch_all=false,&:Hash(String,Lustra::SQL::Any)->Nil)-instance-method","name":"fetch","doc":"Fetch the result set row per row\n`fetch_all` optional parameter is helpful in transactional environment, so it stores\nthe result and close the resultset before starting to call yield over the data\npreventing creation of a new connection if you need to call SQL into the\nyielded block.\n\n```\n# This is wrong: The connection is still busy retrieving the users:\nLustra::SQL.select.from(\"users\").fetch do |u|\n  Lustra::SQL.select.from(\"posts\").where { u[\"id\"] == posts.id }\nend\n\n# Instead, use `fetch_all`\n# Lustra will store the value of the result set in memory\n# before calling the block, and the connection is now ready to handle\n# another query.\nLustra::SQL.select.from(\"users\").fetch(fetch_all: true) do |u|\n  Lustra::SQL.select.from(\"posts\").where { u[\"id\"] == posts.id }\nend\n```","summary":"<p>Fetch the result set row per row <code>fetch_all</code> optional parameter is helpful in transactional environment, so it stores the result and close the resultset before starting to call yield over the data preventing creation of a new connection if you need to call SQL into the yielded block.</p>","abstract":false,"args":[{"name":"fetch_all","default_value":"false","external_name":"fetch_all","restriction":""}],"args_string":"(fetch_all = false, & : Hash(String, Lustra::SQL::Any) -> Nil)","args_html":"(fetch_all = <span class=\"n\">false</span>, & : Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>) -> Nil)","location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":125,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L125"},"def":{"name":"fetch","args":[{"name":"fetch_all","default_value":"false","external_name":"fetch_all","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(Hash(String, ::Lustra::SQL::Any) -> Nil)"},"visibility":"Public","body":"trigger_before_query\n\nh = {} of String => ::Lustra::SQL::Any\n\nsql = to_sql\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n  if fetch_all\n    o = [] of Hash(String, ::Lustra::SQL::Any)\n    fetch_result_set(h, rs) do |x| o << x.dup end\n    o.each do |x| yield(x) end\n  else\n    fetch_result_set(h, rs) do |x| yield(x) end\n  end\nend\n"},"external_var":false},{"html_id":"fetch_first-instance-method","name":"fetch_first","doc":"Alias for `first` because first is redefined in Collection::Base\nobject to return a model instead.","summary":"<p>Alias for <code><a href=\"../../../Lustra/SQL/Query/Fetch.html#first-instance-method\">#first</a></code> because first is redefined in Collection::Base object to return a model instead.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":75,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L75"},"def":{"name":"fetch_first","visibility":"Public","body":"(limit(1)).fetch(fetch_all: true) do |x| return x end\n\nnil\n"},"external_var":false},{"html_id":"fetch_first!-instance-method","name":"fetch_first!","abstract":false,"location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":81,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L81"},"def":{"name":"fetch_first!","visibility":"Public","body":"if o = fetch_first\n  o\nelse\n  raise(Lustra::SQL::RecordNotFoundError.new)\nend"},"external_var":false},{"html_id":"fetch_with_cursor(count=1000,&:Hash(String,Lustra::SQL::Any)->Nil)-instance-method","name":"fetch_with_cursor","doc":"Fetch the data using CURSOR.\nThis will prevent Lustra to load all the data from the database into memory.\nThis is useful if you need to retrieve and update a large dataset.","summary":"<p>Fetch the data using CURSOR.</p>","abstract":false,"args":[{"name":"count","default_value":"1000","external_name":"count","restriction":""}],"args_string":"(count = 1000, & : Hash(String, Lustra::SQL::Any) -> Nil)","args_html":"(count = <span class=\"n\">1000</span>, & : Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>) -> Nil)","location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L24"},"def":{"name":"fetch_with_cursor","args":[{"name":"count","default_value":"1000","external_name":"count","restriction":""}],"yields":1,"block_arity":1,"block_arg":{"name":"","external_name":"","restriction":"(Hash(String, ::Lustra::SQL::Any) -> Nil)"},"visibility":"Public","body":"trigger_before_query\n\nLustra::SQL.transaction do |cnx|\n  cursor_name = \"__cursor_#{Time.local.to_unix ^ (rand * 268435455).to_i}__\"\n\n  cursor_declaration = \"DECLARE #{cursor_name} CURSOR FOR #{to_sql}\"\n\n  Lustra::SQL.log_query(cursor_declaration) do cnx.exec(cursor_declaration) end\n\n  h = {} of String => ::Lustra::SQL::Any\n\n  we_loop = true\n\n  while we_loop\n    fetch_query = \"FETCH #{count} FROM #{cursor_name}\"\n\n    rs = Lustra::SQL.log_query(fetch_query) do cnx.query(fetch_query) end\n\n    o = Array(Hash(String, ::Lustra::SQL::Any)).new(initial_capacity: count)\n\n    we_loop = fetch_result_set(h, rs) do |x| o << x.dup end\n\n    o.each do |hash| yield(hash) end\n  end\nend\n"},"external_var":false},{"html_id":"first-instance-method","name":"first","doc":"Return the first line of the query as Hash(String, ::Lustra::SQL::Any), or nil\nif not found","summary":"<p>Return the first line of the query as Hash(String, ::Lustra::SQL::Any), or nil if not found</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L65"},"def":{"name":"first","visibility":"Public","body":"fetch_first"},"external_var":false},{"html_id":"first!-instance-method","name":"first!","abstract":false,"location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":69,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L69"},"def":{"name":"first!","visibility":"Public","body":"fetch_first!"},"external_var":false},{"html_id":"scalar(type:T.class)forallT-instance-method","name":"scalar","doc":"Helpers to fetch a SELECT with only one row and one column return.","summary":"<p>Helpers to fetch a SELECT with only one row and one column return.</p>","abstract":false,"args":[{"name":"type","external_name":"type","restriction":"T.class"}],"args_string":"(type : T.class) forall T","args_html":"(type : <span class=\"t\">T</span>.<span class=\"k\">class</span>) forall T","location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":53,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L53"},"def":{"name":"scalar","args":[{"name":"type","external_name":"type","restriction":"T.class"}],"visibility":"Public","body":"trigger_before_query\n\nsql = to_sql\n\nLustra::SQL.log_query(sql) do\n  (Lustra::SQL::ConnectionPool.with_connection(connection_name, &.scalar(sql))).as(T)\nend\n"},"external_var":false},{"html_id":"to_a:Array(Hash(String,Lustra::SQL::Any))-instance-method","name":"to_a","doc":"Return an array with all the rows fetched.","summary":"<p>Return an array with all the rows fetched.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/fetch.cr","line_number":90,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/fetch.cr#L90"},"def":{"name":"to_a","return_type":"Array(Hash(String, ::Lustra::SQL::Any))","visibility":"Public","body":"trigger_before_query\n\nh = {} of String => ::Lustra::SQL::Any\n\nsql = to_sql\n\nrs = Lustra::SQL.log_query(sql) do Lustra::SQL::ConnectionPool.with_connection(connection_name, &.query(sql)) end\n\no = [] of Hash(String, ::Lustra::SQL::Any)\nfetch_result_set(h, rs) do |x| o << x.dup end\n\no\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/From","path":"Lustra/SQL/Query/From.html","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From","abstract":false,"locations":[{"filename":"src/lustra/sql/query/from.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_from-instance-method","name":"clear_from","doc":"Clear the FROM clause and return `self`","summary":"<p>Clear the FROM clause and return <code>self</code></p>","abstract":false,"location":{"filename":"src/lustra/sql/query/from.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L29"},"def":{"name":"clear_from","visibility":"Public","body":"@froms.clear\nchange!\n"},"external_var":false},{"html_id":"from(*args)-instance-method","name":"from","doc":"FROM fragment of the SQL query\n\n```\nLustra::SQL.select.from(\"airplanes\").to_sql # < SELECT * FROM airplanes\n```","summary":"<p>FROM fragment of the SQL query</p>","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args)","args_html":"(*args)","location":{"filename":"src/lustra/sql/query/from.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L10"},"def":{"name":"from","args":[{"name":"args","external_name":"args","restriction":""}],"splat_index":0,"visibility":"Public","body":"args.each do |arg|\n  case arg\n  when NamedTuple\n    arg.each do |k, v| @froms << (Lustra::SQL::From.new(v, k.to_s)) end\n  else\n    @froms << (Lustra::SQL::From.new(arg))\n  end\nend\n\nchange!\n"},"external_var":false},{"html_id":"from(**tuple)-instance-method","name":"from","abstract":false,"location":{"filename":"src/lustra/sql/query/from.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L23"},"def":{"name":"from","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"tuple.each do |k, v| @froms << (Lustra::SQL::From.new(v, k.to_s)) end\nchange!\n"},"external_var":false},{"html_id":"froms:Array(SQL::From)-instance-method","name":"froms","abstract":false,"location":{"filename":"src/lustra/sql/query/from.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/from.cr#L3"},"def":{"name":"froms","return_type":"Array(SQL::From)","visibility":"Public","body":"@froms"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","path":"Lustra/SQL/Query/GroupBy.html","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy","abstract":false,"locations":[{"filename":"src/lustra/sql/query/group_by.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/group_by.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_group_bys-instance-method","name":"clear_group_bys","abstract":false,"location":{"filename":"src/lustra/sql/query/group_by.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/group_by.cr#L4"},"def":{"name":"clear_group_bys","visibility":"Public","body":"@group_bys.clear\nchange!\n"},"external_var":false},{"html_id":"group_by(column:Symbolic)-instance-method","name":"group_by","abstract":false,"args":[{"name":"column","external_name":"column","restriction":"Symbolic"}],"args_string":"(column : Symbolic)","args_html":"(column : <a href=\"../../../Lustra/SQL/Symbolic.html\">Symbolic</a>)","location":{"filename":"src/lustra/sql/query/group_by.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/group_by.cr#L9"},"def":{"name":"group_by","args":[{"name":"column","external_name":"column","restriction":"Symbolic"}],"visibility":"Public","body":"@group_bys << column\nchange!\n"},"external_var":false},{"html_id":"group_bys:Array(Symbolic)-instance-method","name":"group_bys","abstract":false,"location":{"filename":"src/lustra/sql/query/group_by.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/group_by.cr#L2"},"def":{"name":"group_bys","return_type":"Array(Symbolic)","visibility":"Public","body":"@group_bys"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Having","path":"Lustra/SQL/Query/Having.html","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having","abstract":false,"locations":[{"filename":"src/lustra/sql/query/having.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_havings-instance-method","name":"clear_havings","doc":"Clear all the having clauses and return `self`","summary":"<p>Clear all the having clauses and return <code>self</code></p>","abstract":false,"location":{"filename":"src/lustra/sql/query/having.cr","line_number":172,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L172"},"def":{"name":"clear_havings","visibility":"Public","body":"@havings.clear\n\nchange!\n"},"external_var":false},{"html_id":"having(node:Lustra::Expression::Node)-instance-method","name":"having","doc":"Build SQL `having` condition using a Lustra::Expression::Node\n\n```\nquery.having(Lustra::Expression::Node::InArray.new(\"id\", ['1', '2', '3', '4']))\n# Note: in this example, InArray node use unsafe strings\n```\n\nIf useful for moving a having clause from a request to another one:\n\n```\nquery1.having { a == b } # having a = b\n```\n\n```\nquery2.having(query1.havings[0]) # HAVING a = b\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> condition using a Lustra::Expression::Node</p>","abstract":false,"args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"args_string":"(node : Lustra::Expression::Node)","args_html":"(node : <a href=\"../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L22"},"def":{"name":"having","args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"@havings << node\nchange!\n"},"external_var":false},{"html_id":"having(&)-instance-method","name":"having","doc":"Build SQL `having` condition using the Expression engine.\n\n```\nquery.having { id == 1 }\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> condition using the Expression engine.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/having.cr","line_number":32,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L32"},"def":{"name":"having","yields":0,"block_arity":0,"visibility":"Public","body":"having(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"having(conditions:NamedTuple|Hash(String,Lustra::SQL::Any))-instance-method","name":"having","doc":"Build SQL `having` condition using a NamedTuple.\nthis will use:\n\n- the `=` operator if compared with a literal\n\n```\nquery.having({keyword: \"hello\"}) # having keyword = 'hello'\n```\n\n- the `IN` operator if compared with an array:\n\n```\nquery.having({x: [1, 2]}) # having x in (1, 2)\n```\n\n- the `>=` and `<=` | `<` if compared with a range:\n\n```\nquery.having({x: (1..4)})  # having x >= 1 AND x <= 4\nquery.having({x: (1...4)}) # having x >= 1 AND x < 4\n```\n\n- You also can put another select query as argument:\n\n```\nquery.having({x: another_select}) # having x IN (SELECT ... )\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> condition using a NamedTuple.</p>","abstract":false,"args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"args_string":"(conditions : NamedTuple | Hash(String, Lustra::SQL::Any))","args_html":"(conditions : NamedTuple | Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>))","location":{"filename":"src/lustra/sql/query/having.cr","line_number":67,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L67"},"def":{"name":"having","args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"visibility":"Public","body":"conditions.each do |k, v|\n  k = Lustra::Expression::Node::Variable.new(k.to_s)\n\n  @havings << (case v\n  when Array\n    Lustra::Expression::Node::InArray.new(k, v.map do |it| Lustra::Expression[it] end)\n  when SelectBuilder\n    Lustra::Expression::Node::InSelect.new(k, v)\n  when Range\n    Lustra::Expression::Node::InRange.new(k, Lustra::Expression[v.begin]..Lustra::Expression[v.end], v.exclusive?)\n  else\n    Lustra::Expression::Node::DoubleOperator.new(k, Lustra::Expression::Node::Literal.new(v), (v.nil? ? \"IS\" : \"=\"))\n  end)\nend\n\nchange!\n"},"external_var":false},{"html_id":"having(template:String,*args)-instance-method","name":"having","doc":"Build SQL `having` condition using a template string and\ninterpolating `?` characters with parameters given in a tuple or array.\n\n```\nhaving(\"x = ? OR y = ?\", 1, \"l'eau\") # having x = 1 OR y = 'l''eau'\n```\n\nRaise error if there's not enough parameters to cover all the `?` placeholders","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> condition using a template string and interpolating <code>?</code> characters with parameters given in a tuple or array.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(template : String, *args)","args_html":"(template : String, *args)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":110,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L110"},"def":{"name":"having","args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"having(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, *args)))"},"external_var":false},{"html_id":"having(template:String,**tuple)-instance-method","name":"having","doc":"Build SQL `having` interpolating `:keyword` with the NamedTuple passed in argument.\n\n```\nhaving(\"id = :id OR date >= :start\", id: 1, start: 1.day.ago)\n# having id = 1 AND date >= '201x-xx-xx ...'\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> interpolating <code>:keyword</code> with the NamedTuple passed in argument.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String, **tuple)","args_html":"(template : String, **tuple)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":98,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L98"},"def":{"name":"having","args":[{"name":"template","external_name":"template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"having(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, **tuple)))"},"external_var":false},{"html_id":"having(**tuple)-instance-method","name":"having","abstract":false,"location":{"filename":"src/lustra/sql/query/having.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L36"},"def":{"name":"having","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"having(conditions: tuple)"},"external_var":false},{"html_id":"or_having(node:Lustra::Expression::Node)-instance-method","name":"or_having","doc":"Build SQL `or_having` condition using a Lustra::Expression::Node\n\n```\nquery.or_having(Lustra::Expression::Node::InArray.new(\"id\", ['1', '2', '3', '4']))\n# Note: in this example, InArray node use unsafe strings\n```\n\nIf useful for moving a having clause from a request to another one:\n\n```\nquery1.or_having { a == b } # having a = b\n```\n\n```\nquery2.or_having(query1.havings[0]) # having a = b\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#or_having%28%26%29-instance-method\">#or_having</a></code> condition using a Lustra::Expression::Node</p>","abstract":false,"args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"args_string":"(node : Lustra::Expression::Node)","args_html":"(node : <a href=\"../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":130,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L130"},"def":{"name":"or_having","args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"if @havings.empty?\n  return having(node)\nend\n\n\nif (\n  (\n    (@havings.size == 1) &&\n    (n = @havings.first)\n  ) &&\n  n.is_a?(Lustra::Expression::Node::NodeArray)\n) &&\n(n.link == \"OR\")\n  n.expression << node\nelse\n  if @havings.size == 1\n    old_clause = @havings.first\n  else\n    old_clause = Lustra::Expression::Node::NodeArray.new(@havings, \"AND\")\n  end\n\n  @havings.clear\n  @havings << (Lustra::Expression::Node::NodeArray.new([old_clause, node], \"OR\"))\nend\n\nchange!\n"},"external_var":false},{"html_id":"or_having(template:String,*args)-instance-method","name":"or_having","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(template : String, *args)","args_html":"(template : String, *args)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":158,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L158"},"def":{"name":"or_having","args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"or_having(Lustra::Expression::Node::Raw.new(Lustra::Expression.raw(\"(#{template})\", *args)))"},"external_var":false},{"html_id":"or_having(template:String,**named_tuple)-instance-method","name":"or_having","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String, **named_tuple)","args_html":"(template : String, **named_tuple)","location":{"filename":"src/lustra/sql/query/having.cr","line_number":154,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L154"},"def":{"name":"or_having","args":[{"name":"template","external_name":"template","restriction":"String"}],"double_splat":{"name":"named_tuple","external_name":"named_tuple","restriction":""},"visibility":"Public","body":"or_having(Lustra::Expression::Node::Raw.new(Lustra::Expression.raw(\"(#{template})\", **named_tuple)))"},"external_var":false},{"html_id":"or_having(&)-instance-method","name":"or_having","doc":"Build SQL `having` condition using the Expression engine.\n\n```\nquery.or_having { id == 1 }\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Having.html#having%28%26%29-instance-method\">#having</a></code> condition using the Expression engine.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/having.cr","line_number":167,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/having.cr#L167"},"def":{"name":"or_having","yields":0,"block_arity":0,"visibility":"Public","body":"or_having(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Join","path":"Lustra/SQL/Query/Join.html","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join","abstract":false,"locations":[{"filename":"src/lustra/sql/query/join.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"cross_join(name:Selectable,lateral=false)-instance-method","name":"cross_join","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L26"},"def":{"name":"cross_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, :cross, lateral, nil)"},"external_var":false},{"html_id":"full_outer_join(name:Selectable,lateral=false,&)-instance-method","name":"full_outer_join","doc":"Add a \"FULL_OUTER\" JOIN directive to the query","summary":"<p>Add a &quot;FULL_OUTER&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, lateral = false, &)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, lateral = <span class=\"n\">false</span>, &)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"full_outer_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"join_impl(name, :full_outer, lateral, Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"full_outer_join(name:Selectable,condition:String=\"true\",lateral=false)-instance-method","name":"full_outer_join","doc":"Add a \"FULL_OUTER\" JOIN directive to the query","summary":"<p>Add a &quot;FULL_OUTER&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, condition : String = \"true\", lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, condition : String = <span class=\"s\">&quot;true&quot;</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"full_outer_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, :full_outer, lateral, Lustra::Expression::Node::Raw.new((\"(\" + condition) + \")\"))"},"external_var":false},{"html_id":"inner_join(name:Selectable,lateral=false,&)-instance-method","name":"inner_join","doc":"Add a \"INNER\" JOIN directive to the query","summary":"<p>Add a &quot;INNER&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, lateral = false, &)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, lateral = <span class=\"n\">false</span>, &)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"inner_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"join_impl(name, :inner, lateral, Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"inner_join(name:Selectable,condition:String=\"true\",lateral=false)-instance-method","name":"inner_join","doc":"Add a \"INNER\" JOIN directive to the query","summary":"<p>Add a &quot;INNER&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, condition : String = \"true\", lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, condition : String = <span class=\"s\">&quot;true&quot;</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"inner_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, :inner, lateral, Lustra::Expression::Node::Raw.new((\"(\" + condition) + \")\"))"},"external_var":false},{"html_id":"join(name:Selectable,type=:inner,lateral=false,&)-instance-method","name":"join","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, type = :inner, lateral = false, &)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, type = <span class=\"n\">:inner</span>, lateral = <span class=\"n\">false</span>, &)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L14"},"def":{"name":"join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"join_impl(name, type, lateral, Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"join(name:Selectable,type=:inner,condition:String=\"true\",lateral=false)-instance-method","name":"join","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, type = :inner, condition : String = \"true\", lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, type = <span class=\"n\">:inner</span>, condition : String = <span class=\"s\">&quot;true&quot;</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L18"},"def":{"name":"join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, type, lateral, Lustra::Expression::Node::Raw.new((\"(\" + condition) + \")\"))"},"external_var":false},{"html_id":"join(name:Selectable,type=:inner,lateral=false)-instance-method","name":"join","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, type = :inner, lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, type = <span class=\"n\">:inner</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L22"},"def":{"name":"join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"type","default_value":":inner","external_name":"type","restriction":""},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, type, lateral, nil)"},"external_var":false},{"html_id":"left_join(name:Selectable,lateral=false,&)-instance-method","name":"left_join","doc":"Add a \"LEFT\" JOIN directive to the query","summary":"<p>Add a &quot;LEFT&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, lateral = false, &)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, lateral = <span class=\"n\">false</span>, &)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"left_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"join_impl(name, :left, lateral, Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"left_join(name:Selectable,condition:String=\"true\",lateral=false)-instance-method","name":"left_join","doc":"Add a \"LEFT\" JOIN directive to the query","summary":"<p>Add a &quot;LEFT&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, condition : String = \"true\", lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, condition : String = <span class=\"s\">&quot;true&quot;</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"left_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, :left, lateral, Lustra::Expression::Node::Raw.new((\"(\" + condition) + \")\"))"},"external_var":false},{"html_id":"right_join(name:Selectable,lateral=false,&)-instance-method","name":"right_join","doc":"Add a \"RIGHT\" JOIN directive to the query","summary":"<p>Add a &quot;RIGHT&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, lateral = false, &)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, lateral = <span class=\"n\">false</span>, &)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"right_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"yields":0,"block_arity":0,"visibility":"Public","body":"join_impl(name, :right, lateral, Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"right_join(name:Selectable,condition:String=\"true\",lateral=false)-instance-method","name":"right_join","doc":"Add a \"RIGHT\" JOIN directive to the query","summary":"<p>Add a &quot;RIGHT&quot; JOIN directive to the query</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"args_string":"(name : Selectable, condition : String = \"true\", lateral = false)","args_html":"(name : <a href=\"../../../Lustra/SQL/Selectable.html\">Selectable</a>, condition : String = <span class=\"s\">&quot;true&quot;</span>, lateral = <span class=\"n\">false</span>)","location":{"filename":"src/lustra/sql/query/join.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/join.cr#L30"},"def":{"name":"right_join","args":[{"name":"name","external_name":"name","restriction":"Selectable"},{"name":"condition","default_value":"\"true\"","external_name":"condition","restriction":"String"},{"name":"lateral","default_value":"false","external_name":"lateral","restriction":""}],"visibility":"Public","body":"join_impl(name, :right, lateral, Lustra::Expression::Node::Raw.new((\"(\" + condition) + \")\"))"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Lock","path":"Lustra/SQL/Query/Lock.html","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock","abstract":false,"locations":[{"filename":"src/lustra/sql/query/lock.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/lock.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"with_lock(str:String=\"FORUPDATE\")-instance-method","name":"with_lock","abstract":false,"args":[{"name":"str","default_value":"\"FOR UPDATE\"","external_name":"str","restriction":"String"}],"args_string":"(str : String = \"FOR UPDATE\")","args_html":"(str : String = <span class=\"s\">&quot;FOR UPDATE&quot;</span>)","location":{"filename":"src/lustra/sql/query/lock.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/lock.cr#L11"},"def":{"name":"with_lock","args":[{"name":"str","default_value":"\"FOR UPDATE\"","external_name":"str","restriction":"String"}],"visibility":"Public","body":"@lock = str\nchange!\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","path":"Lustra/SQL/Query/OffsetLimit.html","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit","abstract":false,"locations":[{"filename":"src/lustra/sql/query/offset_limit.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/offset_limit.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_limit-instance-method","name":"clear_limit","abstract":false,"location":{"filename":"src/lustra/sql/query/offset_limit.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/offset_limit.cr#L12"},"def":{"name":"clear_limit","visibility":"Public","body":"@limit = nil\nchange!\n"},"external_var":false},{"html_id":"clear_offset-instance-method","name":"clear_offset","abstract":false,"location":{"filename":"src/lustra/sql/query/offset_limit.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/offset_limit.cr#L17"},"def":{"name":"clear_offset","visibility":"Public","body":"@offset = nil\nchange!\n"},"external_var":false},{"html_id":"limit(x:Int|Nil)-instance-method","name":"limit","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int | ::Nil"}],"args_string":"(x : Int | Nil)","args_html":"(x : Int | Nil)","location":{"filename":"src/lustra/sql/query/offset_limit.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/offset_limit.cr#L7"},"def":{"name":"limit","args":[{"name":"x","external_name":"x","restriction":"Int | ::Nil"}],"visibility":"Public","body":"@limit = Int64.new(x)\nchange!\n"},"external_var":false},{"html_id":"offset(x:Int|Nil)-instance-method","name":"offset","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Int | ::Nil"}],"args_string":"(x : Int | Nil)","args_html":"(x : Int | Nil)","location":{"filename":"src/lustra/sql/query/offset_limit.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/offset_limit.cr#L22"},"def":{"name":"offset","args":[{"name":"x","external_name":"x","restriction":"Int | ::Nil"}],"visibility":"Public","body":"@offset = Int64.new(x)\nchange!\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/OnConflict","path":"Lustra/SQL/Query/OnConflict.html","kind":"module","full_name":"Lustra::SQL::Query::OnConflict","name":"OnConflict","abstract":false,"locations":[{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/InsertQuery","kind":"class","full_name":"Lustra::SQL::InsertQuery","name":"InsertQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_conflict-instance-method","name":"clear_conflict","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":58,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L58"},"def":{"name":"clear_conflict","visibility":"Public","body":"@on_conflict_condition = false"},"external_var":false},{"html_id":"conflict?-instance-method","name":"conflict?","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":54,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L54"},"def":{"name":"conflict?","visibility":"Public","body":"!(!@on_conflict_condition)"},"external_var":false},{"html_id":"do_conflict_action(str)-instance-method","name":"do_conflict_action","abstract":false,"args":[{"name":"str","external_name":"str","restriction":""}],"args_string":"(str)","args_html":"(str)","location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L23"},"def":{"name":"do_conflict_action","args":[{"name":"str","external_name":"str","restriction":""}],"visibility":"Public","body":"@on_conflict_action = \"#{str}\"\nchange!\n"},"external_var":false},{"html_id":"do_nothing-instance-method","name":"do_nothing","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":35,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L35"},"def":{"name":"do_nothing","visibility":"Public","body":"@on_conflict_action = \"NOTHING\"\nchange!\n"},"external_var":false},{"html_id":"do_update(&)-instance-method","name":"do_update","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L28"},"def":{"name":"do_update","yields":1,"block_arity":1,"visibility":"Public","body":"action = Lustra::SQL::UpdateQuery.new(nil)\nyield(action)\n@on_conflict_action = action\nchange!\n"},"external_var":false},{"html_id":"on_conflict(constraint:String|Bool|OnConflictWhereClause=true)-instance-method","name":"on_conflict","abstract":false,"args":[{"name":"constraint","default_value":"true","external_name":"constraint","restriction":"String | Bool | OnConflictWhereClause"}],"args_string":"(constraint : String | Bool | OnConflictWhereClause = true)","args_html":"(constraint : String | Bool | <a href=\"../../../Lustra/SQL/Query/OnConflict/OnConflictWhereClause.html\">OnConflictWhereClause</a> = <span class=\"n\">true</span>)","location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L40"},"def":{"name":"on_conflict","args":[{"name":"constraint","default_value":"true","external_name":"constraint","restriction":"String | Bool | OnConflictWhereClause"}],"visibility":"Public","body":"@on_conflict_condition = constraint\nchange!\n"},"external_var":false},{"html_id":"on_conflict(&)-instance-method","name":"on_conflict","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":45,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L45"},"def":{"name":"on_conflict","yields":0,"block_arity":0,"visibility":"Public","body":"condition = OnConflictWhereClause.new\ncondition.where(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))\n@on_conflict_condition = condition\nchange!\n"},"external_var":false},{"html_id":"on_conflict_action:String|Lustra::SQL::UpdateQuery-instance-method","name":"on_conflict_action","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L5"},"def":{"name":"on_conflict_action","return_type":"String | Lustra::SQL::UpdateQuery","visibility":"Public","body":"@on_conflict_action"},"external_var":false},{"html_id":"on_conflict_condition:String|OnConflictWhereClause|Bool-instance-method","name":"on_conflict_condition","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L4"},"def":{"name":"on_conflict_condition","return_type":"String | OnConflictWhereClause | Bool","visibility":"Public","body":"@on_conflict_condition"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/Query/OnConflict/OnConflictWhereClause","path":"Lustra/SQL/Query/OnConflict/OnConflictWhereClause.html","kind":"class","full_name":"Lustra::SQL::Query::OnConflict::OnConflictWhereClause","name":"OnConflictWhereClause","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L8"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query/OnConflict","kind":"module","full_name":"Lustra::SQL::Query::OnConflict","name":"OnConflict"},"doc":"Fragment used when ON CONFLICT WHERE ...","summary":"<p>Fragment used when ON CONFLICT WHERE ...</p>","constructors":[{"html_id":"new-class-method","name":"new","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L11"},"def":{"name":"new","visibility":"Public","body":"_ = allocate\n_.initialize\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"change!-instance-method","name":"change!","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L19"},"def":{"name":"change!","visibility":"Public","body":""},"external_var":false},{"html_id":"to_s-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/on_conflict.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/on_conflict.cr#L15"},"def":{"name":"to_s","visibility":"Public","body":"print_wheres"},"external_var":false},{"html_id":"wheres:Array(Lustra::Expression::Node)-instance-method","name":"wheres","doc":"Return the list of where clause; each where clause are transformed into\nLustra::Expression::Node","summary":"<p>Return the list of where clause; each where clause are transformed into Lustra::Expression::Node</p>","abstract":false,"def":{"name":"wheres","return_type":"Array(Lustra::Expression::Node)","visibility":"Public","body":"@wheres"},"external_var":false}]}]},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","path":"Lustra/SQL/Query/OrderBy.html","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy","abstract":false,"locations":[{"filename":"src/lustra/sql/query/order_by.cr","line_number":11,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L11"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"doc":"Encode for:\n\n`ORDER BY expression [ASC | DESC | USING operator] [NULLS FIRST | NULLS LAST];`\n\nCurrent implementation:\n\n[x] Multiple Order by clauses\n[x] ASC/DESC\n[x] NULLS FIRST / NULLS LAST\n[ ] NOT IMPLEMENTED: USING OPERATOR","summary":"<p>Encode for:</p>","instance_methods":[{"html_id":"clear_order_bys-instance-method","name":"clear_order_bys","doc":"Remove all order by clauses","summary":"<p>Remove all order by clauses</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L19"},"def":{"name":"clear_order_bys","visibility":"Public","body":"@order_bys.clear\nchange!\n"},"external_var":false},{"html_id":"order_by(tuple:NamedTuple)-instance-method","name":"order_by","doc":"Add multiple ORDER BY clause using a tuple:\n\n```\nquery = Lustra::SQL.select.from(\"users\").order_by(id: :desc, name: {:asc, :nulls_last})\nquery.to_sql # > SELECT * FROM users ORDER BY \"id\" DESC, \"name\" ASC NULLS LAST\n```","summary":"<p>Add multiple ORDER BY clause using a tuple:</p>","abstract":false,"args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"args_string":"(tuple : NamedTuple)","args_html":"(tuple : NamedTuple)","location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":81,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L81"},"def":{"name":"order_by","args":[{"name":"tuple","external_name":"tuple","restriction":"NamedTuple"}],"visibility":"Public","body":"tuple.each do |k, v|\n  case v\n  when Symbol, String\n    order_by(k, v, nil)\n  when Tuple\n    order_by(k, v[0], v[1])\n  else\n    raise(\"order_by with namedtuple must be called with value of the tuple as Symbol, String or Tuple describing direction and nulls directive\")\n  end\nend\n\nself\n"},"external_var":false},{"html_id":"order_by(expression:Symbol,direction:Symbol=:asc,nulls:Symbol|Nil=nil)-instance-method","name":"order_by","doc":"Add one ORDER BY clause\n\n```\nquery = Lustra::SQL.select.from(\"users\").order_by(:id, :desc, nulls_last)\nquery.to_sql # > SELECT * FROM users ORDER BY \"id\" DESC NULLS LAST\n```","summary":"<p>Add one ORDER BY clause</p>","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":"Symbol"},{"name":"direction","default_value":":asc","external_name":"direction","restriction":"Symbol"},{"name":"nulls","default_value":"nil","external_name":"nulls","restriction":"Symbol | ::Nil"}],"args_string":"(expression : Symbol, direction : Symbol = :asc, nulls : Symbol | Nil = nil)","args_html":"(expression : Symbol, direction : Symbol = <span class=\"n\">:asc</span>, nulls : Symbol | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":102,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L102"},"def":{"name":"order_by","args":[{"name":"expression","external_name":"expression","restriction":"Symbol"},{"name":"direction","default_value":":asc","external_name":"direction","restriction":"Symbol"},{"name":"nulls","default_value":"nil","external_name":"nulls","restriction":"Symbol | ::Nil"}],"visibility":"Public","body":"@order_bys << (Record.new(SQL.escape(expression.to_s), sanitize_direction(direction), sanitize_nulls(nulls)))\nchange!\n"},"external_var":false},{"html_id":"order_by(expression:String,direction:Symbol=:asc,nulls:Symbol|Nil=nil)-instance-method","name":"order_by","doc":"Add one ORDER BY clause\n\n```\nquery = Lustra::SQL.select.from(\"users\").order_by(:id, :desc, nulls_last)\nquery.to_sql # > SELECT * FROM users ORDER BY \"id\" DESC NULLS LAST\n```","summary":"<p>Add one ORDER BY clause</p>","abstract":false,"args":[{"name":"expression","external_name":"expression","restriction":"String"},{"name":"direction","default_value":":asc","external_name":"direction","restriction":"Symbol"},{"name":"nulls","default_value":"nil","external_name":"nulls","restriction":"Symbol | ::Nil"}],"args_string":"(expression : String, direction : Symbol = :asc, nulls : Symbol | Nil = nil)","args_html":"(expression : String, direction : Symbol = <span class=\"n\">:asc</span>, nulls : Symbol | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":108,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L108"},"def":{"name":"order_by","args":[{"name":"expression","external_name":"expression","restriction":"String"},{"name":"direction","default_value":":asc","external_name":"direction","restriction":"Symbol"},{"name":"nulls","default_value":"nil","external_name":"nulls","restriction":"Symbol | ::Nil"}],"visibility":"Public","body":"@order_bys << (Record.new(expression, sanitize_direction(direction), sanitize_nulls(nulls)))\nchange!\n"},"external_var":false},{"html_id":"order_by(**tuple)-instance-method","name":"order_by","doc":"Add multiple ORDER BY clause using a tuple:\n\n```\nquery = Lustra::SQL.select.from(\"users\").order_by(id: :desc, name: {:asc, :nulls_last})\nquery.to_sql # > SELECT * FROM users ORDER BY \"id\" DESC, \"name\" ASC NULLS LAST\n```","summary":"<p>Add multiple ORDER BY clause using a tuple:</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":76,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L76"},"def":{"name":"order_by","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"order_by(tuple)"},"external_var":false},{"html_id":"reverse_order_by-instance-method","name":"reverse_order_by","doc":"Flip over all order bys by switching the ASC direction to DESC and the NULLS FIRST to NULLS LAST\n\n```\nquery = Lustra::SQL.select.from(\"users\").order_by(id: :desc, name: :asc, company: {:asc, :nulls_last})\nquery.reverse_order_by\nquery.to_sql # SELECT * FROM users ORDER BY \"id\" ASC, \"name\" DESC, \"company\" DESC NULLS FIRST\n```\n\nreturn `self`","summary":"<p>Flip over all order bys by switching the ASC direction to DESC and the NULLS FIRST to NULLS LAST</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":53,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L53"},"def":{"name":"reverse_order_by","visibility":"Public","body":"@order_bys = @order_bys.map do |rec|\n  Record.new(rec.op, rec.dir == (:desc) ? :asc : :desc, rec.nulls.try do |n| n == (:nulls_last) ? :nulls_first : :nulls_last end)\nend\nchange!\n"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/Query/OrderBy/Record","path":"Lustra/SQL/Query/OrderBy/Record.html","kind":"struct","full_name":"Lustra::SQL::Query::OrderBy::Record","name":"Record","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/query/order_by.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L12"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},"constructors":[{"html_id":"new(op:String,dir:Symbol,nulls:Symbol|Nil)-class-method","name":"new","abstract":false,"args":[{"name":"op","external_name":"op","restriction":"String"},{"name":"dir","external_name":"dir","restriction":"Symbol"},{"name":"nulls","external_name":"nulls","restriction":"Symbol | ::Nil"}],"args_string":"(op : String, dir : Symbol, nulls : Symbol | Nil)","args_html":"(op : String, dir : Symbol, nulls : Symbol | Nil)","location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L12"},"def":{"name":"new","args":[{"name":"op","external_name":"op","restriction":"String"},{"name":"dir","external_name":"dir","restriction":"Symbol"},{"name":"nulls","external_name":"nulls","restriction":"Symbol | ::Nil"}],"visibility":"Public","body":"_ = allocate\n_.initialize(op, dir, nulls)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L12"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@op.clone, @dir.clone, @nulls.clone)"},"external_var":false},{"html_id":"copy_with(op_op=@op,dir_dir=@dir,nulls_nulls=@nulls)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_op","default_value":"@op","external_name":"op","restriction":""},{"name":"_dir","default_value":"@dir","external_name":"dir","restriction":""},{"name":"_nulls","default_value":"@nulls","external_name":"nulls","restriction":""}],"args_string":"(op _op = @op, dir _dir = @dir, nulls _nulls = @nulls)","args_html":"(op _op = @op, dir _dir = @dir, nulls _nulls = @nulls)","location":{"filename":"src/lustra/sql/query/order_by.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/order_by.cr#L12"},"def":{"name":"copy_with","args":[{"name":"_op","default_value":"@op","external_name":"op","restriction":""},{"name":"_dir","default_value":"@dir","external_name":"dir","restriction":""},{"name":"_nulls","default_value":"@nulls","external_name":"nulls","restriction":""}],"visibility":"Public","body":"self.class.new(_op, _dir, _nulls)"},"external_var":false},{"html_id":"dir:Symbol-instance-method","name":"dir","abstract":false,"def":{"name":"dir","return_type":"Symbol","visibility":"Public","body":"@dir"},"external_var":false},{"html_id":"nulls:Symbol|Nil-instance-method","name":"nulls","abstract":false,"def":{"name":"nulls","return_type":"Symbol | ::Nil","visibility":"Public","body":"@nulls"},"external_var":false},{"html_id":"op:String-instance-method","name":"op","abstract":false,"def":{"name":"op","return_type":"String","visibility":"Public","body":"@op"},"external_var":false}]}]},{"html_id":"lustra/Lustra/SQL/Query/Pluck","path":"Lustra/SQL/Query/Pluck.html","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck","abstract":false,"locations":[{"filename":"src/lustra/sql/query/pluck.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"pluck(fields:Tuple(*T))forallT-instance-method","name":"pluck","doc":"Select specifics columns and return an array of Tuple(*Lustra::SQL::Any) containing the columns in the order of the selected\narguments:\n\n```\nUser.query.pluck(\"first_name\", \"last_name\").each do |(first_name, last_name)|\n  # ...\nend\n```","summary":"<p>Select specifics columns and return an array of Tuple(*Lustra::SQL::Any) containing the columns in the order of the selected arguments:</p>","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":"Tuple(*T)"}],"args_string":"(fields : Tuple(*T)) forall T","args_html":"(fields : Tuple(<span class=\"o\">*</span><span class=\"t\">T</span>)) forall T","location":{"filename":"src/lustra/sql/query/pluck.cr","line_number":77,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L77"},"def":{"name":"pluck","args":[{"name":"fields","external_name":"fields","restriction":"Tuple(*T)"}],"visibility":"Public","body":"select_clause = fields.join(\", \") do |f| f.is_a?(Symbol) ? Lustra::SQL.escape(f) : f.to_s end\nsql = (clear_select.select(select_clause)).to_sql\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  begin\n    rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n    {% if true %}\n        o = [] of Tuple({% for t in T %}Lustra::SQL::Any,{% end %})\n\n        while rs.move_next\n          o << { {% for t in T %} rs.read.as(Lustra::SQL::Any), {% end %} }\n        end\n        o\n      {% end %}\n  ensure\n    rs.try(&.close)\n  end\nend\n"},"external_var":false},{"html_id":"pluck(*fields):Array-instance-method","name":"pluck","doc":"Select specifics columns and return an array of Tuple(*Lustra::SQL::Any) containing the columns in the order of the selected\narguments:\n\n```\nUser.query.pluck(\"first_name\", \"last_name\").each do |(first_name, last_name)|\n  # ...\nend\n```","summary":"<p>Select specifics columns and return an array of Tuple(*Lustra::SQL::Any) containing the columns in the order of the selected arguments:</p>","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":""}],"args_string":"(*fields) : Array","args_html":"(*fields) : Array","location":{"filename":"src/lustra/sql/query/pluck.cr","line_number":72,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L72"},"def":{"name":"pluck","args":[{"name":"fields","external_name":"fields","restriction":""}],"splat_index":0,"return_type":"Array","visibility":"Public","body":"pluck(fields)"},"external_var":false},{"html_id":"pluck(**fields:**T)forallT-instance-method","name":"pluck","doc":"Select specifics columns and returns on array of tuple of type of the named tuple passed as parameter:\n\n```\nUser.query.pluck(id: Int64, \"UPPER(last_name)\": String).each do #...\n```","summary":"<p>Select specifics columns and returns on array of tuple of type of the named tuple passed as parameter:</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/pluck.cr","line_number":102,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L102"},"def":{"name":"pluck","double_splat":{"name":"fields","external_name":"fields","restriction":"**T"},"visibility":"Public","body":"sql = (clear_select.select(fields.keys.join(\", \"))).to_sql\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  begin\n    rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n    {% if true %}\n        o = [] of Tuple({% for k, v in T %}{{ v.instance }},{% end %})\n\n        while rs.move_next\n          o << { {% for k, v in T %} rs.read({{ v.instance }}), {% end %}}\n        end\n        o\n      {% end %}\n  ensure\n    rs.try(&.close)\n  end\nend\n"},"external_var":false},{"html_id":"pluck_col(field:Lustra::SQL::Symbolic,type:T.class):Array(T)forallT-instance-method","name":"pluck_col","doc":"Select a specific column of your SQL query, execute the query\nand return an array containing this field.\n\n```\nUser.query.pluck_col(\"id\") # [1,2,3,4...]\n```\n\nNote: It returns an array of `Lustra::SQL::Any`. Therefore, you may want to use `pluck_col(str, Type)` to return\n      an array of `Type`:\n\n```\nUser.query.pluck_col(\"id\", Int64)\n```\n\nThe field argument is a SQL fragment; it's not escaped (beware SQL injection) and allow call to functions\nand aggregate methods:\n\n```\n# ...\nUser.query.pluck_col(\"CASE WHEN id % 2 = 0 THEN id ELSE NULL END AS id\").each do\n# ...\n```","summary":"<p>Select a specific column of your SQL query, execute the query and return an array containing this field.</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":"Lustra::SQL::Symbolic"},{"name":"type","external_name":"type","restriction":"T.class"}],"args_string":"(field : Lustra::SQL::Symbolic, type : T.class) : Array(T) forall T","args_html":"(field : <a href=\"../../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, type : <span class=\"t\">T</span>.<span class=\"k\">class</span>) : Array(T) forall T","location":{"filename":"src/lustra/sql/query/pluck.cr","line_number":44,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L44"},"def":{"name":"pluck_col","args":[{"name":"field","external_name":"field","restriction":"Lustra::SQL::Symbolic"},{"name":"type","external_name":"type","restriction":"T.class"}],"return_type":"Array(T)","visibility":"Public","body":"if field.is_a?(Symbol)\n  field = Lustra::SQL.escape(field)\nend\n\nsql = (clear_select.select(field)).to_sql\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  begin\n    rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n    o = [] of T\n\n    while rs.move_next\n      o << (rs.read(T))\n    end\n\n    o\n  ensure\n    rs.try(&.close)\n  end\nend\n"},"external_var":false},{"html_id":"pluck_col(field:Lustra::SQL::Symbolic):Array(Lustra::SQL::Any)-instance-method","name":"pluck_col","doc":"Select a specific column of your SQL query, execute the query\nand return an array containing this field.\n\n```\nUser.query.pluck_col(\"id\") # [1,2,3,4...]\n```\n\nNote: It returns an array of `Lustra::SQL::Any`. Therefore, you may want to use `pluck_col(str, Type)` to return\n      an array of `Type`:\n\n```\nUser.query.pluck_col(\"id\", Int64)\n```\n\nThe field argument is a SQL fragment; it's not escaped (beware SQL injection) and allow call to functions\nand aggregate methods:\n\n```\n# ...\nUser.query.pluck_col(\"CASE WHEN id % 2 = 0 THEN id ELSE NULL END AS id\").each do\n# ...\n```","summary":"<p>Select a specific column of your SQL query, execute the query and return an array containing this field.</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":"Lustra::SQL::Symbolic"}],"args_string":"(field : Lustra::SQL::Symbolic) : Array(Lustra::SQL::Any)","args_html":"(field : <a href=\"../../../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>) : Array(<a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>)","location":{"filename":"src/lustra/sql/query/pluck.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/pluck.cr#L24"},"def":{"name":"pluck_col","args":[{"name":"field","external_name":"field","restriction":"Lustra::SQL::Symbolic"}],"return_type":"Array(Lustra::SQL::Any)","visibility":"Public","body":"if field.is_a?(Symbol)\n  field = Lustra::SQL.escape(field)\nend\n\nsql = (clear_select.select(field)).to_sql\n\nLustra::SQL::ConnectionPool.with_connection(connection_name) do |cnx|\n  begin\n    rs = Lustra::SQL.log_query(sql) do cnx.query(sql) end\n\n    o = [] of Lustra::SQL::Any\n\n    while rs.move_next\n      o << (rs.read.as(Lustra::SQL::Any))\n    end\n    o\n  ensure\n    rs.try(&.close)\n  end\nend\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Select","path":"Lustra/SQL/Query/Select.html","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select","abstract":false,"locations":[{"filename":"src/lustra/sql/query/select.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_distinct-instance-method","name":"clear_distinct","doc":"Remove distinct","summary":"<p>Remove distinct</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/select.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L39"},"def":{"name":"clear_distinct","visibility":"Public","body":"distinct(nil)"},"external_var":false},{"html_id":"clear_select-instance-method","name":"clear_select","abstract":false,"location":{"filename":"src/lustra/sql/query/select.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L62"},"def":{"name":"clear_select","visibility":"Public","body":"@columns.clear\nchange!\n"},"external_var":false},{"html_id":"default_wildcard_table=(table:String|Nil=nil)-instance-method","name":"default_wildcard_table=","doc":"In some case you want you query to return `table.*` instead of `*`\n  if no select parameters has been set. This occurs in the case of joins\n  between models.","summary":"<p>In some case you want you query to return <code>table.*</code> instead of <code>*</code>   if no select parameters has been set.</p>","abstract":false,"args":[{"name":"table","default_value":"nil","external_name":"table","restriction":"String | ::Nil"}],"args_string":"(table : String | Nil = nil)","args_html":"(table : String | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/query/select.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L17"},"def":{"name":"default_wildcard_table=","args":[{"name":"table","default_value":"nil","external_name":"table","restriction":"String | ::Nil"}],"visibility":"Public","body":"@default_wildcard_table = table\nchange!\n"},"external_var":false},{"html_id":"distinct(on:String|Nil=\"\")-instance-method","name":"distinct","doc":"Add DISTINCT to the SELECT part of the query\n\n- If `on` is blank (empty string, default), will call a simple `SELECT DISTINCT ...`\n- If `on` is nil, will remove the distinct (see `clear_distinct`)\n- If `on` is a non empty string, will call `SELECT DISTINCT ON (on) ...`","summary":"<p>Add DISTINCT to the SELECT part of the query</p>","abstract":false,"args":[{"name":"on","default_value":"\"\"","external_name":"on","restriction":"String | ::Nil"}],"args_string":"(on : String | Nil = \"\")","args_html":"(on : String | Nil = <span class=\"s\">&quot;&quot;</span>)","location":{"filename":"src/lustra/sql/query/select.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L33"},"def":{"name":"distinct","args":[{"name":"on","default_value":"\"\"","external_name":"on","restriction":"String | ::Nil"}],"visibility":"Public","body":"@distinct_value = on\nchange!\n"},"external_var":false},{"html_id":"distinct_value:String|Nil-instance-method","name":"distinct_value","abstract":false,"location":{"filename":"src/lustra/sql/query/select.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L12"},"def":{"name":"distinct_value","return_type":"String | ::Nil","visibility":"Public","body":"@distinct_value"},"external_var":false},{"html_id":"select(c:Column)-instance-method","name":"select","abstract":false,"args":[{"name":"c","external_name":"c","restriction":"Column"}],"args_string":"(c : Column)","args_html":"(c : <a href=\"../../../Lustra/SQL/Column.html\">Column</a>)","location":{"filename":"src/lustra/sql/query/select.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L22"},"def":{"name":"select","args":[{"name":"c","external_name":"c","restriction":"Column"}],"visibility":"Public","body":"@columns << c\nchange!\n"},"external_var":false},{"html_id":"select(*args)-instance-method","name":"select","doc":"Add field(s) to selection from tuple\n\n```\nselect({user_id: \"uid\", updated_at: \"updated_at\"})\n# => Output \"SELECT user_id AS uid, updated_at AS updated_at\"\n```","summary":"<p>Add field(s) to selection from tuple</p>","abstract":false,"args":[{"name":"args","external_name":"args","restriction":""}],"args_string":"(*args)","args_html":"(*args)","location":{"filename":"src/lustra/sql/query/select.cr","line_number":49,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/select.cr#L49"},"def":{"name":"select","args":[{"name":"args","external_name":"args","restriction":""}],"splat_index":0,"visibility":"Public","body":"args.each do |arg|\n  case arg\n  when NamedTuple\n    arg.each do |k, v| @columns << (Column.new(v, k.to_s)) end\n  else\n    @columns << (Column.new(arg))\n  end\nend\n\nchange!\n"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Where","path":"Lustra/SQL/Query/Where.html","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where","abstract":false,"locations":[{"filename":"src/lustra/sql/query/where.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/DeleteQuery","kind":"class","full_name":"Lustra::SQL::DeleteQuery","name":"DeleteQuery"},{"html_id":"lustra/Lustra/SQL/Query/OnConflict/OnConflictWhereClause","kind":"class","full_name":"Lustra::SQL::Query::OnConflict::OnConflictWhereClause","name":"OnConflictWhereClause"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"doc":"Feature WHERE clause building.\neach call to where method stack where clause.\nTheses clauses are then combined together using the `AND` operator.\nTherefore, `query.where(\"a\").where(\"b\")` will return `a AND b`\n","summary":"<p>Feature WHERE clause building.</p>","instance_methods":[{"html_id":"clear_wheres-instance-method","name":"clear_wheres","doc":"Clear all the where clauses and return `self`","summary":"<p>Clear all the where clauses and return <code>self</code></p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":133,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L133"},"def":{"name":"clear_wheres","visibility":"Public","body":"@wheres.clear\n\nchange!\n"},"external_var":false},{"html_id":"not(&)-instance-method","name":"not","doc":"Build SQL `where NOT` condition using the Expression engine.\nThis is equivalent to wrapping the condition in `NOT(...)`.\n\n```\nquery.where.not { id == 1 }        # WHERE NOT (id = 1)\nquery.where.not { active == true } # WHERE NOT (active = true)\n```","summary":"<p>Build SQL <code>where NOT</code> condition using the Expression engine.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":146,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L146"},"def":{"name":"not","yields":0,"block_arity":0,"visibility":"Public","body":"where(Lustra::Expression.new.not(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield)))"},"external_var":false},{"html_id":"not(conditions:NamedTuple|Hash(String,Lustra::SQL::Any))-instance-method","name":"not","doc":"Build SQL `where NOT` condition using a NamedTuple or Hash.","summary":"<p>Build SQL <code>where NOT</code> condition using a NamedTuple or Hash.</p>","abstract":false,"args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"args_string":"(conditions : NamedTuple | Hash(String, Lustra::SQL::Any))","args_html":"(conditions : NamedTuple | Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>))","location":{"filename":"src/lustra/sql/query/where.cr","line_number":162,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L162"},"def":{"name":"not","args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"visibility":"Public","body":"conditions.each do |k, v|\n  k = Lustra::Expression::Node::Variable.new(k.to_s)\n\n  negated_node = case v\n  when Array\n    Lustra::Expression::Node::InArray.new(k, v.map do |it| Lustra::Expression[it] end)\n  when SelectBuilder\n    Lustra::Expression::Node::InSelect.new(k, v)\n  when Range\n    Lustra::Expression::Node::InRange.new(k, Lustra::Expression[v.begin]..Lustra::Expression[v.end], v.exclusive?)\n  else\n    Lustra::Expression::Node::DoubleOperator.new(k, Lustra::Expression::Node::Literal.new(v), (v.nil? ? \"IS\" : \"=\"))\n  end\n\n  where(Lustra::Expression.new.not(negated_node))\nend\n\nself\n"},"external_var":false},{"html_id":"not(template:String)-instance-method","name":"not","doc":"Build custom SQL `where NOT` condition.\nBeware of SQL injections!\n\n```\nquery.where.not(\"id = 1\") # WHERE NOT (id = 1)\n```","summary":"<p>Build custom SQL <code>where NOT</code> condition.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String)","args_html":"(template : String)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":213,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L213"},"def":{"name":"not","args":[{"name":"template","external_name":"template","restriction":"String"}],"visibility":"Public","body":"where(Lustra::Expression.new.not(Lustra::Expression::Node::Raw.new(template)))"},"external_var":false},{"html_id":"not(template:String,*args)-instance-method","name":"not","doc":"Build SQL `where NOT` condition using a template string with positional parameters.\n\n```\nquery.where.not(\"id = ?\", 1) # WHERE NOT (id = 1)\n```","summary":"<p>Build SQL <code>where NOT</code> condition using a template string with positional parameters.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(template : String, *args)","args_html":"(template : String, *args)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":203,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L203"},"def":{"name":"not","args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"where(Lustra::Expression.new.not(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, *args))))"},"external_var":false},{"html_id":"not(template:String,**tuple)-instance-method","name":"not","doc":"Build SQL `where NOT` condition using a template string.\n\n```\nquery.where.not(\"id = :id\", id: 1) # WHERE NOT (id = 1)\n```","summary":"<p>Build SQL <code>where NOT</code> condition using a template string.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String, **tuple)","args_html":"(template : String, **tuple)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":194,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L194"},"def":{"name":"not","args":[{"name":"template","external_name":"template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"where(Lustra::Expression.new.not(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, **tuple))))"},"external_var":false},{"html_id":"not(**tuple)-instance-method","name":"not","doc":"Build SQL `where NOT` condition using a NamedTuple.\nThis will negate each condition in the tuple.\n\n```\nquery.where.not({active: true})  # WHERE NOT (active = true)\nquery.where.not({id: [1, 2, 3]}) # WHERE NOT (id IN (1,2,3))\n```","summary":"<p>Build SQL <code>where NOT</code> condition using a NamedTuple.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":157,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L157"},"def":{"name":"not","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"not(conditions: tuple)"},"external_var":false},{"html_id":"or(node:Lustra::Expression::Node)-instance-method","name":"or","doc":"Build SQL `where OR` condition using the Expression engine.\n\n```\nquery.where { id == 1 }.or { id == 2 } # WHERE (id = 1) OR (id = 2)\nquery.where.or { active == true }      # WHERE active = true\n```","summary":"<p>Build SQL <code>where OR</code> condition using the Expression engine.</p>","abstract":false,"args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"args_string":"(node : Lustra::Expression::Node)","args_html":"(node : <a href=\"../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":223,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L223"},"def":{"name":"or","args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"if @wheres.empty?\n  return where(node)\nend\n\n\nif (\n  (\n    (@wheres.size == 1) &&\n    (n = @wheres.first)\n  ) &&\n  n.is_a?(Lustra::Expression::Node::NodeArray)\n) &&\n(n.link == \"OR\")\n  n.expression << node\nelse\n  if @wheres.size == 1\n    old_clause = @wheres.first\n  else\n    old_clause = Lustra::Expression::Node::NodeArray.new(@wheres, \"AND\")\n  end\n\n  @wheres.clear\n  @wheres << (Lustra::Expression::Node::NodeArray.new([old_clause, node], \"OR\"))\nend\n\nchange!\n"},"external_var":false},{"html_id":"or(&)-instance-method","name":"or","doc":"Build SQL `where OR` condition using the Expression engine.\n\n```\nquery.where { id == 1 }.or { id == 2 }\n```","summary":"<p>Build SQL <code>where OR</code> condition using the Expression engine.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":252,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L252"},"def":{"name":"or","yields":0,"block_arity":0,"visibility":"Public","body":"or(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"or(conditions:NamedTuple|Hash(String,Lustra::SQL::Any))-instance-method","name":"or","doc":"Build SQL `where OR` condition using a NamedTuple or Hash.","summary":"<p>Build SQL <code>where OR</code> condition using a NamedTuple or Hash.</p>","abstract":false,"args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"args_string":"(conditions : NamedTuple | Hash(String, Lustra::SQL::Any))","args_html":"(conditions : NamedTuple | Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>))","location":{"filename":"src/lustra/sql/query/where.cr","line_number":266,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L266"},"def":{"name":"or","args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"visibility":"Public","body":"nodes = [] of Lustra::Expression::Node\n\nconditions.each do |k, v|\n  k = Lustra::Expression::Node::Variable.new(k.to_s)\n\n  nodes << (case v\n  when Array\n    Lustra::Expression::Node::InArray.new(k, v.map do |it| Lustra::Expression[it] end)\n  when SelectBuilder\n    Lustra::Expression::Node::InSelect.new(k, v)\n  when Range\n    Lustra::Expression::Node::InRange.new(k, Lustra::Expression[v.begin]..Lustra::Expression[v.end], v.exclusive?)\n  else\n    Lustra::Expression::Node::DoubleOperator.new(k, Lustra::Expression::Node::Literal.new(v), (v.nil? ? \"IS\" : \"=\"))\n  end)\nend\n\n\ncombined_node = if nodes.size == 1\n  nodes.first\nelse\n  Lustra::Expression::Node::NodeArray.new(nodes, \"AND\")\nend\n\nor(combined_node)\n"},"external_var":false},{"html_id":"or(template:String,*args)-instance-method","name":"or","doc":"Build SQL `where OR` condition using a template string with positional parameters.\n\n```\nquery.where { id == 1 }.or(\"status = ?\", \"active\")\n```","summary":"<p>Build SQL <code>where OR</code> condition using a template string with positional parameters.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(template : String, *args)","args_html":"(template : String, *args)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":316,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L316"},"def":{"name":"or","args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"or(Lustra::Expression::Node::Raw.new(Lustra::Expression.raw(\"(#{template})\", *args)))"},"external_var":false},{"html_id":"or(template:String,**tuple)-instance-method","name":"or","doc":"Build SQL `where OR` condition using a template string.\n\n```\nquery.where { id == 1 }.or(\"status = :status\", status: \"active\")\n```","summary":"<p>Build SQL <code>where OR</code> condition using a template string.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String, **tuple)","args_html":"(template : String, **tuple)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":307,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L307"},"def":{"name":"or","args":[{"name":"template","external_name":"template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"or(Lustra::Expression::Node::Raw.new(Lustra::Expression.raw(\"(#{template})\", **tuple)))"},"external_var":false},{"html_id":"or(**tuple)-instance-method","name":"or","doc":"Build SQL `where OR` condition using a NamedTuple.\n\n```\nquery.where { id == 1 }.or(status: \"active\") # WHERE (id = 1) OR (status = 'active')\n```","summary":"<p>Build SQL <code>where OR</code> condition using a NamedTuple.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":261,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L261"},"def":{"name":"or","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"or(conditions: tuple)"},"external_var":false},{"html_id":"where(node:Lustra::Expression::Node)-instance-method","name":"where","doc":"Build SQL `where` condition using a Lustra::Expression::Node\n\n```\nquery.where(Lustra::Expression::Node::InArray.new(\"id\", ['1', '2', '3', '4']))\n# Note: in this example, InArray node use unsafe strings\n```\n\nIf useful for moving a where clause from a request to another one:\n\n```\nquery1.where { a == b } # WHERE a = b\n```\n\n```\nquery2.where(query1.wheres[0]) # WHERE a = b\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> condition using a Lustra::Expression::Node</p>","abstract":false,"args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"args_string":"(node : Lustra::Expression::Node)","args_html":"(node : <a href=\"../../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L29"},"def":{"name":"where","args":[{"name":"node","external_name":"node","restriction":"Lustra::Expression::Node"}],"visibility":"Public","body":"@wheres << node\n\nchange!\n"},"external_var":false},{"html_id":"where(&)-instance-method","name":"where","doc":"Build SQL `where` condition using the Expression engine.\n\n```\nquery.where { id == 1 }\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> condition using the Expression engine.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L40"},"def":{"name":"where","yields":0,"block_arity":0,"visibility":"Public","body":"where(Lustra::Expression.ensure_node!(with Lustra::Expression.new yield))"},"external_var":false},{"html_id":"where(conditions:NamedTuple|Hash(String,Lustra::SQL::Any))-instance-method","name":"where","doc":"Build SQL `where` condition using a NamedTuple.\nthis will use:\n- the `=` operator if compared with a literal\n\n```\nquery.where({keyword: \"hello\"}) # WHERE keyword = 'hello'\n```\n\n- the `IN` operator if compared with an array:\n\n```\nquery.where({x: [1, 2]}) # WHERE x in (1,2)\n```\n\n- the `>=` and `<=` | `<` if compared with a range:\n\n```\nquery.where({x: (1..4)})  # WHERE x >= 1 AND x <= 4\nquery.where({x: (1...4)}) # WHERE x >= 1 AND x < 4\n```\n\n- You also can put another select query as argument:\n\n```\nquery.where({x: another_select}) # WHERE x IN (SELECT ... )\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> condition using a NamedTuple.</p>","abstract":false,"args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"args_string":"(conditions : NamedTuple | Hash(String, Lustra::SQL::Any))","args_html":"(conditions : NamedTuple | Hash(String, <a href=\"../../../Lustra/SQL/Any.html\">Lustra::SQL::Any</a>))","location":{"filename":"src/lustra/sql/query/where.cr","line_number":74,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L74"},"def":{"name":"where","args":[{"name":"conditions","external_name":"conditions","restriction":"NamedTuple | Hash(String, Lustra::SQL::Any)"}],"visibility":"Public","body":"conditions.each do |k, v|\n  k = Lustra::Expression::Node::Variable.new(k.to_s)\n\n  @wheres << (case v\n  when Array\n    Lustra::Expression::Node::InArray.new(k, v.map do |it| Lustra::Expression[it] end)\n  when SelectBuilder\n    Lustra::Expression::Node::InSelect.new(k, v)\n  when Range\n    Lustra::Expression::Node::InRange.new(k, Lustra::Expression[v.begin]..Lustra::Expression[v.end], v.exclusive?)\n  else\n    Lustra::Expression::Node::DoubleOperator.new(k, Lustra::Expression::Node::Literal.new(v), (v.nil? ? \"IS\" : \"=\"))\n  end)\nend\n\nchange!\n"},"external_var":false},{"html_id":"where(template:String)-instance-method","name":"where","doc":"Build custom SQL `where`\nbeware of SQL injections!\n\n```\nwhere(\"ADD_SOME_DANGEROUS_SQL_HERE\") # WHERE ADD_SOME_DANGEROUS_SQL_HERE\n```","summary":"<p>Build custom SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> beware of SQL injections!</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String)","args_html":"(template : String)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":127,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L127"},"def":{"name":"where","args":[{"name":"template","external_name":"template","restriction":"String"}],"visibility":"Public","body":"@wheres << (Lustra::Expression::Node::Raw.new(template))\nchange!\n"},"external_var":false},{"html_id":"where(template:String,*args)-instance-method","name":"where","doc":"Build SQL `where` condition using a template string and\ninterpolating `?` characters with parameters given in a tuple or array.\n\n```\nwhere(\"x = ? OR y = ?\", 1, \"l'eau\") # WHERE x = 1 OR y = 'l''eau'\n```\n\nRaise error if there's not enough parameters to cover all the `?` placeholders","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> condition using a template string and interpolating <code>?</code> characters with parameters given in a tuple or array.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"args_string":"(template : String, *args)","args_html":"(template : String, *args)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":117,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L117"},"def":{"name":"where","args":[{"name":"template","external_name":"template","restriction":"String"},{"name":"args","external_name":"args","restriction":""}],"splat_index":1,"visibility":"Public","body":"where(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, *args)))"},"external_var":false},{"html_id":"where(template:String,**tuple)-instance-method","name":"where","doc":"Build SQL `where` interpolating `:keyword` with the NamedTuple passed in argument.\n\n```\nwhere(\"id = :id OR date >= :start\", id: 1, start: 1.day.ago)\n# WHERE id = 1 AND date >= '201x-xx-xx ...'\n```","summary":"<p>Build SQL <code><a href=\"../../../Lustra/SQL/Query/Where.html#where%28%26%29-instance-method\">#where</a></code> interpolating <code>:keyword</code> with the NamedTuple passed in argument.</p>","abstract":false,"args":[{"name":"template","external_name":"template","restriction":"String"}],"args_string":"(template : String, **tuple)","args_html":"(template : String, **tuple)","location":{"filename":"src/lustra/sql/query/where.cr","line_number":105,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L105"},"def":{"name":"where","args":[{"name":"template","external_name":"template","restriction":"String"}],"double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"where(Lustra::Expression::Node::Raw.new(Lustra::SQL.raw(template, **tuple)))"},"external_var":false},{"html_id":"where(**tuple)-instance-method","name":"where","abstract":false,"location":{"filename":"src/lustra/sql/query/where.cr","line_number":44,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/where.cr#L44"},"def":{"name":"where","double_splat":{"name":"tuple","external_name":"tuple","restriction":""},"visibility":"Public","body":"where(conditions: tuple)"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Query/Window","path":"Lustra/SQL/Query/Window.html","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window","abstract":false,"locations":[{"filename":"src/lustra/sql/query/window.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"clear_windows-instance-method","name":"clear_windows","abstract":false,"location":{"filename":"src/lustra/sql/query/window.cr","line_number":21,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L21"},"def":{"name":"clear_windows","visibility":"Public","body":"@windows.clear\n\nchange!\n"},"external_var":false},{"html_id":"print_windows-instance-method","name":"print_windows","abstract":false,"location":{"filename":"src/lustra/sql/query/window.cr","line_number":27,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L27"},"def":{"name":"print_windows","visibility":"Public","body":"@windows.join do |name, value|\n  {name.to_s, \" AS \", value}.join\nend"},"external_var":false},{"html_id":"window(name,value)-instance-method","name":"window","abstract":false,"args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"args_string":"(name, value)","args_html":"(name, value)","location":{"filename":"src/lustra/sql/query/window.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L15"},"def":{"name":"window","args":[{"name":"name","external_name":"name","restriction":""},{"name":"value","external_name":"value","restriction":""}],"visibility":"Public","body":"@windows << {name.to_s, value.to_s}\n\nchange!\n"},"external_var":false},{"html_id":"window(windows:NamedTuple)-instance-method","name":"window","abstract":false,"args":[{"name":"windows","external_name":"windows","restriction":"NamedTuple"}],"args_string":"(windows : NamedTuple)","args_html":"(windows : NamedTuple)","location":{"filename":"src/lustra/sql/query/window.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L7"},"def":{"name":"window","args":[{"name":"windows","external_name":"windows","restriction":"NamedTuple"}],"visibility":"Public","body":"windows.each do |k, v|\n  @windows << {k.to_s, v.to_s}\nend\n\nchange!\n"},"external_var":false},{"html_id":"windows:Array(WindowDeclaration)-instance-method","name":"windows","doc":"eq. WINDOW window_name AS ( window_definition )","summary":"<p>eq.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/window.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L5"},"def":{"name":"windows","return_type":"Array(WindowDeclaration)","visibility":"Public","body":"@windows"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/Query/Window/WindowDeclaration","path":"Lustra/SQL/Query/Window/WindowDeclaration.html","kind":"alias","full_name":"Lustra::SQL::Query::Window::WindowDeclaration","name":"WindowDeclaration","abstract":false,"locations":[{"filename":"src/lustra/sql/query/window.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/window.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"Tuple(String, String)","aliased_html":"{String, String}","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"}}]},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","path":"Lustra/SQL/Query/WithPagination.html","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination","abstract":false,"locations":[{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"DEFAULT_LIMIT","name":"DEFAULT_LIMIT","value":"50"},{"id":"DEFAULT_PAGE","name":"DEFAULT_PAGE","value":"1"}],"including_types":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL/Query","kind":"module","full_name":"Lustra::SQL::Query","name":"Query"},"instance_methods":[{"html_id":"current_page:Int32|Int64-instance-method","name":"current_page","doc":"Return the current page","summary":"<p>Return the current page</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L33"},"def":{"name":"current_page","return_type":"Int32 | Int64","visibility":"Public","body":"if offset.nil? || limit.nil?\n  DEFAULT_PAGE\nelse\n  (((offset.as(Int64)) / (limit.as(Int64))) + 1).to_i\nend"},"external_var":false},{"html_id":"first_page?-instance-method","name":"first_page?","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":64,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L64"},"def":{"name":"first_page?","visibility":"Public","body":"current_page <= 1"},"external_var":false},{"html_id":"last_page?-instance-method","name":"last_page?","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":60,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L60"},"def":{"name":"last_page?","visibility":"Public","body":"next_page.nil?"},"external_var":false},{"html_id":"next_page-instance-method","name":"next_page","doc":"Return `current_page + 1` or `nil` if there is no next page","summary":"<p>Return <code>current_page + 1</code> or <code>nil</code> if there is no next page</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L56"},"def":{"name":"next_page","visibility":"Public","body":"current_page < total_pages ? (current_page + 1) : nil"},"external_var":false},{"html_id":"out_of_bounds?-instance-method","name":"out_of_bounds?","doc":"Helper method that is true when someone tries to fetch a page with a\nlarger number than the last page. Can be used in combination with flashes\nand redirecting.","summary":"<p>Helper method that is true when someone tries to fetch a page with a larger number than the last page.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L71"},"def":{"name":"out_of_bounds?","visibility":"Public","body":"current_page > total_pages"},"external_var":false},{"html_id":"paginate(page:Int32=DEFAULT_PAGE,per_page:Int32=DEFAULT_LIMIT)-instance-method","name":"paginate","doc":"Enter pagination mode.\nThis is helpful to manage paginated table.\nPagination will handle the page progression automatically and update\n`offset` and `limit` parameters by his own.\n\n```\npage = query.paginate(2, 50)\n```","summary":"<p>Enter pagination mode.</p>","abstract":false,"args":[{"name":"page","default_value":"DEFAULT_PAGE","external_name":"page","restriction":"Int32"},{"name":"per_page","default_value":"DEFAULT_LIMIT","external_name":"per_page","restriction":"Int32"}],"args_string":"(page : Int32 = DEFAULT_PAGE, per_page : Int32 = DEFAULT_LIMIT)","args_html":"(page : Int32 = <span class=\"t\">DEFAULT_PAGE</span>, per_page : Int32 = <span class=\"t\">DEFAULT_LIMIT</span>)","location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":17,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L17"},"def":{"name":"paginate","args":[{"name":"page","default_value":"DEFAULT_PAGE","external_name":"page","restriction":"Int32"},{"name":"per_page","default_value":"DEFAULT_LIMIT","external_name":"per_page","restriction":"Int32"}],"visibility":"Public","body":"clear_limit.clear_offset\n@total_entries = count\n\npage = {1, page}.max\n@limit = per_page.to_i64\n@offset = (per_page * (page - 1)).to_i64\nchange!\n"},"external_var":false},{"html_id":"per_page:Int32|Int64-instance-method","name":"per_page","doc":"Return the number of items maximum per page.","summary":"<p>Return the number of items maximum per page.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":28,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L28"},"def":{"name":"per_page","return_type":"Int32 | Int64","visibility":"Public","body":"limit.try(&.to_i) || DEFAULT_LIMIT"},"external_var":false},{"html_id":"previous_page-instance-method","name":"previous_page","doc":"Return `current_page - 1` or `nil` if there is no previous page","summary":"<p>Return <code>current_page - 1</code> or <code>nil</code> if there is no previous page</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L51"},"def":{"name":"previous_page","visibility":"Public","body":"current_page > 1 ? (current_page - 1) : nil"},"external_var":false},{"html_id":"total_pages:Int32|Int64-instance-method","name":"total_pages","doc":"Return the total number of pages.","summary":"<p>Return the total number of pages.</p>","abstract":false,"location":{"filename":"src/lustra/sql/query/with_pagination.cr","line_number":42,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/query/with_pagination.cr#L42"},"def":{"name":"total_pages","return_type":"Int32 | Int64","visibility":"Public","body":"if limit.nil? || total_entries.nil?\n  1\nelse\n  ((total_entries.as(Int64)) / (limit.as(Int64)).to_f).ceil.to_i\nend"},"external_var":false}]}]},{"html_id":"lustra/Lustra/SQL/QueryBuildingError","path":"Lustra/SQL/QueryBuildingError.html","kind":"class","full_name":"Lustra::SQL::QueryBuildingError","name":"QueryBuildingError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/RecordNotFoundError","path":"Lustra/SQL/RecordNotFoundError.html","kind":"class","full_name":"Lustra::SQL::RecordNotFoundError","name":"RecordNotFoundError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L10"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/RollbackError","path":"Lustra/SQL/RollbackError.html","kind":"class","full_name":"Lustra::SQL::RollbackError","name":"RollbackError","abstract":false,"superclass":{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Error","kind":"class","full_name":"Lustra::SQL::Error","name":"Error"},{"html_id":"lustra/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/errors.cr","line_number":13,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/errors.cr#L13"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"doc":"Rollback the transaction or the last savepoint.","summary":"<p>Rollback the transaction or the last savepoint.</p>"},{"html_id":"lustra/Lustra/SQL/Selectable","path":"Lustra/SQL/Selectable.html","kind":"alias","full_name":"Lustra::SQL::Selectable","name":"Selectable","abstract":false,"locations":[{"filename":"src/lustra/sql/sql.cr","line_number":68,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L68"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Lustra::SQL::SelectBuilder | String | Symbol)","aliased_html":"<a href=\"../../Lustra/SQL/SelectBuilder.html\">Lustra::SQL::SelectBuilder</a> | String | Symbol","const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/SelectBuilder","path":"Lustra/SQL/SelectBuilder.html","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder","abstract":false,"ancestors":[{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"}],"locations":[{"filename":"src/lustra/sql/select_builder.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"}],"including_types":[{"html_id":"lustra/Lustra/Model/CollectionBase","kind":"class","full_name":"Lustra::Model::CollectionBase(T)","name":"CollectionBase"},{"html_id":"lustra/Lustra/SQL/SelectQuery","kind":"class","full_name":"Lustra::SQL::SelectQuery","name":"SelectQuery"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"constructors":[{"html_id":"new(distinct_value=nil,cte={}ofString=>Lustra::SQL::SelectBuilder|String,columns=[]ofSQL::Column,froms=[]ofSQL::From,joins=[]ofSQL::Join,wheres=[]ofLustra::Expression::Node,havings=[]ofLustra::Expression::Node,windows=[]of::Tuple(String,String),group_bys=[]ofSymbolic,order_bys=[]ofLustra::SQL::Query::OrderBy::Record,limit=nil,offset=nil,lock=nil,before_query_triggers=[]of(->Nil))-class-method","name":"new","abstract":false,"args":[{"name":"distinct_value","default_value":"nil","external_name":"distinct_value","restriction":""},{"name":"cte","default_value":"{} of String => Lustra::SQL::SelectBuilder | String","external_name":"cte","restriction":""},{"name":"columns","default_value":"[] of SQL::Column","external_name":"columns","restriction":""},{"name":"froms","default_value":"[] of SQL::From","external_name":"froms","restriction":""},{"name":"joins","default_value":"[] of SQL::Join","external_name":"joins","restriction":""},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":""},{"name":"havings","default_value":"[] of Lustra::Expression::Node","external_name":"havings","restriction":""},{"name":"windows","default_value":"[] of ::Tuple(String, String)","external_name":"windows","restriction":""},{"name":"group_bys","default_value":"[] of Symbolic","external_name":"group_bys","restriction":""},{"name":"order_bys","default_value":"[] of Lustra::SQL::Query::OrderBy::Record","external_name":"order_bys","restriction":""},{"name":"limit","default_value":"nil","external_name":"limit","restriction":""},{"name":"offset","default_value":"nil","external_name":"offset","restriction":""},{"name":"lock","default_value":"nil","external_name":"lock","restriction":""},{"name":"before_query_triggers","default_value":"[] of (-> Nil)","external_name":"before_query_triggers","restriction":""}],"args_string":"(distinct_value = nil, cte = {} of String => Lustra::SQL::SelectBuilder | String, columns = [] of SQL::Column, froms = [] of SQL::From, joins = [] of SQL::Join, wheres = [] of Lustra::Expression::Node, havings = [] of Lustra::Expression::Node, windows = [] of ::Tuple(String, String), group_bys = [] of Symbolic, order_bys = [] of Lustra::SQL::Query::OrderBy::Record, limit = nil, offset = nil, lock = nil, before_query_triggers = [] of (-> Nil))","args_html":"(distinct_value = <span class=\"n\">nil</span>, cte = {} <span class=\"k\">of</span> <span class=\"t\">String</span> <span class=\"o\">=&gt;</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">SQL</span><span class=\"t\">::</span><span class=\"t\">SelectBuilder</span> <span class=\"o\">|</span> <span class=\"t\">String</span>, columns = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">SQL</span><span class=\"t\">::</span><span class=\"t\">Column</span>, froms = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">SQL</span><span class=\"t\">::</span><span class=\"t\">From</span>, joins = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">SQL</span><span class=\"t\">::</span><span class=\"t\">Join</span>, wheres = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Expression</span><span class=\"t\">::</span><span class=\"t\">Node</span>, havings = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Expression</span><span class=\"t\">::</span><span class=\"t\">Node</span>, windows = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">::</span><span class=\"t\">Tuple</span>(<span class=\"t\">String</span>, <span class=\"t\">String</span>), group_bys = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Symbolic</span>, order_bys = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">SQL</span><span class=\"t\">::</span><span class=\"t\">Query</span><span class=\"t\">::</span><span class=\"t\">OrderBy</span><span class=\"t\">::</span><span class=\"t\">Record</span>, limit = <span class=\"n\">nil</span>, offset = <span class=\"n\">nil</span>, lock = <span class=\"n\">nil</span>, before_query_triggers = <span class=\"o\">[]</span> <span class=\"k\">of</span> (<span class=\"o\">-&gt;</span> <span class=\"t\">Nil</span>))","location":{"filename":"src/lustra/sql/select_builder.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L29"},"def":{"name":"new","args":[{"name":"distinct_value","default_value":"nil","external_name":"distinct_value","restriction":""},{"name":"cte","default_value":"{} of String => Lustra::SQL::SelectBuilder | String","external_name":"cte","restriction":""},{"name":"columns","default_value":"[] of SQL::Column","external_name":"columns","restriction":""},{"name":"froms","default_value":"[] of SQL::From","external_name":"froms","restriction":""},{"name":"joins","default_value":"[] of SQL::Join","external_name":"joins","restriction":""},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":""},{"name":"havings","default_value":"[] of Lustra::Expression::Node","external_name":"havings","restriction":""},{"name":"windows","default_value":"[] of ::Tuple(String, String)","external_name":"windows","restriction":""},{"name":"group_bys","default_value":"[] of Symbolic","external_name":"group_bys","restriction":""},{"name":"order_bys","default_value":"[] of Lustra::SQL::Query::OrderBy::Record","external_name":"order_bys","restriction":""},{"name":"limit","default_value":"nil","external_name":"limit","restriction":""},{"name":"offset","default_value":"nil","external_name":"offset","restriction":""},{"name":"lock","default_value":"nil","external_name":"lock","restriction":""},{"name":"before_query_triggers","default_value":"[] of (-> Nil)","external_name":"before_query_triggers","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(distinct_value, cte, columns, froms, joins, wheres, havings, windows, group_bys, order_bys, limit, offset, lock, before_query_triggers)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"before_query(&block:->Nil)-instance-method","name":"before_query","doc":"A hook to apply some operation just before the query is executed.\n\n```\ncall = 0\nreq = Lustra::SQL.select(\"1\").before_query { call += 1 }\n10.times { req.execute }\npp call # 10\n```","summary":"<p>A hook to apply some operation just before the query is executed.</p>","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":26,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L26"},"def":{"name":"before_query","yields":0,"block_arity":0,"block_arg":{"name":"block","external_name":"block","restriction":"(-> Nil)"},"visibility":"Public","body":"@before_query_triggers << block\n\nself\n"},"external_var":false},{"html_id":"columns:Array(SQL::Column)-instance-method","name":"columns","abstract":false,"def":{"name":"columns","return_type":"Array(SQL::Column)","visibility":"Public","body":"@columns"},"external_var":false},{"html_id":"default_wildcard_table-instance-method","name":"default_wildcard_table","abstract":false,"def":{"name":"default_wildcard_table","visibility":"Public","body":"@default_wildcard_table"},"external_var":false},{"html_id":"dup:self-instance-method","name":"dup","doc":"Duplicate the query","summary":"<p>Duplicate the query</p>","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":46,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L46"},"def":{"name":"dup","return_type":"self","visibility":"Public","body":"self.class.new(distinct_value: @distinct_value, cte: @cte.dup, columns: @columns.dup, froms: @froms.dup, joins: @joins.dup, wheres: @wheres.dup, havings: @havings.dup, windows: @windows.dup, group_bys: @group_bys.dup, order_bys: @order_bys.dup, limit: @limit, offset: @offset, lock: @lock, before_query_triggers: @before_query_triggers).use_connection(connection_name)"},"external_var":false},{"html_id":"havings:Array(Lustra::Expression::Node)-instance-method","name":"havings","abstract":false,"def":{"name":"havings","return_type":"Array(Lustra::Expression::Node)","visibility":"Public","body":"@havings"},"external_var":false},{"html_id":"is_distinct?-instance-method","name":"is_distinct?","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":4,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L4"},"def":{"name":"is_distinct?","visibility":"Public","body":"!(!@distinct_value)"},"external_var":false},{"html_id":"joins:Array(SQL::Join)-instance-method","name":"joins","abstract":false,"def":{"name":"joins","return_type":"Array(SQL::Join)","visibility":"Public","body":"@joins"},"external_var":false},{"html_id":"limit:Int64|Nil-instance-method","name":"limit","abstract":false,"def":{"name":"limit","return_type":"Int64 | ::Nil","visibility":"Public","body":"@limit"},"external_var":false},{"html_id":"lock:String|Nil-instance-method","name":"lock","abstract":false,"def":{"name":"lock","return_type":"String | ::Nil","visibility":"Public","body":"@lock"},"external_var":false},{"html_id":"offset:Int64|Nil-instance-method","name":"offset","abstract":false,"def":{"name":"offset","return_type":"Int64 | ::Nil","visibility":"Public","body":"@offset"},"external_var":false},{"html_id":"order_bys:Array(Lustra::SQL::Query::OrderBy::Record)-instance-method","name":"order_bys","abstract":false,"def":{"name":"order_bys","return_type":"Array(Lustra::SQL::Query::OrderBy::Record)","visibility":"Public","body":"@order_bys"},"external_var":false},{"html_id":"to_delete-instance-method","name":"to_delete","doc":"Construct a delete query from this select query.\nIt uses only the `from` and the `where` clause fo the current select request.\nCan be useful in some case, but\n  use at your own risk !","summary":"<p>Construct a delete query from this select query.</p>","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":83,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L83"},"def":{"name":"to_delete","visibility":"Public","body":"if @froms.size == 1\nelse\n  raise(QueryBuildingError.new(\"Cannot build a delete query \" + \"from a select with multiple or none `from` clauses\"))\nend\n\nv = @froms[0].value\n\nif v.is_a?(SelectBuilder)\n  raise(QueryBuildingError.new(\"Cannot delete from a select with sub-select as `from` clause\"))\nend\n\nDeleteQuery.new(v.dup, @wheres.dup)\n"},"external_var":false},{"html_id":"to_sql:String-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":65,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L65"},"def":{"name":"to_sql","return_type":"String","visibility":"Public","body":"[print_ctes, print_select, print_froms, print_joins, print_wheres, print_windows, print_group_bys, print_havings, print_order_bys, print_limit_offsets, print_lock].compact.reject(&.empty?).join(\" \")"},"external_var":false},{"html_id":"to_update-instance-method","name":"to_update","abstract":false,"location":{"filename":"src/lustra/sql/select_builder.cr","line_number":94,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_builder.cr#L94"},"def":{"name":"to_update","visibility":"Public","body":"if @froms.size == 1\nelse\n  raise(QueryBuildingError.new(\"Cannot build a update query \" + \"from a select with multiple or none `from` clauses\"))\nend\nv = @froms[0].value\n\nif v.is_a?(SelectBuilder)\n  raise(QueryBuildingError.new(\"Cannot delete from a select with sub-select as `from` clause\"))\nend\n\nUpdateQuery.new(table: v.dup, wheres: @wheres.dup)\n"},"external_var":false},{"html_id":"total_entries:Int64|Nil-instance-method","name":"total_entries","abstract":false,"def":{"name":"total_entries","return_type":"Int64 | ::Nil","visibility":"Public","body":"@total_entries"},"external_var":false},{"html_id":"total_entries=(total_entries:Int64|Nil)-instance-method","name":"total_entries=","abstract":false,"args":[{"name":"total_entries","external_name":"total_entries","restriction":"Int64 | ::Nil"}],"args_string":"(total_entries : Int64 | Nil)","args_html":"(total_entries : Int64 | Nil)","def":{"name":"total_entries=","args":[{"name":"total_entries","external_name":"total_entries","restriction":"Int64 | ::Nil"}],"visibility":"Public","body":"@total_entries = total_entries"},"external_var":false},{"html_id":"wheres:Array(Lustra::Expression::Node)-instance-method","name":"wheres","doc":"Return the list of where clause; each where clause are transformed into\nLustra::Expression::Node","summary":"<p>Return the list of where clause; each where clause are transformed into Lustra::Expression::Node</p>","abstract":false,"def":{"name":"wheres","return_type":"Array(Lustra::Expression::Node)","visibility":"Public","body":"@wheres"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/SelectQuery","path":"Lustra/SQL/SelectQuery.html","kind":"class","full_name":"Lustra::SQL::SelectQuery","name":"SelectQuery","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"},{"html_id":"lustra/Lustra/SQL/Query/WithPagination","kind":"module","full_name":"Lustra::SQL::Query::WithPagination","name":"WithPagination"},{"html_id":"lustra/Lustra/SQL/Query/BeforeQuery","kind":"module","full_name":"Lustra::SQL::Query::BeforeQuery","name":"BeforeQuery"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/Pluck","kind":"module","full_name":"Lustra::SQL::Query::Pluck","name":"Pluck"},{"html_id":"lustra/Lustra/SQL/Query/Fetch","kind":"module","full_name":"Lustra::SQL::Query::Fetch","name":"Fetch"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Lock","kind":"module","full_name":"Lustra::SQL::Query::Lock","name":"Lock"},{"html_id":"lustra/Lustra/SQL/Query/Window","kind":"module","full_name":"Lustra::SQL::Query::Window","name":"Window"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Aggregate","kind":"module","full_name":"Lustra::SQL::Query::Aggregate","name":"Aggregate"},{"html_id":"lustra/Lustra/SQL/Query/OffsetLimit","kind":"module","full_name":"Lustra::SQL::Query::OffsetLimit","name":"OffsetLimit"},{"html_id":"lustra/Lustra/SQL/Query/GroupBy","kind":"module","full_name":"Lustra::SQL::Query::GroupBy","name":"GroupBy"},{"html_id":"lustra/Lustra/SQL/Query/OrderBy","kind":"module","full_name":"Lustra::SQL::Query::OrderBy","name":"OrderBy"},{"html_id":"lustra/Lustra/SQL/Query/Having","kind":"module","full_name":"Lustra::SQL::Query::Having","name":"Having"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Join","kind":"module","full_name":"Lustra::SQL::Query::Join","name":"Join"},{"html_id":"lustra/Lustra/SQL/Query/From","kind":"module","full_name":"Lustra::SQL::Query::From","name":"From"},{"html_id":"lustra/Lustra/SQL/Query/Select","kind":"module","full_name":"Lustra::SQL::Query::Select","name":"Select"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/select_query.cr","line_number":25,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_query.cr#L25"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Lustra/SQL/SelectBuilder","kind":"module","full_name":"Lustra::SQL::SelectBuilder","name":"SelectBuilder"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"doc":"A Select Query builder\n\nPostgres documentation:\n\n```\n[ WITH [ RECURSIVE ] with_query [, ...] ]\nSELECT [ ALL | DISTINCT [ ON ( expression [, ...] ) ] ]\n    [ * | expression [ [ AS ] output_name ] [, ...] ]\n    [ FROM from_item [, ...] ]\n    [ WHERE condition ]\n    [ GROUP BY grouping_element [, ...] ]\n    [ HAVING condition [, ...] ]\n    [ WINDOW window_name AS ( window_definition ) [, ...] ]\n    [ { UNION | INTERSECT | EXCEPT } [ ALL | DISTINCT ] select ]\n    [ ORDER BY expression [ ASC | DESC | USING operator ] [ NULLS { FIRST | LAST } ] [, ...] ]\n    [ LIMIT { count | ALL } ]\n    [ OFFSET start [ ROW | ROWS ] ]\n    [ FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } ONLY ]\n    [ FOR { UPDATE | NO KEY UPDATE | SHARE | KEY SHARE } [ OF table_name [, ...] ] [ NOWAIT | SKIP LOCKED ] [...] ]\n```","summary":"<p>A Select Query builder</p>","instance_methods":[{"html_id":"each(&):Nil-instance-method","name":"each","doc":"Must yield this collection's elements to the block.","summary":"<p>Must yield this collection's elements to the block.</p>","abstract":false,"location":{"filename":"src/lustra/sql/select_query.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/select_query.cr#L29"},"def":{"name":"each","yields":1,"block_arity":1,"return_type":"Nil","visibility":"Public","body":"fetch do |h| yield(h) end"},"external_var":false}]},{"html_id":"lustra/Lustra/SQL/Symbolic","path":"Lustra/SQL/Symbolic.html","kind":"alias","full_name":"Lustra::SQL::Symbolic","name":"Symbolic","abstract":false,"locations":[{"filename":"src/lustra/sql/sql.cr","line_number":67,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/sql.cr#L67"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(String | Symbol)","aliased_html":"String | Symbol","const":false,"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}},{"html_id":"lustra/Lustra/SQL/Transaction","path":"Lustra/SQL/Transaction.html","kind":"module","full_name":"Lustra::SQL::Transaction","name":"Transaction","abstract":false,"locations":[{"filename":"src/lustra/sql/transaction.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"instance_methods":[{"html_id":"after_commit(connection:String=\"default\",&block:DB::Connection->Nil)-instance-method","name":"after_commit","doc":"Register a callback function which will be fired once when SQL `COMMIT`\noperation is called\n\nThis can be used for example to send email, or perform others tasks\nwhen you want to be sure the data is secured in the database.\n\n```\ntransaction do\n  @user = User.find(1)\n  @user.subscribe!\n  Lustra::SQL.after_commit { Email.deliver(ConfirmationMail.new(@user)) }\nend\n```\n\nIn case the transaction fail and eventually rollback, the code won't be called.","summary":"<p>Register a callback function which will be fired once when SQL <code>COMMIT</code> operation is called</p>","abstract":false,"args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"}],"args_string":"(connection : String = \"default\", &block : DB::Connection -> Nil)","args_html":"(connection : String = <span class=\"s\">&quot;default&quot;</span>, &block : <a href=\"../../DB/Connection.html\">DB::Connection</a> -> Nil)","location":{"filename":"src/lustra/sql/transaction.cr","line_number":98,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L98"},"def":{"name":"after_commit","args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(DB::Connection -> Nil)"},"visibility":"Public","body":"Lustra::SQL::ConnectionPool.with_connection(connection) do |cnx|\n  if cnx._in_transaction?\n    __temp_d0a75a42_1 = cnx\n    @@commit_callbacks[__temp_d0a75a42_1] = @@commit_callbacks[__temp_d0a75a42_1] << block\n  else\n    raise(Lustra::SQL::Error.new(\"you need to be in transaction to add after_commit callback\"))\n  end\nend"},"external_var":false},{"html_id":"in_transaction?(connection:String=\"default\")-instance-method","name":"in_transaction?","doc":"Check whether the current pair of fiber/connection is in transaction\nblock or not.","summary":"<p>Check whether the current pair of fiber/connection is in transaction block or not.</p>","abstract":false,"args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"}],"args_string":"(connection : String = \"default\")","args_html":"(connection : String = <span class=\"s\">&quot;default&quot;</span>)","location":{"filename":"src/lustra/sql/transaction.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L29"},"def":{"name":"in_transaction?","args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"}],"visibility":"Public","body":"Lustra::SQL::ConnectionPool.with_connection(connection, &._in_transaction?)"},"external_var":false},{"html_id":"rollback(to=nil)-instance-method","name":"rollback","doc":"Rollback a transaction or return to the previous savepoint in case of a\nwith_savepoint block.\nThe params `to` offer","summary":"<p>Rollback a transaction or return to the previous savepoint in case of a with_savepoint block.</p>","abstract":false,"args":[{"name":"to","default_value":"nil","external_name":"to","restriction":""}],"args_string":"(to = nil)","args_html":"(to = <span class=\"n\">nil</span>)","location":{"filename":"src/lustra/sql/transaction.cr","line_number":138,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L138"},"def":{"name":"rollback","args":[{"name":"to","default_value":"nil","external_name":"to","restriction":""}],"visibility":"Public","body":"raise(RollbackError.new(to))"},"external_var":false},{"html_id":"rollback_transaction-instance-method","name":"rollback_transaction","doc":"Rollback the transaction. In case the call is made inside a savepoint block\nrollback everything.","summary":"<p>Rollback the transaction.</p>","abstract":false,"location":{"filename":"src/lustra/sql/transaction.cr","line_number":144,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L144"},"def":{"name":"rollback_transaction","visibility":"Public","body":"raise(CancelTransactionError.new)"},"external_var":false},{"html_id":"transaction(connection:String=\"default\",level:Level=Level::Serializable,&)-instance-method","name":"transaction","doc":"Enter new transaction block for the current connection/fiber pair.\n\nExample:\n\n```\nLustra::SQL.transaction do\n  # do something\n  Lustra::SQL.transaction do # Technically, this block do nothing, since we already are in transaction\n    rollback                 # < Rollback the up-most `transaction` block.\n  end\nend\n```\n\nsee #with_savepoint to use a stackable version using savepoints.","summary":"<p>Enter new transaction block for the current connection/fiber pair.</p>","abstract":false,"args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"},{"name":"level","default_value":"Level::Serializable","external_name":"level","restriction":"Level"}],"args_string":"(connection : String = \"default\", level : Level = Level::Serializable, &)","args_html":"(connection : String = <span class=\"s\">&quot;default&quot;</span>, level : <a href=\"../../Lustra/SQL/Transaction/Level.html\">Level</a> = <span class=\"t\">Level</span><span class=\"t\">::</span><span class=\"t\">Serializable</span>, &)","location":{"filename":"src/lustra/sql/transaction.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L48"},"def":{"name":"transaction","args":[{"name":"connection","default_value":"\"default\"","external_name":"connection","restriction":"String"},{"name":"level","default_value":"Level::Serializable","external_name":"level","restriction":"Level"}],"yields":1,"block_arity":1,"visibility":"Public","body":"Lustra::SQL::ConnectionPool.with_connection(connection) do |cnx|\n  has_rollback = false\n\n  if cnx._in_transaction?\n    return yield(cnx)\n  else\n    cnx._in_transaction = true\n    execute(level.to_begin_operation)\n    begin\n      return yield(cnx)\n    rescue e\n      has_rollback = true\n      is_rollback_error = e.is_a?(RollbackError) || e.is_a?(CancelTransactionError)\n      begin\n        execute(\"ROLLBACK --\" + (is_rollback_error ? \"normal\" : \"program error\"))\n      rescue\n        nil\n      end\n      if is_rollback_error\n      else\n        raise(e)\n      end\n    ensure\n      cnx._in_transaction = false\n\n      callbacks = @@commit_callbacks.delete(cnx)\n\n      if has_rollback\n      else\n        execute(\"COMMIT\")\n\n\n\n\n        callbacks.try(&.each(&.call(cnx)))\n      end\n    end\n  end\nend"},"external_var":false},{"html_id":"with_savepoint(sp_name:Symbolic|Nil=nil,connection_name:String=\"default\",&)-instance-method","name":"with_savepoint","doc":"Create a transaction, but this one is stackable\nusing savepoints.\n\nExample:\n\n```\nLustra::SQL.with_savepoint do\n  # do something\n  Lustra::SQL.with_savepoint do\n    rollback # < Rollback only the last `with_savepoint` block\n  end\nend\n```","summary":"<p>Create a transaction, but this one is stackable using savepoints.</p>","abstract":false,"args":[{"name":"sp_name","default_value":"nil","external_name":"sp_name","restriction":"Symbolic | ::Nil"},{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"args_string":"(sp_name : Symbolic | Nil = nil, connection_name : String = \"default\", &)","args_html":"(sp_name : <a href=\"../../Lustra/SQL/Symbolic.html\">Symbolic</a> | Nil = <span class=\"n\">nil</span>, connection_name : String = <span class=\"s\">&quot;default&quot;</span>, &)","location":{"filename":"src/lustra/sql/transaction.cr","line_number":121,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L121"},"def":{"name":"with_savepoint","args":[{"name":"sp_name","default_value":"nil","external_name":"sp_name","restriction":"Symbolic | ::Nil"},{"name":"connection_name","default_value":"\"default\"","external_name":"connection_name","restriction":"String"}],"yields":0,"block_arity":0,"visibility":"Public","body":"transaction do |cnx|\n  begin\n    sp_name || (sp_name = \"sp_#{@@savepoint_uid = @@savepoint_uid + 1}\")\n    execute(connection_name, \"SAVEPOINT #{sp_name}\")\n    yield\n    if cnx._in_transaction?\n      execute(connection_name, \"RELEASE SAVEPOINT #{sp_name}\")\n    end\n  rescue e : RollbackError\n    if cnx._in_transaction?\n      execute(connection_name, \"ROLLBACK TO SAVEPOINT #{sp_name}\")\n      if e.savepoint_id.try(&.!=(sp_name))\n        raise(e)\n      end\n    end\n  end\nend"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/Transaction/Level","path":"Lustra/SQL/Transaction/Level.html","kind":"enum","full_name":"Lustra::SQL::Transaction::Level","name":"Level","abstract":false,"ancestors":[{"html_id":"lustra/Enum","kind":"struct","full_name":"Enum","name":"Enum"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/transaction.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L6"}],"repository_name":"lustra","program":false,"enum":true,"alias":false,"const":false,"constants":[{"id":"ReadCommitted","name":"ReadCommitted","value":"0"},{"id":"RepeatableRead","name":"RepeatableRead","value":"1"},{"id":"Serializable","name":"Serializable","value":"2"}],"namespace":{"html_id":"lustra/Lustra/SQL/Transaction","kind":"module","full_name":"Lustra::SQL::Transaction","name":"Transaction"},"doc":"Represents the differents levels of transactions\n  as described in https://www.postgresql.org/docs/9.5/transaction-iso.html\n\n  ReadUncommited is voluntarly ommited as it fallback to ReadCommited in PostgreSQL","summary":"<p>Represents the differents levels of transactions   as described in https://www.postgresql.org/docs/9.5/transaction-iso.html</p>","instance_methods":[{"html_id":"read_committed?-instance-method","name":"read_committed?","doc":"Returns `true` if this enum value equals `ReadCommitted`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../../Lustra/SQL/Transaction/Level.html#ReadCommitted\">ReadCommitted</a></code></p>","abstract":false,"location":{"filename":"src/lustra/sql/transaction.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L7"},"def":{"name":"read_committed?","visibility":"Public","body":"self == ReadCommitted"},"external_var":false},{"html_id":"repeatable_read?-instance-method","name":"repeatable_read?","doc":"Returns `true` if this enum value equals `RepeatableRead`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../../Lustra/SQL/Transaction/Level.html#RepeatableRead\">RepeatableRead</a></code></p>","abstract":false,"location":{"filename":"src/lustra/sql/transaction.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L8"},"def":{"name":"repeatable_read?","visibility":"Public","body":"self == RepeatableRead"},"external_var":false},{"html_id":"serializable?-instance-method","name":"serializable?","doc":"Returns `true` if this enum value equals `Serializable`","summary":"<p>Returns <code>true</code> if this enum value equals <code><a href=\"../../../Lustra/SQL/Transaction/Level.html#Serializable\">Serializable</a></code></p>","abstract":false,"location":{"filename":"src/lustra/sql/transaction.cr","line_number":9,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/transaction.cr#L9"},"def":{"name":"serializable?","visibility":"Public","body":"self == Serializable"},"external_var":false}]}]},{"html_id":"lustra/Lustra/SQL/UpdateQuery","path":"Lustra/SQL/UpdateQuery.html","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"},{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/sql/update_query.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L6"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Lustra/SQL/Query/Change","kind":"module","full_name":"Lustra::SQL::Query::Change","name":"Change"},{"html_id":"lustra/Lustra/SQL/Query/Connection","kind":"module","full_name":"Lustra::SQL::Query::Connection","name":"Connection"},{"html_id":"lustra/Lustra/SQL/Query/CTE","kind":"module","full_name":"Lustra::SQL::Query::CTE","name":"CTE"},{"html_id":"lustra/Lustra/SQL/Query/Execute","kind":"module","full_name":"Lustra::SQL::Query::Execute","name":"Execute"},{"html_id":"lustra/Lustra/SQL/Query/Where","kind":"module","full_name":"Lustra::SQL::Query::Where","name":"Where"}],"namespace":{"html_id":"lustra/Lustra/SQL","kind":"module","full_name":"Lustra::SQL","name":"SQL"},"doc":"TODO: Documentation","summary":"<p><span class=\"flag orange\">TODO</span>  Documentation</p>","constructors":[{"html_id":"new(table:String|Symbol|Nil,wheres:Array(Lustra::Expression::Node)=[]ofLustra::Expression::Node)-class-method","name":"new","abstract":false,"args":[{"name":"table","external_name":"table","restriction":"::String | ::Symbol | ::Nil"},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":"::Array(::Lustra::Expression::Node)"}],"args_string":"(table : String | Symbol | Nil, wheres : Array(Lustra::Expression::Node) = [] of Lustra::Expression::Node)","args_html":"(table : String | Symbol | Nil, wheres : Array(<a href=\"../../Lustra/Expression/Node.html\">Lustra::Expression::Node</a>) = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">Lustra</span><span class=\"t\">::</span><span class=\"t\">Expression</span><span class=\"t\">::</span><span class=\"t\">Node</span>)","location":{"filename":"src/lustra/sql/update_query.cr","line_number":19,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L19"},"def":{"name":"new","args":[{"name":"table","external_name":"table","restriction":"::String | ::Symbol | ::Nil"},{"name":"wheres","default_value":"[] of Lustra::Expression::Node","external_name":"wheres","restriction":"::Array(::Lustra::Expression::Node)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(table, wheres)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"set(row:NamedTuple)-instance-method","name":"set","abstract":false,"args":[{"name":"row","external_name":"row","restriction":"NamedTuple"}],"args_string":"(row : NamedTuple)","args_html":"(row : NamedTuple)","location":{"filename":"src/lustra/sql/update_query.cr","line_number":22,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L22"},"def":{"name":"set","args":[{"name":"row","external_name":"row","restriction":"NamedTuple"}],"visibility":"Public","body":"h = {} of String => Updatable\nrow.each do |k, v| h[k.to_s] = v end\nset(h)\nchange!\n"},"external_var":false},{"html_id":"set(row:String)-instance-method","name":"set","abstract":false,"args":[{"name":"row","external_name":"row","restriction":"String"}],"args_string":"(row : String)","args_html":"(row : String)","location":{"filename":"src/lustra/sql/update_query.cr","line_number":33,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L33"},"def":{"name":"set","args":[{"name":"row","external_name":"row","restriction":"String"}],"visibility":"Public","body":"@values << row\nchange!\n"},"external_var":false},{"html_id":"set(row:Hash(String,Updatable))-instance-method","name":"set","abstract":false,"args":[{"name":"row","external_name":"row","restriction":"Hash(String, Updatable)"}],"args_string":"(row : Hash(String, Updatable))","args_html":"(row : Hash(String, <a href=\"../../Lustra/SQL/UpdateQuery/Updatable.html\">Updatable</a>))","location":{"filename":"src/lustra/sql/update_query.cr","line_number":38,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L38"},"def":{"name":"set","args":[{"name":"row","external_name":"row","restriction":"Hash(String, Updatable)"}],"visibility":"Public","body":"@values << (Hash(String, Updatable).new.merge(row))\nchange!\n"},"external_var":false},{"html_id":"set(**row)-instance-method","name":"set","abstract":false,"location":{"filename":"src/lustra/sql/update_query.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L29"},"def":{"name":"set","double_splat":{"name":"row","external_name":"row","restriction":""},"visibility":"Public","body":"set(row)"},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/sql/update_query.cr","line_number":62,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L62"},"def":{"name":"to_sql","visibility":"Public","body":"table = @table.is_a?(Symbol) ? SQL.escape(@table.to_s) : @table\n\n[print_ctes, \"UPDATE\", table, \"SET\", print_values, print_wheres].compact.join(\" \")\n"},"external_var":false},{"html_id":"wheres:Array(Lustra::Expression::Node)-instance-method","name":"wheres","doc":"Return the list of where clause; each where clause are transformed into\nLustra::Expression::Node","summary":"<p>Return the list of where clause; each where clause are transformed into Lustra::Expression::Node</p>","abstract":false,"def":{"name":"wheres","return_type":"Array(Lustra::Expression::Node)","visibility":"Public","body":"@wheres"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/SQL/UpdateQuery/Updatable","path":"Lustra/SQL/UpdateQuery/Updatable.html","kind":"alias","full_name":"Lustra::SQL::UpdateQuery::Updatable","name":"Updatable","abstract":false,"locations":[{"filename":"src/lustra/sql/update_query.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L7"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | BigDecimal | BigFloat | BigInt | Bool | Char | Crypto::Bcrypt::Password | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | JSON::PullParser | Lustra::Expression::Literal | PG::Geo::Box | PG::Geo::Circle | PG::Geo::Line | PG::Geo::LineSegment | PG::Geo::Path | PG::Geo::Point | PG::Geo::Polygon | PG::Interval | PG::Numeric | Slice(UInt8) | String | Time | UInt16 | UInt32 | UInt64 | UInt8 | UUID | Nil)","aliased_html":"Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | <a href=\"../../../BigDecimal.html\">BigDecimal</a> | BigFloat | BigInt | Bool | <a href=\"../../../Char.html\">Char</a> | <a href=\"../../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | <a href=\"../../../JSON/PullParser.html\">JSON::PullParser</a> | <a href=\"../../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | <a href=\"../../../PG/Geo/Box.html\">PG::Geo::Box</a> | <a href=\"../../../PG/Geo/Circle.html\">PG::Geo::Circle</a> | <a href=\"../../../PG/Geo/Line.html\">PG::Geo::Line</a> | <a href=\"../../../PG/Geo/LineSegment.html\">PG::Geo::LineSegment</a> | <a href=\"../../../PG/Geo/Path.html\">PG::Geo::Path</a> | <a href=\"../../../PG/Geo/Point.html\">PG::Geo::Point</a> | <a href=\"../../../PG/Geo/Polygon.html\">PG::Geo::Polygon</a> | <a href=\"../../../PG/Interval.html\">PG::Interval</a> | <a href=\"../../../PG/Numeric.html\">PG::Numeric</a> | <a href=\"../../../Slice.html\">Slice(UInt8)</a> | String | <a href=\"../../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | <a href=\"../../../UUID.html\">UUID</a> | Nil","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}},{"html_id":"lustra/Lustra/SQL/UpdateQuery/UpdateInstruction","path":"Lustra/SQL/UpdateQuery/UpdateInstruction.html","kind":"alias","full_name":"Lustra::SQL::UpdateQuery::UpdateInstruction","name":"UpdateInstruction","abstract":false,"locations":[{"filename":"src/lustra/sql/update_query.cr","line_number":8,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/sql/update_query.cr#L8"}],"repository_name":"lustra","program":false,"enum":false,"alias":true,"aliased":"(Hash(String, Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | BigDecimal | BigFloat | BigInt | Bool | Char | Crypto::Bcrypt::Password | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | JSON::PullParser | Lustra::Expression::Literal | PG::Geo::Box | PG::Geo::Circle | PG::Geo::Line | PG::Geo::LineSegment | PG::Geo::Path | PG::Geo::Point | PG::Geo::Polygon | PG::Interval | PG::Numeric | Slice(UInt8) | String | Time | UInt16 | UInt32 | UInt64 | UInt8 | UUID | Nil) | String)","aliased_html":"Hash(String, Array(PG::BoolArray) | Array(PG::CharArray) | Array(PG::Float32Array) | Array(PG::Float64Array) | Array(PG::Int16Array) | Array(PG::Int32Array) | Array(PG::Int64Array) | Array(PG::NumericArray) | Array(PG::StringArray) | Array(PG::TimeArray) | Array(PG::UUIDArray) | <a href=\"../../../BigDecimal.html\">BigDecimal</a> | BigFloat | BigInt | Bool | <a href=\"../../../Char.html\">Char</a> | <a href=\"../../../Crypto/Bcrypt/Password.html\">Crypto::Bcrypt::Password</a> | Float32 | Float64 | Int16 | Int32 | Int64 | Int8 | JSON::Any | <a href=\"../../../JSON/PullParser.html\">JSON::PullParser</a> | <a href=\"../../../Lustra/Expression/Literal.html\">Lustra::Expression::Literal</a> | <a href=\"../../../PG/Geo/Box.html\">PG::Geo::Box</a> | <a href=\"../../../PG/Geo/Circle.html\">PG::Geo::Circle</a> | <a href=\"../../../PG/Geo/Line.html\">PG::Geo::Line</a> | <a href=\"../../../PG/Geo/LineSegment.html\">PG::Geo::LineSegment</a> | <a href=\"../../../PG/Geo/Path.html\">PG::Geo::Path</a> | <a href=\"../../../PG/Geo/Point.html\">PG::Geo::Point</a> | <a href=\"../../../PG/Geo/Polygon.html\">PG::Geo::Polygon</a> | <a href=\"../../../PG/Interval.html\">PG::Interval</a> | <a href=\"../../../PG/Numeric.html\">PG::Numeric</a> | <a href=\"../../../Slice.html\">Slice(UInt8)</a> | String | <a href=\"../../../Time.html\">Time</a> | UInt16 | UInt32 | UInt64 | UInt8 | <a href=\"../../../UUID.html\">UUID</a> | Nil) | String","const":false,"namespace":{"html_id":"lustra/Lustra/SQL/UpdateQuery","kind":"class","full_name":"Lustra::SQL::UpdateQuery","name":"UpdateQuery"}}]}]},{"html_id":"lustra/Lustra/TimeInDay","path":"Lustra/TimeInDay.html","kind":"struct","full_name":"Lustra::TimeInDay","name":"TimeInDay","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":29,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L29"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"`Lustra::TimeInDay` represents the \"time\" object of PostgreSQL\n\nIt can be converted automatically from/to a `time` column.\nIt offers helpers which makes it usable also as a stand alone.\n\n## Usage example\n\n```\ntime = Lustra::TimeInDay.parse(\"12:33\")\nputs time.hour    # 12\nputs time.minutes # 0\n\nTime.local.at(time) # Today at 12:33:00\ntime.to_s           # 12:33:00\ntime.to_s(false)    # don't show seconds => 12:33\n\ntime = time + 2.minutes # 12:35\n```\n\nAs with Interval, you might wanna use it as a column (use underlying `time` type in PostgreSQL):\n\n```\nclass MyModel\n  include Lustra::Model\n\n  column time_in_day : Lustra::TimeInDay\nend\n```","summary":"<p><code><a href=\"../Lustra/TimeInDay.html\">Lustra::TimeInDay</a></code> represents the &quot;time&quot; object of PostgreSQL</p>","class_methods":[{"html_id":"parse(str:String)-class-method","name":"parse","doc":"Parse a string, of format HH:MM or HH:MM:SS","summary":"<p>Parse a string, of format HH:MM or HH:MM:SS</p>","abstract":false,"args":[{"name":"str","external_name":"str","restriction":"String"}],"args_string":"(str : String)","args_html":"(str : String)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":113,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L113"},"def":{"name":"parse","args":[{"name":"str","external_name":"str","restriction":"String"}],"visibility":"Public","body":"if str =~ (/^[0-9]+:[0-9]{2}(:[0-9]{2})?$/)\nelse\n  raise(\"Wrong format\")\nend\n\narr = (str.split(/\\:/)).map(&.try(&.to_i))\n\nhours = arr[0]\nminutes = arr[1]\nseconds = arr[2]?\n\nif seconds\n  return Lustra::TimeInDay.new(hours, minutes, seconds)\nend\n\nLustra::TimeInDay.new(hours, minutes)\n"},"external_var":false}],"constructors":[{"html_id":"new(hours,minutes,seconds=0)-class-method","name":"new","abstract":false,"args":[{"name":"hours","external_name":"hours","restriction":""},{"name":"minutes","external_name":"minutes","restriction":""},{"name":"seconds","default_value":"0","external_name":"seconds","restriction":""}],"args_string":"(hours, minutes, seconds = 0)","args_html":"(hours, minutes, seconds = <span class=\"n\">0</span>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":36,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L36"},"def":{"name":"new","args":[{"name":"hours","external_name":"hours","restriction":""},{"name":"minutes","external_name":"minutes","restriction":""},{"name":"seconds","default_value":"0","external_name":"seconds","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(hours, minutes, seconds)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(microseconds:UInt64=0)-class-method","name":"new","abstract":false,"args":[{"name":"microseconds","default_value":"0","external_name":"microseconds","restriction":"UInt64"}],"args_string":"(microseconds : UInt64 = 0)","args_html":"(microseconds : UInt64 = <span class=\"n\">0</span>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":40,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L40"},"def":{"name":"new","args":[{"name":"microseconds","default_value":"0","external_name":"microseconds","restriction":"UInt64"}],"visibility":"Public","body":"_ = allocate\n_.initialize(microseconds)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"+(t:Time::Span)-instance-method","name":"+","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"Time::Span"}],"args_string":"(t : Time::Span)","args_html":"(t : Time::Span)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L43"},"def":{"name":"+","args":[{"name":"t","external_name":"t","restriction":"Time::Span"}],"visibility":"Public","body":"Lustra::TimeInDay.new(microseconds: @microseconds + (t.total_nanoseconds.to_i64 // 1000))"},"external_var":false},{"html_id":"+(x:self)-instance-method","name":"+","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"self"}],"args_string":"(x : self)","args_html":"(x : <span class=\"k\">self</span>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":51,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L51"},"def":{"name":"+","args":[{"name":"x","external_name":"x","restriction":"self"}],"visibility":"Public","body":"TimeInDay.new(@microseconds + x.ms)"},"external_var":false},{"html_id":"-(t:Time::Span)-instance-method","name":"-","abstract":false,"args":[{"name":"t","external_name":"t","restriction":"Time::Span"}],"args_string":"(t : Time::Span)","args_html":"(t : Time::Span)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":47,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L47"},"def":{"name":"-","args":[{"name":"t","external_name":"t","restriction":"Time::Span"}],"visibility":"Public","body":"Lustra::TimeInDay.new(microseconds: @microseconds - (t.total_nanoseconds.to_i64 // 1000))"},"external_var":false},{"html_id":"hour-instance-method","name":"hour","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":55,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L55"},"def":{"name":"hour","visibility":"Public","body":"(@microseconds // HOUR)"},"external_var":false},{"html_id":"inspect-instance-method","name":"inspect","doc":"Returns an unambiguous and information-rich string representation of this\nobject, typically intended for developers.\n\nThis method should usually **not** be overridden. It delegates to\n`#inspect(IO)` which can be overridden for custom implementations.\n\nAlso see `#to_s`.","summary":"<p>Returns an unambiguous and information-rich string representation of this object, typically intended for developers.</p>","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":79,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L79"},"def":{"name":"inspect","visibility":"Public","body":"\"#{self.class.name}(#{self})\""},"external_var":false},{"html_id":"microseconds:UInt64-instance-method","name":"microseconds","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":30,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L30"},"def":{"name":"microseconds","return_type":"UInt64","visibility":"Public","body":"@microseconds"},"external_var":false},{"html_id":"minutes-instance-method","name":"minutes","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":59,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L59"},"def":{"name":"minutes","visibility":"Public","body":"(@microseconds % HOUR) // MINUTE"},"external_var":false},{"html_id":"seconds-instance-method","name":"seconds","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":63,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L63"},"def":{"name":"seconds","visibility":"Public","body":"(@microseconds % MINUTE) // SECOND"},"external_var":false},{"html_id":"to_json(json:JSON::Builder):Nil-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder) : Nil","args_html":"(json : JSON::Builder) : Nil","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":108,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L108"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"return_type":"Nil","visibility":"Public","body":"json.string(to_s)"},"external_var":false},{"html_id":"to_s(show_seconds:Bool=true)-instance-method","name":"to_s","doc":"Returns a nicely readable and concise string representation of this object,\ntypically intended for users.\n\nThis method should usually **not** be overridden. It delegates to\n`#to_s(IO)` which can be overridden for custom implementations.\n\nAlso see `#inspect`.","summary":"<p>Returns a nicely readable and concise string representation of this object, typically intended for users.</p>","abstract":false,"args":[{"name":"show_seconds","default_value":"true","external_name":"show_seconds","restriction":"Bool"}],"args_string":"(show_seconds : Bool = true)","args_html":"(show_seconds : Bool = <span class=\"n\">true</span>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":83,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L83"},"def":{"name":"to_s","args":[{"name":"show_seconds","default_value":"true","external_name":"show_seconds","restriction":"Bool"}],"visibility":"Public","body":"io = IO::Memory.new\nto_s(io, show_seconds)\nio.rewind\nio.to_s\n"},"external_var":false},{"html_id":"to_s(io,show_seconds:Bool=true)-instance-method","name":"to_s","doc":"Return a string","summary":"<p>Return a string</p>","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""},{"name":"show_seconds","default_value":"true","external_name":"show_seconds","restriction":"Bool"}],"args_string":"(io, show_seconds : Bool = true)","args_html":"(io, show_seconds : Bool = <span class=\"n\">true</span>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":91,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L91"},"def":{"name":"to_s","args":[{"name":"io","external_name":"io","restriction":""},{"name":"show_seconds","default_value":"true","external_name":"show_seconds","restriction":"Bool"}],"visibility":"Public","body":"hours, minutes, seconds = to_tuple\n\nif show_seconds\n  io << ({hours.to_s.rjust(2, '0'), minutes.to_s.rjust(2, '0'), seconds.to_s.rjust(2, '0')}.join(':'))\nelse\n  io << ({hours.to_s.rjust(2, '0'), minutes.to_s.rjust(2, '0')}.join(':'))\nend\n"},"external_var":false},{"html_id":"to_tuple-instance-method","name":"to_tuple","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":71,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L71"},"def":{"name":"to_tuple","visibility":"Public","body":"hours, left = @microseconds.divmod(HOUR)\nminutes, left = left.divmod(MINUTE)\nseconds = left // SECOND\n\n{hours, minutes, seconds}\n"},"external_var":false},{"html_id":"total_seconds-instance-method","name":"total_seconds","abstract":false,"location":{"filename":"src/lustra/extensions/time_in_days/time_in_day.cr","line_number":67,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day.cr#L67"},"def":{"name":"total_seconds","visibility":"Public","body":"@microseconds // SECOND"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/TimeInDay/Converter","path":"Lustra/TimeInDay/Converter.html","kind":"module","full_name":"Lustra::TimeInDay::Converter","name":"Converter","abstract":false,"locations":[{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":23,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L23"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/TimeInDay","kind":"struct","full_name":"Lustra::TimeInDay","name":"TimeInDay"},"class_methods":[{"html_id":"to_column(x):TimeInDay|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : TimeInDay | Nil","args_html":"(x) : <a href=\"../../Lustra/TimeInDay.html\">TimeInDay</a> | Nil","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":24,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L24"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"TimeInDay | ::Nil","visibility":"Public","body":"case x\nwhen TimeInDay\n  x\nwhen UInt64\n  TimeInDay.new(x)\nwhen Slice\n  mem = IO::Memory.new(x, writeable: false)\n  TimeInDay.new(mem.read_bytes(UInt64, IO::ByteFormat::BigEndian))\nwhen String\n  TimeInDay.parse(x)\nwhen Nil\n  nil\nelse\n  raise(\"Cannot convert to TimeInDay from #{x.class}\")\nend"},"external_var":false},{"html_id":"to_db(x:TimeInDay|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"TimeInDay | ::Nil"}],"args_string":"(x : TimeInDay | Nil)","args_html":"(x : <a href=\"../../Lustra/TimeInDay.html\">TimeInDay</a> | Nil)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":42,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L42"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"TimeInDay | ::Nil"}],"visibility":"Public","body":"x ? x.to_s : nil"},"external_var":false}]}]},{"html_id":"lustra/Lustra/TSVector","path":"Lustra/TSVector.html","kind":"class","full_name":"Lustra::TSVector","name":"TSVector","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"class_methods":[{"html_id":"decode(x:Slice(UInt8))-class-method","name":"decode","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"Slice(UInt8)"}],"args_string":"(x : Slice(UInt8))","args_html":"(x : <a href=\"../Slice.html\">Slice</a>(UInt8))","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":70,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L70"},"def":{"name":"decode","args":[{"name":"x","external_name":"x","restriction":"Slice(UInt8)"}],"visibility":"Public","body":"io = IO::Memory.new(x, writeable: false)\nLustra::TSVector.new(io)\n"},"external_var":false}],"constructors":[{"html_id":"new(io)-class-method","name":"new","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L56"},"def":{"name":"new","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(io)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"[](key:String)-instance-method","name":"[]","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":39,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L39"},"def":{"name":"[]","args":[{"name":"key","external_name":"key","restriction":"String"}],"visibility":"Public","body":"lexems[key]"},"external_var":false},{"html_id":"[]?(key:String)-instance-method","name":"[]?","abstract":false,"args":[{"name":"key","external_name":"key","restriction":"String"}],"args_string":"(key : String)","args_html":"(key : String)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":43,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L43"},"def":{"name":"[]?","args":[{"name":"key","external_name":"key","restriction":"String"}],"visibility":"Public","body":"lexems[key]?"},"external_var":false},{"html_id":"lexems:Hash(String,Lexem)-instance-method","name":"lexems","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":37,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L37"},"def":{"name":"lexems","return_type":"Hash(String, Lexem)","visibility":"Public","body":"@lexems"},"external_var":false},{"html_id":"to_sql-instance-method","name":"to_sql","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":47,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L47"},"def":{"name":"to_sql","visibility":"Public","body":"@lexems.values.join(\" \") do |v|\n  {Lustra::Expression[v.value], v.positions.join(\",\") do |p| {p.position, p.weight}.join end}.join(\":\")\nend"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/TSVector/Converter","path":"Lustra/TSVector/Converter.html","kind":"module","full_name":"Lustra::TSVector::Converter","name":"Converter","abstract":false,"locations":[{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":75,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L75"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/TSVector","kind":"class","full_name":"Lustra::TSVector","name":"TSVector"},"class_methods":[{"html_id":"to_column(x):Lustra::TSVector|Nil-class-method","name":"to_column","abstract":false,"args":[{"name":"x","external_name":"x","restriction":""}],"args_string":"(x) : Lustra::TSVector | Nil","args_html":"(x) : <a href=\"../../Lustra/TSVector.html\">Lustra::TSVector</a> | Nil","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":76,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L76"},"def":{"name":"to_column","args":[{"name":"x","external_name":"x","restriction":""}],"return_type":"Lustra::TSVector | ::Nil","visibility":"Public","body":"case x\nwhen Slice(UInt8)\n  Lustra::TSVector.decode(x)\nwhen Lustra::TSVector\n  x\nwhen Nil\n  nil\nelse\n  raise(Lustra::ErrorMessages.converter_error(x.class, \"TSVector\"))\nend"},"external_var":false},{"html_id":"to_db(x:TSVector|Nil)-class-method","name":"to_db","abstract":false,"args":[{"name":"x","external_name":"x","restriction":"TSVector | ::Nil"}],"args_string":"(x : TSVector | Nil)","args_html":"(x : <a href=\"../../Lustra/TSVector.html\">TSVector</a> | Nil)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":89,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L89"},"def":{"name":"to_db","args":[{"name":"x","external_name":"x","restriction":"TSVector | ::Nil"}],"visibility":"Public","body":"x.try(&.to_sql)"},"external_var":false}]},{"html_id":"lustra/Lustra/TSVector/Lexem","path":"Lustra/TSVector/Lexem.html","kind":"struct","full_name":"Lustra::TSVector::Lexem","name":"Lexem","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"WEIGHTS","name":"WEIGHTS","value":"['A', 'B', 'C', 'D']"}],"namespace":{"html_id":"lustra/Lustra/TSVector","kind":"class","full_name":"Lustra::TSVector","name":"TSVector"},"constructors":[{"html_id":"new(io)-class-method","name":"new","abstract":false,"args":[{"name":"io","external_name":"io","restriction":""}],"args_string":"(io)","args_html":"(io)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":10,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L10"},"def":{"name":"new","args":[{"name":"io","external_name":"io","restriction":""}],"visibility":"Public","body":"_ = allocate\n_.initialize(io)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"positions:Array(Position)-instance-method","name":"positions","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":6,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L6"},"def":{"name":"positions","return_type":"Array(Position)","visibility":"Public","body":"@positions"},"external_var":false},{"html_id":"value:String-instance-method","name":"value","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":5,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L5"},"def":{"name":"value","return_type":"String","visibility":"Public","body":"@value"},"external_var":false}],"types":[{"html_id":"lustra/Lustra/TSVector/Lexem/Position","path":"Lustra/TSVector/Lexem/Position.html","kind":"struct","full_name":"Lustra::TSVector::Lexem::Position","name":"Position","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L3"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra/TSVector/Lexem","kind":"struct","full_name":"Lustra::TSVector::Lexem","name":"Lexem"},"constructors":[{"html_id":"new(weight:Char,position:UInt16)-class-method","name":"new","abstract":false,"args":[{"name":"weight","external_name":"weight","restriction":"Char"},{"name":"position","external_name":"position","restriction":"UInt16"}],"args_string":"(weight : Char, position : UInt16)","args_html":"(weight : <a href=\"../../../Char.html\">Char</a>, position : UInt16)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L3"},"def":{"name":"new","args":[{"name":"weight","external_name":"weight","restriction":"Char"},{"name":"position","external_name":"position","restriction":"UInt16"}],"visibility":"Public","body":"_ = allocate\n_.initialize(weight, position)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"clone-instance-method","name":"clone","abstract":false,"location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L3"},"def":{"name":"clone","visibility":"Public","body":"self.class.new(@weight.clone, @position.clone)"},"external_var":false},{"html_id":"copy_with(weight_weight=@weight,position_position=@position)-instance-method","name":"copy_with","abstract":false,"args":[{"name":"_weight","default_value":"@weight","external_name":"weight","restriction":""},{"name":"_position","default_value":"@position","external_name":"position","restriction":""}],"args_string":"(weight _weight = @weight, position _position = @position)","args_html":"(weight _weight = @weight, position _position = @position)","location":{"filename":"src/lustra/extensions/full_text_searchable/tsvector.cr","line_number":3,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/full_text_searchable/tsvector.cr#L3"},"def":{"name":"copy_with","args":[{"name":"_weight","default_value":"@weight","external_name":"weight","restriction":""},{"name":"_position","default_value":"@position","external_name":"position","restriction":""}],"visibility":"Public","body":"self.class.new(_weight, _position)"},"external_var":false},{"html_id":"position:UInt16-instance-method","name":"position","abstract":false,"def":{"name":"position","return_type":"UInt16","visibility":"Public","body":"@position"},"external_var":false},{"html_id":"weight:Char-instance-method","name":"weight","abstract":false,"def":{"name":"weight","return_type":"Char","visibility":"Public","body":"@weight"},"external_var":false}]}]}]},{"html_id":"lustra/Lustra/Util","path":"Lustra/Util.html","kind":"module","full_name":"Lustra::Util","name":"Util","abstract":false,"locations":[{"filename":"src/lustra/util.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/util.cr#L2"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"extended_modules":[{"html_id":"lustra/Lustra/Util","kind":"module","full_name":"Lustra::Util","name":"Util"}],"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"A set of method(s) useful for building Lustra ORM.","summary":"<p>A set of method(s) useful for building Lustra ORM.</p>","instance_methods":[{"html_id":"hash_union(h1:Hash(A,B),h2:Hash(C,D))forallA,B,C,D-instance-method","name":"hash_union","doc":"Return a new hash which is union of two hash (some kind of deep merge)","summary":"<p>Return a new hash which is union of two hash (some kind of deep merge)</p>","abstract":false,"args":[{"name":"h1","external_name":"h1","restriction":"Hash(A, B)"},{"name":"h2","external_name":"h2","restriction":"Hash(C, D)"}],"args_string":"(h1 : Hash(A, B), h2 : Hash(C, D)) forall A, B, C, D","args_html":"(h1 : Hash(A, B), h2 : Hash(C, D)) forall A, B, C, D","location":{"filename":"src/lustra/util.cr","line_number":12,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/util.cr#L12"},"def":{"name":"hash_union","args":[{"name":"h1","external_name":"h1","restriction":"Hash(A, B)"},{"name":"h2","external_name":"h2","restriction":"Hash(C, D)"}],"visibility":"Public","body":"o = Hash(A | C, B | D).new\n\nh1.each do |k, v|\n  o[k] = v\nend\n\nh2.each do |k, v|\n  case v\n  when Hash\n    if (v1 = o[k]).is_a?(Hash)\n      o[k] = hash_union(v1, v)\n    else\n      o[k] = v\n    end\n  else\n    o[k] = v\n  end\nend\n\no\n"},"external_var":false},{"html_id":"lambda(u:U.class,v:V.class,&block:U->V)forallU,V-instance-method","name":"lambda","doc":"Equivalent to ruby's lambda with one parameter.\nThis method is useful combined with the macro system of Crystal.","summary":"<p>Equivalent to ruby's lambda with one parameter.</p>","abstract":false,"args":[{"name":"u","external_name":"u","restriction":"U.class"},{"name":"v","external_name":"v","restriction":"V.class"}],"args_string":"(u : U.class, v : V.class, &block : U -> V) forall U, V","args_html":"(u : <span class=\"t\">U</span>.<span class=\"k\">class</span>, v : <span class=\"t\">V</span>.<span class=\"k\">class</span>, &block : U -> V) forall U, V","location":{"filename":"src/lustra/util.cr","line_number":7,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/util.cr#L7"},"def":{"name":"lambda","args":[{"name":"u","external_name":"u","restriction":"U.class"},{"name":"v","external_name":"v","restriction":"V.class"}],"yields":1,"block_arity":1,"block_arg":{"name":"block","external_name":"block","restriction":"(U -> V)"},"visibility":"Public","body":"block"},"external_var":false}]},{"html_id":"lustra/Lustra/Validation","path":"Lustra/Validation.html","kind":"module","full_name":"Lustra::Validation","name":"Validation","abstract":false,"locations":[{"filename":"src/lustra/model/validation/helper.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/validation/helper.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"types":[{"html_id":"lustra/Lustra/Validation/Helper","path":"Lustra/Validation/Helper.html","kind":"module","full_name":"Lustra::Validation::Helper","name":"Helper","abstract":false,"locations":[{"filename":"src/lustra/model/validation/helper.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/validation/helper.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"including_types":[{"html_id":"lustra/Lustra/Model/HasValidation","kind":"module","full_name":"Lustra::Model::HasValidation","name":"HasValidation"}],"namespace":{"html_id":"lustra/Lustra/Validation","kind":"module","full_name":"Lustra::Validation","name":"Validation"},"macros":[{"html_id":"ensure_than(field,message,&block)-macro","name":"ensure_than","doc":"Usage example:\n\n```\nensure_than email, \"must be an email\" do |v|\n  EmailRegexp.valid?(v)\nend\n```","summary":"<p>Usage example:</p>","abstract":false,"args":[{"name":"field","external_name":"field","restriction":""},{"name":"message","external_name":"message","restriction":""}],"args_string":"(field, message, &block)","args_html":"(field, message, &block)","location":{"filename":"src/lustra/model/validation/helper.cr","line_number":15,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/validation/helper.cr#L15"},"def":{"name":"ensure_than","args":[{"name":"field","external_name":"field","restriction":""},{"name":"message","external_name":"message","restriction":""}],"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"    if \n{{ field.id }}\n_column.defined?\n      o = \n{{ field.id }}\n\n\n      fn = Lustra::Util.lambda(typeof(o), Object) \n{{ block }}\n\n\n      unless fn.call(o)\n        add_error(\n{{ field.stringify }}\n, \n{{ message }}\n)\n      \nend\n    \nend\n\n  \n"}},{"html_id":"on_presence(*fields,&block)-macro","name":"on_presence","abstract":false,"args":[{"name":"fields","external_name":"fields","restriction":""}],"args_string":"(*fields, &block)","args_html":"(*fields, &block)","location":{"filename":"src/lustra/model/validation/helper.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/model/validation/helper.cr#L2"},"def":{"name":"on_presence","args":[{"name":"fields","external_name":"fields","restriction":""}],"splat_index":0,"block_arg":{"name":"block","external_name":"block","restriction":""},"visibility":"Public","body":"    if \n{{ (fields.map do |x| \"self.#{x.id}_column.defined?\" end.join(\" && \")).id }}\n\n      \n{{ yield }}\n\n    \nend\n  \n"}}]}]},{"html_id":"lustra/Lustra/View","path":"Lustra/View.html","kind":"class","full_name":"Lustra::View","name":"View","abstract":false,"superclass":{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"lustra/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/view/base.cr","line_number":48,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L48"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"lustra/Lustra","kind":"module","full_name":"Lustra","name":"Lustra"},"doc":"Create and maintain your database views directly in the code.\n\nYou could use the migration system to create and drop your views. However this\nis proven to be difficult, even more if you want to update a view which depends on\nanother subviews.\n\n## How it works ?\n\nWhen you migrate using the migration system, all the views registered\nare going to be destroyed and recreated again.\nOrder of creation depends of the requirement for each views\n\n## Example\n\n```\nLustra::View.register :room_per_days do |view|\n  view.require(:rooms, :year_days)\n\n  view.query <<-SQL\n    SELECT room_id, day\n    FROM year_days\n    CROSS JOIN rooms\n  SQL\nend\n\nLustra::View.register :rooms do |view|\n  view.query <<-SQL\n  SELECT room.id AS room_id\n  FROM generate_series(1, 4) AS room(id)\n  SQL\nend\n\nLustra::View.register :year_days do |view|\n  view.query <<-SQL\n  SELECT date.day::date AS day\n  FROM   generate_series(\n    date_trunc('day', NOW()),\n    date_trunc('day', NOW() + INTERVAL '364 days'),\n    INTERVAL '1 day'\n  ) AS date(day)\n  SQL\nend\n```\n\nIn the example above, room_per_days will be first dropped before a migration\nstart and last created after the migration finished, to prevent issue where some\nviews are linked to others","summary":"<p>Create and maintain your database views directly in the code.</p>","class_methods":[{"html_id":"apply(direction:Symbol,view_name:String,apply_cache:Set(String))-class-method","name":"apply","doc":"install the view into postgresql using CREATE VIEW","summary":"<p>install the view into postgresql using CREATE VIEW</p>","abstract":false,"args":[{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"view_name","external_name":"view_name","restriction":"String"},{"name":"apply_cache","external_name":"apply_cache","restriction":"Set(String)"}],"args_string":"(direction : Symbol, view_name : String, apply_cache : Set(String))","args_html":"(direction : Symbol, view_name : String, apply_cache : Set(String))","location":{"filename":"src/lustra/view/base.cr","line_number":76,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L76"},"def":{"name":"apply","args":[{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"view_name","external_name":"view_name","restriction":"String"},{"name":"apply_cache","external_name":"apply_cache","restriction":"Set(String)"}],"visibility":"Public","body":"if apply_cache.includes?(view_name)\n  return\nend\n\nview = @@views[view_name]\nview.requirement.each do |dep_view| apply(direction, dep_view, apply_cache) end\n\nLustra::SQL.execute(view.connection, direction == (:drop) ? view.to_drop_sql : view.to_create_sql)\napply_cache << view_name\n"},"external_var":false},{"html_id":"apply(direction:Symbol,apply_cache=Set(String).new)-class-method","name":"apply","doc":"install the view into postgresql using CREATE VIEW","summary":"<p>install the view into postgresql using CREATE VIEW</p>","abstract":false,"args":[{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"apply_cache","default_value":"Set(String).new","external_name":"apply_cache","restriction":""}],"args_string":"(direction : Symbol, apply_cache = Set(String).new)","args_html":"(direction : Symbol, apply_cache = <span class=\"t\">Set</span>(<span class=\"t\">String</span>).new)","location":{"filename":"src/lustra/view/base.cr","line_number":68,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L68"},"def":{"name":"apply","args":[{"name":"direction","external_name":"direction","restriction":"Symbol"},{"name":"apply_cache","default_value":"Set(String).new","external_name":"apply_cache","restriction":""}],"visibility":"Public","body":"@@views.values.each do |view|\n  if apply_cache.includes?(view.name)\n    next\n  end\n  apply(direction, view.name, apply_cache)\nend"},"external_var":false},{"html_id":"register(name:Lustra::SQL::Symbolic,&)-class-method","name":"register","doc":"Call the DSL to register a new view\n\n```\nLustra::View.register(:name) do |view|\n  # describe the view here.\nend\n```","summary":"<p>Call the DSL to register a new view</p>","abstract":false,"args":[{"name":"name","external_name":"name","restriction":"Lustra::SQL::Symbolic"}],"args_string":"(name : Lustra::SQL::Symbolic, &)","args_html":"(name : <a href=\"../Lustra/SQL/Symbolic.html\">Lustra::SQL::Symbolic</a>, &)","location":{"filename":"src/lustra/view/base.cr","line_number":56,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L56"},"def":{"name":"register","args":[{"name":"name","external_name":"name","restriction":"Lustra::SQL::Symbolic"}],"yields":1,"block_arity":1,"visibility":"Public","body":"view = Lustra::View.new\nview.name(name)\nyield view\n\nif view.name == \"\"\n  raise(\"Your view need to have a name\")\nend\nif view.query == \"\"\n  raise(\"View `#{view.name}` need to have a query body\")\nend\n\n@@views[view.name] = view\n"},"external_var":false}],"instance_methods":[{"html_id":"connection(connection:String)-instance-method","name":"connection","doc":"database connection where is installed the view","summary":"<p>database connection where is installed the view</p>","abstract":false,"args":[{"name":"connection","external_name":"connection","restriction":"String"}],"args_string":"(connection : String)","args_html":"(connection : String)","location":{"filename":"src/lustra/view/base.cr","line_number":118,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L118"},"def":{"name":"connection","args":[{"name":"connection","external_name":"connection","restriction":"String"}],"visibility":"Public","body":"@connection = connection"},"external_var":false},{"html_id":"connection:String-instance-method","name":"connection","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":99,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L99"},"def":{"name":"connection","return_type":"String","visibility":"Public","body":"@connection"},"external_var":false},{"html_id":"full_name-instance-method","name":"full_name","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":137,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L137"},"def":{"name":"full_name","visibility":"Public","body":"{@schema, @name}.join(\".\") do |x| Lustra::SQL.escape(x) end"},"external_var":false},{"html_id":"materialized(mat:Bool)-instance-method","name":"materialized","doc":"whether the view is materialized or not. I would recommend to use\nmigration execute create/drop whenever the view is a materialized view","summary":"<p>whether the view is materialized or not.</p>","abstract":false,"args":[{"name":"mat","external_name":"mat","restriction":"Bool"}],"args_string":"(mat : Bool)","args_html":"(mat : Bool)","location":{"filename":"src/lustra/view/base.cr","line_number":124,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L124"},"def":{"name":"materialized","args":[{"name":"mat","external_name":"mat","restriction":"Bool"}],"visibility":"Public","body":"@materialized = mat"},"external_var":false},{"html_id":"materialized?:Bool-instance-method","name":"materialized?","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":100,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L100"},"def":{"name":"materialized?","return_type":"Bool","visibility":"Public","body":"@materialized"},"external_var":false},{"html_id":"name(value:String|Symbol)-instance-method","name":"name","doc":"name of the view","summary":"<p>name of the view</p>","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"String | Symbol"}],"args_string":"(value : String | Symbol)","args_html":"(value : String | Symbol)","location":{"filename":"src/lustra/view/base.cr","line_number":103,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L103"},"def":{"name":"name","args":[{"name":"value","external_name":"value","restriction":"String | Symbol"}],"visibility":"Public","body":"@name = value.to_s"},"external_var":false},{"html_id":"name:String-instance-method","name":"name","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":95,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L95"},"def":{"name":"name","return_type":"String","visibility":"Public","body":"@name"},"external_var":false},{"html_id":"query(query:String)-instance-method","name":"query","doc":"query body related to the view. Must be a SELECT clause","summary":"<p>query body related to the view.</p>","abstract":false,"args":[{"name":"query","external_name":"query","restriction":"String"}],"args_string":"(query : String)","args_html":"(query : String)","location":{"filename":"src/lustra/view/base.cr","line_number":113,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L113"},"def":{"name":"query","args":[{"name":"query","external_name":"query","restriction":"String"}],"visibility":"Public","body":"@query = query"},"external_var":false},{"html_id":"query:String-instance-method","name":"query","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":97,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L97"},"def":{"name":"query","return_type":"String","visibility":"Public","body":"@query"},"external_var":false},{"html_id":"require(*req)-instance-method","name":"require","doc":"list of dependencies from the other view related to this view","summary":"<p>list of dependencies from the other view related to this view</p>","abstract":false,"args":[{"name":"req","external_name":"req","restriction":""}],"args_string":"(*req)","args_html":"(*req)","location":{"filename":"src/lustra/view/base.cr","line_number":129,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L129"},"def":{"name":"require","args":[{"name":"req","external_name":"req","restriction":""}],"splat_index":0,"visibility":"Public","body":"req.map(&.to_s).each do |s| @requirement.add(s) end"},"external_var":false},{"html_id":"requirement:Set(String)-instance-method","name":"requirement","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":98,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L98"},"def":{"name":"requirement","visibility":"Public","body":"@requirement"},"external_var":false},{"html_id":"schema(value:String|Symbol)-instance-method","name":"schema","doc":"schema to store the view (default public)","summary":"<p>schema to store the view (default public)</p>","abstract":false,"args":[{"name":"value","external_name":"value","restriction":"String | Symbol"}],"args_string":"(value : String | Symbol)","args_html":"(value : String | Symbol)","location":{"filename":"src/lustra/view/base.cr","line_number":108,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L108"},"def":{"name":"schema","args":[{"name":"value","external_name":"value","restriction":"String | Symbol"}],"visibility":"Public","body":"@schema = value.to_s"},"external_var":false},{"html_id":"schema:String-instance-method","name":"schema","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":96,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L96"},"def":{"name":"schema","return_type":"String","visibility":"Public","body":"@schema"},"external_var":false},{"html_id":"to_create_sql-instance-method","name":"to_create_sql","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":141,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L141"},"def":{"name":"to_create_sql","visibility":"Public","body":"{\"CREATE OR REPLACE\", (materialized? ? \"MATERIALIZED VIEW\" : \"VIEW\"), full_name, \"AS (\", @query, \")\"}.join(' ')"},"external_var":false},{"html_id":"to_drop_sql-instance-method","name":"to_drop_sql","abstract":false,"location":{"filename":"src/lustra/view/base.cr","line_number":133,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/view/base.cr#L133"},"def":{"name":"to_drop_sql","visibility":"Public","body":"\"DROP VIEW IF EXISTS #{@name}\""},"external_var":false}]}]},{"html_id":"lustra/Slice","path":"Slice.html","kind":"struct","full_name":"Slice(T)","name":"Slice","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Indexable/Mutable","kind":"module","full_name":"Indexable::Mutable","name":"Mutable"},{"html_id":"lustra/Indexable","kind":"module","full_name":"Indexable","name":"Indexable"},{"html_id":"lustra/Enumerable","kind":"module","full_name":"Enumerable","name":"Enumerable"},{"html_id":"lustra/Iterable","kind":"module","full_name":"Iterable","name":"Iterable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/core_ext.cr","line_number":109,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L109"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Indexable/Mutable","kind":"module","full_name":"Indexable::Mutable","name":"Mutable"}],"doc":"A `Slice` is a `Pointer` with an associated size.\n\nWhile a pointer is unsafe because no bound checks are performed when reading from and writing to it,\nreading from and writing to a slice involve bound checks.\nIn this way, a slice is a safe alternative to `Pointer`.\n\nA Slice can be created as read-only: trying to write to it\nwill raise. For example the slice of bytes returned by\n`String#to_slice` is read-only.","summary":"<p>A <code><a href=\"Slice.html\">Slice</a></code> is a <code>Pointer</code> with an associated size.</p>","instance_methods":[{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/extensions/core_ext.cr","line_number":110,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/core_ext.cr#L110"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(Base64.strict_encode(to_s))"},"external_var":false}]},{"html_id":"lustra/Time","path":"Time.html","kind":"struct","full_name":"Time","name":"Time","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Steppable","kind":"module","full_name":"Steppable","name":"Steppable"},{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L1"},{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Steppable","kind":"module","full_name":"Steppable","name":"Steppable"}],"doc":"`Time` represents a date-time instant in\n[incremental time](https://www.w3.org/International/articles/definitions-time/#incremental_time)\nobserved in a specific time zone.\n\nThe calendaric calculations are based on the rules of the proleptic Gregorian\ncalendar as specified in [ISO 8601](https://web.archive.org/web/20250306154328/http://xml.coverpages.org/ISO-FDIS-8601.pdf).\nLeap seconds are ignored.\n\nInternally, the time is stored as an `Int64` representing seconds from epoch\n(`0001-01-01 00:00:00Z`) and an `Int32` representing\nnanosecond-of-second with value range `0..999_999_999`.\n\nThe supported date range is `0001-01-01 00:00:00.0` to\n`9999-12-31 23:59:59.999_999_999` in any local time zone.\n\n### Telling the Time\n\nThere are several methods to retrieve a `Time` instance representing the\ncurrent time:\n\n```\nTime.utc                                        # returns the current time in UTC\nTime.local Time::Location.load(\"Europe/Berlin\") # returns the current time in time zone Europe/Berlin\nTime.local                                      # returns the current time in current time zone\n```\n\nIt is generally recommended to keep instances in UTC and only apply a\nlocal time zone when formatting for user display, unless the domain logic\nrequires having a specific time zone (for example for calendaric operations).\n\n### Creating a Specific Instant\n\n`Time` instances representing a specific instant can be created by\n`.utc` or `.new` with the date-time specified as individual arguments:\n\n```\ntime = Time.utc(2016, 2, 15, 10, 20, 30)\ntime.to_s # => \"2016-02-15 10:20:30 UTC\"\ntime = Time.local(2016, 2, 15, 10, 20, 30, location: Time::Location.load(\"Europe/Berlin\"))\ntime.to_s # => \"2016-02-15 10:20:30 +01:00\"\n# The time-of-day can be omitted and defaults to midnight (start of day):\ntime = Time.utc(2016, 2, 15)\ntime.to_s # => \"2016-02-15 00:00:00 UTC\"\n```\n\n### Retrieving Time Information\n\nEach `Time` instance allows querying calendar data:\n\n```\ntime = Time.utc(2016, 2, 15, 10, 20, 30)\ntime.year        # => 2016\ntime.month       # => 2\ntime.day         # => 15\ntime.hour        # => 10\ntime.minute      # => 20\ntime.second      # => 30\ntime.millisecond # => 0\ntime.nanosecond  # => 0\ntime.day_of_week # => Time::DayOfWeek::Monday\ntime.day_of_year # => 46\ntime.monday?     # => true\ntime.time_of_day # => 10:20:30\n```\n\nFor querying if a time is at a specific day of week, `Time` offers named\npredicate methods, delegating to `#day_of_week`:\n\n```\ntime.monday? # => true\n# ...\ntime.sunday? # => false\n```\n\n### Time Zones\n\nEach time is attached to a specific time zone, represented by a `Location`\n(see `#location`).\n`#zone` returns the time zone observed in this location at the current time\n(i.e. the instant represented by this `Time`).\n`#offset` returns the offset of the current zone in seconds.\n\n```\ntime = Time.local(2018, 3, 8, 22, 5, 13, location: Time::Location.load(\"Europe/Berlin\"))\ntime          # => 2018-03-08 22:05:13+01:00[Europe/Berlin]\ntime.location # => #<Time::Location Europe/Berlin>\ntime.zone     # => #<Time::Location::Zone CET +01:00 (3600s) STD>\ntime.offset   # => 3600\n```\n\nUsing `.utc`, the location is `Time::Location::UTC`:\n\n```\ntime = Time.utc(2018, 3, 8, 22, 5, 13)\ntime          # => 2018-03-08 22:05:13Z\ntime.location # => #<Time::Location UTC>\ntime.zone     # => #<Time::Location::Zone UTC +00:00 (0s) STD>\ntime.offset   # => 0\n```\n\nA `Time` instance can be transformed to a different time zone while retaining\nthe same instant using `#in`:\n\n```\ntime_de = Time.local(2018, 3, 8, 22, 5, 13, location: Time::Location.load(\"Europe/Berlin\"))\ntime_ar = time_de.in Time::Location.load(\"America/Argentina/Buenos_Aires\")\ntime_de # => 2018-03-08 22:05:13+01:00[Europe/Berlin]\ntime_ar # => 2018-03-08 18:05:13-03:00[America/Argentina/Buenos_Aires]\n```\n\nBoth `Time` instances show a different local date-time, but they represent\nthe same date-time in the instant time-line, therefore they are considered\nequal:\n\n```\ntime_de.to_utc     # => 2018-03-08 21:05:13Z\ntime_ar.to_utc     # => 2018-03-08 21:05:13Z\ntime_de == time_ar # => true\n```\n\nThere are also two special methods for converting to UTC and local time zone:\n\n```\ntime.to_utc   # equals time.in(Location::UTC)\ntime.to_local # equals time.in(Location.local)\n```\n\n`#to_local_in` allows changing the time zone while keeping\nthe same local date-time (wall clock) which results in a different instant\non the time line.\n\n### Formatting and Parsing Time\n\nTo make date-time instances exchangeable between different computer systems\nor readable to humans, they are usually converted to and from a string\nrepresentation.\n\nThe method `#to_s` formats the date-time according to a specified pattern.\n\n```\ntime = Time.utc(2015, 10, 12, 10, 30, 0)\ntime.to_s(\"%Y-%m-%d %H:%M:%S %:z\") # => \"2015-10-12 10:30:00 +00:00\"\n```\n\nSimilarly, `Time.parse` and `Time.parse!` are used to construct a `Time` instance from date-time\ninformation in a string, according to a specified pattern:\n\n```\nTime.parse(\"2015-10-12 10:30:00 +00:00\", \"%Y-%m-%d %H:%M:%S %z\", Time::Location::UTC)\nTime.parse!(\"2015-10-12 10:30:00 +00:00\", \"%Y-%m-%d %H:%M:%S %z\")\n```\n\nSee `Time::Format` for all directives.\n\n### Calculations\n\n```\nTime.utc(2015, 10, 10) - 5.days # => 2015-10-05 00:00:00 +00:00\n\nspan = Time.utc(2015, 10, 10) - Time.utc(2015, 9, 10)\nspan.days          # => 30\nspan.total_hours   # => 720\nspan.total_minutes # => 43200\n```\n\n## Measuring Time\n\nThe typical time representation provided by the operating system is based on\na \"wall clock\" which is subject to changes for clock synchronization.\nThis can result in discontinuous jumps in the time-line making it not\nsuitable for accurately measuring elapsed time.\n\nInstances of `Time` are focused on telling time – using a \"wall clock\".\nWhen `Time.local` is called multiple times, the difference between the\nreturned instances is not guaranteed to equal to the time elapsed between\nmaking the calls; even the order of the returned `Time` instances might\nnot reflect invocation order.\n\n```\nt1 = Time.utc\n# operation that takes 1 minute\nt2 = Time.utc\nt2 - t1 # => ?\n```\n\nThe resulting `Time::Span` could be anything, even negative, if the\ncomputer's wall clock has changed between both calls.\n\nAs an alternative, the operating system also provides a monotonic clock.\nIts time-line has no specified starting point but is strictly linearly\nincreasing.\n\nThis monotonic clock should always be used for measuring elapsed time.\n\nA reading from this clock can be taken using `.monotonic`:\n\n```\nt1 = Time.monotonic\n# operation that takes 1 minute\nt2 = Time.monotonic\nt2 - t1 # => 1.minute (approximately)\n```\n\nThe execution time of a block can be measured using `.measure`:\n\n```\nelapsed_time = Time.measure do\n  # operation that takes 20 milliseconds\nend\nelapsed_time # => 20.milliseconds (approximately)\n```","summary":"<p><code><a href=\"Time.html\">Time</a></code> represents a date-time instant in <a href=\"https://www.w3.org/International/articles/definitions-time/#incremental_time\">incremental time</a> observed in a specific time zone.</p>","instance_methods":[{"html_id":"+(interval:Lustra::Interval)-instance-method","name":"+","abstract":false,"args":[{"name":"interval","external_name":"interval","restriction":"Lustra::Interval"}],"args_string":"(interval : Lustra::Interval)","args_html":"(interval : <a href=\"Lustra/Interval.html\">Lustra::Interval</a>)","location":{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L2"},"def":{"name":"+","args":[{"name":"interval","external_name":"interval","restriction":"Lustra::Interval"}],"visibility":"Public","body":"[interval.months.months, interval.days.days, interval.hours.hours, interval.minutes.minutes, interval.seconds.seconds, interval.milliseconds.milliseconds, interval.microseconds.microseconds].reduce(self) do |acc, e| acc + e end"},"external_var":false},{"html_id":"+(time_in_day:Lustra::TimeInDay)-instance-method","name":"+","abstract":false,"args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"}],"args_string":"(time_in_day : Lustra::TimeInDay)","args_html":"(time_in_day : <a href=\"Lustra/TimeInDay.html\">Lustra::TimeInDay</a>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L14"},"def":{"name":"+","args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"}],"visibility":"Public","body":"self + time_in_day.microseconds.microseconds"},"external_var":false},{"html_id":"-(interval:Lustra::Interval)-instance-method","name":"-","abstract":false,"args":[{"name":"interval","external_name":"interval","restriction":"Lustra::Interval"}],"args_string":"(interval : Lustra::Interval)","args_html":"(interval : <a href=\"Lustra/Interval.html\">Lustra::Interval</a>)","location":{"filename":"src/lustra/extensions/interval/interval_converter.cr","line_number":14,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/interval/interval_converter.cr#L14"},"def":{"name":"-","args":[{"name":"interval","external_name":"interval","restriction":"Lustra::Interval"}],"visibility":"Public","body":"[interval.months.months, interval.days.days, interval.hours.hours, interval.minutes.minutes, interval.seconds.seconds, interval.milliseconds.milliseconds, interval.microseconds.microseconds].reduce(self) do |acc, e| acc - e end"},"external_var":false},{"html_id":"-(time_in_day:Lustra::TimeInDay)-instance-method","name":"-","abstract":false,"args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"}],"args_string":"(time_in_day : Lustra::TimeInDay)","args_html":"(time_in_day : <a href=\"Lustra/TimeInDay.html\">Lustra::TimeInDay</a>)","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":18,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L18"},"def":{"name":"-","args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"}],"visibility":"Public","body":"self - time_in_day.microseconds.microseconds"},"external_var":false},{"html_id":"at(time_in_day:Lustra::TimeInDay,timezone=nil):Time-instance-method","name":"at","abstract":false,"args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"},{"name":"timezone","default_value":"nil","external_name":"timezone","restriction":""}],"args_string":"(time_in_day : Lustra::TimeInDay, timezone = nil) : Time","args_html":"(time_in_day : <a href=\"Lustra/TimeInDay.html\">Lustra::TimeInDay</a>, timezone = <span class=\"n\">nil</span>) : <a href=\"Time.html\">Time</a>","location":{"filename":"src/lustra/extensions/time_in_days/time_in_day_converter.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/time_in_days/time_in_day_converter.cr#L2"},"def":{"name":"at","args":[{"name":"time_in_day","external_name":"time_in_day","restriction":"Lustra::TimeInDay"},{"name":"timezone","default_value":"nil","external_name":"timezone","restriction":""}],"return_type":"Time","visibility":"Public","body":"if timezone\n  if timezone.is_a?(String)\n    timezone = Time::Location.load(timezone)\n  end\n\n  (self.in(timezone)).at_beginning_of_day + time_in_day.microseconds.microseconds\nelse\n  at_beginning_of_day + time_in_day.microseconds.microseconds\nend"},"external_var":false}]},{"html_id":"lustra/UUID","path":"UUID.html","kind":"struct","full_name":"UUID","name":"UUID","abstract":false,"superclass":{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"},{"html_id":"lustra/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"lustra/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"lustra/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/lustra/extensions/uuid/uuid.cr","line_number":1,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/uuid/uuid.cr#L1"}],"repository_name":"lustra","program":false,"enum":false,"alias":false,"const":false,"included_modules":[{"html_id":"lustra/Comparable","kind":"module","full_name":"Comparable","name":"Comparable"}],"doc":"Represents a UUID (Universally Unique IDentifier).\n\nNOTE: To use `UUID`, you must explicitly import it with `require \"uuid\"`","summary":"<p>Represents a UUID (Universally Unique IDentifier).</p>","instance_methods":[{"html_id":"to_json(json:JSON::Builder)-instance-method","name":"to_json","abstract":false,"args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"args_string":"(json : JSON::Builder)","args_html":"(json : JSON::Builder)","location":{"filename":"src/lustra/extensions/uuid/uuid.cr","line_number":2,"url":"https://github.com/crystal-garage/lustra/blob/a1021aef1ec35416184320deb48ca3b55575a92a/src/lustra/extensions/uuid/uuid.cr#L2"},"def":{"name":"to_json","args":[{"name":"json","external_name":"json","restriction":"JSON::Builder"}],"visibility":"Public","body":"json.string(to_s)"},"external_var":false}]}]}})